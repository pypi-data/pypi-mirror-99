# For more information about tox, see https://tox.readthedocs.io/en/latest/
[tox]
minversion = 3.20
isolated_build = true
envlist =
    py35-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.50, 0.5x, 0.60, 0.6x, 0.70, 0.7x, 0.80, 0.8x}
    py36-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.50, 0.5x, 0.60, 0.6x, 0.70, 0.7x, 0.80, 0.8x}
    py37-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.50, 0.5x, 0.60, 0.6x, 0.70, 0.7x, 0.80, 0.8x}
    py38-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.71, 0.7x, 0.80, 0.8x}
    py39-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.78, 0.7x, 0.80, 0.8x}
    publish
    static

[gh-actions]
python =
    3.5: py35-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.50, 0.5x, 0.60, 0.6x, 0.70, 0.7x, 0.80, 0.8x}
    3.6: py36-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.50, 0.5x, 0.60, 0.6x, 0.70, 0.7x, 0.80, 0.8x}
    3.7: py37-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.50, 0.5x, 0.60, 0.6x, 0.70, 0.7x, 0.80, 0.8x}
    3.8: py38-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.71, 0.7x, 0.80, 0.8x}, publish, static
    3.9: py39-pytest{3.5, 3.x, 4.0, 4.x, 5.0, 5.x, 6.0, 6.x}-mypy{0.78, 0.7x, 0.80, 0.8x}

[testenv]
deps =
    pytest3.5: pytest ~= 3.5.0
    pytest3.5: pytest-cov ~= 2.5.1
    pytest3.5: pytest-randomly ~= 2.1.1
    pytest3.5: pytest-xdist < 1.19.0
    pytest3.6: pytest ~= 3.6.0
    pytest3.6: pytest-cov ~= 2.5.1
    pytest3.6: pytest-randomly ~= 2.1.1
    pytest3.6: pytest-xdist < 1.28.0
    pytest3.7: pytest ~= 3.7.0
    pytest3.7: pytest-cov ~= 2.5.1
    pytest3.7: pytest-randomly ~= 2.1.1
    pytest3.7: pytest-xdist < 1.28.0
    pytest3.8: pytest ~= 3.8.0
    pytest3.8: pytest-cov ~= 2.5.1
    pytest3.8: pytest-randomly ~= 2.1.1
    pytest3.8: pytest-xdist < 1.28.0
    pytest3.9: pytest ~= 3.9.0
    pytest3.9: pytest-cov ~= 2.5.1
    pytest3.9: pytest-randomly ~= 2.1.1
    pytest3.9: pytest-xdist < 1.28.0
    pytest3.10: pytest ~= 3.10.0
    pytest3.10: pytest-cov ~= 2.5.1
    pytest3.10: pytest-randomly ~= 2.1.1
    pytest3.10: pytest-xdist < 1.28.0
    pytest3.x: pytest ~= 3.5
    pytest3.x: pytest-cov ~= 2.5.1
    pytest3.x: pytest-randomly ~= 2.1.1
    pytest3.x: pytest-xdist < 1.28.0
    pytest4.0: attrs < 19.2.0  # https://github.com/pytest-dev/pytest/issues/5900
    pytest4.0: pytest ~= 4.0.0
    pytest4.0: pytest-cov ~= 2.5.1
    pytest4.0: pytest-randomly ~= 2.1.1
    pytest4.0: pytest-xdist < 1.28.0
    pytest4.1: attrs < 19.2.0  # https://github.com/pytest-dev/pytest/issues/5900
    pytest4.1: pytest ~= 4.1.0
    pytest4.1: pytest-cov ~= 2.5.1
    pytest4.1: pytest-randomly ~= 2.1.1
    pytest4.1: pytest-xdist < 1.28.0
    pytest4.2: attrs < 19.2.0  # https://github.com/pytest-dev/pytest/issues/5900
    pytest4.2: pytest-cov ~= 2.5.1
    pytest4.2: pytest-randomly ~= 2.1.1
    pytest4.2: pytest ~= 4.2.0
    pytest4.2: pytest-xdist < 1.28.0
    pytest4.3: pytest ~= 4.3.0
    pytest4.3: pytest-cov ~= 2.5.1
    pytest4.3: pytest-randomly ~= 2.1.1
    pytest4.3: pytest-xdist < 1.28.0
    pytest4.4: pytest ~= 4.4.0
    pytest4.4: pytest-cov ~= 2.5.1
    pytest4.4: pytest-randomly ~= 2.1.1
    pytest4.4: pytest-xdist ~= 1.0, < 1.30.0  # https://github.com/pytest-dev/pytest-xdist/issues/472
    pytest4.5: pytest ~= 4.5.0
    pytest4.5: pytest-cov ~= 2.5.1
    pytest4.5: pytest-randomly ~= 2.1.1
    pytest4.5: pytest-xdist ~= 1.0, < 1.30.0  # https://github.com/pytest-dev/pytest-xdist/issues/472
    pytest4.6: pytest ~= 4.6.0
    pytest4.6: pytest-cov ~= 2.5.1
    pytest4.6: pytest-randomly ~= 2.1.1
    pytest4.6: pytest-xdist ~= 1.0, < 1.30.0  # https://github.com/pytest-dev/pytest-xdist/issues/472
    pytest4.x: pytest ~= 4.0
    pytest4.x: pytest-cov ~= 2.5.1
    pytest4.x: pytest-randomly ~= 2.1.1
    pytest4.x: pytest-xdist ~= 1.0, < 1.30.0  # https://github.com/pytest-dev/pytest-xdist/issues/472
    pytest5.0: pytest ~= 5.0.0
    pytest5.0: pytest-cov ~= 2.5.1
    pytest5.0: pytest-randomly ~= 2.1.1
    pytest5.0: pytest-xdist ~= 1.0, < 1.30.0  # https://github.com/pytest-dev/pytest-xdist/issues/472
    pytest5.x: pytest ~= 5.0
    pytest5.x: pytest-cov ~= 2.5.1
    pytest5.x: pytest-randomly ~= 2.1.1
    pytest5.x: pytest-xdist ~= 1.0, < 1.30.0  # https://github.com/pytest-dev/pytest-xdist/issues/472
    pytest6.0: pytest ~= 6.0.0
    pytest6.0: pytest-cov ~= 2.10
    pytest6.0: pytest-randomly ~= 3.4
    pytest6.0: pytest-xdist ~= 2.0
    pytest6.x: pytest ~= 6.0
    pytest6.x: pytest-cov ~= 2.10
    pytest6.x: pytest-randomly ~= 3.4
    pytest6.x: pytest-xdist ~= 2.0
    mypy0.50: mypy >= 0.500, < 0.510
    mypy0.51: mypy >= 0.510, < 0.520
    mypy0.52: mypy >= 0.520, < 0.530
    mypy0.53: mypy >= 0.530, < 0.540
    mypy0.54: mypy >= 0.540, < 0.550
    mypy0.55: mypy >= 0.550, < 0.560
    mypy0.56: mypy >= 0.560, < 0.570
    mypy0.57: mypy >= 0.570, < 0.580
    mypy0.58: mypy >= 0.580, < 0.590
    mypy0.59: mypy >= 0.590, < 0.600
    mypy0.5x: mypy >= 0.500, < 0.600
    mypy0.60: mypy >= 0.600, < 0.610
    mypy0.61: mypy >= 0.610, < 0.620
    mypy0.62: mypy >= 0.620, < 0.630
    mypy0.63: mypy >= 0.630, < 0.640
    mypy0.64: mypy >= 0.640, < 0.650
    mypy0.65: mypy >= 0.650, < 0.660
    mypy0.66: mypy >= 0.660, < 0.670
    mypy0.67: mypy >= 0.670, < 0.680
    mypy0.6x: mypy >= 0.600, < 0.700
    mypy0.70: mypy >= 0.700, < 0.710
    mypy0.71: mypy >= 0.710, < 0.720
    mypy0.72: mypy >= 0.720, < 0.730
    mypy0.73: mypy >= 0.730, < 0.740
    mypy0.74: mypy >= 0.740, < 0.750
    mypy0.75: mypy >= 0.750, < 0.760
    mypy0.76: mypy >= 0.760, < 0.770
    mypy0.77: mypy >= 0.770, < 0.780
    mypy0.78: mypy >= 0.780, < 0.790
    mypy0.79: mypy >= 0.790, < 0.800
    mypy0.7x: mypy >= 0.700, < 0.800
    mypy0.80: mypy >= 0.800, < 0.810
    mypy0.81: mypy >= 0.810, < 0.820
    mypy0.8x: mypy >= 0.800, < 0.900

    pexpect ~= 4.8.0

commands = py.test -p no:mypy {posargs:--cov pytest_mypy --cov-fail-under 100 --cov-report term-missing -n auto}

[pytest]
testpaths = tests

[testenv:publish]
passenv = TWINE_*
deps =
    build ~= 0.3.0
    twine ~= 3.3.0
commands =
    {envpython} -m build --outdir {distdir} .
    twine {posargs:check} {distdir}/*

[testenv:static]
deps =
    bandit ~= 1.7.0
    black ~= 20.8b
    flake8 ~= 3.8.3
    flake8-commas ~= 2.0.0
    mypy >= 0.810, < 0.820
commands =
    black --check src setup.py tests
    flake8 src setup.py tests
    mypy src setup.py
    bandit --recursive src setup.py

[flake8]
max-line-length = 88
extend-ignore = E203
