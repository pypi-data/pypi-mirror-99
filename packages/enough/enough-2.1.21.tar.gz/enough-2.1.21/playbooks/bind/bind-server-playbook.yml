---
- name: setup DNS server
  hosts: bind-service-group
  become: true

  roles:
    - role: bind
      bind_zone_name: "test.{{ domain }}"
      bind_zone:
        - |
          $ORIGIN test.{{ domain }}.
          $TTL 1W

          @ IN SOA test.{{ domain }}. hostmaster.{{ domain }}. (
          {{ bind_timestamp.stdout }}
          1D
          1H
          1W
          1D )

                     IN  NS     {{ bind_ns_host }}.{{ domain }}.
          @ 1800 IN A {{ ansible_host }}

    - role: bind
      bind_zone_name: "d.{{ domain }}"
      bind_zone:
        - |
          $ORIGIN d.{{ domain }}.
          $TTL 1W

          @ IN SOA d.{{ domain }}. hostmaster.{{ domain }}. (
          {{ bind_timestamp.stdout }}
          1D
          1H
          1W
          1D )

                     IN  NS     {{ bind_ns_host }}.{{ domain }}.
          @ 1800 IN A {{ ansible_host }}
