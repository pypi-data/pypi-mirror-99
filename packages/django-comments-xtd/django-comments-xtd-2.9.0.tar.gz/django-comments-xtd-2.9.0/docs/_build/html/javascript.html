

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>JavaScript plugin &mdash; django-comments-xtd 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Filters and template tags" href="templatetags.html" />
    <link rel="prev" title="Web API" href="webapi.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> django-comments-xtd
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Demo projects</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="logic.html">Control logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapi.html">Web API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">JavaScript plugin</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#frontend-opinions">Frontend opinions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-process">Build process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-up-the-backend">Set up the backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-frontend-packages">Install frontend packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#code-structure">Code structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#improvements-and-contributions">Improvements and contributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="templatetags.html">Filters and template tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrating.html">Migrating to django-comments-xtd</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Customizing django-comments-xtd</a></li>
<li class="toctree-l1"><a class="reference internal" href="i18n.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use cases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">django-comments-xtd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>JavaScript plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/javascript.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="javascript-plugin">
<span id="ref-javascript"></span><h1>JavaScript plugin<a class="headerlink" href="#javascript-plugin" title="Permalink to this headline">¶</a></h1>
<p>As of version 2.0 django-comments-xtd comes with a JavaScript plugin that
enables comment support as in a Single Page Application fashion. Comments are
loaded and sent in the background, as long as like/dislike opinions. There is
an active verification, based on polling, that checks whether there are new
incoming comments to show to the user, and an update button that allows the
user to refresh the tree, highlighting new comments with a green label to
indicate recently received comment entries.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Future v3 of django-comments-xtd will offer a vanilla JavaScript plugin
free of frontend choices, to replace the current plugin based on ReactJS,
jQuery and Twitter-bootstrap.</p>
</div>
<img alt="_images/update-comment-tree.png" src="_images/update-comment-tree.png" />
<p>This plugin is done by making choices that might not be the same you made in
your own projects.</p>
<div class="section" id="frontend-opinions">
<h2>Frontend opinions<a class="headerlink" href="#frontend-opinions" title="Permalink to this headline">¶</a></h2>
<p>Django is a backend framework imposing little opinions regarding the frontend.
It merely uses jQuery in the admin site. Nothing more. That leaves developers
the choice to pick anything they want for the frontend to go along with the
backend.</p>
<p>For backend developers the level of stability found in Python and Django
contrasts with the active diversity of JavaScript libraries available for the
frontend.</p>
<p>The JavaScript plugin included in the app is a mix of frontend decisions with
the goal to provide a quick and full frontend solution. Doing so the app is
ready to be plugged in a large number of backend projects, and in a reduced set
of frontend stacks.</p>
<dl class="simple">
<dt>The JavaScript Plugin is based on:</dt><dd><ul class="simple">
<li><p>ReactJS</p></li>
<li><p>jQuery (merely for Ajax)</p></li>
<li><p>Remarkable (for Markdown markup support)</p></li>
<li><p>Twitter-bootstrap (for the UI and the tooltip utility)</p></li>
</ul>
</dd>
</dl>
<p>The build process is based on Webpack2 instead of any other as good a tool
available in the JavaScript building tools landscape.</p>
<p>The decision of building a plugin based on these choices doesn’t mean there
can’t be other ones. The project is open to improve its own range of JavaScript
plugins through contributions. If you feel like improving the current plugin or
providing additional ones, please, consider to integrate it using Webpack2 and
try to keep the source code tree as clean and structured as possible.</p>
</div>
<div class="section" id="build-process">
<h2>Build process<a class="headerlink" href="#build-process" title="Permalink to this headline">¶</a></h2>
<p>In order to further develop the current plugin, fix potential bugs or install
the the plugin from the sources, you have to use <a class="reference external" href="https://nodejs.org/en/">NodeJS</a> and <a class="reference external" href="https://www.npmjs.com/">NPM</a>.</p>
<div class="section" id="set-up-the-backend">
<h3>Set up the backend<a class="headerlink" href="#set-up-the-backend" title="Permalink to this headline">¶</a></h3>
<p>Before installing the frontend dependencies we will prepare a Python virtualenv
in which we will have all the backend dependencies installed. Let’s start by
creating the virtualenv and fetching the sources:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ virtualenv ~/venv/django-comments-xtd
$ <span class="nb">source</span> ~/venv/django-comments-xtd/bin/activate
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ <span class="nb">cd</span> ~/src/  <span class="c1"># or cd into your sources dir of choice.</span>
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ git clone https://github.com/danirus/django-comments-xtd.git
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ <span class="nb">cd</span> django-comments-xtd
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ python setup.py develop
</pre></div>
</div>
</div></blockquote>
<p>Check whether the app passes the battery of tests:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>django-comments-xtd<span class="o">)</span>$ python setup.py <span class="nb">test</span>
</pre></div>
</div>
</div></blockquote>
<p>As the sample Django project you can use the <strong>comp</strong> example site. Install
first the django-markdown2 package (required by the comp example project) and
setup the project:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>django-comments-xtd<span class="o">)</span>$ <span class="nb">cd</span> example/comp
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ pip install django-markdown2
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ pip install django-rosetta
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ python manage.py migrate
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ python manage.py loaddata ../fixtures/auth.json
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ python manage.py loaddata ../fixtures/sites.json
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ python manage.py loaddata ../fixtures/articles.json
<span class="o">(</span>django-comments-xtd<span class="o">)</span>$ python manage.py runserver
</pre></div>
</div>
</div></blockquote>
<p>Now the project is ready and the plugin will load from the existing bundle
files. Check it out by visiting an article’s page and sending some comments. No
frontend source package has been installed so far.</p>
</div>
<div class="section" id="install-frontend-packages">
<h3>Install frontend packages<a class="headerlink" href="#install-frontend-packages" title="Permalink to this headline">¶</a></h3>
<p>At this point open another terminal and cd into django-comments-xtd source
directory again, then install all the frontend dependencies:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/src/django-comments-xtd
$ npm install
</pre></div>
</div>
</div></blockquote>
<p>It will install all the dependencies listed in the <strong>package.json</strong> file in the
local <cite>node_modules</cite> directory. Once it’s finished run webpack to build the
bundles and watch for changes in the source tree:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ webpack --watch
</pre></div>
</div>
</div></blockquote>
<p>Webpack will put the bundles in the static directory of django-comments-xtd and
Django will fetch them from there when rendering the article’s detail page:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra-js</span> <span class="cp">%}</span>
[...]
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;django_comments_xtd/js/vendor~plugin-3.0.0.js&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;django_comments_xtd/js/plugin-3.0.0.js&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">extra-js</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="code-structure">
<h2>Code structure<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>Plugin sources live inside the <strong>static</strong> directory of django-comments-xtd:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/src/django-comments-xtd
$ tree django_comments_xtd/static/django_comments_xtd/js

django_comments_xtd/static/django_comments_xtd/js
├── src
│   ├── comment.jsx
│   ├── commentbox.jsx
│   ├── commentform.jsx
│   ├── index.js
│   └── lib.js
├── vendor~plugin-3.0.0.js
└── plugin-3.0.0.js

<span class="m">1</span> directory, <span class="m">7</span> files
</pre></div>
</div>
</div></blockquote>
<p>The intial development was inspired by the <a class="reference external" href="https://github.com/facebook/react/blob/v15.3.2/docs/docs/tutorial.md">ReactJS Comment Box tutorial</a>.
Component names reflect those of the ReactJS tutorial.</p>
<p>The application entry point is located inside the <code class="docutils literal notranslate"><span class="pre">index.js</span></code> file. The
<code class="docutils literal notranslate"><span class="pre">props</span></code> passed to the <strong>CommentBox</strong> object are those declared in the
<code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">window.comments_props</span></code> defined in the django template:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">comments_props</span> <span class="o">=</span> <span class="cp">{%</span> <span class="k">get_commentbox_props</span> <span class="nv">for</span> <span class="nv">object</span> <span class="cp">%}</span><span class="p">;</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">comments_props_override</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">allow_comments</span><span class="o">:</span> <span class="cp">{%</span><span class="k">if</span> <span class="nv">object.allow_comments</span><span class="cp">%}</span><span class="nx">true</span><span class="cp">{%</span><span class="k">else</span><span class="cp">%}</span><span class="nx">false</span><span class="cp">{%</span><span class="k">endif</span><span class="cp">%}</span><span class="p">,</span>
    <span class="nx">allow_feedback</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">show_feedback</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">allow_flagging</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">polling_interval</span><span class="o">:</span> <span class="mi">2000</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>And are overriden by those declared in the
<code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">window.comments_props_override</span></code>.</p>
<p>To use without the template, you can set up an endpoint to get the props by
generating a view action within the <a class="reference internal" href="webapi.html"><span class="doc">Web API</span></a>.</p>
</div>
<div class="section" id="improvements-and-contributions">
<h2>Improvements and contributions<a class="headerlink" href="#improvements-and-contributions" title="Permalink to this headline">¶</a></h2>
<p>The current ReactJS plugin could be ported to an <a class="reference external" href="https://infernojs.org/">Inferno</a> plugin within a reasonable timeframe. Inferno offers
a lighter footprint compared to ReactJS plus it is among the faster JavaScript
frontend frameworks.</p>
<p>Another improvement pending for implementation would be a websocket based
update. At the moment comment updates are received by active polling. See
<code class="docutils literal notranslate"><span class="pre">commentbox.jsx</span></code>, method <strong>load_count</strong> of the <strong>CommentBox</strong> component.</p>
<p>Contributions are welcome, write me an email at <a class="reference external" href="mailto:mbox&#37;&#52;&#48;danir&#46;us">mbox<span>&#64;</span>danir<span>&#46;</span>us</a> or open an issue
in the <a class="reference external" href="https://github.com/danirus/django-comments-xtd">GitHub repository</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="templatetags.html" class="btn btn-neutral float-right" title="Filters and template tags" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="webapi.html" class="btn btn-neutral float-left" title="Web API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Daniel Rus Morales

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>