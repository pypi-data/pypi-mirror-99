

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; django-comments-xtd 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Demo projects" href="example.html" />
    <link rel="prev" title="Quick start guide" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> django-comments-xtd
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comment-confirmation">Comment confirmation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#comments-tags">Comments tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#moderation">Moderation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#disallow-black-listed-domains">Disallow black listed domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="#moderate-on-bad-words">Moderate on bad words</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#threads">Threads</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#different-max-thread-levels">Different max thread levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-nested-count-field">The <code class="docutils literal notranslate"><span class="pre">nested_count</span></code> field</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#flags">Flags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#commenting-options">Commenting options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#removal-suggestion">Removal suggestion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#getting-notifications">Getting notifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#liked-it-disliked-it">Liked it, Disliked it</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#show-the-list-of-users">Show the list of users</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#markdown">Markdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="#javascript-plugin">JavaScript plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enable-web-api">Enable Web API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enable-app-model-options">Enable app.model options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-i18n-javascript-catalog">The i18n JavaScript Catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-the-plugin">Load the plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#final-notes">Final notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Demo projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="logic.html">Control logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapi.html">Web API</a></li>
<li class="toctree-l1"><a class="reference internal" href="javascript.html">JavaScript plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="templatetags.html">Filters and template tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrating.html">Migrating to django-comments-xtd</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Customizing django-comments-xtd</a></li>
<li class="toctree-l1"><a class="reference internal" href="i18n.html">Internationalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use cases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">django-comments-xtd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<span id="ref-tutorial"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial guides you through the steps to use every feature of
django-comments-xtd together with the <a class="reference external" href="https://github.com/django/django-contrib-comments">Django Comments Framework</a>. The Django project
used throughout the tutorial is available to <a class="reference external" href="https://github.com/danirus/django-comments-xtd/raw/master/example/tutorial.tar.gz">download</a>. Following the tutorial will take
about an hour, and it is highly recommended to get a comprehensive
understanding of django-comments-xtd.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id5">Introduction</a></p></li>
<li><p><a class="reference internal" href="#preparation" id="id6">Preparation</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id7">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#comment-confirmation" id="id8">Comment confirmation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#comments-tags" id="id9">Comments tags</a></p></li>
<li><p><a class="reference internal" href="#moderation" id="id10">Moderation</a></p>
<ul>
<li><p><a class="reference internal" href="#disallow-black-listed-domains" id="id11">Disallow black listed domains</a></p></li>
<li><p><a class="reference internal" href="#moderate-on-bad-words" id="id12">Moderate on bad words</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#threads" id="id13">Threads</a></p>
<ul>
<li><p><a class="reference internal" href="#different-max-thread-levels" id="id14">Different max thread levels</a></p></li>
<li><p><a class="reference internal" href="#the-nested-count-field" id="id15">The <code class="docutils literal notranslate"><span class="pre">nested_count</span></code> field</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#flags" id="id16">Flags</a></p>
<ul>
<li><p><a class="reference internal" href="#commenting-options" id="id17">Commenting options</a></p></li>
<li><p><a class="reference internal" href="#removal-suggestion" id="id18">Removal suggestion</a></p>
<ul>
<li><p><a class="reference internal" href="#getting-notifications" id="id19">Getting notifications</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#liked-it-disliked-it" id="id20">Liked it, Disliked it</a></p>
<ul>
<li><p><a class="reference internal" href="#show-the-list-of-users" id="id21">Show the list of users</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#markdown" id="id22">Markdown</a></p></li>
<li><p><a class="reference internal" href="#javascript-plugin" id="id23">JavaScript plugin</a></p>
<ul>
<li><p><a class="reference internal" href="#enable-web-api" id="id24">Enable Web API</a></p></li>
<li><p><a class="reference internal" href="#enable-app-model-options" id="id25">Enable app.model options</a></p></li>
<li><p><a class="reference internal" href="#the-i18n-javascript-catalog" id="id26">The i18n JavaScript Catalog</a></p></li>
<li><p><a class="reference internal" href="#load-the-plugin" id="id27">Load the plugin</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#final-notes" id="id28">Final notes</a></p></li>
</ul>
</div>
<div class="section" id="introduction">
<span id="index-0"></span><h2><a class="toc-backref" href="#id5">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Through the following sections the tutorial will cover the creation of a
simple blog with stories to which we will add comments, exercising each and
every feature provided by both, django-comments and django-comments-xtd,
from comment post verification by mail to comment moderation and nested
comments.</p>
</div>
<div class="section" id="preparation">
<span id="index-1"></span><h2><a class="toc-backref" href="#id6">Preparation</a><a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>Before we install any package we will set up a virtualenv and install
everything we need in it.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir ~/django-comments-xtd-tutorial
$ <span class="nb">cd</span> ~/django-comments-xtd-tutorial
$ virtualenv venv
$ <span class="nb">source</span> venv/bin/activate
<span class="o">(</span>venv<span class="o">)</span>$ pip install django-comments-xtd
<span class="o">(</span>venv<span class="o">)</span>$ wget https://github.com/danirus/django-comments-xtd/raw/master/example/tutorial.tar.gz
<span class="o">(</span>venv<span class="o">)</span>$ tar -xvzf tutorial.tar.gz
<span class="o">(</span>venv<span class="o">)</span>$ <span class="nb">cd</span> tutorial
</pre></div>
</div>
</div></blockquote>
<p>By installing django-comments-xtd we install all its dependencies, Django and
django-contrib-comments among them. So we are ready to work on the project.
Take a look at the content of the tutorial directory, it contains:</p>
<blockquote>
<div><ul class="simple">
<li><p>A <strong>blog</strong> app with a <strong>Post</strong> model. It uses two generic class-based views
to list the posts and show a post in detail.</p></li>
<li><p>The <strong>templates</strong> directory, with a <strong>base.html</strong> and <strong>home.html</strong>, and
the templates for the blog app: <strong>blog/post_list.html</strong> and
<strong>blog/post_detail.html</strong>.</p></li>
<li><p>The <strong>static</strong> directory with a <strong>css/bootstrap.min.css</strong> file (this file
is a static asset available, when the app is installed, under the path
<strong>django_comments_xtd/css/bootstrap.min.css</strong>).</p></li>
<li><p>The <strong>tutorial</strong> directory containing the <strong>settings</strong> and <strong>urls</strong> modules.</p></li>
<li><p>And a <strong>fixtures</strong> directory with data files to create the <em>admin</em> superuser
(with <em>admin</em> password), the default site and some blog posts.</p></li>
</ul>
</div></blockquote>
<p>Let’s finish the initial setup, load the fixtures and run the development
server:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>venv<span class="o">)</span>$ python manage.py migrate
<span class="o">(</span>venv<span class="o">)</span>$ python manage.py loaddata fixtures/*.json
<span class="o">(</span>venv<span class="o">)</span>$ python manage.py runserver
</pre></div>
</div>
</div></blockquote>
<p>Head to <a class="reference external" href="http://localhost:8000">http://localhost:8000</a> and visit the tutorial site.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to implement the <cite>get_absolute_url</cite> in the model class whose
objects you want to receive comments, like the class <cite>Post</cite> in this
tutorial. It is so because the permanent URL of each comment uses the
<cite>shortcut</cite> view of <cite>django.contrib.contenttypes</cite> which in turn uses
the <cite>get_absolute_url</cite> method.</p>
</div>
</div>
<div class="section" id="configuration">
<span id="id1"></span><h2><a class="toc-backref" href="#id7">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Now that the project is running we are ready to add comments. Edit the settings
module, <code class="docutils literal notranslate"><span class="pre">tutorial/settings.py</span></code>, and make the following changes:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s1">&#39;django_comments_xtd&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django_comments&#39;</span><span class="p">,</span>
    <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="o">...</span>
<span class="n">COMMENTS_APP</span> <span class="o">=</span> <span class="s1">&#39;django_comments_xtd&#39;</span>

<span class="c1"># Either enable sending mail messages to the console:</span>
<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.console.EmailBackend&#39;</span>

<span class="c1"># Or set up the EMAIL_* settings so that Django can send emails:</span>
<span class="n">EMAIL_HOST</span> <span class="o">=</span> <span class="s2">&quot;smtp.mail.com&quot;</span>
<span class="n">EMAIL_PORT</span> <span class="o">=</span> <span class="s2">&quot;587&quot;</span>
<span class="n">EMAIL_HOST_USER</span> <span class="o">=</span> <span class="s2">&quot;alias@mail.com&quot;</span>
<span class="n">EMAIL_HOST_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;yourpassword&quot;</span>
<span class="n">EMAIL_USE_TLS</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">DEFAULT_FROM_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;Helpdesk &lt;helpdesk@yourdomain&gt;&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Edit the urls module of the project, <code class="docutils literal notranslate"><span class="pre">tutorial/tutorial/urls.py</span></code> and mount
the URL patterns of django_comments_xtd in the path <code class="docutils literal notranslate"><span class="pre">/comments/</span></code>. The urls
installed with django_comments_xtd include django_comments’ urls too:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;comments/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;django_comments_xtd.urls&#39;</span><span class="p">)),</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>Now let Django create the tables for the two new applications:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python manage.py migrate
</pre></div>
</div>
</div></blockquote>
<p>Be sure that the domain field of the <code class="docutils literal notranslate"><span class="pre">Site</span></code> instance points to the correct
domain, which for the development server is expected to be  <code class="docutils literal notranslate"><span class="pre">localhost:8000</span></code>.
The value is used to create comment verifications, follow-up cancellations,
etc. Edit the site instance in the admin interface in case you were using a
different value.</p>
<div class="section" id="comment-confirmation">
<h3><a class="toc-backref" href="#id8">Comment confirmation</a><a class="headerlink" href="#comment-confirmation" title="Permalink to this headline">¶</a></h3>
<p>Before we go any further we need to set up the <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_SALT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_SALT</span></code></a>
setting. This setting plays an important role during the comment confirmation
by mail. It helps obfuscating the comment before the user approves its
publication.</p>
<p>It is so because django-comments-xtd does not store comments in the server
until they have been confirmed. This way there is little to none possible
comment spam flooding in the database. Comments are encoded in URLs and sent
for confirmation by mail. Only when the user clicks the confirmation URL the
comment lands in the database.</p>
<p>This behaviour is disabled for authenticated users, and can be disabled for
anonymous users too by simply setting <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_CONFIRM_EMAIL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_CONFIRM_EMAIL</span></code></a> to
<code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>Now let’s append the following entries to the tutorial settings module:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#  To help obfuscating comments before they are sent for confirmation.</span>
<span class="n">COMMENTS_XTD_SALT</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Timendi causa est nescire. &quot;</span>
                     <span class="sa">b</span><span class="s2">&quot;Aequam memento rebus in arduis servare mentem.&quot;</span><span class="p">)</span>

<span class="c1"># Source mail address used for notifications.</span>
<span class="n">COMMENTS_XTD_FROM_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;noreply@example.com&quot;</span>

<span class="c1"># Contact mail address to show in messages.</span>
<span class="n">COMMENTS_XTD_CONTACT_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;helpdesk@example.com&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="comments-tags">
<h2><a class="toc-backref" href="#id9">Comments tags</a><a class="headerlink" href="#comments-tags" title="Permalink to this headline">¶</a></h2>
<p>Next step consist of editing <code class="docutils literal notranslate"><span class="pre">blog/post_detail.html</span></code> and loading the
<code class="docutils literal notranslate"><span class="pre">comments</span></code> templatetag module after the <code class="docutils literal notranslate"><span class="pre">extends</span></code> tag:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">comments</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
<p>Now we will change the blog post detail template to:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Show the number of comments posted to the blog story,</p></li>
<li><p>List the comments already posted, and</p></li>
<li><p>Show the comment form, so that comments can be sent.</p></li>
</ol>
</div></blockquote>
<p>By using the <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-get_comment_count" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">get_comment_count</span></code></a> tag we will show the number of comments
posted. Change the code around the link element to make it look as follows:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">get_comment_count</span> <span class="nv">for</span> <span class="nv">object</span> <span class="k">as</span> <span class="nv">comment_count</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;py-4 text-center&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:post-list&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>Back to the post list<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="ni">&amp;nbsp;&amp;sdot;&amp;nbsp;</span>
  <span class="cp">{{</span> <span class="nv">comment_count</span> <span class="cp">}}</span> comment<span class="cp">{{</span> <span class="nv">comment_count</span><span class="o">|</span><span class="nf">pluralize</span> <span class="cp">}}</span>
  ha<span class="cp">{{</span> <span class="nv">comment_count</span><span class="o">|</span><span class="nf">pluralize</span><span class="s2">:&quot;s,ve&quot;</span> <span class="cp">}}</span> been posted.
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Now let’s add the code to list the comments posted to the story. We can make
use of two template tags, <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-render_comment_list" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_comment_list</span></code></a> and
<a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-get_comment_list" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">get_comment_list</span></code></a>. The former renders a template with the comments
while the latter put the comment list in a variable in the context of the
template.</p>
<p>When using the first, <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-render_comment_list" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_comment_list</span></code></a>, with a <code class="docutils literal notranslate"><span class="pre">blog.post</span></code> object,
Django will look for the template <code class="docutils literal notranslate"><span class="pre">list.html</span></code> in the following directories:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>comments/blog/post/list.html
comments/blog/list.html
comments/list.html
</pre></div>
</div>
</div></blockquote>
<p>Both, django-contrib-comments and django-comments-xtd, provide the last template
of the list, <code class="docutils literal notranslate"><span class="pre">comments/list.html</span></code>. The one provided within
django-comments-xtd comes with styling based on <a class="reference external" href="http://getbootstrap.com">twitter-bootstrap</a>.</p>
<p>Django will use the first template found depending on the order in which
applications are listed in <a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-INSTALLED_APPS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a>. In this tutorial
django-comments-xtd is listed first and therefore its <code class="docutils literal notranslate"><span class="pre">comment/list.html</span></code>
template will be found first.</p>
<p>Let’s modify the <code class="docutils literal notranslate"><span class="pre">blog/post_detail.html</span></code> template to make use of the
<a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-render_comment_list" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_comment_list</span></code></a>. Add the following code at the end of the page,
before the <code class="docutils literal notranslate"><span class="pre">endblock</span></code> tag:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">comment_count</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">hr</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;comments&quot;</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">render_comment_list</span> <span class="nv">for</span> <span class="nv">object</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
<p>Below the list of comments we want to display the comment form. There are two
template tags available for that purpose, the <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-render_comment_form" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_comment_form</span></code></a> and
the <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-get_comment_form" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">get_comment_form</span></code></a>. The former renders a template with the comment
form while the latter puts the form in the context of the template giving more
control over the fields.</p>
<p>We will use the first tag, <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/quickstart.html#std:templatetag-render_comment_form" title="(in Django Comments v1.8)"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_comment_form</span></code></a>. Again, add the
following code before the <code class="docutils literal notranslate"><span class="pre">endblock</span></code> tag:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">object.allow_comments</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card card-block mb-5&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h4</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title text-center pb-3&quot;</span><span class="p">&gt;</span>Post your comment<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
      <span class="cp">{%</span> <span class="k">render_comment_form</span> <span class="nv">for</span> <span class="nv">object</span> <span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">object.allow_comments</span> <span class="pre">%}</span></code> and corresponding <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endif</span> <span class="pre">%}</span></code> are not necessary in your code. I use it in this tutorial (and in the demo sites) as a way to disable comments whenever the author of a blog post decides so. It has been mentioned <a class="reference external" href="https://github.com/danirus/django-comments-xtd/issues/108">here</a> too.</p>
</div>
<p>Finally, before completing this first set of changes, we could show the number
of comments along with post titles in the blog’s home page. For this we have to
edit <code class="docutils literal notranslate"><span class="pre">blog/post_list.html</span></code> and make the following changes:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">comments</span> <span class="cp">%}</span>

...
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">object</span> <span class="k">in</span> <span class="nv">object_list</span> <span class="cp">%}</span>
    ...
    <span class="cp">{%</span> <span class="k">get_comment_count</span> <span class="nv">for</span> <span class="nv">object</span> <span class="k">as</span> <span class="nv">comment_count</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;date&quot;</span><span class="p">&gt;</span>Published <span class="cp">{{</span> <span class="nv">object.publish</span> <span class="cp">}}</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">comment_count</span> <span class="cp">%}</span>
      <span class="ni">&amp;sdot;&amp;nbsp;</span><span class="cp">{{</span> <span class="nv">comment_count</span> <span class="cp">}}</span> comment<span class="cp">{{</span> <span class="nv">comment_count</span><span class="o">|</span><span class="nf">pluralize</span> <span class="cp">}}</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    ...
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
<p>Now we are ready to send comments. If you are logged in in the admin site, your
comments won’t need to be confirmed by mail. To test the confirmation URL do
logout of the admin interface. Bear in mind that <a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-EMAIL_BACKEND" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">EMAIL_BACKEND</span></code></a> is set
up to send mail messages to the console, so look in the console after you post
the comment and find the first long URL in the message. To confirm the comment
copy the link and paste it in the location bar of the browser.</p>
<img alt="_images/comments-enabled.png" src="_images/comments-enabled.png" />
<p>The setting <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL</span></code></a> is <code class="docutils literal notranslate"><span class="pre">0</span></code> by default, which
means comments can not be nested. Later in the threads section we will enable
nested comments. Now we will set up comment moderation.</p>
</div>
<div class="section" id="moderation">
<span id="index-2"></span><span id="id2"></span><h2><a class="toc-backref" href="#id10">Moderation</a><a class="headerlink" href="#moderation" title="Permalink to this headline">¶</a></h2>
<p>One of the differences between django-comments-xtd and other commenting
applications is the fact that by default it requires comment confirmation by
email when users are not logged in, a very effective feature to discard unwanted
comments. However there might be cases in which you would prefer a different
approach. Django Comments Framework comes with <a class="reference external" href="http://django-contrib-comments.readthedocs.io/en/latest/moderation.html">moderation capabilities</a>
included upon which you can build your own comment filtering.</p>
<p>Comment moderation is often established to fight spam, but may be used for other
purposes, like triggering actions based on comment content, rejecting comments
based on how old is the subject being commented and whatnot.</p>
<p>In this section we want to set up comment moderation for our blog application,
so that comments sent to a blog post older than a year will be automatically
flagged for moderation. Also we want Django to send an email to registered
<a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-MANAGERS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MANAGERS</span></code></a> of the project when the comment is flagged.</p>
<p>Let’s start adding our email address to the <a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-MANAGERS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MANAGERS</span></code></a> in the
<code class="docutils literal notranslate"><span class="pre">tutorial/settings.py</span></code> module:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MANAGERS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;Joe Bloggs&#39;</span><span class="p">,</span> <span class="s1">&#39;joe.bloggs@example.com&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Now we will create a new <code class="docutils literal notranslate"><span class="pre">Moderator</span></code> class that inherits from Django Comments
Frammework’s <code class="docutils literal notranslate"><span class="pre">CommentModerator</span></code>. This class enables moderation by defining a
number of class attributes. Read more about it in <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/moderation.html#moderation-options">moderation options</a>, in the official documentation of the Django Comments
Framework.</p>
<p>We will also register our <code class="docutils literal notranslate"><span class="pre">Moderator</span></code> class with the django-comments-xtd’s
<code class="docutils literal notranslate"><span class="pre">moderator</span></code> object. We use django-comments-xtd’s object instead of
django-contrib-comments’ because we still want to have confirmation by email
for non-registered users, nested comments, follow-up notifications, etc.</p>
<p>Let’s add those changes to the <code class="docutils literal notranslate"><span class="pre">blog/model.py</span></code> file:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1"># Append these imports below the current ones.</span>
<span class="kn">from</span> <span class="nn">django_comments.moderation</span> <span class="kn">import</span> <span class="n">CommentModerator</span>
<span class="kn">from</span> <span class="nn">django_comments_xtd.moderation</span> <span class="kn">import</span> <span class="n">moderator</span>

<span class="o">...</span>

<span class="c1"># Add this code at the end of the file.</span>
<span class="k">class</span> <span class="nc">PostCommentModerator</span><span class="p">(</span><span class="n">CommentModerator</span><span class="p">):</span>
    <span class="n">email_notification</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">auto_moderate_field</span> <span class="o">=</span> <span class="s1">&#39;publish&#39;</span>
    <span class="n">moderate_after</span> <span class="o">=</span> <span class="mi">365</span>


<span class="n">moderator</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostCommentModerator</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>That makes it, moderation is ready. Visit any of the blog posts with a
<code class="docutils literal notranslate"><span class="pre">publish</span></code> datetime older than a year and try to send a comment. After
confirming the comment you will see the <code class="docutils literal notranslate"><span class="pre">django_comments_xtd/moderated.html</span></code>
template, and your comment will be put on hold for approval.</p>
<p>If on the other hand you send a comment to a blog post created within the last
year your comment will not be put in moderation. Give it a try as a logged in
user and as an anonymous user.</p>
<p>When sending a comment as a logged-in user the comment won’t have to be
confirmed and will be put in moderation immediately. However, when you send it
as an anonymous user the comment will have to be confirmed by clicking on the
confirmation link, immediately after that the comment will be put on hold
pending for approval.</p>
<p>In both cases, due to the attribute <code class="docutils literal notranslate"><span class="pre">email_notification</span> <span class="pre">=</span> <span class="pre">True</span></code> above, all
mail addresses listed in the <a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-MANAGERS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MANAGERS</span></code></a> setting will receive a
notification about the reception of a new comment. If you did not received
such message, you might need to review your email settings, or the console
output. Read about the mail settings above in the <a class="reference internal" href="#configuration"><span class="std std-ref">Configuration</span></a> section.
The mail message received is based on the
<code class="docutils literal notranslate"><span class="pre">comments/comment_notification_email.txt</span></code> template provided with
django-comments-xtd.</p>
<p>A last note on comment moderation: comments pending for moderation have to be
reviewed and eventually approved. Don’t forget to visit the comments-xtd app in
the <a class="reference external" href="http://localhost:8000/admin/">admin</a> interface. Filter comments by <cite>is public: No</cite> and <cite>is removed: No</cite>.
Tick the box of those you want to approve, choose <strong>Approve selected comments</strong>
in the <strong>action</strong> dropdown, at the top left of the comment list, and click on
the <strong>Go</strong> button.</p>
<div class="section" id="disallow-black-listed-domains">
<span id="disallow"></span><h3><a class="toc-backref" href="#id11">Disallow black listed domains</a><a class="headerlink" href="#disallow-black-listed-domains" title="Permalink to this headline">¶</a></h3>
<p>In case you wanted to disable comment confirmation by mail you might want to
set up some sort of control to reject spam.</p>
<p>This section goes through the steps to disable comment confirmation while
enabling a comment filtering solution based on Joe Wein’s <a class="reference external" href="http://www.joewein.net/spam/blacklist.htm">blacklist</a> of
spamming domains. We will also add a moderation function that will put in
moderation comments containing <a class="reference external" href="https://gist.github.com/ryanlewis/a37739d710ccdb4b406d">badwords</a>.</p>
<p>Let us first disable comment confirmation. Edit the <code class="docutils literal notranslate"><span class="pre">tutorial/settings.py</span></code>
file and add:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_CONFIRM_EMAIL</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div></blockquote>
<p>django-comments-xtd comes with a <strong>Moderator</strong> class that inherits from
<code class="docutils literal notranslate"><span class="pre">CommentModerator</span></code> and implements a method <code class="docutils literal notranslate"><span class="pre">allow</span></code> that will do the
filtering for us. We just have to change <code class="docutils literal notranslate"><span class="pre">blog/models.py</span></code> and replace
<code class="docutils literal notranslate"><span class="pre">CommentModerator</span></code> with <code class="docutils literal notranslate"><span class="pre">SpamModerator</span></code>, as follows:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the CommentModerator imports and leave only this:</span>
<span class="kn">from</span> <span class="nn">django_comments_xtd.moderation</span> <span class="kn">import</span> <span class="n">moderator</span><span class="p">,</span> <span class="n">SpamModerator</span>

<span class="c1"># Our class Post PostCommentModerator now inherits from SpamModerator</span>
<span class="k">class</span> <span class="nc">PostCommentModerator</span><span class="p">(</span><span class="n">SpamModerator</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">moderator</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostCommentModerator</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Now we can add a domain to the <code class="docutils literal notranslate"><span class="pre">BlackListed</span></code> model in the <a class="reference external" href="http://localhost:8000/admin/">admin</a> interface.
Or we could download a <a class="reference external" href="http://www.joewein.net/spam/blacklist.htm">blacklist</a> from Joe Wein’s website and load the table
with actual spamming domains.</p>
<p>Once we have a <code class="docutils literal notranslate"><span class="pre">BlackListed</span></code> domain, try to send a new comment and use an
email address with such a domain. Be sure to log out before trying, otherwise
django-comments-xtd will use the logged in user credentials and ignore the
email given in the comment form.</p>
<p>Sending a comment with an email address of the blacklisted domain triggers a
<strong>Comment post not allowed</strong> response, which would have been a HTTP 400 Bad
Request response with <code class="docutils literal notranslate"><span class="pre">DEBUG</span> <span class="pre">=</span> <span class="pre">False</span></code> in production.</p>
</div>
<div class="section" id="moderate-on-bad-words">
<h3><a class="toc-backref" href="#id12">Moderate on bad words</a><a class="headerlink" href="#moderate-on-bad-words" title="Permalink to this headline">¶</a></h3>
<p>Let’s now create our own Moderator class by subclassing <code class="docutils literal notranslate"><span class="pre">SpamModerator</span></code>. The
goal is to provide a <code class="docutils literal notranslate"><span class="pre">moderate</span></code> method that looks in the content of the
comment and returns <code class="docutils literal notranslate"><span class="pre">False</span></code> whenever it finds a bad word in the message. The
effect of returning <code class="docutils literal notranslate"><span class="pre">False</span></code> is that comment’s <code class="docutils literal notranslate"><span class="pre">is_public</span></code> attribute will be
put to <code class="docutils literal notranslate"><span class="pre">False</span></code> and therefore the comment will be in moderation.</p>
<p>The blog application comes with a bad word list in the
file <code class="docutils literal notranslate"><span class="pre">blog/badwords.py</span></code>.</p>
<p>We assume we already have a list of <code class="docutils literal notranslate"><span class="pre">BlackListed</span></code> domains and we don’t need
further spam control. So we will disable comment confirmation by email. Edit
the <code class="docutils literal notranslate"><span class="pre">settings.py</span></code> file:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_CONFIRM_EMAIL</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div></blockquote>
<p>Now edit <code class="docutils literal notranslate"><span class="pre">blog/models.py</span></code> and add the code corresponding to our new
<code class="docutils literal notranslate"><span class="pre">PostCommentModerator</span></code>:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Below the other imports:</span>
<span class="kn">from</span> <span class="nn">django_comments_xtd.moderation</span> <span class="kn">import</span> <span class="n">moderator</span><span class="p">,</span> <span class="n">SpamModerator</span>
<span class="kn">from</span> <span class="nn">blog.badwords</span> <span class="kn">import</span> <span class="n">badwords</span>

<span class="o">...</span>

<span class="k">class</span> <span class="nc">PostCommentModerator</span><span class="p">(</span><span class="n">SpamModerator</span><span class="p">):</span>
    <span class="n">email_notification</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">moderate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">content_object</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Make a dictionary where the keys are the words of the message</span>
        <span class="c1"># and the values are their relative position in the message.</span>
        <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">word</span>
            <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="n">lowcase_comment</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">comment</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">clean</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lowcase_comment</span><span class="o">.</span><span class="n">split</span><span class="p">())])</span>
        <span class="k">for</span> <span class="n">badword</span> <span class="ow">in</span> <span class="n">badwords</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">badword</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">lowcase_comment</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">badword</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lastindex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">for</span> <span class="n">subword</span> <span class="ow">in</span> <span class="n">badword</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">subword</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">lastindex</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="n">subword</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">lastindex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="n">lastindex</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">subword</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lastindex</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">subword</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">badword</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">msg</span><span class="p">[</span><span class="n">badword</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="n">lastindex</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PostCommentModerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">moderate</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span>
                                                          <span class="n">content_object</span><span class="p">,</span>
                                                          <span class="n">request</span><span class="p">)</span>

<span class="n">moderator</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostCommentModerator</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Now we can try to send a comment with any of the bad words listed in <a class="reference external" href="https://gist.github.com/ryanlewis/a37739d710ccdb4b406d">badwords</a>.
After sending the comment we will see the content of the
<code class="docutils literal notranslate"><span class="pre">django_comments_xtd/moderated.html</span></code> template and the comment will be put in
moderation.</p>
<p>If you enable comment confirmation by email, the comment will be put on hold
after the user clicks on the confirmation link in the email.</p>
</div>
</div>
<div class="section" id="threads">
<span id="index-3"></span><h2><a class="toc-backref" href="#id13">Threads</a><a class="headerlink" href="#threads" title="Permalink to this headline">¶</a></h2>
<p>Up until this point in the tutorial django-comments-xtd has been configured to
disallow nested comments. Every comment is at thread level 0. It is so because
by default the setting <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL</span></code></a> is set to 0.</p>
<p>When the <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL</span></code></a> is greater than 0, comments
below the maximum thread level may receive replies that will nest inside each
other up to the maximum thread level. A comment in a the thread level below
the <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL</span></code></a> can show a <strong>Reply</strong> link that
allows users to send nested comments.</p>
<p>In this section we will enable nested comments by modifying
<a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL</span></code></a> and apply some changes to
our <code class="docutils literal notranslate"><span class="pre">blog_detail.html</span></code> template.</p>
<p>We can make use of two template tags, <a class="reference internal" href="templatetags.html#std:templatetag-render_xtdcomment_tree"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_xtdcomment_tree</span></code></a> and
<a class="reference internal" href="templatetags.html#std:templatetag-get_xtdcomment_tree"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">get_xtdcomment_tree</span></code></a>. The former renders a template with the comments
while the latter put the comments in a nested data structure in the context of
the template.</p>
<p>We will also introduce the setting <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_LIST_ORDER"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_LIST_ORDER</span></code></a>, that
allows altering the default order in which the comments are sorted in the list.
By default comments are sorted by thread and their position inside the thread,
which turns out to be in ascending datetime of arrival. In this example we will
list newer comments first.</p>
<p>Let’s start by editing <code class="docutils literal notranslate"><span class="pre">tutorial/settings.py</span></code> to set up the maximum thread
level to 1 and a comment ordering such that newer comments are retrieve first:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_MAX_THREAD_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># default is 0</span>
<span class="n">COMMENTS_XTD_LIST_ORDER</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-thread_id&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">)</span>  <span class="c1"># default is (&#39;thread_id&#39;, &#39;order&#39;)</span>
</pre></div>
</div>
</div></blockquote>
<p>Now we have to modify the blog post detail template to load the <code class="docutils literal notranslate"><span class="pre">comments_xtd</span></code>
templatetag and make use of <a class="reference internal" href="templatetags.html#std:templatetag-render_xtdcomment_tree"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_xtdcomment_tree</span></code></a>. We also want to move
the comment form from the bottom of the page to a more visible position right
below the blog post, followed by the list of comments.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">blog/post_detail.html</span></code> to make it look like follows:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>{% extends &quot;base.html&quot; %}
{% load comments %}
{% load comments_xtd %}

{% block title %}{{ object.title }}{% endblock %}

{% block content %}
&lt;div class=&quot;pb-3&quot;&gt;
  &lt;h1 class=&quot;page-header text-center&quot;&gt;{{ object.title }}&lt;/h1&gt;
  &lt;p class=&quot;small text-center&quot;&gt;{{ object.publish|date:&quot;l, j F Y&quot; }}&lt;/p&gt;
&lt;/div&gt;
&lt;div&gt;
  {{ object.body|linebreaks }}
&lt;/div&gt;

{% get_comment_count for object as comment_count %}
&lt;div class=&quot;py-4 text-center&gt;
  &lt;a href=&quot;{% url &#39;blog:post-list&#39; %}&quot;&gt;Back to the post list&lt;/a&gt;
  &amp;nbsp;&amp;sdot;&amp;nbsp;
  {{ comment_count }} comment{{ comment_count|pluralize }}
  ha{{ comment_count|pluralize:&quot;s,ve&quot;}} been posted.
&lt;/div&gt;

{% if object.allow_comments %}
&lt;div class=&quot;comment&quot;&gt;
  &lt;h4 class=&quot;text-center&quot;&gt;Your comment&lt;/h4&gt;
  &lt;div class=&quot;well&quot;&gt;
    {% render_comment_form for object %}
  &lt;/div&gt;
&lt;/div&gt;
{% endif %}

{% if comment_count %}
&lt;ul class=&quot;media-list&quot;&gt;
  {% render_xtdcomment_tree for object %}
&lt;/ul&gt;
{% endif %}
{% endblock %}
</pre></div>
</div>
</div></blockquote>
<p>The tag <a class="reference internal" href="templatetags.html#std:templatetag-render_xtdcomment_tree"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">render_xtdcomment_tree</span></code></a> renders the template
<code class="docutils literal notranslate"><span class="pre">django_comments_xtd/comment_tree.html</span></code>.</p>
<p>Now visit any of the blog posts to which you have already sent comments and see
that a new <cite>Reply</cite> link shows up below each comment. Click on the link and post
a new comment. It will appear nested inside the parent comment. The new comment
will not show a <cite>Reply</cite> link because <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL</span></code></a>
has been set to 1. Raise it to 2 and reload the page to offer the chance to
nest comments inside one level deeper.</p>
<img alt="_images/reply-link.png" src="_images/reply-link.png" />
<div class="section" id="different-max-thread-levels">
<h3><a class="toc-backref" href="#id14">Different max thread levels</a><a class="headerlink" href="#different-max-thread-levels" title="Permalink to this headline">¶</a></h3>
<p>There might be cases in which nested comments have a lot of sense and others
in which we would prefer a plain comment sequence. We can handle both scenarios
under the same Django project.</p>
<p>We just have to use both settings, <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL</span></code></a>
and <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_MAX_THREAD_LEVEL_BY_APP_MODEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_MAX_THREAD_LEVEL_BY_APP_MODEL</span></code></a>. The former
establishes the default maximum thread level site wide, while the latter
sets the maximum thread level on <cite>app.model</cite> basis.</p>
<p>If we wanted to disable nested comments site wide, and enable nested comments
up to level one for blog posts, we would set it up as follows in our
<code class="docutils literal notranslate"><span class="pre">settings.py</span></code> module:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_MAX_THREAD_LEVEL</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># site wide default</span>
<span class="n">COMMENTS_XTD_MAX_THREAD_LEVEL_BY_APP_MODEL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Objects of the app blog, model post, can be nested</span>
    <span class="c1"># up to thread level 1.</span>
        <span class="s1">&#39;blog.post&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="the-nested-count-field">
<h3><a class="toc-backref" href="#id15">The <code class="docutils literal notranslate"><span class="pre">nested_count</span></code> field</a><a class="headerlink" href="#the-nested-count-field" title="Permalink to this headline">¶</a></h3>
<p>When threaded comments are enabled the field <code class="docutils literal notranslate"><span class="pre">nested_count</span></code> of every <strong>XtdComment</strong> instance keeps track of how many nested comments it contains.</p>
</div>
</div>
<div class="section" id="flags">
<h2><a class="toc-backref" href="#id16">Flags</a><a class="headerlink" href="#flags" title="Permalink to this headline">¶</a></h2>
<p>The Django Comments Framework supports <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/example.html#flagging">comment flagging</a>, so comments can be flagged for:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Removal suggestion</strong>, when a registered user suggests the removal of a
comment.</p></li>
<li><p><strong>Moderator deletion</strong>, when a comment moderator marks the comment as deleted.</p></li>
<li><p><strong>Moderator approval</strong>, when a comment moderator sets the comment as approved.</p></li>
</ul>
</div></blockquote>
<p>django-comments-xtd expands flagging with two more flags:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Liked it</strong>, when a registered user likes the comment.</p></li>
<li><p><strong>Disliked it</strong>, when a registered user dislikes the comment.</p></li>
</ul>
</div></blockquote>
<p>In this section we will see how to enable a user with the capacity to flag a
comment for removal with the <strong>Removal suggestion</strong> flag, how to express
likeability, conformity, acceptance or acknowledgement with the <strong>Liked it</strong>
flag and the opposite with the <strong>Disliked it</strong> flag.</p>
<p>One important requirement to mark comments is that the user flagging must be
authenticated. In other words, comments can not be flagged by anonymous users.</p>
<div class="section" id="commenting-options">
<h3><a class="toc-backref" href="#id17">Commenting options</a><a class="headerlink" href="#commenting-options" title="Permalink to this headline">¶</a></h3>
<p>As of version 2.0 django-comments-xtd has a new setting
<a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_APP_MODEL_OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_APP_MODEL_OPTIONS</span></code></a> that must be used to allow comment
flagging. The purpose of it is to give an additional level of control about what
actions users can perform on comments: flag them as inappropriate, like/dislike them, retrieve the list of users who liked/disliked them, and whether visitors can post comments or only registered users can do it.</p>
<p>It defaults to:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_APP_MODEL_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;allow_flagging&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;allow_feedback&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;show_feedback&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;who_can_post&#39;</span><span class="p">:</span> <span class="s1">&#39;all&#39;</span>  <span class="c1"># Valid values: &#39;all&#39;, users&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>We will go through the first three options in the following sections. As for the last option, <em>who_can_post</em>, I recommend you to read the special use case <a class="reference internal" href="usecases/only-signed-in-can-comment.html#ref-recipe-only-signed-in-can-comment"><span class="std std-ref">Only signed in users can comment</span></a>, that explains the topic in depth.</p>
</div>
<div class="section" id="removal-suggestion">
<h3><a class="toc-backref" href="#id18">Removal suggestion</a><a class="headerlink" href="#removal-suggestion" title="Permalink to this headline">¶</a></h3>
<p>Enabling the comment removal flag is about including the <strong>allow_flagging</strong>
argument in the <code class="docutils literal notranslate"><span class="pre">render_xtdcomment_tree</span></code> template tag. Edit the
<code class="docutils literal notranslate"><span class="pre">blog/post_detail.html</span></code> template and append the argument:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>...
<span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;media-list&quot;</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">render_xtdcomment_tree</span> <span class="nv">for</span> <span class="nv">object</span> <span class="nv">allow_flagging</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>The <strong>allow_flagging</strong> argument makes the templatetag populate a variable
<code class="docutils literal notranslate"><span class="pre">allow_flagging</span> <span class="pre">=</span> <span class="pre">True</span></code> in the context in which
<code class="docutils literal notranslate"><span class="pre">django_comments_xtd/comment_tree.html</span></code> is rendered. Edit now the settings
module and enable the <code class="docutils literal notranslate"><span class="pre">allow_flagging</span></code> option for the <code class="docutils literal notranslate"><span class="pre">blog.post</span></code>:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_APP_MODEL_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;blog.post&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;allow_flagging&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;allow_feedback&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;show_feedback&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>Now let’s suggest a removal. First we need to login in the <a class="reference external" href="http://localhost:8000/admin/">admin</a> interface so
that we are not an anonymous user. Then we can visit any of the blog posts we
sent comments to. There is a flag at the right side of every comment’s header.
Clicking on it takes the user to a page in which she is requested to confirm
the removal suggestion. Finally, clicking on the red <strong>Flag</strong> button confirms
the request.</p>
<p>Users with the <code class="docutils literal notranslate"><span class="pre">django_comments.can_moderate</span></code> permission will see a yellow
labelled counter near the flag button in each flagged comment, representing
how many times comments have been flagged. Also notice that when a user flags
a comment for removal the icon turns red for that user.</p>
<img alt="_images/flag-counter.png" src="_images/flag-counter.png" />
<p>Administrators/moderators can find flagged comment entries in the <a class="reference external" href="http://localhost:8000/admin/">admin</a>
interface, under the <strong>Comment flags</strong> model, within the Django Comments
application.</p>
<div class="section" id="getting-notifications">
<h4><a class="toc-backref" href="#id19">Getting notifications</a><a class="headerlink" href="#getting-notifications" title="Permalink to this headline">¶</a></h4>
<p>A user might want to flag a comment on the basis of a violation of the site’s
terms of use, hate speech, racism or the like. To prevent a comment from staying
published long after it has been flagged we might want to receive notifications
on flagging events.</p>
<p>For such purpose django-comments-xtd provides the class <strong>XtdCommentModerator</strong>,
which extends django-contrib-comments’ <strong>CommentModerator</strong>.</p>
<p>In addition to all the <a class="reference external" href="https://django-contrib-comments.readthedocs.io/en/latest/moderation.html#moderation-options">options</a> of its parent class,
<strong>XtdCommentModerator</strong> offers the <code class="docutils literal notranslate"><span class="pre">removal_suggestion_notification</span></code>
attribute, that when set to <code class="docutils literal notranslate"><span class="pre">True</span></code> makes Django send a mail to all the
<a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-MANAGERS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MANAGERS</span></code></a> on every <strong>Removal suggestion</strong> flag created.</p>
<p>To see an example let’s edit <code class="docutils literal notranslate"><span class="pre">blog/models.py</span></code>. If you are already using the
class <strong>SpamModerator</strong>, which inherits from <strong>XtdCommentModerator</strong>, just add
<code class="docutils literal notranslate"><span class="pre">removal_suggestion_notification</span> <span class="pre">=</span> <span class="pre">True</span></code> to your <code class="docutils literal notranslate"><span class="pre">PostCommentModeration</span></code>
class. Otherwise add the following code:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django_comments_xtd.moderation</span> <span class="kn">import</span> <span class="n">moderator</span><span class="p">,</span> <span class="n">XtdCommentModerator</span>

<span class="o">...</span>
<span class="k">class</span> <span class="nc">PostCommentModerator</span><span class="p">(</span><span class="n">XtdCommentModerator</span><span class="p">):</span>
    <span class="n">removal_suggestion_notification</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">moderator</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostCommentModerator</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Be sure that <code class="docutils literal notranslate"><span class="pre">PostCommentModerator</span></code> is the only moderation class registered
for the <code class="docutils literal notranslate"><span class="pre">Post</span></code> model, and be sure as well that the <a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-MANAGERS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MANAGERS</span></code></a>
setting contains a valid email address. The message sent is based on the
<code class="docutils literal notranslate"><span class="pre">django_comments_xtd/removal_notification_email.txt</span></code> template, already
provided within django-comments-xtd. After these changes flagging a comment
with a <strong>Removal suggestion</strong> will trigger a notification by mail.</p>
</div>
</div>
<div class="section" id="liked-it-disliked-it">
<h3><a class="toc-backref" href="#id20">Liked it, Disliked it</a><a class="headerlink" href="#liked-it-disliked-it" title="Permalink to this headline">¶</a></h3>
<p>Django-comments-xtd adds two new flags: the <strong>Liked it</strong> and the <strong>Disliked it</strong>
flags.</p>
<p>Unlike the <strong>Removal suggestion</strong> flag, the <strong>Liked it</strong> and <strong>Disliked it</strong>
flags are mutually exclusive. A user can not like and dislike a comment at the
same time. Users can like/dislike at any time but only the last action will
prevail.</p>
<p>In this section we make changes to give our users the capacity to like or
dislike comments. Following the same pattern as with the removal flag, enabling
like/dislike buttons is about adding an argument to the
<code class="docutils literal notranslate"><span class="pre">render_xtdcomment_tree</span></code>, the argument <code class="docutils literal notranslate"><span class="pre">allow_feedback</span></code>.
Edit the <code class="docutils literal notranslate"><span class="pre">blog/post_detail.html</span></code> template and add the new argument:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;media-list&quot;</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">render_xtdcomment_tree</span> <span class="nv">for</span> <span class="nv">object</span> <span class="nv">allow_flagging</span> <span class="nv">allow_feedback</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>The <strong>allow_feedback</strong> argument makes the templatetag populate a variable
<code class="docutils literal notranslate"><span class="pre">allow_feedback</span> <span class="pre">=</span> <span class="pre">True</span></code> in the context in which
<code class="docutils literal notranslate"><span class="pre">django_comments_xtd/comment_tree.html</span></code> is rendered. Edit the settings
module and enable the <code class="docutils literal notranslate"><span class="pre">allow_feedback</span></code> option for the <code class="docutils literal notranslate"><span class="pre">blog.post</span></code>
<strong>app.label</strong> pair:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_APP_MODEL_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;blog.post&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;allow_flagging&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;allow_feedback&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;show_feedback&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>The blog post detail template is ready to show the like/dislike buttons,
refresh your browser.</p>
<img alt="_images/feedback-buttons.png" src="_images/feedback-buttons.png" />
<p>Having the new like/dislike links in place, if we click on any of them we will
end up in either the <code class="docutils literal notranslate"><span class="pre">django_comments_xtd/like.html</span></code> or the
<code class="docutils literal notranslate"><span class="pre">django_comments_xtd/dislike.html</span></code> templates, which are meant to request
the user a confirmation for the operation.</p>
<div class="section" id="show-the-list-of-users">
<span id="id3"></span><h4><a class="toc-backref" href="#id21">Show the list of users</a><a class="headerlink" href="#show-the-list-of-users" title="Permalink to this headline">¶</a></h4>
<p>With the like/dislike buttons enabled we might as well consider to display the
users who actually liked/disliked comments. Again addind an argument to the
<code class="docutils literal notranslate"><span class="pre">render_xtdcomment_tree</span></code> will enable the feature. Change the
<code class="docutils literal notranslate"><span class="pre">blog/post_detail.html</span></code> and add the argument <code class="docutils literal notranslate"><span class="pre">show_feedback</span></code>
to the template tag:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;media-list&quot;</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">render_xtdcomment_tree</span> <span class="nv">for</span> <span class="nv">object</span> <span class="nv">allow_flagging</span> <span class="nv">allow_feedback</span> <span class="nv">show_feedback</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra-js</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">script</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;</span>
  <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js&quot;</span>
  <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49&quot;</span>
  <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js&quot;</span>
  <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy&quot;</span>
  <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[data-toggle=&quot;tooltip&quot;]&#39;</span><span class="p">).</span><span class="nx">tooltip</span><span class="p">({</span><span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
  <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
<p>Also change the settings and enable the <code class="docutils literal notranslate"><span class="pre">show_feedback</span></code> option for
<code class="docutils literal notranslate"><span class="pre">blog.post</span></code>:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_APP_MODEL_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;blog.post&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;allow_flagging&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;allow_feedback&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;show_feedback&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>We loaded jQuery and <a class="reference external" href="http://getbootstrap.com">twitter-bootstrap</a> libraries from their respective default
CDNs as the code above uses bootstrap’s tooltip functionality to show the list
of users when the mouse hovers the numbers near the buttons, as the following
image shows:</p>
<img alt="_images/feedback-users.png" src="_images/feedback-users.png" />
<p>Put the mouse over the counters near the like/dislike buttons to display the
list of users.</p>
</div>
</div>
</div>
<div class="section" id="markdown">
<h2><a class="toc-backref" href="#id22">Markdown</a><a class="headerlink" href="#markdown" title="Permalink to this headline">¶</a></h2>
<p>In versions prior to 2.0 django-comments-xtd required the installation of
django-markup as a dependency. There was also a specific template filter
called <code class="docutils literal notranslate"><span class="pre">render_markup_comment</span></code> to help rendering comment’s content in
the markup language of choice.</p>
<p>As of version 2.0 the backend side of the application does not require the
installation of any additional package to parser comments’ content, and
therefore does not provide the <code class="docutils literal notranslate"><span class="pre">render_markup_comment</span></code> filter anymore.
However, in the client side the JavaScript plugin uses Markdown by default
to render comments’ content.</p>
<p>As for the backend side, comment’s content is presented by default in plain
text, but it is easily customizable by overriding the template
<code class="docutils literal notranslate"><span class="pre">includes/django_comments_xtd/render_comment.html</span></code>.</p>
<p>In this section we will send a Markdown formatted comment, and once published
we will install support for Markdown, with
<a class="reference external" href="https://pypi.python.org/pypi/django-markdown2">django-markdown2</a>. We’ll
then override the template mentioned above so that comments are interpreted
as Markdown.</p>
<p>Send a comment formatted in Markdown, as the one in the following image.</p>
<img alt="_images/markdown-input.png" src="_images/markdown-input.png" />
<p>Now we will install <a class="reference external" href="https://pypi.python.org/pypi/django-markdown2">django-markdown2</a>, and create the template
directory and the template file:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>venv<span class="o">)</span>$ pip install django-markdown2
<span class="o">(</span>venv<span class="o">)</span>$ mkdir -p templates/includes/django_comments_xtd/
<span class="o">(</span>venv<span class="o">)</span>$ touch templates/includes/django_comments_xtd/comment_content.html
</pre></div>
</div>
</div></blockquote>
<p>We have to add <code class="docutils literal notranslate"><span class="pre">django_markdown2</span></code> to our <a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-INSTALLED_APPS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a>, and add
the following template code to the file <code class="docutils literal notranslate"><span class="pre">comment_content.html</span></code> we just created:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">md2</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">content</span><span class="o">|</span><span class="nf">markdown</span><span class="s2">:&quot;safe, code-friendly, code-color&quot;</span> <span class="cp">}}</span>
</pre></div>
</div>
</div></blockquote>
<p>Now our project is ready to show comments posted in Markdown. After reloading,
the comment’s page will look like this:</p>
<img alt="_images/markdown-comment.png" src="_images/markdown-comment.png" />
</div>
<div class="section" id="javascript-plugin">
<h2><a class="toc-backref" href="#id23">JavaScript plugin</a><a class="headerlink" href="#javascript-plugin" title="Permalink to this headline">¶</a></h2>
<p>Up until now we have used django-comments-xtd as a backend application. As of
version 2.0 it includes a JavaScript plugin that helps moving part of the logic
to the browser improving the overall usability. By making use of the JavaScript
plugin users don’t have to leave the blog post page to preview, submit or reply
comments, or to like/dislike them. But it comes at the cost of using:</p>
<blockquote>
<div><ul class="simple">
<li><p>ReactJS</p></li>
<li><p>jQuery (to handle Ajax calls).</p></li>
<li><p>Twitter-Bootstrap (for the UI).</p></li>
<li><p>Remarkable (for Markdown support).</p></li>
</ul>
</div></blockquote>
<p>To know more about the client side of the application and the build process
read the specific page on the <a class="reference internal" href="javascript.html"><span class="doc">JavaScript plugin</span></a>.</p>
<p>In this section of the tutorial we go through the steps to make use of the
JavaScript plugin.</p>
<div class="section" id="enable-web-api">
<h3><a class="toc-backref" href="#id24">Enable Web API</a><a class="headerlink" href="#enable-web-api" title="Permalink to this headline">¶</a></h3>
<p>The JavaScript plugin uses the Web API provided within the app. In order to
enable it install the <a class="reference external" href="http://www.django-rest-framework.org/">django-rest-framework</a>:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>venv<span class="o">)</span>$ pip install djangorestframework
</pre></div>
</div>
</div></blockquote>
<p>Once installed, add it to our tutorial <a class="reference external" href="http://docs.djangoproject.com/en/3.1/_objects/ref/settings/#std:setting-INSTALLED_APPS" title="(in Django v3.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> setting:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>To know more about the Web API provided by django-comments-xtd read on the
<a class="reference internal" href="webapi.html"><span class="doc">Web API</span></a> page.</p>
</div>
<div class="section" id="enable-app-model-options">
<h3><a class="toc-backref" href="#id25">Enable app.model options</a><a class="headerlink" href="#enable-app-model-options" title="Permalink to this headline">¶</a></h3>
<p>Be sure <a class="reference internal" href="settings.html#std:setting-COMMENTS_XTD_APP_MODEL_OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">COMMENTS_XTD_APP_MODEL_OPTIONS</span></code></a> includes the options we want
to enable for comments sent to Blog posts. In this case we will allow users to
flag comments for removal (allow_flagging option), to like/dislike comments
(allow_feedback), and we want users to see the list of people who
liked/disliked comments:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENTS_XTD_APP_MODEL_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;blog.post&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;allow_flagging&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;allow_feedback&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;show_feedback&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="the-i18n-javascript-catalog">
<h3><a class="toc-backref" href="#id26">The i18n JavaScript Catalog</a><a class="headerlink" href="#the-i18n-javascript-catalog" title="Permalink to this headline">¶</a></h3>
<p>Internationalization support (see <a class="reference external" href="https://docs.python.org/3/library/i18n.html#i18n" title="(in Python v3.9)"><span>Internationalization</span></a>) has been included within the
plugin by making use of the <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/i18n/translation/#using-the-javascript-translation-catalog">Django’s JavaScript i18n catalog</a>. If your project doesn’t need
i18n you can easily remove every mention to these functions (namespaced
under the <cite>django</cite> object) from the source and change the
<code class="docutils literal notranslate"><span class="pre">webpack.config.js</span></code> file to build the plugin without it.</p>
<p>Our tutorial doesn’t have i18n enabled (the <a class="reference external" href="https://github.com/danirus/django-comments-xtd/tree/master/example/comp">comp example project</a>
has it), but we will not remove its support from the plugin, we will simply
enable the JavaScript Catalog URL, so that the plugin can access its functions.
Edit <code class="docutils literal notranslate"><span class="pre">tutorial/urls.py</span></code> and add the following url:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.i18n</span> <span class="kn">import</span> <span class="n">JavaScriptCatalog</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;jsi18n/&#39;</span><span class="p">,</span> <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;javascript-catalog&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>In the next section we will use the new URL to load the i18n JavaScript catalog.</p>
</div>
<div class="section" id="load-the-plugin">
<h3><a class="toc-backref" href="#id27">Load the plugin</a><a class="headerlink" href="#load-the-plugin" title="Permalink to this headline">¶</a></h3>
<p>Now let’s edit <code class="docutils literal notranslate"><span class="pre">blog/post_detail.html</span></code> and make it look as follows:</p>
<blockquote>
<div><div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">comments</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">comments_xtd</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{{</span> <span class="nv">object.title</span> <span class="cp">}}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pb-3&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">object.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;small text-center&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">object.publish</span><span class="o">|</span><span class="nf">date</span><span class="s2">:&quot;l, j F Y&quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{{</span> <span class="nv">object.body</span><span class="o">|</span><span class="nf">linebreaks</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;py-4 text-center&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:post-list&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>Back to the post list<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;comments&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extra-js</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">crossorigin</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/react@16/umd/react.production.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">crossorigin</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/react-dom@16/umd/react-dom.production.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
 <span class="nb">window</span><span class="p">.</span><span class="nx">comments_props</span> <span class="o">=</span> <span class="cp">{%</span> <span class="k">get_commentbox_props</span> <span class="nv">for</span> <span class="nv">object</span> <span class="cp">%}</span><span class="p">;</span>
 <span class="nb">window</span><span class="p">.</span><span class="nx">comments_props_override</span> <span class="o">=</span> <span class="p">{</span>
     <span class="nx">allow_comments</span><span class="o">:</span> <span class="cp">{%</span><span class="k">if</span> <span class="nv">object.allow_comments</span><span class="cp">%}</span><span class="nx">true</span><span class="cp">{%</span><span class="k">else</span><span class="cp">%}</span><span class="nx">false</span><span class="cp">{%</span><span class="k">endif</span><span class="cp">%}</span><span class="p">,</span>
     <span class="nx">allow_feedback</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
     <span class="nx">show_feedback</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
     <span class="nx">allow_flagging</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
     <span class="nx">polling_interval</span><span class="o">:</span> <span class="mi">5000</span>  <span class="c1">// In milliseconds.</span>
 <span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;</span>
  <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js&quot;</span>
  <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49&quot;</span>
  <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js&quot;</span>
  <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy&quot;</span>
  <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span>
  <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;javascript-catalog&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;django_comments_xtd/js/vendor~plugin-3.0.0.js&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;django_comments_xtd/js/plugin-3.0.0.js&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[data-toggle=&quot;tooltip&quot;]&#39;</span><span class="p">).</span><span class="nx">tooltip</span><span class="p">({</span><span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
<p>The blog post page is now ready to handle comments through the JavaScript
plugin, including the following features:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Post comments.</p></li>
<li><p>Preview comments, with instant preview update while typing.</p></li>
<li><p>Reply comment in the same page, with instant preview while typing.</p></li>
<li><p>Notifications of new incoming comments using active polling (override
<em>polling_interval</em> parameter, see the content of first <em>&lt;script&gt;</em> tag in
the code above).</p></li>
<li><p>Button to reload the tree of comments, highlighting new comments (see
image below).</p></li>
<li><p>Immediate like/dislike actions.</p></li>
</ol>
</div></blockquote>
<img alt="_images/update-comment-tree.png" src="_images/update-comment-tree.png" />
</div>
</div>
<div class="section" id="final-notes">
<h2><a class="toc-backref" href="#id28">Final notes</a><a class="headerlink" href="#final-notes" title="Permalink to this headline">¶</a></h2>
<p>We have reached the end of the tutorial. I hope you got enough to start using
django-comments-xtd in your own project.</p>
<p>The following page introduces the <strong>Demo projects</strong>. The <strong>simple</strong> demo is a
straightforward backend handled project that uses comment confirmation by mail,
with follow-up notifications and mute links. The <strong>custom</strong> demo is an example
about how to extend django-comments-xtd <strong>Comment</strong> model with new attributes.
The <strong>comp</strong> demo shows a project using the complete set of features provided
by both django-contrib-comments and django-comments-xtd.</p>
<p>Checkout the <strong>Control Logic</strong> page to understand how django-comments-xtd
works along with django-contrib-comments. The <strong>Web API</strong> page details the
API provided. The <strong>JavaScript Plugin</strong> covers every aspect regarding the
frontend code. Read on <strong>Filters and Template Tags</strong> to see in detail the
list of template tags and filters offered. The page on
<strong>Customizing django-comments-xtd</strong> goes through the steps to extend the app
with a quick example and little prose. Read the <strong>Settings</strong> page and the
<strong>Templates</strong> page to get to know how you can customize the default behaviour
and default look and feel.</p>
<p>If you want to help, please, report any bug or enhancement directly to
the <a class="reference external" href="https://github.com/danirus/django-comments-xtd">github</a> page of the project. Your contributions are welcome.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example.html" class="btn btn-neutral float-right" title="Demo projects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quick start guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Daniel Rus Morales

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>