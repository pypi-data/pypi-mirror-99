(self.webpackChunkrichie_education=self.webpackChunkrichie_education||[]).push([[59177],{59177:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return A}}),r(80044),r(26364),r(19701),r(80238),r(6208),r(12938),r(86632),r(10853),r(61928),r(45007),r(54883),r(68995),r(18821),r(54994),r(4845),r(35054),r(32390);var t,o=r(89526),l=r(34323),a=r(38136),c=r(20843);!function(e){e[e.ONGOING_OPEN=0]="ONGOING_OPEN",e[e.FUTURE_OPEN=1]="FUTURE_OPEN",e[e.ARCHIVED_OPEN=2]="ARCHIVED_OPEN",e[e.FUTURE_NOT_YET_OPEN=3]="FUTURE_NOT_YET_OPEN",e[e.FUTURE_CLOSED=4]="FUTURE_CLOSED",e[e.ONGOING_CLOSED=5]="ONGOING_CLOSED",e[e.ARCHIVED_CLOSED=6]="ARCHIVED_CLOSED",e[e.TO_BE_SCHEDULED=7]="TO_BE_SCHEDULED"}(t||(t={}));var u,s=r(24463),i=r(3787),E=(r(42900),r(72975),r(39275),r(33290),r(80042)),d=r(15799),m=r(22820),f=r(51270),O=null===(u=window.__richie_frontend_context__)||void 0===u?void 0:u.context;if(!O)throw new Error("No context frontend context available");var p=O.lms_backends,_=function(e){var n=function(e){return p.find((function(n){return new RegExp(n.course_regexp).test(e)}))}(e);switch(null==n?void 0:n.backend){case E.w.BASE:return(0,d.Z)(n);case E.w.OPENEDX_DOGWOOD:return(0,m.Z)(n);case E.w.OPENEDX_HAWTHORN:return(0,f.Z)(n)}var r=new Error("No LMS Backend found for ".concat(e,"."));throw(0,s.p)(r),r},N=function(e,n){return _(e).enrollment.isEnrolled(e,n)},L=function(e,n){return _(e).enrollment.set(e,n)};function v(e,n,r,t,o,l,a){try{var c=e[l](a),u=c.value}catch(e){return void r(e)}c.done?n(u):Promise.resolve(u).then(t,o)}function R(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var l=e.apply(n,r);function a(e){v(l,t,o,a,c,"next",e)}function c(e){v(l,t,o,a,c,"throw",e)}a(void 0)}))}}function y(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function g(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function D(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?g(Object(r),!0).forEach((function(n){b(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function b(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}var h,C,T=(0,l.vU)({enroll:{id:"components.CourseRunEnrollment.enroll",defaultMessage:[{type:0,value:"Enroll now"}]},enrolled:{id:"components.CourseRunEnrollment.enrolled",defaultMessage:[{type:0,value:"You are enrolled in this course run"}]},enrollmentClosed:{id:"components.CourseRunEnrollment.enrollmentClosed",defaultMessage:[{type:0,value:"Enrollment in this course run is closed at the moment"}]},enrollmentFailed:{id:"components.CourseRunEnrollment.enrollmentFailed",defaultMessage:[{type:0,value:"Your enrollment request failed."}]},goToCourse:{id:"components.CourseRunEnrollment.goToCourse",defaultMessage:[{type:0,value:"Go to course"}]},loadingInitial:{id:"components.CourseRunEnrollment.loadingInitial",defaultMessage:[{type:0,value:"Loading enrollment information..."}]},loginToEnroll:{id:"components.CourseRunEnrollment.loginToEnroll",defaultMessage:[{type:0,value:"Log in to enroll"}]}});!function(e){e.ANONYMOUS="anonymous",e.CLOSED="closed",e.LOADING="loading",e.ENROLLED="enrolled",e.ENROLLING="enrolling",e.ENROLLMENT_FAILED="enrollmentFailed",e.FAILED="failed",e.IDLE="idle"}(h||(h={})),function(e){e.UPDATE_CONTEXT="UPDATE_CONTEXT",e.ENROLL="ENROLL",e.ERROR="ERROR"}(C||(C={}));var w=function(e,n){var r=e.currentUser,o=e.courseRun,l=e.isEnrolled;switch(!0){case o.priority>t.ARCHIVED_OPEN:return h.CLOSED;case n===h.ENROLLING&&!l:return h.ENROLLMENT_FAILED;case void 0===r||void 0===o||void 0===l:return h.LOADING;case null===r:return h.ANONYMOUS;case!!l:return h.ENROLLED;case!l:return h.IDLE;default:throw new Error("Impossible state")}},I=function(e,n){var r=e.step,t=e.context;switch(n.type){case C.UPDATE_CONTEXT:var o=D(D({},t),n.payload);return{step:w(o,r),context:o};case C.ENROLL:return{step:h.ENROLLING,context:t};case C.ERROR:return D({step:h.FAILED,context:t},n.payload);default:return{step:r,context:t}}},A=function(e){var n,r,t=(n=(0,o.useReducer)(I,function(e){return{step:h.LOADING,context:{currentUser:void 0,courseRun:e,isEnrolled:void 0}}}(e.courseRun),(function(e){return e})),r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],t=!0,o=!1,l=void 0;try{for(var a,c=e[Symbol.iterator]();!(t=(a=c.next()).done)&&(r.push(a.value),!n||r.length!==n);t=!0);}catch(e){o=!0,l=e}finally{try{t||null==c.return||c.return()}finally{if(o)throw l}}return r}}(n,r)||function(e,n){if(e){if("string"==typeof e)return y(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=t[0],E=u.step,d=u.context,m=d.currentUser,f=d.isEnrolled,O=d.courseRun,p=u.error,_=t[1],v=(0,c.k)(),g=v.user,D=v.login,b=(0,o.useCallback)(R(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_({type:C.ENROLL}),!O||!m){e.next=6;break}return e.next=4,L(O.resource_link,m);case 4:n=e.sent,_({type:C.UPDATE_CONTEXT,payload:{isEnrolled:n}});case 6:case"end":return e.stop()}}),e)}))),[O,m,_]);switch((0,o.useEffect)((function(){_({type:C.UPDATE_CONTEXT,payload:{currentUser:g,isEnrolled:void 0}})}),[g]),(0,i.b)(R(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==f){e.next=7;break}if(n=!1,!m){e.next=6;break}return e.next=5,N(O.resource_link,m);case 5:n=e.sent;case 6:_({type:C.UPDATE_CONTEXT,payload:{isEnrolled:n}});case 7:case"end":return e.stop()}}),e)}))),[m,O]),!0){case E===h.CLOSED:return o.createElement("div",{className:"course-run-enrollment__helptext"},o.createElement(l._H,T.enrollmentClosed));case E===h.ANONYMOUS:return o.createElement("button",{onClick:D,className:"course-run-enrollment__cta"},o.createElement(l._H,T.loginToEnroll));case E===h.LOADING:return o.createElement(a.$,{size:"small","aria-labelledby":"loading-course-run-".concat(O.id)},o.createElement("span",{id:"loading-course-run-".concat(O.id)},o.createElement(l._H,T.loadingInitial)));case E===h.IDLE:case E===h.ENROLLING:case E===h.ENROLLMENT_FAILED:return o.createElement(o.Fragment,null,o.createElement("button",{onClick:b,className:"course-run-enrollment__cta ".concat(E===h.ENROLLING?"course-run-enrollment__cta--loading":""),"aria-busy":E===h.ENROLLING},o.createElement(l._H,T.enroll),E===h.ENROLLING?o.createElement("span",{"aria-hidden":"true"},o.createElement(a.$,null,o.createElement(o.Fragment,null))):null),E===h.ENROLLMENT_FAILED?o.createElement("div",{className:"course-run-enrollment__errortext"},o.createElement(l._H,T.enrollmentFailed)):null);case E===h.ENROLLED:return o.createElement(o.Fragment,null,O.starts_in_message?o.createElement("div",null,O.dashboard_link?o.createElement("a",{href:O.dashboard_link,className:"course-run-enrollment__cta"},o.createElement(l._H,T.enrolled)):o.createElement("p",{className:"course-run-enrollment__helptext"},o.createElement(l._H,T.enrolled)),o.createElement("p",{className:"course-run-enrollment__helptext"},O.starts_in_message)):o.createElement("div",null,o.createElement("a",{href:O.resource_link,className:"course-run-enrollment__cta"},o.createElement(l._H,T.goToCourse)),o.createElement("div",{className:"course-run-enrollment__helptext"},o.createElement(l._H,T.enrolled))))}return E===h.FAILED&&p?(0,s.p)(p):(0,s.p)(new Error("<CourseRunEnrollment /> in an impossible state, ".concat(JSON.stringify(E)))),null}},42900:function(e,n,r){"use strict";var t=r(19882),o=r(68671).find,l=r(6677),a="find",c=!0;a in[]&&Array(1).find((function(){c=!1})),t({target:"Array",proto:!0,forced:c},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),l(a)}}]);
//# sourceMappingURL=59177.91ea99e24c51d022fa54.index.js.map