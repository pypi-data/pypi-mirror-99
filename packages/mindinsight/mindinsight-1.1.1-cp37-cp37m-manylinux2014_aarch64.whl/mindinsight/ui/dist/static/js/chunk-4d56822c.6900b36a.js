(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d56822c"],{"1b54":function(t,e,i){t.exports=i.p+"static/img/queue.9041b2bc.svg"},2659:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pro-router-wrap"},[a("div",{staticClass:"pro-router-left"},[a("div",{staticClass:"step-trace"},[a("div",{staticClass:"title-wrap"},[a("div",{staticClass:"title"},[t._v(t._s(t.$t("profiling.stepTrace")))]),a("div",{staticClass:"view-detail"},[a("button",{class:{disabled:t.svg.noData&&0===t.svg.data.length},attrs:{disabled:t.svg.noData&&0===t.svg.data.length},on:{click:function(e){return t.viewDetail("step-trace")}}},[t._v(t._s(t.$t("profiling.viewDetail"))+" "),a("i",{staticClass:"el-icon-d-arrow-right"})])]),a("div",{staticClass:"tip-icon"},[a("el-tooltip",{attrs:{placement:"bottom",effect:"light"}},[a("div",{staticClass:"tooltip-container",attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"font-size-style"},[t._v(t._s(t.$t("profiling.features")))]),a("div",[t._v(t._s(t.$t("profiling.iterationInfo")))]),a("div",[a("span",{staticClass:"font-style"},[t._v(t._s(t.$t("profiling.queueInfo"))+" ")]),a("span",[t._v(t._s(t.$t("profiling.iterationGapInfo")))])]),a("div",[a("span",{staticClass:"font-style"},[t._v(t._s(t.$t("profiling.fpbpTitle"))+" ")]),a("span",[t._v(t._s(t.$t("profiling.fpbpInfo")))])]),a("div",[a("span",{staticClass:"font-style"},[t._v(t._s(t.$t("profiling.iterativeTailingTitle"))+" ")]),a("span",[t._v(t._s(t.$t("profiling.iterativeTailingInfo")))])]),a("br"),a("div",{staticClass:"font-size-style"},[t._v(t._s(t.$t("profiling.statistics")))]),a("div",[t._v(t._s(t.$t("profiling.totalTime"))+" "),a("span",[t._v(t._s(t.totalTime)+t._s(t.$t("profiling.millisecond")))])]),a("div",[t._v(t._s(t.$t("profiling.totalSteps"))),a("span",[t._v(t._s(t.totalSteps))])]),a("div",[t._v(t._s(t.$t("profiling.iterationGapTimeRatio"))),a("span",[t._v(t._s(t.iterationIntervalPercent))])]),t.fpBpPercent?a("div",[t._v(t._s(t.$t("profiling.fpbpTimeRatio"))),a("span",[t._v(t._s(t.fpBpPercent))])]):a("div",[t._v(t._s(t.$t("profiling.fpTimeRatio"))),a("span",[t._v(t._s(t.fpPercent))])]),t.tailPercent?a("div",[t._v(" "+t._s(t.$t("profiling.iterativeTailingTimeRatio"))+" "),a("span",[t._v(t._s(t.tailPercent))])]):t._e()]),a("i",{staticClass:"el-icon-info"})])],1)]),a("div",{staticClass:"trace-container"},[a("div",{staticClass:"training-trace",style:{height:t.svg.totalHeight+"px"},attrs:{id:"trace"}},[a("svg",{attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg",height:"100%",width:"100%"}},[a("defs",[a("marker",{attrs:{id:"marker_end",refX:"5",refY:"4",markerWidth:"10",markerHeight:"8",orient:"auto"}},[a("path",{attrs:{d:"M1,1 L1,7 L9,4 z",fill:"#6c7280",stroke:"#6c7280"}})]),a("marker",{attrs:{id:"marker_start",refX:"5",refY:"4",markerWidth:"10",markerHeight:"8",orient:"auto"}},[a("path",{attrs:{d:"M9,1 L9,7 L1,4 z",fill:"#6c7280",stroke:"#6c7280"}})])])])]),t.svg.noData?a("div",{staticClass:"image-noData"},[a("div",[a("img",{attrs:{src:i("9485"),alt:""}})]),a("p",{directives:[{name:"show",rawName:"v-show",value:!t.svg.initOver,expression:"!svg.initOver"}]},[t._v(t._s(t.$t("public.dataLoading")))]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.svg.initOver,expression:"svg.initOver"}]},[t._v(t._s(t.$t("public.noData")))])]):t._e()])]),a("div",{staticClass:"minddata"},[a("div",{staticClass:"title-wrap"},[a("div",{staticClass:"title"},[t._v(t._s(t.$t("profiling.mindData")))]),a("div",{staticClass:"view-detail"},[a("button",{class:{disabled:t.processSummary.noData},attrs:{disabled:t.processSummary.noData},on:{click:function(e){return t.viewDetail("data-process")}}},[t._v(" "+t._s(t.$t("profiling.viewDetail"))+" "),a("i",{staticClass:"el-icon-d-arrow-right"})])]),a("div",{staticClass:"tip-icon"},[a("el-tooltip",{attrs:{placement:"bottom",effect:"light"}},[a("div",{staticClass:"tooltip-container",attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"font-size-style"},[t._v(t._s(t.$t("profiling.features")))]),a("div",[t._v(t._s(t.$t("profilingGPU.dataProcess")))]),a("div",[t._v(t._s(t.$t("profilingGPU.dataProcessInfo")))]),a("div",[t._v(t._s(t.$t("profilingGPU.analysisOne")))]),a("div",[t._v(t._s(t.$t("profilingGPU.analysisTwo")))]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.deviceInfoShow||t.queueInfoShow,expression:"deviceInfoShow || queueInfoShow"}]},[t._v(t._s(t.$t("profiling.higherAnalysis")))]),a("br"),a("div",{directives:[{name:"show",rawName:"v-show",value:t.deviceInfoShow||t.queueInfoShow,expression:"deviceInfoShow || queueInfoShow"}],staticClass:"font-size-style"},[t._v(t._s(t.$t("profiling.statistics")))]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.queueInfoShow,expression:"queueInfoShow"}]},[t._v(t._s(t.$t("profilingGPU.chipInfo"))+" "),a("span",[t._v(t._s(t.processSummary.get_next.empty)+" / "+t._s(t.processSummary.get_next.total))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.deviceInfoShow,expression:"deviceInfoShow"}]},[a("div",[t._v(t._s(t.$t("profiling.hostIsEmpty"))+" "),a("span",[t._v(t._s(t.processSummary.device.empty)+" / "+t._s(t.processSummary.device.total))])]),a("div",[t._v(t._s(t.$t("profiling.hostIsFull"))+" "),a("span",[t._v(t._s(t.processSummary.device.full)+" / "+t._s(t.processSummary.device.total))])])])]),a("i",{staticClass:"el-icon-info"})])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.processSummary.noData,expression:"!processSummary.noData"}],staticClass:"pipeline-container"},[a("div",{staticClass:"cell-container data-process"},[a("div",{staticClass:"title"},[t._v(" "+t._s(t.$t("profiling.pipeline"))+" ")])]),a("div",{staticClass:"queue-container"},[t._m(0),a("div",{staticClass:"title"},[t._v(t._s(t.$t("profiling.connectorQuene")))]),a("div",{staticClass:"description"},[a("div",{staticClass:"line"}),t.processSummary.device.empty||0===t.processSummary.device.empty?a("div",{staticClass:"item"},[t._v(" "+t._s(t.$t("profiling.queueTip2"))+" "),a("span",{staticClass:"num"},[t._v(" "+t._s(t.processSummary.device.empty)+" / "+t._s(t.processSummary.device.total)+" ")])]):t._e(),t.processSummary.device.full||0===t.processSummary.device.full?a("div",{staticClass:"item"},[t._v(" "+t._s(t.$t("profiling.queueTip1"))+" "),a("span",{staticClass:"num"},[t._v(" "+t._s(t.processSummary.device.full)+" / "+t._s(t.processSummary.device.total)+" ")])]):t._e()])]),a("div",{staticClass:"cell-container device_queue_op",attrs:{clickKey:"device_queue_op"}},[a("div",{staticClass:"title"},[t._v(" "+t._s(t.$t("profiling.deviceQueueOp"))+" ")])]),t.processSummary.count===t.processSummary.maxCount?a("div",{staticClass:"queue-container"},[t._m(1),a("div",{staticClass:"title"},[t._v(t._s(t.$t("profiling.dataQueue")))]),a("div",{staticClass:"description"},[a("div",{staticClass:"line"}),t.processSummary.get_next.empty||0===t.processSummary.get_next.empty?a("div",{staticClass:"item"},[t._v(" "+t._s(t.$t("profiling.queueTip2"))+" "),a("span",{staticClass:"num"},[t._v(" "+t._s(t.processSummary.get_next.empty)+" / "+t._s(t.processSummary.get_next.total)+" ")])]):t._e(),t.processSummary.get_next.full||0===t.processSummary.get_next.full?a("div",{staticClass:"item"},[t._v(" "+t._s(t.$t("profiling.queueTip1"))+" "),a("span",{staticClass:"num"},[t._v(" "+t._s(t.processSummary.get_next.full)+" / "+t._s(t.processSummary.get_next.total)+" ")])]):t._e()])]):t._e(),t.processSummary.count===t.processSummary.maxCount?a("div",{staticClass:"cell-container get-next",attrs:{clickKey:"get_next"}},[a("div",{staticClass:"title"},[t._v(" "+t._s(t.$t("profiling.getData"))+" ")])]):t._e()]),t.processSummary.noData?a("div",{staticClass:"image-noData"},[a("div",[a("img",{attrs:{src:i("9485"),alt:""}})]),a("p",{directives:[{name:"show",rawName:"v-show",value:!t.processSummary.initOver,expression:"!processSummary.initOver"}]},[t._v(t._s(t.$t("public.dataLoading")))]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.processSummary.initOver,expression:"processSummary.initOver"}]},[t._v(t._s(t.$t("public.noData")))])]):t._e()])]),a("div",{staticClass:"pro-router-right"},[a("div",{staticClass:"op-time-consume"},[a("div",{staticClass:"title-wrap"},[a("div",{staticClass:"title"},[t._v(t._s(t.$t("profiling.rankOfOperator")))]),a("div",{staticClass:"view-detail"},[a("button",{class:{disabled:t.pieChart.noData&&0===t.pieChart.data.length},attrs:{disabled:t.pieChart.noData&&0===t.pieChart.data.length},on:{click:function(e){return t.viewDetail("operator")}}},[t._v(t._s(t.$t("profiling.viewDetail"))+" "),a("i",{staticClass:"el-icon-d-arrow-right"})])])]),t.pieChart.noData?a("div",{staticClass:"image-noData"},[a("div",[a("img",{attrs:{src:i("9485"),alt:""}})]),a("p",{directives:[{name:"show",rawName:"v-show",value:!t.pieChart.initOver,expression:"!pieChart.initOver"}]},[t._v(t._s(t.$t("public.dataLoading")))]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.pieChart.initOver,expression:"pieChart.initOver"}]},[t._v(t._s(t.$t("public.noData")))])]):t._e(),a("div",{staticClass:"op-time-content"},[t.pieChart.data.length?a("div",{staticClass:"pie-chart",attrs:{id:"pieChart"}}):t._e(),t.pieChart.data.length?a("div",{staticClass:"time-list"},[a("ul",t._l(t.pieChart.topN,(function(e,i){return a("li",{key:i,staticClass:"item"},[a("span",{staticClass:"index",style:{"background-color":t.pieChart.colorList[i]}},[t._v(t._s(i+1))]),a("span",{staticClass:"name"},[t._v(t._s(e.name))]),a("span",{staticClass:"num"},[t._v(t._s(e.frequency+t.$t("profiling.times")))]),a("span",{staticClass:"time"},[a("span",{staticClass:"bar",style:{width:e.time/t.pieChart.topN[0].time*100+"%"}}),a("span",{staticClass:"value"},[t._v(t._s(e.time+t.$t("profiling.gpuunit")))])])])})),0)]):t._e()])]),a("div",{staticClass:"time-line"},[a("div",{staticClass:"title-wrap"},[a("div",{staticClass:"title"},[t._v(t._s(t.$t("profiling.timeLine")))]),a("div",{staticClass:"view-detail"},[a("button",{directives:[{name:"show",rawName:"v-show",value:!t.timeLine.waiting,expression:"!timeLine.waiting"}],class:{disabled:t.timeLine.disable},attrs:{disabled:t.timeLine.disable},on:{click:function(e){return t.downloadTimelineFile()}}},[t._v(t._s(t.$t("profiling.downloadTimeline"))+" ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.timeLine.waiting,expression:"timeLine.waiting"}],staticClass:"el-icon-loading loading-icon"})]),a("div",{staticClass:"tip-icon"},[a("el-tooltip",{attrs:{placement:"bottom",effect:"light"}},[a("div",{staticClass:"tooltip-container",attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"font-size-style"},[t._v(t._s(t.$t("profiling.features")))]),a("div",{staticClass:"font-style"},[t._v(t._s(t.$t("profiling.timelineTips.title1")))]),a("div",[t._v(t._s(t.$t("profiling.timelineTips.content12")))]),a("div",[t._v(t._s(t.$t("profiling.timelineTips.content13")))]),a("br"),a("div",{staticClass:"font-style"},[t._v(t._s(t.$t("profiling.timelineTips.title2")))]),a("div",[t._v(" "+t._s(t.$t("profiling.timelineTips.content21.part1"))+" "),a("b",[t._v(t._s(t.$t("profiling.timelineTips.content21.part2")))]),t._v(" "+t._s(t.$t("profiling.timelineTips.content21.part3"))+" ")]),a("div",[t._v(t._s(t.$t("profiling.timelineTips.content22")))]),a("div",[t._v(" "+t._s(t.$t("profiling.timelineTips.content23.part1"))+" "),a("b",[t._v(t._s(t.$t("profiling.timelineTips.content23.part2")))]),t._v(" "+t._s(t.$t("profiling.timelineTips.content23.part3"))+" "),a("b",[t._v(t._s(t.$t("profiling.timelineTips.content23.part4")))]),t._v(" "+t._s(t.$t("profiling.timelineTips.content23.part5"))+" "),a("b",[t._v(t._s(t.$t("profiling.timelineTips.content23.part6")))]),t._v(" "+t._s(t.$t("profiling.timelineTips.content23.part7"))+" ")]),a("br"),a("div",{staticClass:"font-style"},[t._v(t._s(t.$t("profiling.timelineTips.title3")))]),a("div",[t._v(t._s(t.$t("profiling.timelineTips.content31")))]),a("div",[t._v(t._s(t.$t("profiling.timelineTips.content32")))])]),a("i",{staticClass:"el-icon-info"})])],1)]),t.timelineInfo.noData?t._e():a("div",{staticClass:"timeline-info"},[a("div",{staticClass:"info-line"},[a("span",[t._v(t._s(t.$t("profiling.opTotalTime")))]),a("span",[t._v(t._s(t.timelineInfo.totalTime)+"ms")])]),a("div",{staticClass:"info-line"},[a("span",[t._v(t._s(t.$t("profiling.streamNum")))]),a("span",[t._v(t._s(t.timelineInfo.streamNum))])]),a("div",{staticClass:"info-line"},[a("span",[t._v(t._s(t.$t("profiling.opNum")))]),a("span",[t._v(t._s(t.timelineInfo.opNum))])]),a("div",{staticClass:"info-line"},[a("span",[t._v(t._s(t.$t("profiling.opTimes")))]),a("span",[t._v(t._s(t.timelineInfo.opTimes)+t._s(t.$t("profiling.times")))])])]),t.timelineInfo.noData?a("div",{staticClass:"image-noData"},[a("div",[a("img",{attrs:{src:i("9485"),alt:""}})]),a("p",{directives:[{name:"show",rawName:"v-show",value:!t.timelineInfo.initOver,expression:"!timelineInfo.initOver"}]},[t._v(t._s(t.$t("public.dataLoading")))]),a("p",{directives:[{name:"show",rawName:"v-show",value:t.timelineInfo.initOver,expression:"timelineInfo.initOver"}]},[t._v(t._s(t.$t("public.noData")))])]):t._e()])])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"img"},[a("div",{staticClass:"edge"},[a("img",{attrs:{src:i("7012"),alt:""}})]),a("div",{staticClass:"icon"},[a("img",{attrs:{src:i("1b54"),alt:"",clickKey:"connector_queue"}})]),a("div",{staticClass:"edge"},[a("img",{attrs:{src:i("7012"),alt:""}})])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"img"},[a("div",{staticClass:"edge"},[a("img",{attrs:{src:i("7012"),alt:""}})]),a("div",{staticClass:"icon"},[a("img",{attrs:{src:i("1b54"),clickKey:"data_queue",alt:""}})]),a("div",{staticClass:"edge"},[a("img",{attrs:{src:i("7012"),alt:""}})])])}],n=(i("99af"),i("4160"),i("e260"),i("d81d"),i("fb6a"),i("b0c0"),i("b64b"),i("d3b7"),i("3ca3"),i("159b"),i("ddb0"),i("2b3d"),i("313e")),r=i.n(n),o=i("3778"),l=i("2dd7"),c={data:function(){return{trainingJobId:this.$route.query.id,summaryPath:this.$route.query.dir,relativePath:this.$route.query.path,currentCard:"",queueInfoShow:!1,deviceInfoShow:!1,fpBpPercent:"--",fpPercent:"--",iterationIntervalPercent:"--",totalSteps:"--",totalTime:"--",tailPercent:"--",svg:{data:[],svgPadding:20,totalWidth:0,totalTime:0,cellHeight:40,cellPadding:0,rowPadding:20,rowMargin:10,totalHeight:0,markerPadding:4,minRate:.1,minTime:0,minWidth:1,fontSize:12,textMargin:21,namespaceURI:"http://www.w3.org/2000/svg",resizeTimer:null,colors:{iteration_interval:["#A6DD82","#edf8e6"],fp_and_bp:["#6CBFFF","#e2f2ff"],tail:["#fa8e5b","#fff4de"],stream_parallel:["#01a5a7","#cceded"]},noData:!0,initOver:!1},processSummary:{noData:!0,count:6,maxCount:6,device:{empty:0,full:0,total:0},get_next:{empty:0,full:0,total:0},initOver:!1},pieChart:{chartDom:null,data:[],noData:!0,topN:[],colorList:["#6C92FA","#6CBFFF","#4EDED2","#7ADFA0","#A6DD82"],initOver:!1},timeLine:{data:null,waiting:!0,disable:!0},timelineInfo:{totalTime:0,streamNum:0,opNum:0,opTimes:0,noData:!0,initOver:!1}}},mounted:function(){var t=this;setTimeout((function(){t.$bus.$on("collapse",t.resizeTrace)}),500)},watch:{"$parent.curDashboardInfo":{handler:function(t,e){""===t.curCardNum&&(this.svg.noData=!0,this.svg.initOver=!0,this.pieChart.noData=!0,this.pieChart.initOver=!0,this.processSummary.initOver=!0,this.timelineInfo.initOver=!0,this.timeLine.waiting=!1),t.query.dir&&t.query.id&&t.query.path&&t.curCardNum&&(this.summaryPath=t.query.dir,this.trainingJobId=t.query.id,this.relativePath=t.query.path,this.currentCard=t.curCardNum,this.trainingJobId?document.title="".concat(decodeURIComponent(this.trainingJobId),"-").concat(this.$t("profiling.profilingDashboard"),"-MindInsight"):document.title="".concat(this.$t("profiling.profilingDashboard"),"-MindInsight"),this.svg.initOver=!1,this.pieChart.initOver=!1,this.processSummary.initOver=!1,this.timelineInfo.initOver=!1,this.init())},deep:!0,immediate:!0}},methods:{init:function(){this.queryTimeline(),this.initPieChart(),this.getProccessSummary(),this.queryTrainingTrace(),window.addEventListener("resize",this.resizeTrace,!1)},getProccessSummary:function(){var t=this,e={train_id:this.trainingJobId,profile:this.summaryPath,device_id:this.currentCard};o["a"].queryProcessSummary(e).then((function(e){if(t.processSummary.initOver=!0,e&&e.data){var i=JSON.parse(JSON.stringify(e.data));t.processSummary.count=Object.keys(i).length,t.dealProcess(i)}else t.dealProcess(null),t.processSummary.initOver=!0}))},dealProcess:function(t){this.processSummary.device={empty:0,full:0,total:0},this.processSummary.get_next={empty:0,full:0,total:0},this.processSummary.noData=!0,t&&Object.keys(t).length&&(t.device_queue_info&&t.device_queue_info.summary&&(this.deviceInfoShow=!0,this.processSummary.device={empty:t.device_queue_info.summary.empty_batch_count,full:t.device_queue_info.summary.full_batch_count,total:t.device_queue_info.summary.total_batch}),t.get_next_queue_info&&t.get_next_queue_info.summary&&(this.queueInfoShow=!0,this.processSummary.get_next={empty:t.get_next_queue_info.summary.empty_batch_count,full:t.get_next_queue_info.summary.full_batch_count,total:t.get_next_queue_info.summary.total_batch}),this.processSummary.noData=!1)},viewDetail:function(t){this.$router.push({path:t,query:{id:this.trainingJobId,dir:this.summaryPath,path:this.relativePath}})},setPieOption:function(){var t=this,e={tooltip:{trigger:"item",formatter:function(t){return"".concat(t.data.name,"<br>").concat(t.marker).concat(t.percent,"%")},confine:!0,extraCssText:"white-space:normal; word-break:break-word;"}};e.series=[{type:"pie",center:["50%","50%"],data:this.pieChart.data,radius:"80%",label:{normal:{show:!1,positionL:"inner"}},itemStyle:{normal:{color:function(t){return l["a"].pieColorArr[t.dataIndex]}}}}],this.$nextTick((function(){var i=document.getElementById("pieChart");i?(t.pieChart.chartDom=r.a.init(i,null),t.pieChart.chartDom.setOption(e,!0),t.pieChart.chartDom.resize()):t.pieChart.chartDom&&t.pieChart.chartDom.clear()}),10)},initPieChart:function(){var t=this,e={};e.params={profile:this.summaryPath,train_id:this.trainingJobId},e.body={op_type:"gpu_op_type",device_id:this.currentCard,filter_condition:{},sort_condition:{name:"avg_time",type:"descending"}},o["a"].getProfilerOpData(e).then((function(e){t.pieChart.initOver=!0,e&&e.data&&e.data.object&&(t.pieChart.data=[],e.data.object.forEach((function(e){t.pieChart.data&&t.pieChart.data.length<5?t.pieChart.data.push({name:e[0],value:e[4],frequency:e[1],percent:e[3]}):(t.pieChart.data[5]||(t.pieChart.data[5]={name:"Other",value:0,percent:0}),t.pieChart.data[5].value+=e[4],t.pieChart.data[5].percent+=e[3])})),t.setPieOption(),t.pieChart.noData=!t.pieChart.data.length,t.pieChart.topN=t.pieChart.data.slice(0,Math.min(t.pieChart.data.length,5)).map((function(t){return{name:t.name,time:t.value,frequency:t.frequency}})))})).catch((function(){t.pieChart.data=[],t.pieChart.noData=!0,t.pieChart.initOver=!0}))},queryTimeline:function(){var t=this;this.timeLine.waiting=!0,this.timeLine.disable=!0;var e={dir:this.relativePath,device_id:this.currentCard,device_type:"gpu"};o["a"].queryTimlineInfo(e).then((function(e){t.timelineInfo.initOver=!0,e&&e.data?(t.timelineInfo.noData=!1,t.timelineInfo.totalTime=t.toFixedFun(e.data.total_time,4)||(0===e.data.total_time?0:"--"),t.timelineInfo.streamNum=e.data.num_of_streams||(0===e.data.num_of_streams?0:"--"),t.timelineInfo.opNum=e.data.num_of_ops||(0===e.data.num_of_ops?0:"--"),t.timelineInfo.opTimes=e.data.op_exe_times||(0===e.data.op_exe_times?0:"--")):t.timelineInfo.noData=!0})).catch((function(){t.timelineInfo.noData=!0,t.timelineInfo.initOver=!0})),o["a"].queryTimeline(e).then((function(e){t.timeLine.waiting=!1,e&&e.data&&e.data.length&&(t.timeLine.data=JSON.stringify(e.data),t.timeLine.disable=!1)})).catch((function(){t.timeLine.waiting=!1}))},downloadTimelineFile:function(){var t=document.createElement("a");t.download=this.getDocName(),t.style.display="none";var e=new Blob([this.timeLine.data]);t.href=URL.createObjectURL(e),document.body.appendChild(t),t.click(),document.body.removeChild(t)},getDocName:function(){var t=function(t){var e=t<10?"0":"";return e+t},e=new Date,i=e.getFullYear(),a=t(e.getMonth()+1),s=t(e.getDate()),n=t(e.getHours()),r=t(e.getMinutes()),o=t(e.getSeconds()),l=e.getMilliseconds(),c="".concat(i).concat(a).concat(s).concat(n).concat(r).concat(o).concat(l);return"timeline_".concat(this.trainingJobId,"_").concat(this.currentCard,"_").concat(c,".json")},toFixedFun:function(t,e){return isNaN(t)||isNaN(e)||!t||!e?t:Math.round(t*Math.pow(10,e))/Math.pow(10,e)},queryTrainingTrace:function(){var t=this,e={dir:this.relativePath,type:0,device_id:this.currentCard};o["a"].queryTrainingTrace(e).then((function(e){t.svg.initOver=!0,e&&e.data&&e.data.training_trace_graph&&e.data.training_trace_graph.length?(t.svg.noData=!1,t.removeTrace(),t.$nextTick((function(){t.packageTraceData(JSON.parse(JSON.stringify(e.data.training_trace_graph)))})),e.data.summary?(t.fpBpPercent=e.data.summary.fp_and_bp_percent,t.fpPercent=e.data.summary.fp_percent,t.iterationIntervalPercent=e.data.summary.iteration_interval_percent,t.totalSteps=e.data.summary.total_steps,t.totalTime=e.data.summary.total_time,t.tailPercent=e.data.summary.tail_percent):(t.fpBpPercent="--",t.iterationIntervalPercent="--",t.totalSteps="--",t.totalTime="--",t.tailPercent="--")):(t.svg.totalHeight=0,t.svg.noData=!0,t.svg.data=[],t.svg.initOver=!0,t.removeTrace())}),(function(e){t.svg.totalHeight=0,t.svg.noData=!0,t.svg.data=[],t.svg.initOver=!0,t.removeTrace(),t.fpBpPercent="--",t.iterationIntervalPercent="--",t.totalSteps="--",t.totalTime="--",t.tailPercent="--"}))},packageTraceData:function(t){var e=this;this.svg.totalTime=0,this.svg.minTime=0,this.svg.totalHeight=0;var i=[];t&&t[0]&&t[0][0]&&(this.svg.totalTime=t[0][0].duration,this.svg.minTime=this.svg.minRate*this.svg.totalTime,t.forEach((function(t,a){for(var s={rowCount:0,data:[],height:0,startY:e.svg.totalHeight},n=[],r=0;r<t.length;r++)t[r].duration<e.svg.minTime?(n.length&&(s.data.push(n),n=[],s.rowCount++),s.data.push([t[r]]),s.rowCount++):n.push(t[r]),r===t.length-1&&n.length&&(s.data.push(n),n=[],s.rowCount++);s.height=s.rowCount*e.svg.cellHeight+(s.rowCount-1)*e.svg.cellPadding+(a?2*e.svg.rowPadding:0),e.svg.totalHeight+=s.height+e.svg.rowMargin,i.push(s)})),this.svg.totalHeight+=this.svg.rowPadding,this.svg.data=JSON.parse(JSON.stringify(i)),this.$nextTick((function(){e.dealTraceData()})))},dealTraceData:function(){var t=this,e=document.querySelector("#trace");if(e)if(this.svg.totalWidth=e.offsetWidth-2*this.svg.svgPadding,this.svg.data[0]&&this.svg.data[0].data.length){var i=e.querySelector("svg");this.svg.totalTime&&this.svg.data.forEach((function(e,a){var s={};s=a?t.createMultipleRowContainer(e):t.createRowContainer(e.data,e.startY),i.appendChild(s)}))}else this.removeTrace()},createMultipleRowContainer:function(t){var e=document.createElementNS(this.svg.namespaceURI,"g");e.setAttribute("class","container");var i=document.createElementNS(this.svg.namespaceURI,"rect");i.setAttribute("x",this.svg.svgPadding),i.setAttribute("y",t.startY+this.svg.rowPadding),i.setAttribute("height",t.height),i.setAttribute("width",this.svg.totalWidth),i.setAttribute("style","fill:#edf0f5;stroke:#E2E2E2;stroke-width:1"),e.appendChild(i);var a=this.createRowContainer(t.data,t.startY+this.svg.rowPadding);return e.appendChild(a),e},createRowContainer:function(t,e){var i=this,a=document.createElementNS(this.svg.namespaceURI,"g");return t.forEach((function(t,s){var n=e+i.svg.rowPadding+s*(i.svg.cellPadding+i.svg.cellHeight);t.forEach((function(t){var e;t.duration&&(t.name?(e=i.createRect(t,n),a.insertBefore(e,a.querySelector("g"))):(e=i.createArrow(t,n),a.appendChild(e)))}))})),a},createRect:function(t,e){var i=t.name&&this.svg.colors[t.name]?this.svg.colors[t.name]:this.svg.colors.stream_parallel,a=t.start/this.svg.totalTime*this.svg.totalWidth+this.svg.svgPadding,s=Math.max(this.svg.minWidth,t.duration/this.svg.totalTime*this.svg.totalWidth),n="";switch(t.name){case"iteration_interval":n=this.$t("profiling.lterationGap");break;case"fp_and_bp":n=this.$t("profiling.deviceQueueOpTip");break;case"fp":n=this.$t("profiling.deviceQueueOpFpTip");break;case"tail":n=this.$t("profiling.lterationTail");break;default:n=t.name;break}var r="".concat(n,": ").concat(this.toFixedFun(t.duration,4),"ms"),o=this.getTextWidth(r),l=t.duration>=this.svg.minTime,c=document.createElementNS(this.svg.namespaceURI,"g");c.setAttribute("class","rect");var d=document.createElementNS(this.svg.namespaceURI,"rect");d.setAttribute("x",a),d.setAttribute("y",e),d.setAttribute("height",this.svg.cellHeight),d.setAttribute("width",s),d.setAttribute("style","fill:".concat(i[1],";stroke:").concat(i[0],";"));var v=document.createElementNS(this.svg.namespaceURI,"foreignObject");v.textContent=r,v.setAttribute("x",l?a:Math.min(2*this.svg.svgPadding+this.svg.totalWidth-o-this.svg.textMargin,Math.max(this.svg.textMargin,a+s/2-o/2))),v.setAttribute("y",e),v.setAttribute("height",this.svg.cellHeight),v.setAttribute("width",s),v.setAttribute("style","color:".concat(i[0])),v.setAttribute("class","content".concat(l?"":" content-mini"));var m=document.createElementNS(this.svg.namespaceURI,"title");return m.textContent=r,c.appendChild(d),c.appendChild(v),c.appendChild(m),c},createArrow:function(t,e){var i=t.duration/this.svg.totalTime*this.svg.totalWidth,a=t.start/this.svg.totalTime*this.svg.totalWidth+this.svg.svgPadding,s=e+this.svg.cellHeight/2,n=document.createElementNS(this.svg.namespaceURI,"g");n.setAttribute("class","arrow");var r=document.createElementNS(this.svg.namespaceURI,"line");r.setAttribute("y1",s),r.setAttribute("y2",s),r.setAttribute("style","stroke:#6c7280;stroke-width:1"),i>this.svg.markerPadding?(r.setAttribute("x1",a+this.svg.markerPadding),r.setAttribute("x2",a+i-this.svg.markerPadding),r.setAttribute("marker-end","url(#marker_end)"),r.setAttribute("marker-start","url(#marker_start)")):(r.setAttribute("x1",a),r.setAttribute("x2",a+i));var o=document.createElementNS(this.svg.namespaceURI,"text");o.textContent="".concat(t.duration===this.svg.totalTime?this.$t("profiling.approximateTime"):"").concat(this.toFixedFun(t.duration,4),"ms");var l=o.textContent?this.getTextWidth(o.textContent):0;o.setAttribute("x",Math.min(2*this.svg.svgPadding+this.svg.totalWidth-l-this.svg.textMargin,Math.max(this.svg.textMargin,i/2+a-l/2))),o.setAttribute("y",s-this.svg.fontSize/2),o.setAttribute("font-size",this.svg.fontSize),o.setAttribute("fill","black");var c=document.createElementNS(this.svg.namespaceURI,"line");c.setAttribute("x1",a),c.setAttribute("y1",e),c.setAttribute("x2",a),c.setAttribute("y2",e+this.svg.cellHeight),c.setAttribute("style","stroke:#6c7280;stroke-width:1"),n.appendChild(c);var d=document.createElementNS(this.svg.namespaceURI,"line");return d.setAttribute("x1",a+i),d.setAttribute("y1",e),d.setAttribute("x2",a+i),d.setAttribute("y2",e+this.svg.cellHeight),d.setAttribute("style","stroke:#6c7280;stroke-width:1"),n.appendChild(d),n.appendChild(r),n.appendChild(o),n},getTextWidth:function(t){var e=document.querySelector("body"),i=document.createElement("span");i.style["font-size"]="12px",i.textContent=t,e.appendChild(i);var a=i.offsetWidth;return e.removeChild(i),a},removeTrace:function(){var t=document.querySelector("#trace svg");if(t){var e=t.children;if(e)for(var i=0;i<e.length;i++)"g"===e[i].nodeName&&t.removeChild(e[i--])}},resizeTrace:function(){var t=this;this.svg.resizeTimer&&clearTimeout(this.svg.resizeTimer),this.svg.resizeTimer=setTimeout((function(){t.removeTrace(),t.dealTraceData(),t.svg.resizeTimer=null}),500)}},destroyed:function(){window.removeEventListener("resize",this.resizeTrace,!1),this.$bus.$off("collapse")}},d=c,v=(i("fd5c"),i("2877")),m=Object(v["a"])(d,a,s,!1,null,null,null);e["default"]=m.exports},b64b:function(t,e,i){var a=i("23e7"),s=i("7b0b"),n=i("df75"),r=i("d039"),o=r((function(){n(1)}));a({target:"Object",stat:!0,forced:o},{keys:function(t){return n(s(t))}})},d81d:function(t,e,i){"use strict";var a=i("23e7"),s=i("b727").map,n=i("1dde"),r=i("ae40"),o=n("map"),l=r("map");a({target:"Array",proto:!0,forced:!o||!l},{map:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})},e0bd:function(t,e,i){},fd5c:function(t,e,i){"use strict";i("e0bd")}}]);