(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2748c34e"],{"1dad":function(t,e,a){"use strict";a("90c4")},"90c4":function(t,e,a){},9485:function(t,e,a){t.exports=a.p+"static/img/nodata.8290bed9.png"},b0c0:function(t,e,a){var i=a("83ab"),s=a("9bf2").f,r=Function.prototype,n=r.toString,o=/^\s*function ([^ (]*)/,c="name";i&&!(c in r)&&s(r,c,{configurable:!0,get:function(){try{return n.call(this).match(o)[1]}catch(t){return""}}})},b64b:function(t,e,a){var i=a("23e7"),s=a("7b0b"),r=a("df75"),n=a("d039"),o=n((function(){r(1)}));i({target:"Object",stat:!0,forced:o},{keys:function(t){return r(s(t))}})},e2d9:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"step-trace"},[i("div",{staticClass:"step-trace-title"},[t._v(t._s(t.$t("profiling.stepTraceDetail"))+" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:t.$t("profiling.defaultTip"),placement:"top"}},[i("span",{staticClass:"el-icon-info"})]),i("div",{directives:[{name:"show",rawName:"v-show",value:!(t.tabsArr[0].noData&&t.tabsArr[1].noData&&t.tabsArr[2].noData&&t.svg.noData),expression:"!(tabsArr[0].noData && tabsArr[1].noData && tabsArr[2].noData && svg.noData)"}],staticClass:"pf-content-right"},[i("div",{staticClass:"input-wrap"},[i("label",[t._v(t._s(t.steps.label))]),i("el-input",{ref:"step",attrs:{disabled:t.steps.disabled,clearable:""},on:{blur:t.resetStep,clear:t.clearStep},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.changeStep(e)}},model:{value:t.steps.step,callback:function(e){t.$set(t.steps,"step",t._n(e))},expression:"steps.step"}}),i("el-button",{attrs:{disabled:t.steps.disabled},on:{click:t.changeStep}},[t._v(" "+t._s(t.$t("public.sure"))+" ")])],1)]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!(t.tabsArr[0].noData&&t.tabsArr[1].noData&&t.tabsArr[2].noData&&t.svg.noData),expression:"!(tabsArr[0].noData && tabsArr[1].noData && tabsArr[2].noData && svg.noData)"}],staticClass:"show-average",attrs:{disabled:t.steps.disabled},on:{click:function(e){return t.changeStep(0)}}},[t._v(" "+t._s(t.$t("profiling.showAverage"))+" ")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:!(t.tabsArr[0].noData&&t.tabsArr[1].noData&&t.tabsArr[2].noData&&t.svg.noData),expression:"!(tabsArr[0].noData && tabsArr[1].noData && tabsArr[2].noData && svg.noData)"}],staticClass:"step-message"},[i("div",{staticClass:"step-left-padding-right"},[i("span",{staticClass:"font-weight-style"},[t._v(t._s(t.$t("profiling.FPMessage")))]),i("span",[t._v(t._s(t.fp_start))])]),t.bp_end?i("div",{staticClass:"step-padding-right"},[i("span",{staticClass:"font-weight-style"},[t._v(t._s(t.$t("profiling.BPMessage")))]),i("span",[t._v(t._s(t.bp_end))])]):t._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:!(t.tabsArr[0].noData&&t.tabsArr[1].noData&&t.tabsArr[2].noData&&t.svg.noData),expression:"!(tabsArr[0].noData && tabsArr[1].noData && tabsArr[2].noData && svg.noData)"}],staticClass:"pf-content-middle"},[i("div",{attrs:{id:"trace-container"}},[i("div",{staticClass:"training-trace",style:{height:t.svg.totalHeight+"px"},attrs:{id:"trace"}},[i("svg",{attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg",height:"100%",width:"100%"}},[i("defs",[i("marker",{attrs:{id:"marker_end",refX:"5",refY:"4",markerWidth:"10",markerHeight:"8",orient:"auto"}},[i("path",{attrs:{d:"M1,1 L1,7 L9,4 z",fill:"#6c7280",stroke:"#6c7280"}})]),i("marker",{attrs:{id:"marker_start",refX:"5",refY:"4",markerWidth:"10",markerHeight:"8",orient:"auto"}},[i("path",{attrs:{d:"M9,1 L9,7 L1,4 z",fill:"#6c7280",stroke:"#6c7280"}})])])])]),t.svg.noData?i("div",{staticClass:"image-noData svg"},[i("div",[i("img",{attrs:{src:a("9485"),alt:""}})]),i("p",[t._v(t._s(t.svg.initOver?t.$t("public.noData"):t.$t("public.dataLoading")))])]):t._e()]),t._l(t.tabsArr,(function(e,s){return[2!==s||t.bp_end?i("div",{key:s,staticClass:"chart-wrap",class:{"chart-show":2!==s&&!t.bp_end}},[i("div",{staticClass:"title"},[t._v(t._s(e.name))]),i("div",{staticClass:"rate-wrap"},[void 0!==e.timeSummary[e.rate]?i("div",[i("span",[t._v(t._s(e.timeLabel)+":")]),t._v(" "+t._s(e.timeSummary[e.rate])+"ms ")]):t._e(),void 0!==e.timeSummary[e.percent]?i("div",[i("span",[t._v(t._s(e.rateLabel)+":")]),t._v(t._s(e.timeSummary[e.percent])+" ")]):t._e(),void 0!==e.timeSummary.total_steps?i("div",[i("span",[t._v(t._s(t.$t("profiling.stepNum"))+":")]),t._v(t._s(e.timeSummary.total_steps)+" ")]):t._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.noData,expression:"!item.noData"}],staticClass:"chart",attrs:{id:e.id}}),e.noData?i("div",{staticClass:"image-noData"},[i("div",[i("img",{attrs:{src:a("9485"),alt:""}})]),i("p",[t._v(t._s(e.initOver?t.$t("public.noData"):t.$t("public.dataLoading")))])]):t._e()]):t._e()]}))],2),t.tabsArr[0].noData&&t.tabsArr[1].noData&&t.tabsArr[2].noData&&t.svg.noData?i("div",{staticClass:"image-noData"},[i("div",[i("img",{attrs:{src:a("9485"),alt:""}})]),i("p",[t._v(t._s(t.svg.initOver?t.$t("public.noData"):t.$t("public.dataLoading")))])]):t._e()])},s=[],r=(a("99af"),a("4160"),a("b0c0"),a("b64b"),a("ac1f"),a("5319"),a("159b"),a("313e")),n=a.n(r),o=a("3778"),c={data:function(){return{dir:this.$route.query.dir,train_id:this.$route.query.id,relativePath:this.$route.query.path,fp_start:"--",bp_end:"--",steps:{step:null,trueStep:null,max:0,disabled:!0,label:this.$t("profiling.stepInputTip")},charts:[],svg:{data:[],svgPadding:20,totalWidth:0,totalTime:0,cellHeight:40,cellPadding:0,rowPadding:20,rowMargin:10,totalHeight:0,markerPadding:4,minRate:.1,minTime:0,minWidth:1,fontSize:12,textMargin:21,namespaceURI:"http://www.w3.org/2000/svg",resizeTimer:null,colors:{iteration_interval:["#A6DD82","#edf8e6"],fp_and_bp:["#6CBFFF","#e2f2ff"],tail:["#fa8e5b","#fff4de"],stream_parallel:["#01a5a7","#cceded"]},noData:!0,initOver:!1},deviceId:0,radio:this.$t("profiling.lterationGap"),tabsArr:[{name:this.$t("profiling.lterationGap"),id:"iter-gap",timeSummary:{},rate:"iteration_interval",timeLabel:this.$t("profiling.iterGapTimeLabel"),rateLabel:this.$t("profiling.iterGapRateLabel"),noData:!0,percent:"iteration_interval_percent",initOver:!1},{name:this.$t("profiling.deviceQueueOpTip"),id:"fp-bp",timeSummary:{},rate:"fp_and_bp",timeLabel:this.$t("profiling.fpBpTimeLabel"),rateLabel:this.$t("profiling.fpBpRateLabel"),noData:!0,percent:"fp_and_bp_percent",initOver:!1},{name:this.$t("profiling.lterationTail"),id:"tailing",timeSummary:{},rate:"tail",timeLabel:this.$t("profiling.tailTimeLabel"),rateLabel:this.$t("profiling.tailRateLabel"),noData:!0,percent:"tail_percent",initOver:!1}]}},watch:{"$parent.curDashboardInfo":{handler:function(t,e){(t.curCardNum||0===t.curCardNum)&&(this.dir=t.query.dir,this.train_id=t.query.id,this.deviceId=t.curCardNum,this.relativePath=t.query.path,this.train_id?document.title="".concat(decodeURIComponent(this.train_id),"-").concat(this.$t("profiling.stepTrace"),"-MindInsight"):document.title="".concat(this.$t("profiling.stepTrace"),"-MindInsight"),this.svg.noData=!0,this.svg.initOver=!1,this.tabsArr.forEach((function(t){t.noData=!0,t.initOver=!1})),this.init()),t.initOver&&(this.svg.initOver=!0,this.tabsArr.forEach((function(t){t.initOver=!0})))},deep:!0,immediate:!0}},computed:{},mounted:function(){var t=this;setTimeout((function(){t.$bus.$on("collapse",(function(){t.resizeTrace(),t.resizeEchart()}))}),500)},methods:{init:function(){window.addEventListener("resize",this.resizeTrace,!1),window.addEventListener("resize",this.resizeEchart,!1),this.charts.length&&this.charts.forEach((function(t){t.clear()})),this.steps={step:null,trueStep:null,max:0,disabled:!0,label:this.$t("profiling.stepInputTip")},this.queryTrainingTrace(0,!0)},changeStep:function(t){0===t||!this.steps.step&&0!==this.steps.step?(this.steps.step=null,this.steps.trueStep=null,this.queryTrainingTrace(0,!1)):/^[0-9]*[1-9][0-9]*$/.test(this.steps.step)&&this.steps.step<=this.steps.max?(this.steps.trueStep=this.steps.step,this.queryTrainingTrace(this.steps.step,!1)):(this.steps.step=this.steps.trueStep,this.$message.error(this.$t("profiling.inputError").replace("{max}",this.steps.max)))},resetStep:function(){var t=this;setTimeout((function(){t.$refs.step.focused||(t.steps.step=t.steps.trueStep)}),200)},clearStep:function(){this.steps.step=null,this.$refs.step.focus()},getTimeInfo:function(t,e){var a=this,i={dir:this.relativePath,type:e,device_id:this.deviceId};o["a"].targetTimeInfo(i).then((function(i){if(i&&i.data&&i.data.summary){var s=i.data.summary;Object.keys(s).forEach((function(t){s[t]=s[t]})),a.tabsArr.forEach((function(e){t===e.id&&(e.timeSummary=s)}))}if(i&&i.data&&i.data.info){i.data.size&&!a.steps.max&&(a.steps.max=i.data.size,a.steps.disabled=!1,a.steps.label=a.steps.label.replace("{max}",a.steps.max));for(var r=[],n=1;n<=a.steps.max;n++)r.push(n);var o=[];if(Object.keys(i.data.info).forEach((function(t){o.push({data:i.data.info[t],name:t,type:"line"})})),o.length){var c={xAxis:{type:"category",data:r,name:"step"},yAxis:{type:"value",name:"",nameTextStyle:{padding:[0,0,0,-30],align:"left"}},grid:{left:50,top:50,right:50,bottom:50},series:o,tooltip:{trigger:"axis",confine:!0},dataZoom:[{bottom:0},{type:"inside",bottom:0}]};"iteration_interval"===e?(c.yAxis.name="".concat(a.$t("profiling.iterationGapTime"),"(ms)"),a.tabsArr[0].noData=!a.steps.max,a.tabsArr[0].initOver=!0):"fp_and_bp"===e||"fp"===e?(c.yAxis.name="".concat("fp_and_bp"===e?a.$t("profiling.fpBpTime"):a.$t("profiling.fpTime"),"(ms)"),a.tabsArr[1].noData=!a.steps.max,a.tabsArr[1].initOver=!0,a.tabsArr[1].name="fp_and_bp"===e?a.$t("profiling.deviceQueueOpTip"):a.$t("profiling.deviceQueueOpFpTip")):"tail"===e&&(c.yAxis.name="".concat(a.$t("profiling.tailTime"),"(ms)"),a.tabsArr[2].noData=!a.steps.max,a.tabsArr[2].initOver=!0),a.initChart(c,t)}}}),(function(t){"iteration_interval"===e?(a.tabsArr[0].noData=!0,a.tabsArr[0].initOver=!0):"fp_and_bp"===e||"fp"===e?(a.tabsArr[1].noData=!0,a.tabsArr[1].initOver=!0,a.tabsArr[1].name="fp_and_bp"===e?a.$t("profiling.deviceQueueOpTip"):a.$t("profiling.deviceQueueOpFpTip")):"tail"===e&&(a.tabsArr[2].noData=!0,a.tabsArr[2].initOver=!0)}))},initChart:function(t,e){var a=this;this.$nextTick((function(){var i=n.a.init(document.getElementById(e));i.setOption(t,!0),a.charts.push(i)}))},resizeEchart:function(){var t=this;setTimeout((function(){t.charts.forEach((function(t){t.resize()}))}),300)},queryTrainingTrace:function(t,e){var a=this,i={dir:this.relativePath,type:t,device_id:this.deviceId};o["a"].queryTrainingTrace(i).then((function(t){a.svg.initOver=!0,t&&t.data&&t.data.training_trace_graph&&t.data.training_trace_graph.length?(a.svg.noData=!1,t.data.point_info?(a.fp_start=t.data.point_info.fp_start?t.data.point_info.fp_start:"--",a.bp_end=t.data.point_info.bp_end?t.data.point_info.bp_end:""):(a.fp_start="--",a.bp_end="--"),a.removeTrace(),a.$nextTick((function(){a.packageTraceData(JSON.parse(JSON.stringify(t.data.training_trace_graph)))})),e&&(a.getTimeInfo("fp-bp",a.bp_end?"fp_and_bp":"fp"),a.getTimeInfo("iter-gap","iteration_interval"),a.bp_end&&a.getTimeInfo("tailing","tail"))):(a.fp_start="--",a.bp_end="--",a.svg.data=[],a.svg.noData=!0,a.removeTrace(),a.tabsArr.forEach((function(t){t.noData=!0,t.initOver=!0})))}),(function(t){a.fp_start="--",a.bp_end="--",a.svg.data=[],a.svg.noData=!0,a.svg.initOver=!0,a.removeTrace(),a.tabsArr.forEach((function(t){t.noData=!0,t.initOver=!0}))}))},packageTraceData:function(t){var e=this;this.svg.totalTime=0,this.svg.minTime=0,this.svg.totalHeight=0;var a=[];t&&t[0]&&t[0][0]&&(this.svg.totalTime=t[0][0].duration,this.svg.minTime=this.svg.minRate*this.svg.totalTime,t.forEach((function(t,i){for(var s={rowCount:0,data:[],height:0,startY:e.svg.totalHeight},r=[],n=0;n<t.length;n++)t[n].duration<e.svg.minTime?(r.length&&(s.data.push(r),r=[],s.rowCount++),s.data.push([t[n]]),s.rowCount++):r.push(t[n]),n===t.length-1&&r.length&&(s.data.push(r),r=[],s.rowCount++);s.height=s.rowCount*e.svg.cellHeight+(s.rowCount-1)*e.svg.cellPadding+(i?2*e.svg.rowPadding:0),e.svg.totalHeight+=s.height+e.svg.rowMargin,a.push(s)})),this.svg.totalHeight+=this.svg.rowPadding,this.svg.data=JSON.parse(JSON.stringify(a)),this.$nextTick((function(){e.dealTraceData()})))},dealTraceData:function(){var t=this,e=document.querySelector("#trace");if(e)if(this.svg.totalWidth=e.offsetWidth-2*this.svg.svgPadding,this.svg.data[0]&&this.svg.data[0].data.length){var a=e.querySelector("svg");this.svg.totalTime&&this.svg.data.forEach((function(e,i){var s={};s=i?t.createMultipleRowContainer(e):t.createRowContainer(e.data,e.startY),a.appendChild(s)}))}else this.removeTrace()},createMultipleRowContainer:function(t){var e=document.createElementNS(this.svg.namespaceURI,"g");e.setAttribute("class","container");var a=document.createElementNS(this.svg.namespaceURI,"rect");a.setAttribute("x",this.svg.svgPadding),a.setAttribute("y",t.startY+this.svg.rowPadding),a.setAttribute("height",t.height),a.setAttribute("width",this.svg.totalWidth),a.setAttribute("style","fill:#edf0f5;stroke:#E2E2E2;stroke-width:1"),e.appendChild(a);var i=this.createRowContainer(t.data,t.startY+this.svg.rowPadding);return e.appendChild(i),e},createRowContainer:function(t,e){var a=this,i=document.createElementNS(this.svg.namespaceURI,"g");return t.forEach((function(t,s){var r=e+a.svg.rowPadding+s*(a.svg.cellPadding+a.svg.cellHeight);t.forEach((function(t){var e;t.duration&&(t.name?(e=a.createRect(t,r),i.insertBefore(e,i.querySelector("g"))):(e=a.createArrow(t,r),i.appendChild(e)))}))})),i},createRect:function(t,e){var a=t.name&&this.svg.colors[t.name]?this.svg.colors[t.name]:this.svg.colors.stream_parallel,i=t.start/this.svg.totalTime*this.svg.totalWidth+this.svg.svgPadding,s=Math.max(this.svg.minWidth,t.duration/this.svg.totalTime*this.svg.totalWidth),r="";switch(t.name){case"iteration_interval":r=this.$t("profiling.lterationGap");break;case"fp_and_bp":r=this.$t("profiling.deviceQueueOpTip");break;case"fp":r=this.$t("profiling.deviceQueueOpFpTip");break;case"tail":r=this.$t("profiling.lterationTail");break;default:r=t.name;break}var n="".concat(r,": ").concat(this.toFixedFun(t.duration,4),"ms"),o=this.getTextWidth(n),c=t.duration>=this.svg.minTime,l=document.createElementNS(this.svg.namespaceURI,"g");l.setAttribute("class","rect");var d=document.createElementNS(this.svg.namespaceURI,"rect");d.setAttribute("x",i),d.setAttribute("y",e),d.setAttribute("height",this.svg.cellHeight),d.setAttribute("width",s),d.setAttribute("style","fill:".concat(a[1],";stroke:").concat(a[0],";"));var p=document.createElementNS(this.svg.namespaceURI,"foreignObject");p.textContent=n,p.setAttribute("x",c?i:Math.min(2*this.svg.svgPadding+this.svg.totalWidth-o-this.svg.textMargin,Math.max(this.svg.textMargin,i+s/2-o/2))),p.setAttribute("y",e),p.setAttribute("height",this.svg.cellHeight),p.setAttribute("width",s),p.setAttribute("style","color:".concat(a[0])),p.setAttribute("class","content".concat(c?"":" content-mini"));var h=document.createElementNS(this.svg.namespaceURI,"title");return h.textContent=n,l.appendChild(d),l.appendChild(p),l.appendChild(h),l},createArrow:function(t,e){var a=t.duration/this.svg.totalTime*this.svg.totalWidth,i=t.start/this.svg.totalTime*this.svg.totalWidth+this.svg.svgPadding,s=e+this.svg.cellHeight/2,r=document.createElementNS(this.svg.namespaceURI,"g");r.setAttribute("class","arrow");var n=document.createElementNS(this.svg.namespaceURI,"line");n.setAttribute("y1",s),n.setAttribute("y2",s),n.setAttribute("style","stroke:#6c7280;stroke-width:1"),a>this.svg.markerPadding?(n.setAttribute("x1",i+this.svg.markerPadding),n.setAttribute("x2",i+a-this.svg.markerPadding),n.setAttribute("marker-end","url(#marker_end)"),n.setAttribute("marker-start","url(#marker_start)")):(n.setAttribute("x1",i),n.setAttribute("x2",i+a));var o=document.createElementNS(this.svg.namespaceURI,"text");o.textContent="".concat(t.duration===this.svg.totalTime?this.$t("profiling.approximateTime"):"").concat(this.toFixedFun(t.duration,4),"ms");var c=o.textContent?this.getTextWidth(o.textContent):0;o.setAttribute("x",Math.min(2*this.svg.svgPadding+this.svg.totalWidth-c-this.svg.textMargin,Math.max(this.svg.textMargin,a/2+i-c/2))),o.setAttribute("y",s-this.svg.fontSize/2),o.setAttribute("font-size",this.svg.fontSize),o.setAttribute("fill","black");var l=document.createElementNS(this.svg.namespaceURI,"line");l.setAttribute("x1",i),l.setAttribute("y1",e),l.setAttribute("x2",i),l.setAttribute("y2",e+this.svg.cellHeight),l.setAttribute("style","stroke:#6c7280;stroke-width:1"),r.appendChild(l);var d=document.createElementNS(this.svg.namespaceURI,"line");return d.setAttribute("x1",i+a),d.setAttribute("y1",e),d.setAttribute("x2",i+a),d.setAttribute("y2",e+this.svg.cellHeight),d.setAttribute("style","stroke:#6c7280;stroke-width:1"),r.appendChild(d),r.appendChild(n),r.appendChild(o),r},getTextWidth:function(t){var e=document.querySelector("body"),a=document.createElement("span");a.style["font-size"]="12px",a.textContent=t,e.appendChild(a);var i=a.offsetWidth;return e.removeChild(a),i},removeTrace:function(){var t=document.querySelector("#trace svg");if(t){var e=t.children;if(e)for(var a=0;a<e.length;a++)"g"===e[a].nodeName&&t.removeChild(e[a--])}},resizeTrace:function(){var t=this;this.svg.resizeTimer&&clearTimeout(this.svg.resizeTimer),this.svg.resizeTimer=setTimeout((function(){t.removeTrace(),t.dealTraceData(),t.svg.resizeTimer=null}),500)},toFixedFun:function(t,e){return isNaN(t)||isNaN(e)||!t||!e?t:Math.round(t*Math.pow(10,e))/Math.pow(10,e)}},destroyed:function(){window.removeEventListener("resize",this.resizeTrace,!1),window.removeEventListener("resize",this.resizeEchart,!1),this.$bus.$off("collapse")}},l=c,d=(a("1dad"),a("2877")),p=Object(d["a"])(l,i,s,!1,null,null,null);e["default"]=p.exports}}]);