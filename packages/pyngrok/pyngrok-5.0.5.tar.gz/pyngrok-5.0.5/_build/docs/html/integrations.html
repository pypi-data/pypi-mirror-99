
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Integration Examples &#8212; pyngrok 5.0.5 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="API Documentation" href="api.html" />
    
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


    <meta name="description"
          content="A Python wrapper for ngrok that makes ngrok readily available from anywhere on the command line and via a convenient Python API."/>

    <!-- Twitter Card data -->
    <meta name="twitter:title" content="pyngrok - A Python wrapper for ngrok">
    <meta name="twitter:card"
          value="A Python wrapper for ngrok that makes ngrok readily available from anywhere on the command line and via a convenient Python API.">

    <!-- Open Graph data -->
    <meta property="og:title" content="pyngrok - A Python wrapper for ngrok"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://pyngrok.readthedocs.io/en/latest/integrations.html"/>
    <meta property="og:image" content="https://pyngrok.readthedocs.io/en/latest/_images/logo.png"/>
    <meta property="og:description"
          content="A Python wrapper for ngrok that makes ngrok readily available from anywhere on the command line and via a convenient Python API."/>

    <meta name="yandex-verification" content="ac8f18b56add6591"/>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43184722-4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-43184722-4');
    </script>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="integration-examples">
<h1>Integration Examples<a class="headerlink" href="#integration-examples" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> is useful in any number of integrations to let us test things locally without having to deploy,
for instance to test locally without having to deploy or configure anything. Below are some common usage examples.</p>
<div class="section" id="flask">
<h2>Flask<a class="headerlink" href="#flask" title="Permalink to this headline">¶</a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">server.py</span></code>, <a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/tutorial/factory/#the-application-factory">where our Flask app is initialized</a>,
we should add a variable that let’s us configure from an environment variable whether we want to open a tunnel
to <code class="docutils literal notranslate"><span class="pre">localhost</span></code> with <code class="docutils literal notranslate"><span class="pre">ngrok</span></code> when the dev server starts. We can initialize the <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> tunnel in this
same place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="k">def</span> <span class="nf">init_webhooks</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
    <span class="c1"># Update inbound traffic via APIs to use the public-facing ngrok URL</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">create_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># Initialize our ngrok settings into Flask</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_mapping</span><span class="p">(</span>
        <span class="n">BASE_URL</span><span class="o">=</span><span class="s2">&quot;http://localhost:5000&quot;</span><span class="p">,</span>
        <span class="n">USE_NGROK</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;USE_NGROK&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WERKZEUG_RUN_MAIN&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;true&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ENV&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;development&quot;</span> <span class="ow">and</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;USE_NGROK&quot;</span><span class="p">]:</span>
        <span class="c1"># pyngrok will only be installed, and should only ever be initialized, in a dev environment</span>
        <span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>

        <span class="c1"># Get the dev server port (defaults to 5000 for Flask, can be overridden with `--port`</span>
        <span class="c1"># when starting the server</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;--port&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;--port&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="k">else</span> <span class="mi">5000</span>

        <span class="c1"># Open a ngrok tunnel to the dev server</span>
        <span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="o">.</span><span class="n">public_url</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; * ngrok tunnel </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> -&gt; </span><span class="se">\&quot;</span><span class="s2">http://127.0.0.1:</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">public_url</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

        <span class="c1"># Update any base URLs or webhooks to use the public ngrok URL</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;BASE_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">public_url</span>
        <span class="n">init_webhooks</span><span class="p">(</span><span class="n">public_url</span><span class="p">)</span>

    <span class="c1"># ... Initialize Blueprints and the rest of our app</span>

    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
<p>Now Flask can be started in development by the usual means, setting <code class="docutils literal notranslate"><span class="pre">USE_NGROK</span></code> to open a tunnel.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">USE_NGROK</span><span class="o">=</span>True <span class="nv">FLASK_ENV</span><span class="o">=</span>development <span class="nv">FLASK_APP</span><span class="o">=</span>server.py flask run
</pre></div>
</div>
</div>
<div class="section" id="django">
<h2>Django<a class="headerlink" href="#django" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference external" href="https://docs.djangoproject.com/en/3.0/topics/settings/">settings.py</a> of
<a class="reference external" href="https://docs.djangoproject.com/en/3.0/intro/tutorial01/#creating-a-project">our Django project</a>, we should add a
variable that let’s us configure from an environment variable whether we want to open a tunnel to
<code class="docutils literal notranslate"><span class="pre">localhost</span></code> with <code class="docutils literal notranslate"><span class="pre">ngrok</span></code> when the dev server starts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># ... The rest of our Django settings</span>

<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8000&quot;</span>

<span class="n">DEV_SERVER</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;runserver&quot;</span>

<span class="n">USE_NGROK</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;USE_NGROK&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;RUN_MAIN&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
<p>If this flag is set, we want to initialize <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> when Django is booting from its dev server. An easy place
to do this is one of our <code class="docutils literal notranslate"><span class="pre">apps.py</span></code> by <a class="reference external" href="https://docs.djangoproject.com/en/3.0/ref/applications/#django.apps.AppConfig.ready">extending AppConfig</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">AppConfig</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>


<span class="k">class</span> <span class="nc">CommonConfig</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;myproject.common&quot;</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Common&quot;</span>

    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEV_SERVER</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_NGROK</span><span class="p">:</span>
            <span class="c1"># pyngrok will only be installed, and should only ever be initialized, in a dev environment</span>
            <span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>

            <span class="c1"># Get the dev server port (defaults to 8000 for Django, can be overridden with the</span>
            <span class="c1"># last arg when calling `runserver`)</span>
            <span class="n">addrport</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="s2">&quot;http://</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">addrport</span><span class="o">.</span><span class="n">port</span> <span class="k">if</span> <span class="n">addrport</span><span class="o">.</span><span class="n">netloc</span> <span class="ow">and</span> <span class="n">addrport</span><span class="o">.</span><span class="n">port</span> <span class="k">else</span> <span class="mi">8000</span>

            <span class="c1"># Open a ngrok tunnel to the dev server</span>
            <span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="o">.</span><span class="n">public_url</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ngrok tunnel </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> -&gt; </span><span class="se">\&quot;</span><span class="s2">http://127.0.0.1:</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">public_url</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

            <span class="c1"># Update any base URLs or webhooks to use the public ngrok URL</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">BASE_URL</span> <span class="o">=</span> <span class="n">public_url</span>
            <span class="n">CommonConfig</span><span class="o">.</span><span class="n">init_webhooks</span><span class="p">(</span><span class="n">public_url</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">init_webhooks</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
        <span class="c1"># Update inbound traffic via APIs to use the public-facing ngrok URL</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Now the Django dev server can be started by the usual means, setting <code class="docutils literal notranslate"><span class="pre">USE_NGROK</span></code> to open a tunnel.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">USE_NGROK</span><span class="o">=</span>True python manage.py runserver
</pre></div>
</div>
</div>
<div class="section" id="fastapi">
<h2>FastAPI<a class="headerlink" href="#fastapi" title="Permalink to this headline">¶</a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">server.py</span></code>, <a class="reference external" href="https://fastapi.tiangolo.com/tutorial/first-steps/">where our FastAPI app is initialized</a>,
we should add a variable that let’s us configure from an environment variable whether we want to tunnel to
<code class="docutils literal notranslate"><span class="pre">localhost</span></code> with <code class="docutils literal notranslate"><span class="pre">ngrok</span></code>. We can initialize the <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> tunnel in this same place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">fastapi.logger</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseSettings</span>


<span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="c1"># ... The rest of our FastAPI settings</span>

    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8000&quot;</span>
    <span class="n">USE_NGROK</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;USE_NGROK&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span>


<span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">init_webhooks</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
    <span class="c1"># Update inbound traffic via APIs to use the public-facing ngrok URL</span>
    <span class="k">pass</span>


<span class="c1"># Initialize the FastAPI app for a simple web server</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_NGROK</span><span class="p">:</span>
    <span class="c1"># pyngrok should only ever be installed or initialized in a dev environment when this flag is set</span>
    <span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>

    <span class="c1"># Get the dev server port (defaults to 8000 for Uvicorn, can be overridden with `--port`</span>
    <span class="c1"># when starting the server</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;--port&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;--port&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="k">else</span> <span class="mi">8000</span>

    <span class="c1"># Open a ngrok tunnel to the dev server</span>
    <span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="o">.</span><span class="n">public_url</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ngrok tunnel </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> -&gt; </span><span class="se">\&quot;</span><span class="s2">http://127.0.0.1:</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">public_url</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

    <span class="c1"># Update any base URLs or webhooks to use the public ngrok URL</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">BASE_URL</span> <span class="o">=</span> <span class="n">public_url</span>
    <span class="n">init_webhooks</span><span class="p">(</span><span class="n">public_url</span><span class="p">)</span>

<span class="c1"># ... Initialize routers and the rest of our app</span>
</pre></div>
</div>
<p>Now FastAPI can be started by the usual means, with <a class="reference external" href="https://www.uvicorn.org/#usage">Uvicorn</a>, setting
<code class="docutils literal notranslate"><span class="pre">USE_NGROK</span></code> to open a tunnel.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">USE_NGROK</span><span class="o">=</span>True uvicorn server:app
</pre></div>
</div>
</div>
<div class="section" id="google-colaboratory">
<h2>Google Colaboratory<a class="headerlink" href="#google-colaboratory" title="Permalink to this headline">¶</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">ngrok</span></code> in a <a class="reference external" href="https://colab.research.google.com/notebooks/intro.ipynb#recent=true">Google Colab Notebook</a>
takes just two code cells with <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code>. Install <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> as a dependency in our Notebook by create a code
block like this:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>!pip install pyngrok
</pre></div>
</div>
<div class="section" id="colab-ssh-example">
<h3>Colab SSH Example<a class="headerlink" href="#colab-ssh-example" title="Permalink to this headline">¶</a></h3>
<a class="reference external image-reference" href="https://colab.research.google.com/drive/1_ZDG69zjD-6j1dbGbrzAQkyrtlUfdr88?usp=sharing"><img alt="Open SSH Example in Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a>
<p>With an SSH server setup and running (as shown fully in the linked example), all we need to do is create another code cell
that uses <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> to open a tunnel to that server.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">getpass</span>

<span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span><span class="p">,</span> <span class="n">conf</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enter your authtoken, which can be copied from https://dashboard.ngrok.com/auth&quot;</span><span class="p">)</span>
<span class="n">conf</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>

<span class="c1"># Open a TCP ngrok tunnel to the SSH server</span>
<span class="n">connection_string</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="s2">&quot;tcp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">public_url</span>

<span class="n">ssh_url</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">connection_string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;tcp://&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; * ngrok tunnel available, access with `ssh root@</span><span class="si">{</span><span class="n">ssh_url</span><span class="si">}</span><span class="s2"> -p</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="colab-http-example">
<h3>Colab HTTP Example<a class="headerlink" href="#colab-http-example" title="Permalink to this headline">¶</a></h3>
<a class="reference external image-reference" href="https://colab.research.google.com/drive/1F-b8Vv_jaThi55_z0VLYLw3DDVnPYZMp?usp=sharing"><img alt="Open HTTP Example in Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a>
<p>It can also be useful to expose a web server, process HTTP requests, etc. from within our Notebook. This code block
assumes we have also added <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">flask</span></code> to our dependency code block.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;FLASK_ENV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="c1"># Open a ngrok tunnel to the HTTP server</span>
<span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="o">.</span><span class="n">public_url</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; * ngrok tunnel </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> -&gt; </span><span class="se">\&quot;</span><span class="s2">http://127.0.0.1:</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">public_url</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="c1"># Update any base URLs to use the public ngrok URL</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;BASE_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">public_url</span>

<span class="c1"># ... Update inbound traffic via APIs to use the public-facing ngrok URL</span>


<span class="c1"># Define Flask routes</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello from Colab!&quot;</span>

<span class="c1"># Start the Flask server in a new thread</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;use_reloader&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="end-to-end-testing">
<h2>End-to-End Testing<a class="headerlink" href="#end-to-end-testing" title="Permalink to this headline">¶</a></h2>
<p>Some testing use-cases might mean we want to temporarily expose a route via a <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> tunnel to fully
validate a workflow. For example, an internal end-to-end tester, a step in a pre-deployment validation pipeline, or a
service that automatically updates a status page.</p>
<p>Whatever the case may be, extending <a class="reference external" href="https://docs.python.org/3/library/unittest.html#unittest.TestCase">unittest.TestCase</a>
and adding our own fixtures that start the dev server and open a <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> tunnel is relatively simple. This
snippet builds on the <a class="reference external" href="#flask">Flask example above</a>, but it could be easily modified to work with Django or another
framework if its dev server was started/stopped in the <code class="docutils literal notranslate"><span class="pre">start_dev_server()</span></code> and <code class="docutils literal notranslate"><span class="pre">stop_dev_server()</span></code> methods
and <code class="docutils literal notranslate"><span class="pre">PORT</span></code> was changed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>

<span class="kn">from</span> <span class="nn">server</span> <span class="kn">import</span> <span class="n">create_app</span>


<span class="k">class</span> <span class="nc">PyngrokTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c1"># Default Flask port</span>
    <span class="n">PORT</span> <span class="o">=</span> <span class="mi">5000</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">start_dev_server</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">shutdown</span><span class="p">():</span>
            <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;werkzeug.server.shutdown&quot;</span><span class="p">)()</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/shutdown&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">route_shutdown</span><span class="p">():</span>
            <span class="n">shutdown</span><span class="p">()</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">204</span>

        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">stop_dev_server</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s2">&quot;http://localhost:5000/shutdown&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_webhooks</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">base_url</span><span class="p">):</span>
        <span class="n">webhook_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/foo&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>

        <span class="c1"># ... Update inbound traffic via APIs to use the public-facing ngrok URL</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_pyngrok</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Open a ngrok tunnel to the dev server</span>
        <span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span><span class="o">.</span><span class="n">public_url</span>

        <span class="c1"># Update any base URLs or webhooks to use the public ngrok URL</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">init_webhooks</span><span class="p">(</span><span class="n">public_url</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">start_dev_server</span><span class="p">()</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">init_pyngrok</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">stop_dev_server</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, any test that needs a <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> tunnel can simply extend <code class="docutils literal notranslate"><span class="pre">PyngrokTestCase</span></code> to inherit these fixtures.
If we want the <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> tunnel to remain open across numerous tests, it may be more efficient to
<a class="reference external" href="https://docs.python.org/3/library/unittest.html#class-and-module-fixtures">setup these fixtures at the suite or module level instead</a>,
which would also be a simple change.</p>
</div>
<div class="section" id="aws-lambda-local">
<h2>AWS Lambda (Local)<a class="headerlink" href="#aws-lambda-local" title="Permalink to this headline">¶</a></h2>
<p>Lambdas deployed to AWS can be easily developed locally using <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> and extending the
<a class="reference external" href="#flask">Flask example shown above</a>. In addition to effortless local development, this gives us more flexibility when
writing tests, leveraging a CI, managing revisions, etc.</p>
<p>Let’s assume we have a file <code class="docutils literal notranslate"><span class="pre">foo_GET.py</span></code> in our <code class="docutils literal notranslate"><span class="pre">lambdas</span></code> module and, when deployed, it handles requests to
<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/foo</span></code>. Locally, we can use a Flask route as a shim to funnel requests to this same Lambda handler.</p>
<p>To start, add <code class="docutils literal notranslate"><span class="pre">app.register_blueprint(lambda_routes.bp)</span></code> to <code class="docutils literal notranslate"><span class="pre">server.py</span></code> from the example above. The create
<code class="docutils literal notranslate"><span class="pre">lambda_routes.py</span></code> as shown below to handle the routing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">request</span>

<span class="kn">from</span> <span class="nn">lambdas.foo_GET</span> <span class="kn">import</span> <span class="n">lambda_function</span> <span class="k">as</span> <span class="n">foo_GET</span>

<span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s2">&quot;lambda_routes&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/foo&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">route_foo</span><span class="p">():</span>
    <span class="c1"># This becomes the event in the Lambda handler</span>
    <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;someQueryParam&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;someQueryParam&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">foo_GET</span><span class="o">.</span><span class="n">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">{}))</span>
</pre></div>
</div>
<p>For a complete example of how we can leverage all these things together to rapidly and reliably develop, test,
and deploy AWS Lambda’s, check out <a class="reference external" href="https://github.com/alexdlaird/air-quality-bot">the Air Quality Bot repository</a>
and have a look at the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and <code class="docutils literal notranslate"><span class="pre">devserver.py</span></code>.</p>
</div>
<div class="section" id="python-http-server">
<h2>Python HTTP Server<a class="headerlink" href="#python-http-server" title="Permalink to this headline">¶</a></h2>
<p>Python’s <a class="reference external" href="https://docs.python.org/3/library/http.server.html">http.server module</a> also makes for a useful development
server. We can use <code class="docutils literal notranslate"><span class="pre">pyngrok</span></code> to expose it to the web via a tunnel, as show in <code class="docutils literal notranslate"><span class="pre">server.py</span></code> here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">HTTPServer</span><span class="p">,</span> <span class="n">BaseHTTPRequestHandler</span>
<span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>

<span class="n">port</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PORT&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>

<span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<span class="n">httpd</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="n">BaseHTTPRequestHandler</span><span class="p">)</span>

<span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="o">.</span><span class="n">public_url</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ngrok tunnel </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> -&gt; </span><span class="se">\&quot;</span><span class="s2">http://127.0.0.1:</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">public_url</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Block until CTRL-C or some other terminating event</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Shutting down server.&quot;</span><span class="p">)</span>

   <span class="n">httpd</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>We can then run this script to start the server.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python server.py
</pre></div>
</div>
</div>
<div class="section" id="python-tcp-server-and-client">
<h2>Python TCP Server and Client<a class="headerlink" href="#python-tcp-server-and-client" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of a simple TCP ping/pong server. It opens a local socket, uses <code class="docutils literal notranslate"><span class="pre">ngrok</span></code> to tunnel to that
socket, then the client/server communicate via the publicly exposed address.</p>
<p>For this code to run, we first need to go to
<a class="reference external" href="https://dashboard.ngrok.com/reserved">ngrok’s Reserved TCP Addresses</a> and make a reservation. Set the HOST and PORT
environment variables pointing to that reserved address.</p>
<p>Now create <code class="docutils literal notranslate"><span class="pre">server.py</span></code> with the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HOST&quot;</span><span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PORT&quot;</span><span class="p">))</span>

<span class="c1"># Create a TCP socket</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="c1"># Bind a local socket to the port</span>
<span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Open a ngrok tunnel to the socket</span>
<span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="n">remote_addr</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)})</span><span class="o">.</span><span class="n">public_url</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ngrok tunnel </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> -&gt; </span><span class="se">\&quot;</span><span class="s2">tcp://127.0.0.1:</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">public_url</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Wait for a connection</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Waiting for a connection ...&quot;</span><span class="p">)</span>
        <span class="n">connection</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... connection established from </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">client_address</span><span class="p">))</span>

        <span class="c1"># Receive the message, send a response</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>

                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;pong&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Shutting down server.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">break</span>

<span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>In a terminal window, we can now start our socket server:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">HOST</span><span class="o">=</span><span class="s2">&quot;1.tcp.ngrok.io&quot;</span> <span class="nv">PORT</span><span class="o">=</span><span class="m">12345</span> python server.py
</pre></div>
</div>
<p>It’s now waiting for incoming connections, so let’s write a client to connect to it and send it something.</p>
<p>Create <code class="docutils literal notranslate"><span class="pre">client.py</span></code> with the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HOST&quot;</span><span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PORT&quot;</span><span class="p">))</span>

<span class="c1"># Create a TCP socket</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="c1"># Connect to the server with the socket via our ngrok tunnel</span>
<span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected to </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="c1"># Send the message</span>
<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;ping&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
<span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

<span class="c1"># Await a response</span>
<span class="n">data_received</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data_expected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">while</span> <span class="n">data_received</span> <span class="o">&lt;</span> <span class="n">data_expected</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">data_received</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>

<span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>In another terminal window, we can run our client:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">HOST</span><span class="o">=</span><span class="s2">&quot;1.tcp.ngrok.io&quot;</span> <span class="nv">PORT</span><span class="o">=</span><span class="m">12345</span> python client.py
</pre></div>
</div>
<p>And that’s it! Data was sent and received from a socket via our <code class="docutils literal notranslate"><span class="pre">ngrok</span></code> tunnel.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Getting Around</h3>
<ul>
    <li><a class="reference internal" href="index.html">Basic Usage</a>
        <ul>
            <li><a class="reference internal" href="index.html#installation">Installation</a>
            </li>
            <li><a class="reference internal" href="index.html#open-a-tunnel">Open a
                Tunnel</a></li>
            <li><a class="reference internal"
                   href="index.html#configuration">Configuration</a></li>
            <li><a class="reference internal" href="index.html#event-logs">Event Logs</a></li>
            <li><a class="reference internal" href="index.html#command-line-usage">Command
                Line Usage</a>
            </li>
        </ul>
    </li>
    <li><a class="reference internal" href="index.html#dive-deeper">Dive Deeper</a>
        <ul>
            <li><a class="reference internal" href="api.html">API Documentation</a></li>
            <li><a class="reference internal" href="#">Integration Examples</a></li>
            <li><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
            <li><a href="https://github.com/alexdlaird/pyngrok/blob/main/CHANGELOG.md">Changelog</a></li>
            <li><a href="https://github.com/alexdlaird/pyngrok/issues">Issues</a></li>
            <li><a class="reference internal" href="index.html#contributing">Contributing</a>
            </li>
        </ul>
    </li>
</ul>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Integration Examples</a><ul>
<li><a class="reference internal" href="#flask">Flask</a></li>
<li><a class="reference internal" href="#django">Django</a></li>
<li><a class="reference internal" href="#fastapi">FastAPI</a></li>
<li><a class="reference internal" href="#google-colaboratory">Google Colaboratory</a><ul>
<li><a class="reference internal" href="#colab-ssh-example">Colab SSH Example</a></li>
<li><a class="reference internal" href="#colab-http-example">Colab HTTP Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#end-to-end-testing">End-to-End Testing</a></li>
<li><a class="reference internal" href="#aws-lambda-local">AWS Lambda (Local)</a></li>
<li><a class="reference internal" href="#python-http-server">Python HTTP Server</a></li>
<li><a class="reference internal" href="#python-tcp-server-and-client">Python TCP Server and Client</a></li>
</ul>
</li>
</ul>
<h3>Useful Links</h3>
<ul>
    <li><a href="https://ngrok.com/docs"><code class="code docutils literal notranslate"><span class="pre">ngrok</span></code>
        Documentation</a></li>
    <li><a href="https://github.com/alexdlaird/pyngrok"><code class="code docutils literal notranslate"><span
            class="pre">pyngrok</span></code> on GitHub</a></li>
    <li><a href="https://pypi.org/project/pyngrok/"><code class="code docutils literal notranslate"><span class="pre">pyngrok</span></code>
        on PyPI</a></li>
    <li><a href="https://www.paypal.me/alexdlaird">Sponsor <code class="code docutils literal notranslate"><span
            class="pre">pyngrok</span></code></a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    
    <div class="footer">
      &copy;2020, Alex Laird.
      
    </div>

    
    <a href="https://github.com/alexdlaird/pyngrok" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <div class="footer">This page uses <a href="https://analytics.google.com/">
        Google Analytics</a> to collect statistics. You can disable it by blocking
        the JavaScript coming from www.google-analytics.com.
        <script type="text/javascript">
            (function () {
                var ga = document.createElement('script');
                ga.src = ('https:' == document.location.protocol ?
                    'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                ga.setAttribute('async', 'true');
                document.documentElement.firstChild.appendChild(ga);
            })();
        </script>
    </div>

  </body>
</html>