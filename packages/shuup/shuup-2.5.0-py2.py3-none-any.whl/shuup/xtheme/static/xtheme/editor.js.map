{"version":3,"sources":["../lib/domready.js","../lib/qs.js","../lib/el.js","editor.js"],"names":["callbacks","events","loaded","document","readyState","listener","fn","forEach","ev","removeEventListener","shift","setTimeout","push","addEventListener","stringify","obj","bits","key","hasOwnProperty","encodeURIComponent","sort","join","parse","queryString","kw","location","search","replace","split","bit","val","undefined","mutateObj","mutations","mutate","mutateURL","url","base","length","processAttrs","element","attrs","eventHash","eventName","processChildren","children","Array","isArray","child","createTextNode","appendChild","el","selector","tag","classes","createElement","cls","classList","add","post","args","window","CSRF_TOKEN","csrfmiddlewaretoken","inputs","Object","keys","map","type","name","value","form","method","action","href","body","submit","activateSelect","$select","model","searchMode","extraFilters","noExpand","width","select2","assign","language","minimumInputLength","ShuupAdminConfig","settings","minSearchInputLength","ajax","browserUrls","select","dataType","data","params","term","processResults","results","$","item","text","id","on","e","option","target","detach","append","change","activateSelects","each","idx","object","hasClass","updateModelChoiceWidgetURL","selectedObject","options","selectedIndex","dataset","adminUrl","widgetExtraDiv","getElementById","linkText","interpolate","gettext","innerHTML","outerHTML","changesMade","confirm","x","y","newQs","cellCount","cellLimit","alert","command","getElementsByName","setAttribute","parent","togglePopup","plugin","jQuery","we","contents","$editable","Sortable","querySelector","handle","forceFallback","onUpdate","evt","from_y","oldIndex","to_y","newIndex","els","getElementsByClassName","i","group","from_x","to_x","onAdd","prototype","indexOf","call","parentNode","refreshPlaceholderInParent","placeholderName","postMessage"],"mappings":"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","file":"editor.js","sourceRoot":"../../static_src/editor","sourcesContent":["/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nconst callbacks = [];\nconst events = [\"DOMContentLoaded\", \"load\"];\nvar loaded = (document.readyState === \"complete\");\n\nfunction listener() {\n    events.forEach((ev) => { document.removeEventListener(ev, listener); });\n    if (!loaded) {\n        loaded = true;\n        var fn;\n        while ((fn = callbacks.shift())) {\n            fn();\n        }\n    }\n}\n\nif (!loaded) {\n    events.forEach((ev) => { document.addEventListener(ev, listener); });\n}\n\nexport default function(fn) {\n    if (loaded) {\n        setTimeout(fn, 0);\n    } else {\n        callbacks.push(fn);\n    }\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nexport function stringify(obj) {\n    const bits = [];\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key) && obj[key]) {\n            bits.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(obj[key]));\n        }\n    }\n    return bits.sort().join(\"&\");\n}\n\nexport function parse(queryString) {\n    const kw = {};\n    if (queryString === null || queryString === undefined) {\n        queryString = location.search.replace(/^\\?/, \"\");\n    }\n    queryString.split(\"&\").forEach((bit) => {\n        const [key, val] = bit.split(\"=\", 2);\n        kw[key] = (val !== undefined ? val : true);\n    });\n    return kw;\n}\n\nexport function mutateObj(obj, mutations) {\n    for (var key in mutations) {\n        if (!mutations.hasOwnProperty(key)) {\n            continue;\n        }\n        const val = mutations[key];\n        if (val === null || val === undefined) {\n            delete obj[key];\n        } else {\n            obj[key] = val;\n        }\n    }\n    return obj;\n}\n\nexport function mutate(mutations, queryString) {\n    const kw = parse(queryString);\n    mutateObj(kw, mutations);\n    return stringify(kw);\n}\n\nexport function mutateURL(url, mutations) {\n    var [base, search] = url.split(\"?\", 2);\n    search = mutate(mutations, search || \"\");\n    return base + (search.length ? \"?\" + search : \"\");\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nfunction processAttrs(element, attrs) {\n    for (var key in attrs) {\n        if (!attrs.hasOwnProperty(key)) {\n            continue;\n        }\n        if (key === \"$events\") {\n            const eventHash = attrs[key];\n            for (var eventName in eventHash) {\n                if (!eventHash.hasOwnProperty(eventName)) {\n                    continue;\n                }\n                element.addEventListener(eventName, eventHash[eventName], false);\n            }\n            continue;\n        }\n        element[key] = attrs[key];\n    }\n}\n\nfunction processChildren(element, children) {\n    if (children && !Array.isArray(children)) {\n        children = [children];\n    }\n    (children || []).forEach((child) => {\n        if (!child) {\n            return;\n        }\n        if (typeof child === \"string\") {\n            child = document.createTextNode(child);\n        }\n        element.appendChild(child);\n    });\n}\n\n/**\n * Generate a HTML element.\n * For instance, el(\"div.foo\", {id: \"y\"}, [\"Hello\", \"Hello\"]) would generate\n * a div with the outerHTML `<div id=\"y\" class=\"foo\">HelloHello</div>`.\n *\n * @param selector Tag + CSS classes, separated with full-stops.\n * @param attrs Optional hash of attributes to assign on the new element.\n * @param children Optional array of children for the node.\n * @returns {HTMLElement}\n */\nexport default function el(selector, attrs, children) {\n    const [tag, ...classes] = selector.split(\".\");\n    const element = document.createElement(tag);\n    classes.forEach((cls) => {\n        element.classList.add(cls);\n    });\n    if (Array.isArray(attrs)) {\n        children = attrs;\n        attrs = {};\n    }\n    processAttrs(element, attrs);\n    processChildren(element, children);\n    return element;\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport domready from \"../lib/domready\";\nimport { mutate } from \"../lib/qs\";\nimport el from \"../lib/el\";\n\nfunction post(args) {\n    if (window.CSRF_TOKEN) {\n        args.csrfmiddlewaretoken = window.CSRF_TOKEN;\n    }\n    const inputs = Object.keys(args).\n        map((key) => {\n            const val = args[key];\n            return typeof val !== \"undefined\"? el(\"input\", {type: \"hidden\", name: key, value: val}) : null;\n        }\n    );\n    const form = el(\"form\", {method: \"POST\", action: location.href}, inputs);\n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction activateSelect($select, model, searchMode, extraFilters = null, noExpand = false, attrs = {}) {\n    if (!noExpand) {\n        // make sure to expand the select2 to use all the available space\n        $select.width(\"100%\");\n    }\n\n    if (!model) {\n        return $select.select2({\n            language: \"xx\",\n            ...attrs\n        }).on('select2:select', function (e) {\n            var id = e.params.data.id;\n            var option = $(e.target).children('[value=' + id + ']');\n            option.detach();\n            $(e.target).append(option).change();\n        });\n    }\n\n    return $select.select2(Object.assign({\n        language: \"xx\",\n        minimumInputLength: window.ShuupAdminConfig.settings.minSearchInputLength,\n        ajax: {\n            url: window.ShuupAdminConfig.browserUrls.select,\n            dataType: \"json\",\n            data: function (params) {\n                const data = {\n                    model: model,\n                    searchMode: searchMode,\n                    search: params.term,\n                };\n                // extraFilters is a fn that returns extra params for the query\n                if (extraFilters) {\n                    Object.assign(data, extraFilters(params));\n                }\n                return data;\n            },\n            processResults: function (data) {\n                return {\n                    results: $.map(data.results, function (item) {\n                        return { text: item.name, id: item.id };\n                    })\n                };\n            }\n        }\n    }, attrs));\n}\n\nfunction activateSelects() {\n    $(\"select\").each(function (idx, object) {\n        const select = $(object);\n        // only activate selects that aren't already select2 inputs\n        if (!select.hasClass(\"select2-hidden-accessible\") && !select.hasClass(\"no-select2\")) {\n            const model = select.data(\"model\");\n            const searchMode = select.data(\"search-mode\");\n            const noExpand = select.data(\"no-expand\");\n            activateSelect(select, model, searchMode, noExpand);\n        }\n    });\n}\n\nfunction updateModelChoiceWidgetURL(select) {\n    const selectedObject = select.options[select.selectedIndex];\n    const url = selectedObject.dataset.adminUrl;\n    const widgetExtraDiv = document.getElementById(\"extra_for_\" + select.id);\n    const linkText = interpolate(gettext(\"Edit %s\"), [selectedObject.text]);\n    widgetExtraDiv.innerHTML = url ? el(\"a\", {\"target\": \"_blank\", \"href\": url}, [linkText]).outerHTML : \"\";\n}\n\ndomready(() => {\n    let changesMade = false;\n    $(\".layout-cell\").on(\"click\", function() {\n        if(changesMade) {\n            if(!confirm(gettext(\"Changing plugin cells without saving will cause changes made to this cell to be lost.\"))) {\n                return;\n            }\n        }\n        const {x, y} = this.dataset;\n        const newQs = mutate({x, y});\n        location.href = \"?\" + newQs;\n    });\n    $(\".layout-add-cell-btn\").on(\"click\", function() {\n        const {y, cellCount, cellLimit} = this.dataset;\n        if (cellCount >= cellLimit) {\n            alert(interpolate(gettext(\"Error: Cannot add more than %s cells to one row.\"), [cellLimit]));\n            return;\n        }\n        post({y: y, command: \"add_cell\"});\n    });\n    $(\".layout-add-row-btn\").on(\"click\", function() {\n        const {y} = this.dataset;\n        post({y, command: \"add_row\"});\n    });\n    $(\".layout-del-row-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to delete this row?\"))) {\n            return;\n        }\n        const {y} = this.dataset;\n        post({y, command: \"del_row\"});\n    });\n    $(\".del-cell-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to delete this cell?\"))) {\n            return;\n        }\n        const {x, y} = this.dataset;\n        post({x, y, command: \"del_cell\"});\n    });\n    $(\".publish-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to publish changes made to this view?\"))) {\n            return;\n        }\n        if (changesMade) {\n            if (confirm(gettext(\"You have changed the form. Do you want to save them before publishing?\"))) {\n                document.getElementsByName(\"publish\")[0].setAttribute(\"value\", \"1\");\n                document.getElementById(\"xt-editor-form\").submit();\n            } else {\n                post({command: \"publish\"});\n            }\n        } else {\n            post({command: \"publish\"});\n        }\n    });\n\n    $(\"#xtheme-editor-close\").on(\"click\", function() {\n        parent.togglePopup(false);\n    });\n\n    $(\".revert-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to revert all changes made since the last published version?\"))) {\n            return;\n        }\n        post({command: \"revert\"});\n    });\n    $(\"input, select, textarea\").on(\"change input\", function() {\n        if (this.id === \"id_general-plugin\") {\n            return;\n        }\n        changesMade = true;\n    });\n    $(\"#id_general-plugin\").on(\"change\", function() {\n        if (changesMade) {\n            if (!confirm(gettext(\"Changing plugins will cause other changes made on this form to be lost.\"))) {\n                return;\n            }\n        }\n        post({command: \"change_plugin\", plugin: this.value});\n    });\n    $(\".xtheme-model-choice-widget\").each(function(element) {\n        updateModelChoiceWidgetURL(element);\n        element.addEventListener(\"change\", function() {\n            updateModelChoiceWidgetURL(document.getElementById(this.id));\n        });\n    });\n\n    // when summernote changes, set the flag on\n    jQuery(\".summernote-editor\").on(\"summernote.change\", (we, contents, $editable) => {\n        changesMade = true;\n    });\n\n    new window.Sortable(document.querySelector(\".layout-rows\"), {\n        handle: \".layout-move-row-btn\",\n\t\tforceFallback: true,\n        onUpdate: function(evt) {\n            post({command: \"move_row_to_index\", from_y: evt.oldIndex, to_y: evt.newIndex});\n        }\n    });\n\n    var els = document.getElementsByClassName(\"layout-row-cells\");\n    for(var i = 0; i < els.length; i++) {\n        new window.Sortable(els[i], {\n            group: \"cells\",\n            onUpdate: function(evt) {\n                // cell re-arranged within the same row\n                post({\n                    command: \"move_cell_to_position\",\n                    from_x: evt.item.dataset.x,\n                    from_y: evt.item.dataset.y,\n                    to_x: evt.newIndex,\n                    to_y: evt.item.dataset.y\n                });\n            },\n            onAdd: function(evt) {\n                // cell moved to different row\n                post({\n                    command: \"move_cell_to_position\",\n                    from_x: evt.item.dataset.x,\n                    from_y: evt.item.dataset.y,\n                    to_x: Array.prototype.indexOf.call(evt.item.parentNode.children, evt.item),\n                    to_y: evt.item.parentNode.parentNode.dataset.y\n                });\n            }\n        });\n    }\n    activateSelects();\n});\n\nwindow.refreshPlaceholderInParent = (placeholderName) => {\n    window.parent.postMessage({\"reloadPlaceholder\": placeholderName}, \"*\");\n};\n"]}