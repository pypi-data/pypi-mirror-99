{"version":3,"sources":["../lib/domready.js","../lib/qs.js","../lib/el.js","../lib/ajax.js","editor-injection.js"],"names":["callbacks","events","loaded","document","readyState","listener","fn","forEach","ev","removeEventListener","shift","setTimeout","push","addEventListener","stringify","obj","bits","key","hasOwnProperty","encodeURIComponent","sort","join","parse","queryString","kw","location","search","replace","split","bit","val","undefined","mutateObj","mutations","mutate","mutateURL","url","base","length","processAttrs","element","attrs","eventHash","eventName","processChildren","children","Array","isArray","child","createTextNode","appendChild","el","selector","tag","classes","createElement","cls","classList","add","ajax","options","noop","client","XMLHttpRequest","success","error","async","open","method","send","data","onreadystatechange","status","responseText","statusText","_sidebarDiv","_sidebarIframe","_sidebarToggler","getSidebarDiv","id","body","getSidebarIframe","setPopup","visible","sidebarDiv","toggle","openPlaceholderEditor","domElement","layoutIdentifier","dataset","xtLayoutIdentifier","layoutDataKey","xtLayoutDataKey","placeholderName","xtPlaceholderName","globalType","xtGlobalType","xtContentTypeId","defaultConfigElement","querySelector","defaultConfigJSON","innerHTML","urlParams","view","window","XthemeEditorConfig","viewName","theme","themeIdentifier","ph","src","editUrl","addSnippetInjectionMarkup","nav","button","gettext","injectSnipperUrl","li","insertBefore","firstChild","addEditToggleMarkup","hidden","name","value","type","editing","edit","commandUrl","csrfToken","href","handleMessage","event","origin","placeholder","reloadPlaceholder","oldPh","Date","text","newDoc","implementation","createHTMLDocument","newPh","addPhClickHandler","target","contains","preventDefault","stopPropagation","addCloseHandler","togglePopup"],"mappings":"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","file":"editor-injection.js","sourceRoot":"../../static_src/injection","sourcesContent":["/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nconst callbacks = [];\nconst events = [\"DOMContentLoaded\", \"load\"];\nvar loaded = (document.readyState === \"complete\");\n\nfunction listener() {\n    events.forEach((ev) => { document.removeEventListener(ev, listener); });\n    if (!loaded) {\n        loaded = true;\n        var fn;\n        while ((fn = callbacks.shift())) {\n            fn();\n        }\n    }\n}\n\nif (!loaded) {\n    events.forEach((ev) => { document.addEventListener(ev, listener); });\n}\n\nexport default function(fn) {\n    if (loaded) {\n        setTimeout(fn, 0);\n    } else {\n        callbacks.push(fn);\n    }\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nexport function stringify(obj) {\n    const bits = [];\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key) && obj[key]) {\n            bits.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(obj[key]));\n        }\n    }\n    return bits.sort().join(\"&\");\n}\n\nexport function parse(queryString) {\n    const kw = {};\n    if (queryString === null || queryString === undefined) {\n        queryString = location.search.replace(/^\\?/, \"\");\n    }\n    queryString.split(\"&\").forEach((bit) => {\n        const [key, val] = bit.split(\"=\", 2);\n        kw[key] = (val !== undefined ? val : true);\n    });\n    return kw;\n}\n\nexport function mutateObj(obj, mutations) {\n    for (var key in mutations) {\n        if (!mutations.hasOwnProperty(key)) {\n            continue;\n        }\n        const val = mutations[key];\n        if (val === null || val === undefined) {\n            delete obj[key];\n        } else {\n            obj[key] = val;\n        }\n    }\n    return obj;\n}\n\nexport function mutate(mutations, queryString) {\n    const kw = parse(queryString);\n    mutateObj(kw, mutations);\n    return stringify(kw);\n}\n\nexport function mutateURL(url, mutations) {\n    var [base, search] = url.split(\"?\", 2);\n    search = mutate(mutations, search || \"\");\n    return base + (search.length ? \"?\" + search : \"\");\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nfunction processAttrs(element, attrs) {\n    for (var key in attrs) {\n        if (!attrs.hasOwnProperty(key)) {\n            continue;\n        }\n        if (key === \"$events\") {\n            const eventHash = attrs[key];\n            for (var eventName in eventHash) {\n                if (!eventHash.hasOwnProperty(eventName)) {\n                    continue;\n                }\n                element.addEventListener(eventName, eventHash[eventName], false);\n            }\n            continue;\n        }\n        element[key] = attrs[key];\n    }\n}\n\nfunction processChildren(element, children) {\n    if (children && !Array.isArray(children)) {\n        children = [children];\n    }\n    (children || []).forEach((child) => {\n        if (!child) {\n            return;\n        }\n        if (typeof child === \"string\") {\n            child = document.createTextNode(child);\n        }\n        element.appendChild(child);\n    });\n}\n\n/**\n * Generate a HTML element.\n * For instance, el(\"div.foo\", {id: \"y\"}, [\"Hello\", \"Hello\"]) would generate\n * a div with the outerHTML `<div id=\"y\" class=\"foo\">HelloHello</div>`.\n *\n * @param selector Tag + CSS classes, separated with full-stops.\n * @param attrs Optional hash of attributes to assign on the new element.\n * @param children Optional array of children for the node.\n * @returns {HTMLElement}\n */\nexport default function el(selector, attrs, children) {\n    const [tag, ...classes] = selector.split(\".\");\n    const element = document.createElement(tag);\n    classes.forEach((cls) => {\n        element.classList.add(cls);\n    });\n    if (Array.isArray(attrs)) {\n        children = attrs;\n        attrs = {};\n    }\n    processAttrs(element, attrs);\n    processChildren(element, children);\n    return element;\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n/**\n * BASED ON:\n * xhr-ajax.js Copyright (C) 2013 Craig Roberts (http://craig0990.co.uk)\n *\n * Licensed under the MIT License (http://mit-license.org)\n */\n\nexport default function ajax(options) {\n    const noop = function() {};\n    const client = new XMLHttpRequest();\n    options.success = options.success || noop;\n    options.error = options.error || noop;\n    options.async = true;\n    client.open(options.method || \"GET\", options.url);\n    client.send(options.data);\n    client.onreadystatechange = function() {\n        if (this.readyState !== 4) {\n            return;\n        }\n        if (this.status === 200) {\n            options.success(this.responseText, this);\n        } else {\n            options.error(this.status, this.statusText, this);\n        }\n        client.onreadystatechange = noop;\n    };\n    return client;\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shoop Commerce Ltd. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n// import styles\nimport \"./editor-injection.less\";\n\nimport domready from \"../lib/domready\";\nimport { stringify, mutateURL } from \"../lib/qs\";\nimport el from \"../lib/el\";\nimport ajax from \"../lib/ajax\";\n\nvar _sidebarDiv = null;\nvar _sidebarIframe = null;\nvar _sidebarToggler = null;\n\nfunction getSidebarDiv() {\n    if (_sidebarDiv === null) {\n        _sidebarDiv = el(\"div\", { id: \"xt-edit-sidebar\" }, [\n            el(\"div\", { id: \"xt-edit-sidebar-container\" },\n                (_sidebarIframe = el(\"iframe\", {\n                    id: \"xt-edit-sidebar-iframe\"\n                }))\n            )\n        ]);\n        document.body.appendChild(_sidebarDiv);\n    }\n    return _sidebarDiv;\n}\n\nfunction getSidebarIframe() {\n    getSidebarDiv();\n    return _sidebarIframe;\n}\n\nfunction setPopup(visible) {\n    const sidebarDiv = getSidebarDiv();\n    if (visible === undefined) {\n        sidebarDiv.classList.toggle(\"popout\");\n    } else {\n        sidebarDiv.classList.toggle(\"popout\", !!visible);\n    }\n}\n\nfunction openPlaceholderEditor(domElement) {\n    const layoutIdentifier = domElement.dataset.xtLayoutIdentifier;\n    const layoutDataKey = domElement.dataset.xtLayoutDataKey;\n    const placeholderName = domElement.dataset.xtPlaceholderName;\n    const globalType = domElement.dataset.xtGlobalType;\n    const contentTypeId = domElement.dataset.xtContentTypeId;\n    if (!placeholderName) {\n        return;\n    }\n    const defaultConfigElement = domElement.querySelector(\"script.xt-ph-default-layout\");\n    const defaultConfigJSON = (defaultConfigElement ? defaultConfigElement.innerHTML : null);\n    const viewName = window.XthemeEditorConfig.viewName;\n    const urlParams = {\n        view: viewName,\n        theme: window.XthemeEditorConfig.themeIdentifier,\n        ph: placeholderName,\n        \"global_type\": globalType,\n        \"layout_identifier\": layoutIdentifier,\n        \"layout_data_key\": layoutDataKey,\n        // TODO: Hopefully we won't get any problems with too-long query strings (2048 is the maximum for IE):\n        \"default_config\": defaultConfigJSON\n    };\n    getSidebarIframe().src = window.XthemeEditorConfig.editUrl + \"?\" + stringify(urlParams);\n    setTimeout(() => {\n        setPopup(true);\n    }, 1); // Defer slide-out, because otherwise browsers coalesce the addClass (as it's done in the same JS \"tick\")\n}\n\nfunction addSnippetInjectionMarkup() {\n    const nav = document.querySelector(\".navbar-admin-tools .navbar-nav\");\n    if (!nav) return;  // No navigation no snippet in navigation either\n    if (!document.querySelector(\".xt-ph\")) {\n        // No placeholders in the DOM, so no need to show Inject button here.\n        return;\n    }\n    const button = el(\"button\", {\n        \"type\": \"button\"\n    }, gettext(\"Custom CSS/JS\"));\n    button.addEventListener(\"click\", () => {\n        window.open(window.XthemeEditorConfig.injectSnipperUrl, \"_blank\");\n    });\n    const li = el(\"li.xt-snippet-injection\", [button]);\n    nav.insertBefore(li, nav.firstChild);\n}\n\nfunction addEditToggleMarkup() {\n    const hidden = (name, value) => el(\"input\", { type: \"hidden\", name, value });\n    const editing = (window.XthemeEditorConfig.edit);\n    if (!document.querySelector(\".xt-ph\")) {\n        // No placeholders in the DOM, so no need to show an Edit button here.\n        return;\n    }\n    const li = el(\"li.xt-edit-toggle\", [\n        el(\"form\", {\n            \"action\": window.XthemeEditorConfig.commandUrl,\n            \"method\": \"POST\"\n        }, [\n                hidden(\"csrfmiddlewaretoken\", window.XthemeEditorConfig.csrfToken),\n                hidden(\"path\", location.href),\n                hidden(\"command\", (editing ? \"edit_off\" : \"edit_on\")),\n                el(\"button\", {\n                    \"type\": \"submit\"\n                }, (editing ? gettext(\"Exit Edit\") : gettext(\"Edit Page\")))\n            ])\n    ]);\n    let nav = document.querySelector(\".navbar-admin-tools .navbar-nav\");\n    if (!nav) return;  // No navigation no edit toggle in navigation either\n    nav.insertBefore(li, nav.firstChild);\n}\n\nfunction handleMessage(event) {\n    if (!window.XthemeEditorConfig.edit) {\n        return;  // Not editing, ignore messages\n    }\n    if (event.origin !== location.origin) {\n        return;  // Not our origin, can't be our message\n    }\n    const placeholder = event.data.reloadPlaceholder;\n    if (!placeholder) {\n        return; // Not our message\n    }\n    const oldPh = document.querySelector(\"#xt-ph-\" + placeholder);\n    if (!oldPh) {\n        return;   // Not sure where to put output anyway\n    }\n    ajax({\n        url: mutateURL(location.href, { \"_uncache_\": +new Date() }),\n        success: (text) => {\n            const newDoc = document.implementation.createHTMLDocument();\n            newDoc.body.innerHTML = text;\n            const newPh = newDoc.querySelector(\"#xt-ph-\" + placeholder);\n            if (newPh) {\n                oldPh.innerHTML = newPh.innerHTML;\n            }\n        }\n    });\n}\n\nfunction addPhClickHandler() {\n    document.addEventListener(\"click\", (event) => {\n        const classList = event.target.classList;\n        if (classList && classList.contains(\"xt-ph\")) {\n            openPlaceholderEditor(event.target);\n            event.preventDefault();\n            event.stopPropagation();\n            return false;\n        }\n    }, false);\n}\n\nfunction addCloseHandler() {\n    document.addEventListener(\"keyup\", (event) => {\n        if (event.key === \"Escape\") {\n            setPopup(false);\n        }\n    }, false);\n}\n\ndomready(() => {\n    window.addEventListener(\"message\", handleMessage, false);\n    addSnippetInjectionMarkup();\n    addEditToggleMarkup();\n    if (window.XthemeEditorConfig.edit) {\n        addPhClickHandler();\n        addCloseHandler();\n    }\n});\n\n\nwindow.togglePopup = function(visible) {\n    setPopup(visible);\n};\n"]}