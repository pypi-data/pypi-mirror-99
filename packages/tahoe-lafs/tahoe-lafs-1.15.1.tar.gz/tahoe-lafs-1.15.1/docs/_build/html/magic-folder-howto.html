
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Magic Folder Set-up Howto &#8212; Tahoe-LAFS 1.x documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Tahoe BackupDB" href="backupdb.html" />
    <link rel="prev" title="Avoiding Write Collisions in Tahoe" href="write_coordination.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="backupdb.html" title="The Tahoe BackupDB"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="write_coordination.html" title="Avoiding Write Collisions in Tahoe"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Tahoe-LAFS 1.x documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="magic-folder-set-up-howto">
<span id="magic-folder-howto"></span><h1>Magic Folder Set-up Howto<a class="headerlink" href="#magic-folder-set-up-howto" title="Permalink to this headline">¶</a></h1>
<ol class="arabic simple">
<li><a class="reference internal" href="#this-document">This document</a></li>
<li><a class="reference internal" href="#setting-up-a-local-test-grid">Setting up a local test grid</a></li>
<li><a class="reference internal" href="#setting-up-magic-folder">Setting up Magic Folder</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
</ol>
<div class="section" id="this-document">
<h2>This document<a class="headerlink" href="#this-document" title="Permalink to this headline">¶</a></h2>
<p>This is preliminary documentation of how to set up Magic Folder using a test
grid on a single Linux or Windows machine, with two clients and one server.
It is aimed at a fairly technical audience.</p>
<p>For an introduction to Magic Folder and how to configure it
more generally, see <a class="reference internal" href="frontends/magic-folder.html"><span class="doc">Tahoe-LAFS Magic Folder Frontend</span></a>.</p>
<p>It it possible to adapt these instructions to run the nodes on
different machines, to synchronize between three or more clients,
to mix Windows and Linux clients, and to use multiple servers
(if the Tahoe-LAFS encoding parameters are changed).</p>
</div>
<div class="section" id="setting-up-a-local-test-grid">
<h2>Setting up a local test grid<a class="headerlink" href="#setting-up-a-local-test-grid" title="Permalink to this headline">¶</a></h2>
<div class="section" id="linux">
<h3>Linux<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<p>Run these commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir ../grid
bin/tahoe create-introducer ../grid/introducer
bin/tahoe start ../grid/introducer
export FURL=`cat ../grid/introducer/private/introducer.furl`
bin/tahoe create-node --introducer=&quot;$FURL&quot; ../grid/server
bin/tahoe create-client --introducer=&quot;$FURL&quot; ../grid/alice
bin/tahoe create-client --introducer=&quot;$FURL&quot; ../grid/bob
</pre></div>
</div>
</div>
<div class="section" id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p>Run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">..</span>\<span class="n">grid</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">introducer</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">introducer</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="n">start</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">introducer</span>
</pre></div>
</div>
<p>Leave the introducer running in that Command Prompt,
and in a separate Command Prompt (with the same current
directory), run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="o">/</span><span class="n">p</span> <span class="n">FURL</span><span class="o">=&lt;..</span>\<span class="n">grid</span>\<span class="n">introducer</span>\<span class="n">private</span>\<span class="n">introducer</span><span class="o">.</span><span class="n">furl</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">introducer</span><span class="o">=%</span><span class="n">FURL</span><span class="o">%</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">server</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">client</span> <span class="o">--</span><span class="n">introducer</span><span class="o">=%</span><span class="n">FURL</span><span class="o">%</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">alice</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">client</span> <span class="o">--</span><span class="n">introducer</span><span class="o">=%</span><span class="n">FURL</span><span class="o">%</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">bob</span>
</pre></div>
</div>
</div>
<div class="section" id="both-linux-and-windows">
<h3>Both Linux and Windows<a class="headerlink" href="#both-linux-and-windows" title="Permalink to this headline">¶</a></h3>
<p>(Replace <code class="docutils literal notranslate"><span class="pre">/</span></code> with <code class="docutils literal notranslate"><span class="pre">\</span></code> for Windows paths.)</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">../grid/alice/tahoe.cfg</span></code>, and make the following
changes to the <code class="docutils literal notranslate"><span class="pre">[node]</span></code> and <code class="docutils literal notranslate"><span class="pre">[client]</span></code> sections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="n">nickname</span> <span class="o">=</span> <span class="n">alice</span>
<span class="n">web</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">tcp</span><span class="p">:</span><span class="mi">3457</span><span class="p">:</span><span class="n">interface</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>

<span class="p">[</span><span class="n">client</span><span class="p">]</span>
<span class="n">shares</span><span class="o">.</span><span class="n">needed</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">shares</span><span class="o">.</span><span class="n">happy</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">shares</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Edit <code class="docutils literal notranslate"><span class="pre">../grid/bob/tahoe.cfg</span></code>, and make the following
change to the <code class="docutils literal notranslate"><span class="pre">[node]</span></code> section, and the same change as
above to the <code class="docutils literal notranslate"><span class="pre">[client]</span></code> section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="n">nickname</span> <span class="o">=</span> <span class="n">bob</span>
<span class="n">web</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">tcp</span><span class="p">:</span><span class="mi">3458</span><span class="p">:</span><span class="n">interface</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
</pre></div>
</div>
<p>Note that when running nodes on a single machine,
unique port numbers must be used for each node (and they
must not clash with ports used by other server software).
Here we have used the default of 3456 for the server,
3457 for alice, and 3458 for bob.</p>
<p>Now start all of the nodes (the introducer should still be
running from above):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">tahoe</span> <span class="n">start</span> <span class="o">../</span><span class="n">grid</span><span class="o">/</span><span class="n">server</span>
<span class="nb">bin</span><span class="o">/</span><span class="n">tahoe</span> <span class="n">start</span> <span class="o">../</span><span class="n">grid</span><span class="o">/</span><span class="n">alice</span>
<span class="nb">bin</span><span class="o">/</span><span class="n">tahoe</span> <span class="n">start</span> <span class="o">../</span><span class="n">grid</span><span class="o">/</span><span class="n">bob</span>
</pre></div>
</div>
<p>On Windows, a separate Command Prompt is needed to run each
node.</p>
<p>Open a web browser on <a class="reference external" href="http://127.0.0.1:3457/">http://127.0.0.1:3457/</a> and verify that
alice is connected to the introducer and one storage server.
Then do the same for <a class="reference external" href="http://127.0.0.1:3568/">http://127.0.0.1:3568/</a> to verify that
bob is connected. Leave all of the nodes running for the
next stage.</p>
</div>
</div>
<div class="section" id="setting-up-magic-folder">
<h2>Setting up Magic Folder<a class="headerlink" href="#setting-up-magic-folder" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Linux<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir -p ../local/alice ../local/bob
bin/tahoe -d ../grid/alice magic-folder create magic: alice ../local/alice
bin/tahoe -d ../grid/alice magic-folder invite magic: bob &gt;invitecode
export INVITECODE=`cat invitecode`
bin/tahoe -d ../grid/bob magic-folder join &quot;$INVITECODE&quot; ../local/bob

bin/tahoe restart ../grid/alice
bin/tahoe restart ../grid/bob
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Windows<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">..</span>\<span class="n">local</span>\<span class="n">alice</span> <span class="o">..</span>\<span class="n">local</span>\<span class="n">bob</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="o">-</span><span class="n">d</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">alice</span> <span class="n">magic</span><span class="o">-</span><span class="n">folder</span> <span class="n">create</span> <span class="n">magic</span><span class="p">:</span> <span class="n">alice</span> <span class="o">..</span>\<span class="n">local</span>\<span class="n">alice</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="o">-</span><span class="n">d</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">alice</span> <span class="n">magic</span><span class="o">-</span><span class="n">folder</span> <span class="n">invite</span> <span class="n">magic</span><span class="p">:</span> <span class="n">bob</span> <span class="o">&gt;</span><span class="n">invitecode</span>
<span class="nb">set</span> <span class="o">/</span><span class="n">p</span> <span class="n">INVITECODE</span><span class="o">=&lt;</span><span class="n">invitecode</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="o">-</span><span class="n">d</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">bob</span> <span class="n">magic</span><span class="o">-</span><span class="n">folder</span> <span class="n">join</span> <span class="o">%</span><span class="n">INVITECODE</span><span class="o">%</span> <span class="o">..</span>\<span class="n">local</span>\<span class="n">bob</span>
</pre></div>
</div>
<p>Then close the Command Prompt windows that are running the alice and bob
nodes, and open two new ones in which to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span>\<span class="n">tahoe</span> <span class="n">start</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">alice</span>
<span class="nb">bin</span>\<span class="n">tahoe</span> <span class="n">start</span> <span class="o">..</span>\<span class="n">grid</span>\<span class="n">bob</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>You can now experiment with creating files and directories in
<code class="docutils literal notranslate"><span class="pre">../local/alice</span></code> and <code class="docutils literal notranslate"><span class="pre">/local/bob</span></code>; any changes should be
propagated to the other directory.</p>
<p>Note that when a file is deleted, the corresponding file in the
other directory will be renamed to a filename ending in <code class="docutils literal notranslate"><span class="pre">.backup</span></code>.
Deleting a directory will have no effect.</p>
<p>For other known issues and limitations, see <a class="reference internal" href="frontends/magic-folder.html#known-issues-in-magic-folder"><span class="std std-ref">Known Issues and Limitations With Magic-Folder</span></a>.</p>
<p>As mentioned earlier, it is also possible to run the nodes on
different machines, to synchronize between three or more clients,
to mix Windows and Linux clients, and to use multiple servers
(if the Tahoe-LAFS encoding parameters are changed).</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>There will be a <code class="docutils literal notranslate"><span class="pre">[magic_folder]</span></code> section in your <code class="docutils literal notranslate"><span class="pre">tahoe.cfg</span></code> file
after setting up Magic Folder.</p>
<p>There is an option you can add to this called <code class="docutils literal notranslate"><span class="pre">poll_interval=</span></code> to
control how often (in seconds) the Downloader will check for new things
to download.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Magic Folder Set-up Howto</a><ul>
<li><a class="reference internal" href="#this-document">This document</a></li>
<li><a class="reference internal" href="#setting-up-a-local-test-grid">Setting up a local test grid</a><ul>
<li><a class="reference internal" href="#linux">Linux</a></li>
<li><a class="reference internal" href="#windows">Windows</a></li>
<li><a class="reference internal" href="#both-linux-and-windows">Both Linux and Windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-up-magic-folder">Setting up Magic Folder</a><ul>
<li><a class="reference internal" href="#id1">Linux</a></li>
<li><a class="reference internal" href="#id2">Windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="write_coordination.html"
                        title="previous chapter">Avoiding Write Collisions in Tahoe</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="backupdb.html"
                        title="next chapter">The Tahoe BackupDB</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/magic-folder-howto.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="backupdb.html" title="The Tahoe BackupDB"
             >next</a> |</li>
        <li class="right" >
          <a href="write_coordination.html" title="Avoiding Write Collisions in Tahoe"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Tahoe-LAFS 1.x documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, The Tahoe-LAFS Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>