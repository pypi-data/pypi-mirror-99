
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Performance costs for some common operations &#8212; Tahoe-LAFS 1.x documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tahoe Logging" href="logging.html" />
    <link rel="prev" title="Node Keys in Tahoe-LAFS" href="nodekeys.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="logging.html" title="Tahoe Logging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nodekeys.html" title="Node Keys in Tahoe-LAFS"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Tahoe-LAFS 1.x documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="performance-costs-for-some-common-operations">
<h1>Performance costs for some common operations<a class="headerlink" href="#performance-costs-for-some-common-operations" title="Permalink to this headline">¶</a></h1>
<ol class="arabic simple">
<li><a class="reference internal" href="#publishing-an-a-byte-immutable-file">Publishing an A-byte immutable file</a></li>
<li><a class="reference internal" href="#publishing-an-a-byte-mutable-file">Publishing an A-byte mutable file</a></li>
<li><a class="reference internal" href="#downloading-b-bytes-of-an-a-byte-immutable-file">Downloading B bytes of an A-byte immutable file</a></li>
<li><a class="reference internal" href="#downloading-b-bytes-of-an-a-byte-mutable-file">Downloading B bytes of an A-byte mutable file</a></li>
<li><a class="reference internal" href="#modifying-b-bytes-of-an-a-byte-mutable-file">Modifying B bytes of an A-byte mutable file</a></li>
<li><a class="reference internal" href="#inserting-removing-b-bytes-in-an-a-byte-mutable-file">Inserting/Removing B bytes in an A-byte mutable file</a></li>
<li><a class="reference internal" href="#adding-an-entry-to-an-a-entry-directory">Adding an entry to an A-entry directory</a></li>
<li><a class="reference internal" href="#listing-an-a-entry-directory">Listing an A entry directory</a></li>
<li><a class="reference internal" href="#checking-an-a-byte-file">Checking an A-byte file</a></li>
<li><a class="reference internal" href="#verifying-an-a-byte-file-immutable">Verifying an A-byte file (immutable)</a></li>
<li><a class="reference internal" href="#repairing-an-a-byte-file-mutable-or-immutable">Repairing an A-byte file (mutable or immutable)</a></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">K</span></code> indicates the number of shares required to reconstruct the file
(default: 3)</p>
<p><code class="docutils literal notranslate"><span class="pre">N</span></code> indicates the total number of shares produced (default: 10)</p>
<p><code class="docutils literal notranslate"><span class="pre">S</span></code> indicates the segment size (default: 128 KiB)</p>
<p><code class="docutils literal notranslate"><span class="pre">A</span></code> indicates the number of bytes in a file</p>
<p><code class="docutils literal notranslate"><span class="pre">B</span></code> indicates the number of bytes of a file that are being read or
written</p>
<p><code class="docutils literal notranslate"><span class="pre">G</span></code> indicates the number of storage servers on your grid</p>
<p>Most of these cost estimates may have a further constant multiplier: when a
formula says <code class="docutils literal notranslate"><span class="pre">N/K*S</span></code>, the cost may actually be <code class="docutils literal notranslate"><span class="pre">2*N/K*S</span></code> or <code class="docutils literal notranslate"><span class="pre">3*N/K*S</span></code>.
Also note that all references to mutable files are for SDMF-formatted files;
this document has not yet been updated to describe the MDMF format.</p>
<div class="section" id="publishing-an-a-byte-immutable-file">
<h2>Publishing an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte immutable file<a class="headerlink" href="#publishing-an-a-byte-immutable-file" title="Permalink to this headline">¶</a></h2>
<div class="section" id="when-the-file-is-already-uploaded">
<h3>when the file is already uploaded<a class="headerlink" href="#when-the-file-is-already-uploaded" title="Permalink to this headline">¶</a></h3>
<p>If the file is already uploaded with the exact same contents, same
erasure coding parameters (K, N), and same added convergence secret,
then it reads the whole file from disk one time while hashing it to
compute the storage index, then contacts about N servers to ask each
one to store a share. All of the servers reply that they already have
a copy of that share, and the upload is done.</p>
<p>disk: A</p>
<p>cpu: ~A</p>
<p>network: ~N</p>
<p>memory footprint: S</p>
</div>
<div class="section" id="when-the-file-is-not-already-uploaded">
<h3>when the file is not already uploaded<a class="headerlink" href="#when-the-file-is-not-already-uploaded" title="Permalink to this headline">¶</a></h3>
<p>If the file is not already uploaded with the exact same contents, same
erasure coding parameters (K, N), and same added convergence secret,
then it reads the whole file from disk one time while hashing it to
compute the storage index, then contacts about N servers to ask each
one to store a share. Then it uploads each share to a storage server.</p>
<p>disk: 2*A</p>
<p>cpu: 2*~A</p>
<p>network: N/K*A</p>
<p>memory footprint: N/K*S</p>
</div>
</div>
<div class="section" id="publishing-an-a-byte-mutable-file">
<h2>Publishing an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file<a class="headerlink" href="#publishing-an-a-byte-mutable-file" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~A + a large constant for RSA keypair generation</p>
<p>network: A</p>
<p>memory footprint: N/K*A</p>
<p>notes: Tahoe-LAFS generates a new RSA keypair for each mutable file that it
publishes to a grid. This takes up to 1 or 2 seconds on a typical desktop PC.</p>
<p>Part of the process of encrypting, encoding, and uploading a mutable file to a
Tahoe-LAFS grid requires that the entire file be in memory at once. For larger
files, this may cause Tahoe-LAFS to have an unacceptably large memory footprint
(at least when uploading a mutable file).</p>
</div>
<div class="section" id="downloading-b-bytes-of-an-a-byte-immutable-file">
<h2>Downloading <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes of an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte immutable file<a class="headerlink" href="#downloading-b-bytes-of-an-a-byte-immutable-file" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~B</p>
<p>network: B</p>
<p>notes: When Tahoe-LAFS 1.8.0 or later is asked to read an arbitrary
range of an immutable file, only the S-byte segments that overlap the
requested range will be downloaded.</p>
<p>(Earlier versions would download from the beginning of the file up
until the end of the requested range, and then continue to download
the rest of the file even after the request was satisfied.)</p>
</div>
<div class="section" id="downloading-b-bytes-of-an-a-byte-mutable-file">
<h2>Downloading <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes of an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file<a class="headerlink" href="#downloading-b-bytes-of-an-a-byte-mutable-file" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~A</p>
<p>network: A</p>
<p>memory footprint: A</p>
<p>notes: As currently implemented, mutable files must be downloaded in
their entirety before any part of them can be read. We are
exploring fixes for this; see ticket #393 for more information.</p>
</div>
<div class="section" id="modifying-b-bytes-of-an-a-byte-mutable-file">
<h2>Modifying <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes of an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file<a class="headerlink" href="#modifying-b-bytes-of-an-a-byte-mutable-file" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~A</p>
<p>network: A</p>
<p>memory footprint: N/K*A</p>
<p>notes: If you upload a changed version of a mutable file that you
earlier put onto your grid with, say, ‘tahoe put –mutable’,
Tahoe-LAFS will replace the old file with the new file on the
grid, rather than attempting to modify only those portions of the
file that have changed. Modifying a file in this manner is
essentially uploading the file over again, except that it re-uses
the existing RSA keypair instead of generating a new one.</p>
</div>
<div class="section" id="inserting-removing-b-bytes-in-an-a-byte-mutable-file">
<h2>Inserting/Removing <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes in an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file<a class="headerlink" href="#inserting-removing-b-bytes-in-an-a-byte-mutable-file" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~A</p>
<p>network: A</p>
<p>memory footprint: N/K*A</p>
<p>notes: Modifying any part of a mutable file in Tahoe-LAFS requires that
the entire file be downloaded, modified, held in memory while it is
encrypted and encoded, and then re-uploaded. A future version of the
mutable file layout (“LDMF”) may provide efficient inserts and
deletes. Note that this sort of modification is mostly used internally
for directories, and isn’t something that the WUI, CLI, or other
interfaces will do – instead, they will simply overwrite the file to
be modified, as described in “Modifying B bytes of an A-byte mutable
file”.</p>
</div>
<div class="section" id="adding-an-entry-to-an-a-entry-directory">
<h2>Adding an entry to an <code class="docutils literal notranslate"><span class="pre">A</span></code>-entry directory<a class="headerlink" href="#adding-an-entry-to-an-a-entry-directory" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~A</p>
<p>network: ~A</p>
<p>memory footprint: N/K*~A</p>
<p>notes: In Tahoe-LAFS, directories are implemented as specialized mutable
files. So adding an entry to a directory is essentially adding B
(actually, 300-330) bytes somewhere in an existing mutable file.</p>
</div>
<div class="section" id="listing-an-a-entry-directory">
<h2>Listing an <code class="docutils literal notranslate"><span class="pre">A</span></code> entry directory<a class="headerlink" href="#listing-an-a-entry-directory" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~A</p>
<p>network: ~A</p>
<p>memory footprint: N/K*~A</p>
<p>notes: Listing a directory requires that the mutable file storing the
directory be downloaded from the grid. So listing an A entry
directory requires downloading a (roughly) 330 * A byte mutable
file, since each directory entry is about 300-330 bytes in size.</p>
</div>
<div class="section" id="checking-an-a-byte-file">
<h2>Checking an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte file<a class="headerlink" href="#checking-an-a-byte-file" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~G</p>
<p>network: ~G</p>
<p>memory footprint: negligible</p>
<p>notes: To check a file, Tahoe-LAFS queries all the servers that it knows
about. Note that neither of these values directly depend on the size
of the file. This is relatively inexpensive, compared to the verify
and repair operations.</p>
</div>
<div class="section" id="verifying-an-a-byte-file-immutable">
<h2>Verifying an A-byte file (immutable)<a class="headerlink" href="#verifying-an-a-byte-file-immutable" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~N/K*A</p>
<p>network: N/K*A</p>
<p>memory footprint: N/K*S</p>
<p>notes: To verify a file, Tahoe-LAFS downloads all of the ciphertext
shares that were originally uploaded to the grid and integrity checks
them. This is (for grids with good redundancy) more expensive than
downloading an A-byte file, since only a fraction of these shares would
be necessary to recover the file.</p>
</div>
<div class="section" id="verifying-an-a-byte-file-mutable">
<h2>Verifying an A-byte file (mutable)<a class="headerlink" href="#verifying-an-a-byte-file-mutable" title="Permalink to this headline">¶</a></h2>
<p>cpu: ~N/K*A</p>
<p>network: N/K*A</p>
<p>memory footprint: N/K*A</p>
<p>notes: To verify a file, Tahoe-LAFS downloads all of the ciphertext
shares that were originally uploaded to the grid and integrity checks
them. This is (for grids with good redundancy) more expensive than
downloading an A-byte file, since only a fraction of these shares would
be necessary to recover the file.</p>
</div>
<div class="section" id="repairing-an-a-byte-file-mutable-or-immutable">
<h2>Repairing an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte file (mutable or immutable)<a class="headerlink" href="#repairing-an-a-byte-file-mutable-or-immutable" title="Permalink to this headline">¶</a></h2>
<p>cpu: variable, between ~A and ~N/K*A</p>
<p>network: variable; between A and N/K*A</p>
<dl class="docutils">
<dt>memory footprint (immutable): (1+N/K)*S</dt>
<dd>(SDMF mutable): (1+N/K)*A</dd>
</dl>
<p>notes: To repair a file, Tahoe-LAFS downloads the file, and
generates/uploads missing shares in the same way as when it initially
uploads the file.  So, depending on how many shares are missing, this
can cost as little as a download or as much as a download followed by
a full upload.</p>
<p>Since SDMF files have only one segment, which must be processed in its
entirety, repair requires a full-file download followed by a full-file
upload.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Performance costs for some common operations</a><ul>
<li><a class="reference internal" href="#publishing-an-a-byte-immutable-file">Publishing an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte immutable file</a><ul>
<li><a class="reference internal" href="#when-the-file-is-already-uploaded">when the file is already uploaded</a></li>
<li><a class="reference internal" href="#when-the-file-is-not-already-uploaded">when the file is not already uploaded</a></li>
</ul>
</li>
<li><a class="reference internal" href="#publishing-an-a-byte-mutable-file">Publishing an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file</a></li>
<li><a class="reference internal" href="#downloading-b-bytes-of-an-a-byte-immutable-file">Downloading <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes of an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte immutable file</a></li>
<li><a class="reference internal" href="#downloading-b-bytes-of-an-a-byte-mutable-file">Downloading <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes of an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file</a></li>
<li><a class="reference internal" href="#modifying-b-bytes-of-an-a-byte-mutable-file">Modifying <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes of an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file</a></li>
<li><a class="reference internal" href="#inserting-removing-b-bytes-in-an-a-byte-mutable-file">Inserting/Removing <code class="docutils literal notranslate"><span class="pre">B</span></code> bytes in an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte mutable file</a></li>
<li><a class="reference internal" href="#adding-an-entry-to-an-a-entry-directory">Adding an entry to an <code class="docutils literal notranslate"><span class="pre">A</span></code>-entry directory</a></li>
<li><a class="reference internal" href="#listing-an-a-entry-directory">Listing an <code class="docutils literal notranslate"><span class="pre">A</span></code> entry directory</a></li>
<li><a class="reference internal" href="#checking-an-a-byte-file">Checking an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte file</a></li>
<li><a class="reference internal" href="#verifying-an-a-byte-file-immutable">Verifying an A-byte file (immutable)</a></li>
<li><a class="reference internal" href="#verifying-an-a-byte-file-mutable">Verifying an A-byte file (mutable)</a></li>
<li><a class="reference internal" href="#repairing-an-a-byte-file-mutable-or-immutable">Repairing an <code class="docutils literal notranslate"><span class="pre">A</span></code>-byte file (mutable or immutable)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="nodekeys.html"
                        title="previous chapter">Node Keys in Tahoe-LAFS</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="logging.html"
                        title="next chapter">Tahoe Logging</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/performance.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="logging.html" title="Tahoe Logging"
             >next</a> |</li>
        <li class="right" >
          <a href="nodekeys.html" title="Node Keys in Tahoe-LAFS"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Tahoe-LAFS 1.x documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, The Tahoe-LAFS Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>