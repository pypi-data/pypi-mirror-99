
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>How To Configure A Server &#8212; Tahoe-LAFS 1.x documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Tahoe Upload Helper" href="helper.html" />
    <link rel="prev" title="Known Issues" href="known_issues.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="helper.html" title="The Tahoe Upload Helper"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="known_issues.html" title="Known Issues"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Tahoe-LAFS 1.x documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-configure-a-server">
<h1>How To Configure A Server<a class="headerlink" href="#how-to-configure-a-server" title="Permalink to this headline">¶</a></h1>
<p>Many Tahoe-LAFS nodes run as “servers”, meaning they provide services for
other machines (i.e. “clients”). The two most important kinds are the
Introducer, and Storage Servers.</p>
<p>To be useful, servers must be reachable by clients. Tahoe servers can listen
on TCP ports, and advertise their “location” (hostname and TCP port number)
so clients can connect to them. They can also listen on Tor “onion services”
and I2P ports.</p>
<p>Storage servers advertise their location by announcing it to the Introducer,
which then broadcasts the location to all clients. So once the location is
determined, you don’t need to do anything special to deliver it.</p>
<p>The Introducer itself has a location, which must be manually delivered to all
storage servers and clients. You might email it to the new members of your
grid. This location (along with other important cryptographic identifiers) is
written into a file named <code class="docutils literal notranslate"><span class="pre">private/introducer.furl</span></code> in the Introducer’s
base directory, and should be provided as the <code class="docutils literal notranslate"><span class="pre">--introducer=</span></code> argument to
<code class="docutils literal notranslate"><span class="pre">tahoe</span> <span class="pre">create-client</span></code> or <code class="docutils literal notranslate"><span class="pre">tahoe</span> <span class="pre">create-node</span></code>.</p>
<p>The first step when setting up a server is to figure out how clients will
reach it. Then you need to configure the server to listen on some ports, and
then configure the location properly.</p>
<div class="section" id="manual-configuration">
<h2>Manual Configuration<a class="headerlink" href="#manual-configuration" title="Permalink to this headline">¶</a></h2>
<p>Each server has two settings in their <code class="docutils literal notranslate"><span class="pre">tahoe.cfg</span></code> file: <code class="docutils literal notranslate"><span class="pre">tub.port</span></code>, and
<code class="docutils literal notranslate"><span class="pre">tub.location</span></code>. The “port” controls what the server node listens to: this
is generally a TCP port.</p>
<p>The “location” controls what is advertised to the outside world. This is a
“foolscap connection hint”, and it includes both the type of the connection
(tcp, tor, or i2p) and the connection details (hostname/address, port
number). Various proxies, port-forwardings, and privacy networks might be
involved, so it’s not uncommon for <code class="docutils literal notranslate"><span class="pre">tub.port</span></code> and <code class="docutils literal notranslate"><span class="pre">tub.location</span></code> to look
different.</p>
<p>You can directly control the <code class="docutils literal notranslate"><span class="pre">tub.port</span></code> and <code class="docutils literal notranslate"><span class="pre">tub.location</span></code> configuration
settings by providing <code class="docutils literal notranslate"><span class="pre">--port=</span></code> and <code class="docutils literal notranslate"><span class="pre">--location=</span></code> when running <code class="docutils literal notranslate"><span class="pre">tahoe</span>
<span class="pre">create-node</span></code>.</p>
</div>
<div class="section" id="automatic-configuration">
<h2>Automatic Configuration<a class="headerlink" href="#automatic-configuration" title="Permalink to this headline">¶</a></h2>
<p>Instead of providing <code class="docutils literal notranslate"><span class="pre">--port=/--location=</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">--listen=</span></code>.
Servers can listen on TCP, Tor, I2P, a combination of those, or none at all.
The <code class="docutils literal notranslate"><span class="pre">--listen=</span></code> argument controls which kinds of listeners the new server
will use.</p>
<p><code class="docutils literal notranslate"><span class="pre">--listen=none</span></code> means the server should not listen at all. This doesn’t
make sense for a server, but is appropriate for a client-only node. The
<code class="docutils literal notranslate"><span class="pre">tahoe</span> <span class="pre">create-client</span></code> command automatically includes <code class="docutils literal notranslate"><span class="pre">--listen=none</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">--listen=tcp</span></code> is the default, and turns on a standard TCP listening port.
Using <code class="docutils literal notranslate"><span class="pre">--listen=tcp</span></code> requires a <code class="docutils literal notranslate"><span class="pre">--hostname=</span></code> argument too, which will be
incorporated into the node’s advertised location. We’ve found that computers
cannot reliably determine their externally-reachable hostname, so rather than
having the server make a guess (or scanning its interfaces for IP addresses
that might or might not be appropriate), node creation requires the user to
provide the hostname.</p>
<p><code class="docutils literal notranslate"><span class="pre">--listen=tor</span></code> will talk to a local Tor daemon and create a new “onion
server” address (which look like <code class="docutils literal notranslate"><span class="pre">alzrgrdvxct6c63z.onion</span></code>). Likewise
<code class="docutils literal notranslate"><span class="pre">--listen=i2p</span></code> will talk to a local I2P daemon and create a new server
address. See <a class="reference internal" href="anonymity-configuration.html"><span class="doc">Using Tahoe-LAFS with an anonymizing network: Tor, I2P</span></a> for details.</p>
<p>You could listen on all three by using <code class="docutils literal notranslate"><span class="pre">--listen=tcp,tor,i2p</span></code>.</p>
</div>
<div class="section" id="deployment-scenarios">
<h2>Deployment Scenarios<a class="headerlink" href="#deployment-scenarios" title="Permalink to this headline">¶</a></h2>
<p>The following are some suggested scenarios for configuring servers using
various network transports. These examples do not include specifying an
introducer FURL which normally you would want when provisioning storage
nodes. For these and other configuration details please refer to
<a class="reference internal" href="configuration.html"><span class="doc">Configuring a Tahoe-LAFS node</span></a>.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#server-has-a-public-dns-name">Server has a public DNS name</a></li>
<li><a class="reference internal" href="#server-has-a-public-ipv4-ipv6-address">Server has a public IPv4/IPv6 address</a></li>
<li><a class="reference internal" href="#server-is-behind-a-firewall-with-port-forwarding">Server is behind a firewall with port forwarding</a></li>
<li><a class="reference internal" href="#using-i2p-tor-to-avoid-port-forwarding">Using I2P/Tor to Avoid Port-Forwarding</a></li>
</ol>
<div class="section" id="server-has-a-public-dns-name">
<h3>Server has a public DNS name<a class="headerlink" href="#server-has-a-public-dns-name" title="Permalink to this headline">¶</a></h3>
<p>The simplest case is where your server host is directly connected to the
internet, without a firewall or NAT box in the way. Most VPS (Virtual Private
Server) and colocated servers are like this, although some providers block
many inbound ports by default.</p>
<p>For these servers, all you need to know is the external hostname. The system
administrator will tell you this. The main requirement is that this hostname
can be looked up in DNS, and it will map to an IPv4 or IPv6 address which
will reach the machine.</p>
<p>If your hostname is <code class="docutils literal notranslate"><span class="pre">example.net</span></code>, then you’ll create the introducer like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">introducer</span> <span class="o">--</span><span class="n">hostname</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="o">~/</span><span class="n">introducer</span>
</pre></div>
</div>
<p>or a storage server like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">hostname</span><span class="o">=</span><span class="n">example</span><span class="o">.</span><span class="n">net</span>
</pre></div>
</div>
<p>These will allocate a TCP port (e.g. 12345), assign <code class="docutils literal notranslate"><span class="pre">tub.port</span></code> to be
<code class="docutils literal notranslate"><span class="pre">tcp:12345</span></code>, and <code class="docutils literal notranslate"><span class="pre">tub.location</span></code> will be <code class="docutils literal notranslate"><span class="pre">tcp:example.com:12345</span></code>.</p>
<p>Ideally this should work for IPv6-capable hosts too (where the DNS name
provides an “AAAA” record, or both “A” and “AAAA”). However Tahoe-LAFS
support for IPv6 is new, and may still have problems. Please see ticket
<a class="reference external" href="https://tahoe-lafs.org/trac/tahoe-lafs/ticket/867">#867</a> for details.</p>
</div>
<div class="section" id="server-has-a-public-ipv4-ipv6-address">
<h3>Server has a public IPv4/IPv6 address<a class="headerlink" href="#server-has-a-public-ipv4-ipv6-address" title="Permalink to this headline">¶</a></h3>
<p>If the host has a routeable (public) IPv4 address (e.g. <code class="docutils literal notranslate"><span class="pre">203.0.113.1</span></code>), but
no DNS name, you will need to choose a TCP port (e.g. <code class="docutils literal notranslate"><span class="pre">3457</span></code>), and use the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mi">3457</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.1</span><span class="p">:</span><span class="mi">3457</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">--port</span></code> is an “endpoint specification string” that controls which local
port the node listens on. <code class="docutils literal notranslate"><span class="pre">--location</span></code> is the “connection hint” that it
advertises to others, and describes the outbound connections that those
clients will make, so it needs to work from their location on the network.</p>
<p>Tahoe-LAFS nodes listen on all interfaces by default. When the host is
multi-homed, you might want to make the listening port bind to just one
specific interface by adding a <code class="docutils literal notranslate"><span class="pre">interface=</span></code> option to the <code class="docutils literal notranslate"><span class="pre">--port=</span></code>
argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mi">3457</span><span class="p">:</span><span class="n">interface</span><span class="o">=</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.1</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.1</span><span class="p">:</span><span class="mi">3457</span>
</pre></div>
</div>
<p>If the host’s public address is IPv6 instead of IPv4, use square brackets to
wrap the address, and change the endpoint type to <code class="docutils literal notranslate"><span class="pre">tcp6</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">tcp6</span><span class="p">:</span><span class="mi">3457</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">tcp</span><span class="p">:[</span><span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="mi">1</span><span class="p">]:</span><span class="mi">3457</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">interface=</span></code> to bind to a specific IPv6 interface too, however
you must backslash-escape the colons, because otherwise they are interpreted
as delimiters by the Twisted “endpoint” specification language. The
<code class="docutils literal notranslate"><span class="pre">--location=</span></code> argument does not need colons to be escaped, because they are
wrapped by the square brackets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">tcp6</span><span class="p">:</span><span class="mi">3457</span><span class="p">:</span><span class="n">interface</span><span class="o">=</span><span class="mi">2001</span>\<span class="p">:</span><span class="n">db8</span>\<span class="p">:</span>\<span class="p">:</span><span class="mi">1</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">tcp</span><span class="p">:[</span><span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="mi">1</span><span class="p">]:</span><span class="mi">3457</span>
</pre></div>
</div>
<p>For IPv6-only hosts with AAAA DNS records, if the simple <code class="docutils literal notranslate"><span class="pre">--hostname=</span></code>
configuration does not work, they can be told to listen specifically on an
IPv6-enabled port with this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">tcp6</span><span class="p">:</span><span class="mi">3457</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="n">example</span><span class="o">.</span><span class="n">net</span><span class="p">:</span><span class="mi">3457</span>
</pre></div>
</div>
</div>
<div class="section" id="server-is-behind-a-firewall-with-port-forwarding">
<h3>Server is behind a firewall with port forwarding<a class="headerlink" href="#server-is-behind-a-firewall-with-port-forwarding" title="Permalink to this headline">¶</a></h3>
<p>To configure a storage node behind a firewall with port forwarding you will
need to know:</p>
<ul class="simple">
<li>public IPv4 address of the router</li>
<li>the TCP port that is available from outside your network</li>
<li>the TCP port that is the forwarding destination</li>
<li>internal IPv4 address of the storage node (the storage node itself is
unaware of this address, and it is not used during <code class="docutils literal notranslate"><span class="pre">tahoe</span> <span class="pre">create-node</span></code>,
but the firewall must be configured to send connections to this)</li>
</ul>
<p>The internal and external TCP port numbers could be the same or different
depending on how the port forwarding is configured. If it is mapping ports
1-to-1, and the public IPv4 address of the firewall is 203.0.113.1 (and
perhaps the internal IPv4 address of the storage node is 192.168.1.5), then
use a CLI command like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mi">3457</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.1</span><span class="p">:</span><span class="mi">3457</span>
</pre></div>
</div>
<p>If however the firewall/NAT-box forwards external port <em>6656</em> to internal
port 3457, then do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mi">3457</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="mf">203.0</span><span class="o">.</span><span class="mf">113.1</span><span class="p">:</span><span class="mi">6656</span>
</pre></div>
</div>
</div>
<div class="section" id="using-i2p-tor-to-avoid-port-forwarding">
<h3>Using I2P/Tor to Avoid Port-Forwarding<a class="headerlink" href="#using-i2p-tor-to-avoid-port-forwarding" title="Permalink to this headline">¶</a></h3>
<p>I2P and Tor onion services, among other great properties, also provide NAT
penetration without port-forwarding, hostnames, or IP addresses. So setting
up a server that listens only on Tor is simple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tahoe</span> <span class="n">create</span><span class="o">-</span><span class="n">node</span> <span class="o">--</span><span class="n">listen</span><span class="o">=</span><span class="n">tor</span>
</pre></div>
</div>
<p>For more information about using Tahoe-LAFS with I2p and Tor see
<a class="reference internal" href="anonymity-configuration.html"><span class="doc">Using Tahoe-LAFS with an anonymizing network: Tor, I2P</span></a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How To Configure A Server</a><ul>
<li><a class="reference internal" href="#manual-configuration">Manual Configuration</a></li>
<li><a class="reference internal" href="#automatic-configuration">Automatic Configuration</a></li>
<li><a class="reference internal" href="#deployment-scenarios">Deployment Scenarios</a><ul>
<li><a class="reference internal" href="#server-has-a-public-dns-name">Server has a public DNS name</a></li>
<li><a class="reference internal" href="#server-has-a-public-ipv4-ipv6-address">Server has a public IPv4/IPv6 address</a></li>
<li><a class="reference internal" href="#server-is-behind-a-firewall-with-port-forwarding">Server is behind a firewall with port forwarding</a></li>
<li><a class="reference internal" href="#using-i2p-tor-to-avoid-port-forwarding">Using I2P/Tor to Avoid Port-Forwarding</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="known_issues.html"
                        title="previous chapter">Known Issues</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="helper.html"
                        title="next chapter">The Tahoe Upload Helper</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/servers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="helper.html" title="The Tahoe Upload Helper"
             >next</a> |</li>
        <li class="right" >
          <a href="known_issues.html" title="Known Issues"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Tahoe-LAFS 1.x documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, The Tahoe-LAFS Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>