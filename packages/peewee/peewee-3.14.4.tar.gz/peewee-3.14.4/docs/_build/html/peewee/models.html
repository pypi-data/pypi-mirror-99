
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Models and Fields &#8212; peewee 3.9.3 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Querying" href="querying.html" />
    <link rel="prev" title="Database" href="database.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="querying.html" title="Querying"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="database.html" title="Database"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">peewee 3.9.3 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="models-and-fields">
<span id="models"></span><h1>Models and Fields<a class="headerlink" href="#models-and-fields" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="api.html#Model" title="Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> classes, <a class="reference internal" href="api.html#Field" title="Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> instances and model instances all
map to database concepts:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Thing</th>
<th class="head">Corresponds to…</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Model class</td>
<td>Database table</td>
</tr>
<tr class="row-odd"><td>Field instance</td>
<td>Column on a table</td>
</tr>
<tr class="row-even"><td>Model instance</td>
<td>Row in a database table</td>
</tr>
</tbody>
</table>
<p>The following code shows the typical way you will define your database
connection and model classes.</p>
<div class="highlight-python notranslate" id="blog-models"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;my_app.db&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;tweets&#39;</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">created_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">is_published</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic">
<li><p class="first">Create an instance of a <a class="reference internal" href="api.html#Database" title="Database"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code></a>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;my_app.db&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">db</span></code> object will be used to manage the connections to the Sqlite
database. In this example we’re using <a class="reference internal" href="api.html#SqliteDatabase" title="SqliteDatabase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SqliteDatabase</span></code></a>, but you
could also use one of the other <a class="reference internal" href="database.html#database"><span class="std std-ref">database engines</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Create a base model class which specifies our database.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>
</pre></div>
</div>
<p>It is good practice to define a base model class which establishes the
database connection. This makes your code DRY as you will not have to
specify the database for subsequent models.</p>
<p>Model configuration is kept namespaced in a special class called <code class="docutils literal notranslate"><span class="pre">Meta</span></code>.
This convention is borrowed from Django. <a class="reference internal" href="#model-options"><span class="std std-ref">Meta</span></a>
configuration is passed on to subclasses, so our project’s models will all
subclass <em>BaseModel</em>. There are <a class="reference internal" href="#model-options"><span class="std std-ref">many different attributes</span></a> you can configure using <em>Model.Meta</em>.</p>
</div></blockquote>
</li>
<li><p class="first">Define a model class.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Model definition uses the declarative style seen in other popular ORMs like
SQLAlchemy or Django. Note that we are extending the <em>BaseModel</em> class so
the <em>User</em> model will inherit the database connection.</p>
<p>We have explicitly defined a single <em>username</em> column with a unique
constraint. Because we have not specified a primary key, peewee will
automatically add an auto-incrementing integer primary key field named
<em>id</em>.</p>
</div></blockquote>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you would like to start using peewee with an existing database, you can
use <a class="reference internal" href="playhouse.html#pwiz"><span class="std std-ref">pwiz, a model generator</span></a> to automatically generate model definitions.</p>
</div>
<div class="section" id="fields">
<span id="id1"></span><h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="api.html#Field" title="Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> class is used to describe the mapping of
<a class="reference internal" href="api.html#Model" title="Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> attributes to database columns. Each field type has a
corresponding SQL storage class (i.e. varchar, int), and conversion between
python data types and underlying storage is handled transparently.</p>
<p>When creating a <a class="reference internal" href="api.html#Model" title="Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> class, fields are defined as class
attributes. This should look familiar to users of the django framework. Here’s
an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">join_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">about_me</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
</pre></div>
</div>
<p>In the above example, because none of the fields are initialized with
<code class="docutils literal notranslate"><span class="pre">primary_key=True</span></code>, an auto-incrementing primary key will automatically be
created and named “id”. Peewee uses <a class="reference internal" href="api.html#AutoField" title="AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a> to signify an
auto-incrementing integer primary key, which implies <code class="docutils literal notranslate"><span class="pre">primary_key=True</span></code>.</p>
<p>There is one special type of field, <a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></a>, which allows
you to represent foreign-key relationships between models in an intuitive way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;messages&#39;</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">send_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows you to write code like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">some_message</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
<span class="go">Some User</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">some_user</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
<span class="go">some message</span>
<span class="go">another message</span>
<span class="go">yet another message</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Refer to the <a class="reference internal" href="relationships.html#relationships"><span class="std std-ref">Relationships and Joins</span></a> document for an in-depth discussion of
foreign-keys, joins and relationships between models.</p>
</div>
<p>For full documentation on fields, see the <a class="reference internal" href="api.html#fields-api"><span class="std std-ref">Fields API notes</span></a></p>
<div class="section" id="field-types-table">
<span id="id2"></span><h3>Field types table<a class="headerlink" href="#field-types-table" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="24%" />
<col width="24%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field Type</th>
<th class="head">Sqlite</th>
<th class="head">Postgresql</th>
<th class="head">MySQL</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">AutoField</span></code></td>
<td>integer</td>
<td>serial</td>
<td>integer</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">BigAutoField</span></code></td>
<td>integer</td>
<td>bigserial</td>
<td>bigint</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">IntegerField</span></code></td>
<td>integer</td>
<td>integer</td>
<td>integer</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">BigIntegerField</span></code></td>
<td>integer</td>
<td>bigint</td>
<td>bigint</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SmallIntegerField</span></code></td>
<td>integer</td>
<td>smallint</td>
<td>smallint</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IdentityField</span></code></td>
<td>not supported</td>
<td>int identity</td>
<td>not supported</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">FloatField</span></code></td>
<td>real</td>
<td>real</td>
<td>real</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">DoubleField</span></code></td>
<td>real</td>
<td>double precision</td>
<td>double precision</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">DecimalField</span></code></td>
<td>decimal</td>
<td>numeric</td>
<td>numeric</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">CharField</span></code></td>
<td>varchar</td>
<td>varchar</td>
<td>varchar</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">FixedCharField</span></code></td>
<td>char</td>
<td>char</td>
<td>char</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">TextField</span></code></td>
<td>text</td>
<td>text</td>
<td>text</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">BlobField</span></code></td>
<td>blob</td>
<td>bytea</td>
<td>blob</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">BitField</span></code></td>
<td>integer</td>
<td>bigint</td>
<td>bigint</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">BigBitField</span></code></td>
<td>blob</td>
<td>bytea</td>
<td>blob</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">UUIDField</span></code></td>
<td>text</td>
<td>uuid</td>
<td>varchar(40)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">BinaryUUIDField</span></code></td>
<td>blob</td>
<td>bytea</td>
<td>varbinary(16)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">DateTimeField</span></code></td>
<td>datetime</td>
<td>timestamp</td>
<td>datetime</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">DateField</span></code></td>
<td>date</td>
<td>date</td>
<td>date</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">TimeField</span></code></td>
<td>time</td>
<td>time</td>
<td>time</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">TimestampField</span></code></td>
<td>integer</td>
<td>integer</td>
<td>integer</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IPField</span></code></td>
<td>integer</td>
<td>bigint</td>
<td>bigint</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">BooleanField</span></code></td>
<td>integer</td>
<td>boolean</td>
<td>bool</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">BareField</span></code></td>
<td>untyped</td>
<td>not supported</td>
<td>not supported</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></td>
<td>integer</td>
<td>integer</td>
<td>integer</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Don’t see the field you’re looking for in the above table? It’s easy to
create custom field types and use them with your models.</p>
<ul class="last simple">
<li><a class="reference internal" href="#custom-fields"><span class="std std-ref">Creating a custom field</span></a></li>
<li><a class="reference internal" href="api.html#Database" title="Database"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code></a>, particularly the <code class="docutils literal notranslate"><span class="pre">fields</span></code> parameter.</li>
</ul>
</div>
</div>
<div class="section" id="field-initialization-arguments">
<h3>Field initialization arguments<a class="headerlink" href="#field-initialization-arguments" title="Permalink to this headline">¶</a></h3>
<p>Parameters accepted by all field types and their default values:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">null</span> <span class="pre">=</span> <span class="pre">False</span></code> – allow null values</li>
<li><code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">=</span> <span class="pre">False</span></code> – create an index on this column</li>
<li><code class="docutils literal notranslate"><span class="pre">unique</span> <span class="pre">=</span> <span class="pre">False</span></code> – create a unique index on this column. See also <a class="reference internal" href="#model-indexes"><span class="std std-ref">adding composite indexes</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">column_name</span> <span class="pre">=</span> <span class="pre">None</span></code> – explicitly specify the column name in the database.</li>
<li><code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">=</span> <span class="pre">None</span></code> – any value or callable to use as a default for uninitialized models</li>
<li><code class="docutils literal notranslate"><span class="pre">primary_key</span> <span class="pre">=</span> <span class="pre">False</span></code> – primary key for the table</li>
<li><code class="docutils literal notranslate"><span class="pre">constraints</span> <span class="pre">=</span> <span class="pre">None</span></code> - one or more constraints, e.g. <code class="docutils literal notranslate"><span class="pre">[Check('price</span> <span class="pre">&gt;</span> <span class="pre">0')]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sequence</span> <span class="pre">=</span> <span class="pre">None</span></code> – sequence name (if backend supports it)</li>
<li><code class="docutils literal notranslate"><span class="pre">collation</span> <span class="pre">=</span> <span class="pre">None</span></code> – collation to use for ordering the field / index</li>
<li><code class="docutils literal notranslate"><span class="pre">unindexed</span> <span class="pre">=</span> <span class="pre">False</span></code> – indicate field on virtual table should be unindexed (<strong>SQLite-only</strong>)</li>
<li><code class="docutils literal notranslate"><span class="pre">choices</span> <span class="pre">=</span> <span class="pre">None</span></code> – optional iterable containing 2-tuples of <code class="docutils literal notranslate"><span class="pre">value</span></code>, <code class="docutils literal notranslate"><span class="pre">display</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">help_text</span> <span class="pre">=</span> <span class="pre">None</span></code> – string representing any helpful text for this field</li>
<li><code class="docutils literal notranslate"><span class="pre">verbose_name</span> <span class="pre">=</span> <span class="pre">None</span></code> – string representing the “user-friendly” name of this field</li>
<li><code class="docutils literal notranslate"><span class="pre">index_type</span> <span class="pre">=</span> <span class="pre">None</span></code> – specify a custom index-type, e.g. for Postgres you might specify a <code class="docutils literal notranslate"><span class="pre">'BRIN'</span></code> or <code class="docutils literal notranslate"><span class="pre">'GIN'</span></code> index.</li>
</ul>
</div>
<div class="section" id="some-fields-take-special-parameters">
<h3>Some fields take special parameters…<a class="headerlink" href="#some-fields-take-special-parameters" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field type</th>
<th class="head">Special Parameters</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="api.html#CharField" title="CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">max_length</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api.html#FixedCharField" title="FixedCharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FixedCharField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">max_length</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api.html#DateTimeField" title="DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">formats</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api.html#DateField" title="DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">formats</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api.html#TimeField" title="TimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">formats</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api.html#TimestampField" title="TimestampField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimestampField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">resolution</span></code>, <code class="docutils literal notranslate"><span class="pre">utc</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api.html#DecimalField" title="DecimalField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DecimalField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">max_digits</span></code>, <code class="docutils literal notranslate"><span class="pre">decimal_places</span></code>,
<code class="docutils literal notranslate"><span class="pre">auto_round</span></code>, <code class="docutils literal notranslate"><span class="pre">rounding</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">model</span></code>, <code class="docutils literal notranslate"><span class="pre">field</span></code>, <code class="docutils literal notranslate"><span class="pre">backref</span></code>,
<code class="docutils literal notranslate"><span class="pre">on_delete</span></code>, <code class="docutils literal notranslate"><span class="pre">on_update</span></code>, <code class="docutils literal notranslate"><span class="pre">deferrable</span></code>
<code class="docutils literal notranslate"><span class="pre">lazy_load</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api.html#BareField" title="BareField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BareField</span></code></a></td>
<td><code class="docutils literal notranslate"><span class="pre">adapt</span></code></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">default</span></code> and <code class="docutils literal notranslate"><span class="pre">choices</span></code> could be implemented at the database level
as <em>DEFAULT</em> and <em>CHECK CONSTRAINT</em> respectively, but any application
change would require a schema change. Because of this, <code class="docutils literal notranslate"><span class="pre">default</span></code> is
implemented purely in python and <code class="docutils literal notranslate"><span class="pre">choices</span></code> are not validated but exist
for metadata purposes only.</p>
<p class="last">To add database (server-side) constraints, use the <code class="docutils literal notranslate"><span class="pre">constraints</span></code>
parameter.</p>
</div>
</div>
<div class="section" id="default-field-values">
<h3>Default field values<a class="headerlink" href="#default-field-values" title="Permalink to this headline">¶</a></h3>
<p>Peewee can provide default values for fields when objects are created. For
example to have an <code class="docutils literal notranslate"><span class="pre">IntegerField</span></code> default to zero rather than <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, you
could declare the field with a default value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">read_count</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>In some instances it may make sense for the default value to be dynamic. A
common scenario is using the current date and time. Peewee allows you to
specify a function in these cases, whose return value will be used when the
object is created. Note we only provide the function, we do not actually <em>call</em>
it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are using a field that accepts a mutable type (<cite>list</cite>, <cite>dict</cite>, etc),
and would like to provide a default, it is a good idea to wrap your default
value in a simple function so that multiple model instances are not sharing
a reference to the same underlying object:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">house_defaults</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;beds&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;baths&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">House</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">street</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">house_defaults</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The database can also provide the default value for a field. While peewee does
not explicitly provide an API for setting a server-side default value, you can
use the <code class="docutils literal notranslate"><span class="pre">constraints</span></code> parameter to specify the server default:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;DEFAULT CURRENT_TIMESTAMP&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Remember:</strong> when using the <code class="docutils literal notranslate"><span class="pre">default</span></code> parameter, the values are set by
Peewee rather than being a part of the actual table and column definition.</p>
</div>
</div>
<div class="section" id="foreignkeyfield">
<h3>ForeignKeyField<a class="headerlink" href="#foreignkeyfield" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></a> is a special field type that allows one model to
reference another. Typically a foreign key will contain the primary key of the
model it relates to (but you can specify a particular column by specifying a
<code class="docutils literal notranslate"><span class="pre">field</span></code>).</p>
<p>Foreign keys allow data to be <a class="reference external" href="http://en.wikipedia.org/wiki/Database_normalization">normalized</a>.
In our example models, there is a foreign key from <code class="docutils literal notranslate"><span class="pre">Tweet</span></code> to <code class="docutils literal notranslate"><span class="pre">User</span></code>. This
means that all the users are stored in their own table, as are the tweets, and
the foreign key from tweet to user allows each tweet to <em>point</em> to a particular
user object.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Refer to the <a class="reference internal" href="relationships.html#relationships"><span class="std std-ref">Relationships and Joins</span></a> document for an in-depth discussion of
foreign keys, joins and relationships between models.</p>
</div>
<p>In peewee, accessing the value of a <a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></a> will return the
entire related object, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tweet</span>
          <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">User</span><span class="p">)</span>
          <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
          <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the example above the <code class="docutils literal notranslate"><span class="pre">User</span></code> data was selected as part of the query.
For more examples of this technique, see the <a class="reference internal" href="relationships.html#nplusone"><span class="std std-ref">Avoiding N+1</span></a>
document.</p>
</div>
<p>If we did not select the <code class="docutils literal notranslate"><span class="pre">User</span></code>, though, then an <strong>additional query</strong> would
be issued to fetch the associated <code class="docutils literal notranslate"><span class="pre">User</span></code> data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
    <span class="c1"># WARNING: an additional query will be issued for EACH tweet</span>
    <span class="c1"># to fetch the associated User data.</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>Sometimes you only need the associated primary key value from the foreign key
column. In this case, Peewee follows the convention established by Django, of
allowing you to access the raw foreign key value by appending <code class="docutils literal notranslate"><span class="pre">&quot;_id&quot;</span></code> to the
foreign key field’s name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
    <span class="c1"># Instead of &quot;tweet.user&quot;, we will just get the raw ID value stored</span>
    <span class="c1"># in the column.</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>To prevent accidentally resolving a foreign-key and triggering an additional
query, <a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></a> supports an initialization paramater
<code class="docutils literal notranslate"><span class="pre">lazy_load</span></code> which, when disabled, behaves like the <code class="docutils literal notranslate"><span class="pre">&quot;_id&quot;</span></code> attribute. For
example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ... same fields, except we declare the user FK to have</span>
    <span class="c1"># lazy-load disabled:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;tweets&#39;</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

<span class="c1"># With lazy-load disabled, accessing tweet.user will not perform an extra</span>
<span class="c1"># query and the user ID value is returned instead.</span>
<span class="c1"># e.g.:</span>
<span class="c1"># 1  tweet from user1</span>
<span class="c1"># 1  another from user1</span>
<span class="c1"># 2  tweet from user2</span>

<span class="c1"># However, if we eagerly load the related user object, then the user</span>
<span class="c1"># foreign key will behave like usual:</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

<span class="c1"># user1  tweet from user1</span>
<span class="c1"># user1  another from user1</span>
<span class="c1"># user2  tweet from user1</span>
</pre></div>
</div>
</div>
<div class="section" id="foreignkeyfield-back-references">
<h3>ForeignKeyField Back-references<a class="headerlink" href="#foreignkeyfield-back-references" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></a> allows for a backreferencing property to be bound
to the target model. Implicitly, this property will be named <code class="docutils literal notranslate"><span class="pre">classname_set</span></code>,
where <code class="docutils literal notranslate"><span class="pre">classname</span></code> is the lowercase name of the class, but can be overridden
using the parameter <code class="docutils literal notranslate"><span class="pre">backref</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">from_user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;outbox&#39;</span><span class="p">)</span>
    <span class="n">to_user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;inbox&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>

<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">some_user</span><span class="o">.</span><span class="n">outbox</span><span class="p">:</span>
    <span class="c1"># We are iterating over all Messages whose from_user is some_user.</span>
    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">some_user</span><span class="o">.</span><span class="n">inbox</span><span class="p">:</span>
    <span class="c1"># We are iterating over all Messages whose to_user is some_user</span>
    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="datetimefield-datefield-and-timefield">
<h3>DateTimeField, DateField and TimeField<a class="headerlink" href="#datetimefield-datefield-and-timefield" title="Permalink to this headline">¶</a></h3>
<p>The three fields devoted to working with dates and times have special properties
which allow access to things like the year, month, hour, etc.</p>
<p><a class="reference internal" href="api.html#DateField" title="DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> has properties for:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">year</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">month</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">day</span></code></li>
</ul>
<p><a class="reference internal" href="api.html#TimeField" title="TimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeField</span></code></a> has properties for:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">hour</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">minute</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">second</span></code></li>
</ul>
<p><a class="reference internal" href="api.html#DateTimeField" title="DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> has all of the above.</p>
<p>These properties can be used just like any other expression. Let’s say we have
an events calendar and want to highlight all the days in the current month that
have an event attached:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the current time.</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="c1"># Get days that have events for the current month.</span>
<span class="n">Event</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">event_date</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">event_date</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">event_date</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SQLite does not have a native date type, so dates are stored in formatted
text columns. To ensure that comparisons work correctly, the dates need to
be formatted so they are sorted lexicographically. That is why they are
stored, by default, as <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span> <span class="pre">HH:MM:SS</span></code>.</p>
</div>
</div>
<div class="section" id="bitfield-and-bigbitfield">
<h3>BitField and BigBitField<a class="headerlink" href="#bitfield-and-bigbitfield" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="api.html#BitField" title="BitField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitField</span></code></a> and <a class="reference internal" href="api.html#BigBitField" title="BigBitField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigBitField</span></code></a> are new as of 3.0.0. The
former provides a subclass of <a class="reference internal" href="api.html#IntegerField" title="IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a> that is suitable for
storing feature toggles as an integer bitmask. The latter is suitable for
storing a bitmap for a large data-set, e.g. expressing membership or
bitmap-type data.</p>
<p>As an example of using <a class="reference internal" href="api.html#BitField" title="BitField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitField</span></code></a>, let’s say we have a <em>Post</em> model
and we wish to store certain True/False flags about how the post. We could
store all these feature toggles in their own <a class="reference internal" href="api.html#BooleanField" title="BooleanField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BooleanField</span></code></a> objects,
or we could use <a class="reference internal" href="api.html#BitField" title="BitField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitField</span></code></a> instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">BitField</span><span class="p">()</span>

    <span class="n">is_favorite</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">flag</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">is_sticky</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">flag</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">is_minimized</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">flag</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">is_deleted</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">flag</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>Using these flags is quite simple:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">is_sticky</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">is_minimized</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>  <span class="c1"># Prints 4 | 2 --&gt; &quot;6&quot;</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">is_favorite</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">is_sticky</span>
<span class="go">True</span>
</pre></div>
</div>
<p>We can also use the flags on the Post class to build expressions in queries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generates a WHERE clause that looks like:</span>
<span class="c1"># WHERE (post.flags &amp; 1 != 0)</span>
<span class="n">favorites</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">is_favorite</span><span class="p">)</span>

<span class="c1"># Query for sticky + favorite posts:</span>
<span class="n">sticky_faves</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">is_sticky</span> <span class="o">&amp;</span> <span class="n">Post</span><span class="o">.</span><span class="n">is_favorite</span><span class="p">)</span>
</pre></div>
</div>
<p>Since the <a class="reference internal" href="api.html#BitField" title="BitField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitField</span></code></a> is stored in an integer, there is a maximum of
64 flags you can represent (64-bits is common size of integer column). For
storing arbitrarily large bitmaps, you can instead use <a class="reference internal" href="api.html#BigBitField" title="BigBitField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigBitField</span></code></a>,
which uses an automatically managed buffer of bytes, stored in a
<a class="reference internal" href="api.html#BlobField" title="BlobField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BlobField</span></code></a>.</p>
<p>Example usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bitmap</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">BigBitField</span><span class="p">()</span>

<span class="n">bitmap</span> <span class="o">=</span> <span class="n">Bitmap</span><span class="p">()</span>

<span class="c1"># Sets the ith bit, e.g. the 1st bit, the 11th bit, the 63rd, etc.</span>
<span class="n">bits_to_set</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bit_idx</span> <span class="ow">in</span> <span class="n">bits_to_set</span><span class="p">:</span>
    <span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_bit</span><span class="p">(</span><span class="n">bit_idx</span><span class="p">)</span>

<span class="c1"># We can test whether a bit is set using &quot;is_set&quot;:</span>
<span class="k">assert</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_set</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_set</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># We can clear a bit:</span>
<span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clear_bit</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_set</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="c1"># We can also &quot;toggle&quot; a bit. Recall that the 63rd bit was set earlier.</span>
<span class="k">assert</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">toggle_bit</span><span class="p">(</span><span class="mi">63</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">toggle_bit</span><span class="p">(</span><span class="mi">63</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span>
<span class="k">assert</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_set</span><span class="p">(</span><span class="mi">63</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="barefield">
<h3>BareField<a class="headerlink" href="#barefield" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="api.html#BareField" title="BareField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BareField</span></code></a> class is intended to be used only with SQLite. Since
SQLite uses dynamic typing and data-types are not enforced, it can be perfectly
fine to declare fields without <em>any</em> data-type. In those cases you can use
<a class="reference internal" href="api.html#BareField" title="BareField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BareField</span></code></a>. It is also common for SQLite virtual tables to use
meta-columns or untyped columns, so for those cases as well you may wish to use
an untyped field (although for full-text search, you should use
<a class="reference internal" href="sqlite_ext.html#SearchField" title="SearchField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SearchField</span></code></a> instead!).</p>
<p><a class="reference internal" href="api.html#BareField" title="BareField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BareField</span></code></a> accepts a special parameter <code class="docutils literal notranslate"><span class="pre">adapt</span></code>. This parameter is
a function that takes a value coming from the database and converts it into the
appropriate Python type. For instance, if you have a virtual table with an
un-typed column but you know that it will return <code class="docutils literal notranslate"><span class="pre">int</span></code> objects, you can
specify <code class="docutils literal notranslate"><span class="pre">adapt=int</span></code>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Junk</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">anything</span> <span class="o">=</span> <span class="n">BareField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>

<span class="c1"># Store multiple data-types in the Junk.anything column:</span>
<span class="n">Junk</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">anything</span><span class="o">=</span><span class="s1">&#39;a string&#39;</span><span class="p">)</span>
<span class="n">Junk</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">anything</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">Junk</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">anything</span><span class="o">=</span><span class="mf">3.14159</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-custom-field">
<span id="custom-fields"></span><h3>Creating a custom field<a class="headerlink" href="#creating-a-custom-field" title="Permalink to this headline">¶</a></h3>
<p>It is easy to add support for custom field types in peewee. In this example we
will create a UUID field for postgresql (which has a native UUID column type).</p>
<p>To add a custom field type you need to first identify what type of column the
field data will be stored in. If you just want to add python behavior atop,
say, a decimal field (for instance to make a currency field) you would just
subclass <a class="reference internal" href="api.html#DecimalField" title="DecimalField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DecimalField</span></code></a>. On the other hand, if the database offers a
custom column type you will need to let peewee know. This is controlled by the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Field.field_type</span></code> attribute.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Peewee ships with a <a class="reference internal" href="api.html#UUIDField" title="UUIDField"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUIDField</span></code></a>, the following code is intended
only as an example.</p>
</div>
<p>Let’s start by defining our UUID field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UUIDField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="n">field_type</span> <span class="o">=</span> <span class="s1">&#39;uuid&#39;</span>
</pre></div>
</div>
<p>We will store the UUIDs in a native UUID column. Since psycopg2 treats the data
as a string by default, we will add two methods to the field to handle:</p>
<ul class="simple">
<li>The data coming out of the database to be used in our application</li>
<li>The data from our python app going into the database</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uuid</span>

<span class="k">class</span> <span class="nc">UUIDField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="n">field_type</span> <span class="o">=</span> <span class="s1">&#39;uuid&#39;</span>

    <span class="k">def</span> <span class="nf">db_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">hex</span>  <span class="c1"># convert UUID to hex string.</span>

    <span class="k">def</span> <span class="nf">python_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1"># convert hex string to UUID</span>
</pre></div>
</div>
<p><strong>This step is optional.</strong> By default, the <code class="docutils literal notranslate"><span class="pre">field_type</span></code> value will be used
for the columns data-type in the database schema. If you need to support
multiple databases which use different data-types for your field-data, we need
to let the database know how to map this <em>uuid</em> label to an actual <em>uuid</em>
column type in the database. Specify the overrides in the <a class="reference internal" href="api.html#Database" title="Database"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code></a> constructor:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Postgres, we use UUID data-type.</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="s1">&#39;my_db&#39;</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;uuid&#39;</span><span class="p">})</span>

<span class="c1"># Sqlite doesn&#39;t have a UUID type, so we use text type.</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;my_db&#39;</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
<p>That is it! Some fields may support exotic operations, like the postgresql
HStore field acts like a key/value store and has custom operators for things
like <em>contains</em> and <em>update</em>. You can specify <a class="reference internal" href="query_operators.html#custom-operators"><span class="std std-ref">custom operations</span></a> as well. For example code, check out the source code for
the <a class="reference internal" href="playhouse.html#HStoreField" title="HStoreField"><code class="xref py py-class docutils literal notranslate"><span class="pre">HStoreField</span></code></a>, in <code class="docutils literal notranslate"><span class="pre">playhouse.postgres_ext</span></code>.</p>
</div>
<div class="section" id="field-naming-conflicts">
<h3>Field-naming conflicts<a class="headerlink" href="#field-naming-conflicts" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="api.html#Model" title="Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> classes implement a number of class- and instance-methods,
for example <a class="reference internal" href="api.html#Model.save" title="Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.save()</span></code></a> or <a class="reference internal" href="api.html#Model.create" title="Model.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.create()</span></code></a>. If you declare a
field whose name coincides with a model method, it could cause problems.
Consider:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LogEntry</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">create</span> <span class="o">=</span> <span class="n">TimestampField</span><span class="p">()</span>  <span class="c1"># Uh-oh.</span>
    <span class="n">update</span> <span class="o">=</span> <span class="n">TimestampField</span><span class="p">()</span>  <span class="c1"># Uh-oh.</span>
</pre></div>
</div>
<p>To avoid this problem while still using the desired column name in the database
schema, explicitly specify the <code class="docutils literal notranslate"><span class="pre">column_name</span></code> while providing an alternative
name for the field attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LogEntry</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_</span> <span class="o">=</span> <span class="n">TimestampField</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s1">&#39;create&#39;</span><span class="p">)</span>
    <span class="n">update_</span> <span class="o">=</span> <span class="n">TimestampField</span><span class="p">(</span><span class="n">column_name</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-model-tables">
<h2>Creating model tables<a class="headerlink" href="#creating-model-tables" title="Permalink to this headline">¶</a></h2>
<p>In order to start using our models, its necessary to open a connection to the
database and create the tables first. Peewee will run the necessary <em>CREATE
TABLE</em> queries, additionally creating any constraints and indexes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect to our database.</span>
<span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># Create the tables.</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Strictly speaking, it is not necessary to call <a class="reference internal" href="api.html#Database.connect" title="Database.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connect()</span></code></a>
but it is good practice to be explicit. That way if something goes wrong,
the error occurs at the connect step, rather than some arbitrary time
later.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, Peewee includes an <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS</span></code> clause when creating
tables. If you want to disable this, specify <code class="docutils literal notranslate"><span class="pre">safe=False</span></code>.</p>
</div>
<p>After you have created your tables, if you choose to modify your database
schema (by adding, removing or otherwise changing the columns) you will need to
either:</p>
<ul class="simple">
<li>Drop the table and re-create it.</li>
<li>Run one or more <em>ALTER TABLE</em> queries. Peewee comes with a schema migration
tool which can greatly simplify this. Check the <a class="reference internal" href="playhouse.html#migrate"><span class="std std-ref">schema migrations</span></a>
docs for details.</li>
</ul>
</div>
<div class="section" id="model-options-and-table-metadata">
<span id="model-options"></span><h2>Model options and table metadata<a class="headerlink" href="#model-options-and-table-metadata" title="Permalink to this headline">¶</a></h2>
<p>In order not to pollute the model namespace, model-specific configuration is
placed in a special class called <em>Meta</em> (a convention borrowed from the django
framework):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">contacts_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;contacts.db&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">contacts_db</span>
</pre></div>
</div>
<p>This instructs peewee that whenever a query is executed on <em>Person</em> to use the
contacts database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Take a look at <a class="reference internal" href="#blog-models"><span class="std std-ref">the sample models</span></a> - you will notice
that we created a <code class="docutils literal notranslate"><span class="pre">BaseModel</span></code> that defined the database, and then
extended. This is the preferred way to define a database and create models.</p>
</div>
<p>Once the class is defined, you should not access <code class="docutils literal notranslate"><span class="pre">ModelClass.Meta</span></code>, but
instead use <code class="docutils literal notranslate"><span class="pre">ModelClass._meta</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">Meta</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">AttributeError</span>: <span class="n">type object &#39;Person&#39; has no attribute &#39;Meta&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">_meta</span>
<span class="go">&lt;peewee.ModelOptions object at 0x7f51a2f03790&gt;</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">ModelOptions</span></code> class implements several methods which may be of
use for retrieving model metadata (such as lists of fields, foreign key
relationships, and more).</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span>
<span class="go">{&#39;id&#39;: &lt;peewee.PrimaryKeyField object at 0x7f51a2e92750&gt;,</span>
<span class="go"> &#39;name&#39;: &lt;peewee.CharField object at 0x7f51a2f0a510&gt;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">primary_key</span>
<span class="go">&lt;peewee.PrimaryKeyField object at 0x7f51a2e92750&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">database</span>
<span class="go">&lt;peewee.SqliteDatabase object at 0x7f519bff6dd0&gt;</span>
</pre></div>
</div>
<p>There are several options you can specify as <code class="docutils literal notranslate"><span class="pre">Meta</span></code> attributes. While most
options are inheritable, some are table-specific and will not be inherited by
subclasses.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="56%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Meaning</th>
<th class="head">Inheritable?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">database</span></code></td>
<td>database for model</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">table_name</span></code></td>
<td>name of the table to store data</td>
<td>no</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">table_function</span></code></td>
<td>function to generate table name dynamically</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">indexes</span></code></td>
<td>a list of fields to index</td>
<td>yes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">primary_key</span></code></td>
<td>a <a class="reference internal" href="api.html#CompositeKey" title="CompositeKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeKey</span></code></a> instance</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">constraints</span></code></td>
<td>a list of table constraints</td>
<td>yes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">schema</span></code></td>
<td>the database schema for the model</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">only_save_dirty</span></code></td>
<td>when calling model.save(), only save dirty fields</td>
<td>yes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">options</span></code></td>
<td>dictionary of options for create table extensions</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">table_settings</span></code></td>
<td>list of setting strings to go after close parentheses</td>
<td>yes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">temporary</span></code></td>
<td>indicate temporary table</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">legacy_table_names</span></code></td>
<td>use legacy table name generation (enabled by default)</td>
<td>yes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">depends_on</span></code></td>
<td>indicate this table depends on another for creation</td>
<td>no</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">without_rowid</span></code></td>
<td>indicate table should not have rowid (SQLite only)</td>
<td>no</td>
</tr>
</tbody>
</table>
<p>Here is an example showing inheritable versus non-inheritable attributes:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ModelOne</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>
<span class="gp">... </span>        <span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;model_one_tbl&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ModelTwo</span><span class="p">(</span><span class="n">ModelOne</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ModelOne</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="n">ModelTwo</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">database</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ModelOne</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">table_name</span> <span class="o">==</span> <span class="n">ModelTwo</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">table_name</span>
<span class="go">False</span>
</pre></div>
</div>
<div class="section" id="meta-primary-key">
<h3>Meta.primary_key<a class="headerlink" href="#meta-primary-key" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Meta.primary_key</span></code> attribute is used to specify either a
<a class="reference internal" href="api.html#CompositeKey" title="CompositeKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeKey</span></code></a> or to indicate that the model has <em>no</em> primary key.
Composite primary keys are discussed in more detail here: <a class="reference internal" href="#composite-key"><span class="std std-ref">Composite primary keys</span></a>.</p>
<p>To indicate that a model should not have a primary key, then set <code class="docutils literal notranslate"><span class="pre">primary_key</span> <span class="pre">=</span> <span class="pre">False</span></code>.</p>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogToTag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A simple &quot;through&quot; table for many-to-many relationship.&quot;&quot;&quot;</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">NoPrimaryKey</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
</div>
<div class="section" id="table-names">
<span id="id3"></span><h3>Table Names<a class="headerlink" href="#table-names" title="Permalink to this headline">¶</a></h3>
<p>By default Peewee will automatically generate a table name based on the name of
your model class. The way the table-name is generated depends on the value of
<code class="docutils literal notranslate"><span class="pre">Meta.legacy_table_names</span></code>. By default, <code class="docutils literal notranslate"><span class="pre">legacy_table_names=True</span></code> so as to
avoid breaking backwards-compatibility. However, if you wish to use the new and
improved table-name generation, you can specify <code class="docutils literal notranslate"><span class="pre">legacy_table_names=False</span></code>.</p>
<p>This table shows the differences in how a model name is converted to a SQL
table name, depending on the value of <code class="docutils literal notranslate"><span class="pre">legacy_table_names</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="34%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Model name</th>
<th class="head">legacy_table_names=True</th>
<th class="head">legacy_table_names=False (new)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>User</td>
<td>user</td>
<td>user</td>
</tr>
<tr class="row-odd"><td>UserProfile</td>
<td>userprofile</td>
<td>user_profile</td>
</tr>
<tr class="row-even"><td>APIResponse</td>
<td>apiresponse</td>
<td>api_response</td>
</tr>
<tr class="row-odd"><td>WebHTTPRequest</td>
<td>webhttprequest</td>
<td>web_http_request</td>
</tr>
<tr class="row-even"><td>mixedCamelCase</td>
<td>mixedcamelcase</td>
<td>mixed_camel_case</td>
</tr>
<tr class="row-odd"><td>Name2Numbers3XYZ</td>
<td>name2numbers3xyz</td>
<td>name2_numbers3_xyz</td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p>To preserve backwards-compatibility, the current release (Peewee 3.x)
specifies <code class="docutils literal notranslate"><span class="pre">legacy_table_names=True</span></code> by default.</p>
<p class="last">In the next major release (Peewee 4.0), <code class="docutils literal notranslate"><span class="pre">legacy_table_names</span></code> will have a
default value of <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<p>To explicitly specify the table name for a model class, use the <code class="docutils literal notranslate"><span class="pre">table_name</span></code>
Meta option. This feature can be useful for dealing with pre-existing database
schemas that may have used awkward naming conventions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserProfile</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;user_profile_tbl&#39;</span>
</pre></div>
</div>
<p>If you wish to implement your own naming convention, you can specify the
<code class="docutils literal notranslate"><span class="pre">table_function</span></code> Meta option. This function will be called with your model
class and should return the desired table name as a string. Suppose our company
specifies that table names should be lower-cased and end with “_tbl”, we can
implement this as a table function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_table_name</span><span class="p">(</span><span class="n">model_class</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">model_class</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="n">model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_tbl&#39;</span>

<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">table_function</span> <span class="o">=</span> <span class="n">make_table_name</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="c1"># table_name will be &quot;user_tbl&quot;.</span>

<span class="k">class</span> <span class="nc">UserProfile</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="c1"># table_name will be &quot;userprofile_tbl&quot;.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indexes-and-constraints">
<span id="model-indexes"></span><h2>Indexes and Constraints<a class="headerlink" href="#indexes-and-constraints" title="Permalink to this headline">¶</a></h2>
<p>Peewee can create indexes on single or multiple columns, optionally including a
<em>UNIQUE</em> constraint. Peewee also supports user-defined constraints on both
models and fields.</p>
<div class="section" id="single-column-indexes-and-constraints">
<h3>Single-column indexes and constraints<a class="headerlink" href="#single-column-indexes-and-constraints" title="Permalink to this headline">¶</a></h3>
<p>Single column indexes are defined using field initialization parameters. The
following example adds a unique index on the <em>username</em> field, and a normal
index on the <em>email</em> field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To add a user-defined constraint on a column, you can pass it in using the
<code class="docutils literal notranslate"><span class="pre">constraints</span></code> parameter. You may wish to specify a default value as part of
the schema, or add a <code class="docutils literal notranslate"><span class="pre">CHECK</span></code> constraint, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span><span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">Check</span><span class="p">(</span><span class="s1">&#39;price &lt; 10000&#39;</span><span class="p">)])</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">SQL</span><span class="p">(</span><span class="s2">&quot;DEFAULT (datetime(&#39;now&#39;))&quot;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-column-indexes">
<h3>Multi-column indexes<a class="headerlink" href="#multi-column-indexes" title="Permalink to this headline">¶</a></h3>
<p>Multi-column indexes may be defined as <em>Meta</em> attributes using a nested tuple.
Each database index is a 2-tuple, the first part of which is a tuple of the
names of the fields, the second part a boolean indicating whether the index
should be unique.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Transaction</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">from_acct</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">to_acct</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c1"># create a unique on from/to/date</span>
            <span class="p">((</span><span class="s1">&#39;from_acct&#39;</span><span class="p">,</span> <span class="s1">&#39;to_acct&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">),</span> <span class="bp">True</span><span class="p">),</span>

            <span class="c1"># create a non-unique on from/to</span>
            <span class="p">((</span><span class="s1">&#39;from_acct&#39;</span><span class="p">,</span> <span class="s1">&#39;to_acct&#39;</span><span class="p">),</span> <span class="bp">False</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Remember to add a <strong>trailing comma</strong> if your tuple of indexes contains only one item:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">((</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">),</span> <span class="bp">True</span><span class="p">),</span>  <span class="c1"># Note the trailing comma!</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-index-creation">
<h3>Advanced Index Creation<a class="headerlink" href="#advanced-index-creation" title="Permalink to this headline">¶</a></h3>
<p>Peewee supports a more structured API for declaring indexes on a model using
the <a class="reference internal" href="api.html#Model.add_index" title="Model.add_index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.add_index()</span></code></a> method or by directly using the
<a class="reference internal" href="api.html#ModelIndex" title="ModelIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelIndex</span></code></a> helper class.</p>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">TimestampField</span><span class="p">()</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">()</span>

<span class="c1"># Add an index on &quot;name&quot; and &quot;timestamp&quot; columns.</span>
<span class="n">Article</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Article</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>

<span class="c1"># Add a partial index on name and timestamp where status = 1.</span>
<span class="n">Article</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Article</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
                  <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Create a unique index on timestamp desc, status &amp; 4.</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
    <span class="n">Article</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">desc</span><span class="p">(),</span>
    <span class="n">Article</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">bin_and</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Article</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>SQLite does not support parameterized <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span></code> queries. This means
that when using SQLite to create an index that involves an expression or
scalar value, you will need to declare the index using the <a class="reference internal" href="api.html#SQL" title="SQL"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQL</span></code></a>
helper:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># SQLite does not support parameterized CREATE INDEX queries, so</span>
<span class="c1"># we declare it manually.</span>
<span class="n">Article</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;CREATE INDEX ...&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p class="last">See <a class="reference internal" href="api.html#Model.add_index" title="Model.add_index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_index()</span></code></a> for details.</p>
</div>
<p>For more information, see:</p>
<ul class="simple">
<li><a class="reference internal" href="api.html#Model.add_index" title="Model.add_index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.add_index()</span></code></a></li>
<li><a class="reference internal" href="api.html#Model.index" title="Model.index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.index()</span></code></a></li>
<li><a class="reference internal" href="api.html#ModelIndex" title="ModelIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelIndex</span></code></a></li>
<li><a class="reference internal" href="api.html#Index" title="Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a></li>
</ul>
</div>
<div class="section" id="table-constraints">
<h3>Table constraints<a class="headerlink" href="#table-constraints" title="Permalink to this headline">¶</a></h3>
<p>Peewee allows you to add arbitrary constraints to your <a class="reference internal" href="api.html#Model" title="Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a>, that
will be part of the table definition when the schema is created.</p>
<p>For instance, suppose you have a <em>people</em> table with a composite primary key of
two columns, the person’s first and last name. You wish to have another table
relate to the <em>people</em> table, and to do this, you will need to define a foreign
key constraint:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Pet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">owner_first</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">owner_last</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">pet_name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;FOREIGN KEY(owner_first, owner_last) &#39;</span>
                           <span class="s1">&#39;REFERENCES person(first, last)&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>You can also implement <code class="docutils literal notranslate"><span class="pre">CHECK</span></code> constraints at the table level:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">Check</span><span class="p">(</span><span class="s1">&#39;price &lt; 10000&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="primary-keys-composite-keys-and-other-tricks">
<span id="non-integer-primary-keys"></span><h2>Primary Keys, Composite Keys and other Tricks<a class="headerlink" href="#primary-keys-composite-keys-and-other-tricks" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="api.html#AutoField" title="AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a> is used to identify an auto-incrementing integer
primary key. If you do not specify a primary key, Peewee will automatically
create an auto-incrementing primary key named “id”.</p>
<p>To specify an auto-incrementing ID using a different field name, you can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">event_id</span> <span class="o">=</span> <span class="n">AutoField</span><span class="p">()</span>  <span class="c1"># Event.event_id will be auto-incrementing PK.</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">BlobField</span><span class="p">()</span>
</pre></div>
</div>
<p>You can identify a different field as the primary key, in which case an “id”
column will not be created. In this example we will use a person’s email
address as the primary key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">dob</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>I frequently see people write the following, expecting an auto-incrementing
integer primary key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Peewee understands the above model declaration as a model with an integer
primary key, but the value of that ID is determined by the application. To
create an auto-incrementing integer primary key, you would instead write:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">AutoField</span><span class="p">()</span>  <span class="c1"># primary_key=True is implied.</span>
</pre></div>
</div>
</div>
<p>Composite primary keys can be declared using <a class="reference internal" href="api.html#CompositeKey" title="CompositeKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeKey</span></code></a>. Note
that doing this may cause issues with <a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyField</span></code></a>, as Peewee
does not support the concept of a “composite foreign-key”. As such, I’ve found
it only advisable to use composite primary keys in a handful of situations,
such as trivial many-to-many junction tables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">mimetype</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ImageTag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>  <span class="c1"># Many-to-many relationship.</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Image</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the extremely rare case you wish to declare a model with <em>no</em> primary key,
you can specify <code class="docutils literal notranslate"><span class="pre">primary_key</span> <span class="pre">=</span> <span class="pre">False</span></code> in the model <code class="docutils literal notranslate"><span class="pre">Meta</span></code> options.</p>
<div class="section" id="id4">
<h3>Non-integer primary keys<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>If you would like use a non-integer primary key (which I generally don’t
recommend), you can specify <code class="docutils literal notranslate"><span class="pre">primary_key=True</span></code> when creating a field. When
you wish to create a new instance for a model using a non-autoincrementing
primary key, you need to be sure you <a class="reference internal" href="api.html#Model.save" title="Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> specifying
<code class="docutils literal notranslate"><span class="pre">force_insert=True</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">UUIDModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">UUIDField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Auto-incrementing IDs are, as their name says, automatically generated for you
when you insert a new row into the database. When you call
<a class="reference internal" href="api.html#Model.save" title="Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a>, peewee determines whether to do an <em>INSERT</em> versus an
<em>UPDATE</em> based on the presence of a primary key value. Since, with our uuid
example, the database driver won’t generate a new ID, we need to specify it
manually. When we call save() for the first time, pass in <code class="docutils literal notranslate"><span class="pre">force_insert</span> <span class="pre">=</span> <span class="pre">True</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This works because .create() will specify `force_insert=True`.</span>
<span class="n">obj1</span> <span class="o">=</span> <span class="n">UUIDModel</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

<span class="c1"># This will not work, however. Peewee will attempt to do an update:</span>
<span class="n">obj2</span> <span class="o">=</span> <span class="n">UUIDModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="n">obj2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c1"># WRONG</span>

<span class="n">obj2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># CORRECT</span>

<span class="c1"># Once the object has been created, you can call save() normally.</span>
<span class="n">obj2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any foreign keys to a model with a non-integer primary key will have a
<code class="docutils literal notranslate"><span class="pre">ForeignKeyField</span></code> use the same underlying storage type as the primary key
they are related to.</p>
</div>
</div>
<div class="section" id="composite-primary-keys">
<span id="composite-key"></span><h3>Composite primary keys<a class="headerlink" href="#composite-primary-keys" title="Permalink to this headline">¶</a></h3>
<p>Peewee has very basic support for composite keys.  In order to use a composite
key, you must set the <code class="docutils literal notranslate"><span class="pre">primary_key</span></code> attribute of the model options to a
<a class="reference internal" href="api.html#CompositeKey" title="CompositeKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeKey</span></code></a> instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogToTag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A simple &quot;through&quot; table for many-to-many relationship.&quot;&quot;&quot;</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Peewee does not support foreign-keys to models that define a
<a class="reference internal" href="api.html#CompositeKey" title="CompositeKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeKey</span></code></a> primary key. If you wish to add a foreign-key to a
model that has a composite primary key, replicate the columns on the
related model and add a custom accessor (e.g. a property).</p>
</div>
</div>
<div class="section" id="manually-specifying-primary-keys">
<h3>Manually specifying primary keys<a class="headerlink" href="#manually-specifying-primary-keys" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you do not want the database to automatically generate a value for
the primary key, for instance when bulk loading relational data. To handle this
on a <em>one-off</em> basis, you can simply tell peewee to turn off <code class="docutils literal notranslate"><span class="pre">auto_increment</span></code>
during the import:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">load_user_csv</span><span class="p">()</span> <span class="c1"># load up a bunch of data</span>

<span class="n">User</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">auto_increment</span> <span class="o">=</span> <span class="bp">False</span> <span class="c1"># turn off auto incrementing IDs</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">username</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">u</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># &lt;-- force peewee to insert row</span>

<span class="n">User</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">auto_increment</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Although a better way to accomplish the above, without resorting to hacks, is
to use the <a class="reference internal" href="api.html#Model.insert_many" title="Model.insert_many"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.insert_many()</span></code></a> API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">load_user_csv</span><span class="p">()</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">]</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
    <span class="n">User</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>If you <em>always</em> want to have control over the primary key, simply do not use
the <code class="xref py py-class docutils literal notranslate"><span class="pre">PrimaryKeyField</span></code> field type, but use a normal
<a class="reference internal" href="api.html#IntegerField" title="IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a> (or other column type):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;somebody&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">id</span>
<span class="mi">999</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s1">&#39;somebody&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
<span class="mi">999</span>
</pre></div>
</div>
</div>
<div class="section" id="models-without-a-primary-key">
<h3>Models without a Primary Key<a class="headerlink" href="#models-without-a-primary-key" title="Permalink to this headline">¶</a></h3>
<p>If you wish to create a model with no primary key, you can specify
<code class="docutils literal notranslate"><span class="pre">primary_key</span> <span class="pre">=</span> <span class="pre">False</span></code> in the inner <code class="docutils literal notranslate"><span class="pre">Meta</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyData</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>This will yield the following DDL:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;mydata&quot;</span> <span class="p">(</span>
  <span class="ss">&quot;timestamp&quot;</span> <span class="n">DATETIME</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="ss">&quot;value&quot;</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Some model APIs may not work correctly for models without a primary key,
for instance <a class="reference internal" href="api.html#Model.save" title="Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> and <a class="reference internal" href="api.html#Model.delete_instance" title="Model.delete_instance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete_instance()</span></code></a>
(you can instead use <a class="reference internal" href="api.html#Model.insert" title="Model.insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">insert()</span></code></a>, <a class="reference internal" href="api.html#Model.update" title="Model.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a> and
<a class="reference internal" href="api.html#Model.delete" title="Model.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code></a>).</p>
</div>
</div>
</div>
<div class="section" id="self-referential-foreign-keys">
<h2>Self-referential foreign keys<a class="headerlink" href="#self-referential-foreign-keys" title="Permalink to this headline">¶</a></h2>
<p>When creating a hierarchical structure it is necessary to create a
self-referential foreign key which links a child object to its parent.  Because
the model class is not defined at the time you instantiate the self-referential
foreign key, use the special string <code class="docutils literal notranslate"><span class="pre">'self'</span></code> to indicate a self-referential
foreign key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, the foreign key points <em>upward</em> to the parent object and the
back-reference is named <em>children</em>.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Self-referential foreign-keys should always be <code class="docutils literal notranslate"><span class="pre">null=True</span></code>.</p>
</div>
<p>When querying against a model that contains a self-referential foreign key you
may sometimes need to perform a self-join. In those cases you can use
<a class="reference internal" href="api.html#Model.alias" title="Model.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.alias()</span></code></a> to create a table reference. Here is how you might query
the category and parent model using a self-join:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Parent</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span>
<span class="n">GrandParent</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Category</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">Parent</span><span class="p">)</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Parent</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">Parent</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">GrandParent</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">(</span><span class="n">Parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">GrandParent</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
         <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GrandParent</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;some category&#39;</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="circular-foreign-key-dependencies">
<span id="circular-fks"></span><h2>Circular foreign key dependencies<a class="headerlink" href="#circular-foreign-key-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it happens that you will create a circular dependency between two
tables.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">My personal opinion is that circular foreign keys are a code smell and
should be refactored (by adding an intermediary table, for instance).</p>
</div>
<p>Adding circular foreign keys with peewee is a bit tricky because at the time
you are defining either foreign key, the model it points to will not have been
defined yet, causing a <code class="docutils literal notranslate"><span class="pre">NameError</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">favorite_tweet</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># NameError!!</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;tweets&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>One option is to simply use an <a class="reference internal" href="api.html#IntegerField" title="IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a> to store the raw ID:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">favorite_tweet_id</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>By using <a class="reference internal" href="api.html#DeferredForeignKey" title="DeferredForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeferredForeignKey</span></code></a> we can get around the problem and still
use a foreign key field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="c1"># Tweet has not been defined yet so use the deferred reference.</span>
    <span class="n">favorite_tweet</span> <span class="o">=</span> <span class="n">DeferredForeignKey</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;tweets&#39;</span><span class="p">)</span>

<span class="c1"># Now that Tweet is defined, &quot;favorite_tweet&quot; has been converted into</span>
<span class="c1"># a ForeignKeyField.</span>
<span class="k">print</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">favorite_tweet</span><span class="p">)</span>
<span class="c1"># &lt;ForeignKeyField: &quot;user&quot;.&quot;favorite_tweet&quot;&gt;</span>
</pre></div>
</div>
<p>There is one more quirk to watch out for, though. When you call
<a class="reference internal" href="api.html#Model.create_table" title="Model.create_table"><code class="xref py py-class docutils literal notranslate"><span class="pre">create_table</span></code></a> we will again encounter the same issue. For
this reason peewee will not automatically create a foreign key constraint for
any <em>deferred</em> foreign keys.</p>
<p>To create the tables <em>and</em> the foreign-key constraint, you can use the
<a class="reference internal" href="api.html#SchemaManager.create_foreign_key" title="SchemaManager.create_foreign_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SchemaManager.create_foreign_key()</span></code></a> method to create the constraint
after creating the tables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Will create the User and Tweet tables, but does *not* create a</span>
<span class="c1"># foreign-key constraint on User.favorite_tweet.</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">])</span>

<span class="c1"># Create the foreign-key constraint:</span>
<span class="n">User</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">create_foreign_key</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">favorite_tweet</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because SQLite has limited support for altering tables, foreign-key
constraints cannot be added to a table after it has been created.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Models and Fields</a><ul>
<li><a class="reference internal" href="#fields">Fields</a><ul>
<li><a class="reference internal" href="#field-types-table">Field types table</a></li>
<li><a class="reference internal" href="#field-initialization-arguments">Field initialization arguments</a></li>
<li><a class="reference internal" href="#some-fields-take-special-parameters">Some fields take special parameters…</a></li>
<li><a class="reference internal" href="#default-field-values">Default field values</a></li>
<li><a class="reference internal" href="#foreignkeyfield">ForeignKeyField</a></li>
<li><a class="reference internal" href="#foreignkeyfield-back-references">ForeignKeyField Back-references</a></li>
<li><a class="reference internal" href="#datetimefield-datefield-and-timefield">DateTimeField, DateField and TimeField</a></li>
<li><a class="reference internal" href="#bitfield-and-bigbitfield">BitField and BigBitField</a></li>
<li><a class="reference internal" href="#barefield">BareField</a></li>
<li><a class="reference internal" href="#creating-a-custom-field">Creating a custom field</a></li>
<li><a class="reference internal" href="#field-naming-conflicts">Field-naming conflicts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-model-tables">Creating model tables</a></li>
<li><a class="reference internal" href="#model-options-and-table-metadata">Model options and table metadata</a><ul>
<li><a class="reference internal" href="#meta-primary-key">Meta.primary_key</a></li>
<li><a class="reference internal" href="#table-names">Table Names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indexes-and-constraints">Indexes and Constraints</a><ul>
<li><a class="reference internal" href="#single-column-indexes-and-constraints">Single-column indexes and constraints</a></li>
<li><a class="reference internal" href="#multi-column-indexes">Multi-column indexes</a></li>
<li><a class="reference internal" href="#advanced-index-creation">Advanced Index Creation</a></li>
<li><a class="reference internal" href="#table-constraints">Table constraints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#primary-keys-composite-keys-and-other-tricks">Primary Keys, Composite Keys and other Tricks</a><ul>
<li><a class="reference internal" href="#id4">Non-integer primary keys</a></li>
<li><a class="reference internal" href="#composite-primary-keys">Composite primary keys</a></li>
<li><a class="reference internal" href="#manually-specifying-primary-keys">Manually specifying primary keys</a></li>
<li><a class="reference internal" href="#models-without-a-primary-key">Models without a Primary Key</a></li>
</ul>
</li>
<li><a class="reference internal" href="#self-referential-foreign-keys">Self-referential foreign keys</a></li>
<li><a class="reference internal" href="#circular-foreign-key-dependencies">Circular foreign key dependencies</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="database.html"
                        title="previous chapter">Database</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="querying.html"
                        title="next chapter">Querying</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/peewee/models.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="querying.html" title="Querying"
             >next</a> |</li>
        <li class="right" >
          <a href="database.html" title="Database"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">peewee 3.9.3 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright charles leifer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>