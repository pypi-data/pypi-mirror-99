
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ELK Stack &#8212; intelmq 3.0.0.alpha.1 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MISP integrations in IntelMQ" href="MISP-Integrations.html" />
    <link rel="prev" title="IntelMQ Ecosystem" href="ecosystem.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="elk-stack">
<h1>ELK Stack<a class="headerlink" href="#elk-stack" title="Permalink to this headline">¶</a></h1>
<p>If you wish to run IntelMQ with ELK (Elasticsearch, Logstash, Kibana) it is entirely possible. This guide assumes the reader is familiar with basic configuration of ELK and does not aim to cover using ELK in general. It is based on the version 6.8.0 (ELK is a fast moving train therefore things might change). Assuming you have IntelMQ (and Redis) installation in place, lets dive in.</p>
<div class="section" id="configuring-intelmq-for-logstash">
<h2>Configuring IntelMQ for Logstash<a class="headerlink" href="#configuring-intelmq-for-logstash" title="Permalink to this headline">¶</a></h2>
<p>In order to pass IntelMQ events to Logstash we will utilize already installed Redis. Add a new Redis Output Bot to your pipeline. As the minimum fill in the following parameters: <cite>bot-id</cite>, <cite>redis_server_ip</cite> (can be hostname), <cite>redis_server_port</cite>, <cite>redis_password</cite> (if required, else set to empty!), <cite>redis_queue</cite> (name for the queue). Redis IP, port and password can be taken from <cite>defaults.conf</cite>. It is recommended to use a different <cite>redis_db</cite> parameter than used by the IntelMQ (specified in <cite>defaults.conf</cite> as <cite>source_pipeline_db</cite>, <cite>destination_pipeline_db</cite> and <cite>statistics_database</cite>).</p>
<p>Example values:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>bot-id: logstash-output
redis_server_ip: 10.10.10.10
redis_server_port: 6379
redis_db: 4
redis_queue: logstash-queue
</pre></div>
</div>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>Unfortunately you will not be able to monitor this redis queue via IntelMQ Manager.</p></li>
</ul>
</div>
<div class="section" id="configuring-logstash">
<h2>Configuring Logstash<a class="headerlink" href="#configuring-logstash" title="Permalink to this headline">¶</a></h2>
<p>Logstash defines pipeline as well. In the pipeline configuration of Logstash you need to specify where it should look for IntelMQ events, what to do with them and where to pass them.</p>
<div class="section" id="input">
<h3>Input<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h3>
<p>This part describes how to receive data from Redis queue.
See the example configuration and comments below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">redis</span> <span class="p">{</span>
    <span class="n">host</span> <span class="o">=&gt;</span> <span class="s2">&quot;10.10.10.10&quot;</span>
    <span class="n">port</span> <span class="o">=&gt;</span> <span class="mi">6379</span>
    <span class="n">db</span> <span class="o">=&gt;</span> <span class="mi">4</span>
    <span class="n">data_type</span> <span class="o">=&gt;</span> <span class="s2">&quot;list&quot;</span>
    <span class="n">key</span> <span class="o">=&gt;</span> <span class="s2">&quot;logstash-queue&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><cite>host</cite> - same as redis_server_ip from the Redis Output Bot</p></li>
<li><p><cite>port</cite> - the redis_server_port from the Redis Output Bot</p></li>
<li><p><cite>db</cite> - the redis_db parameter from the Redis Output Bot</p></li>
<li><p><cite>data_type</cite> - set to <cite>list</cite></p></li>
<li><p><cite>key</cite> - same as redis_queue from the Redis Output Bot</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>You can also use syntax like this: <cite>host =&gt; “${REDIS_HOST:10.10.10.10}”</cite>The value will be taken from environment variable <cite>$REDIS_HOST</cite>. If the environment variable is not defined then the default value of <cite>10.10.10.10</cite> will be used instead.</p></li>
</ul>
</div>
<div class="section" id="filter-optional">
<h3>Filter (optional)<a class="headerlink" href="#filter-optional" title="Permalink to this headline">¶</a></h3>
<p>Before passing the data to the database you can apply certain changes. This is done with filters. See an example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>filter {
  mutate {
    lowercase =&gt; [&quot;source.geolocation.city&quot;, &quot;classification.identifier&quot;]
    remove_field =&gt; [&quot;__type&quot;, &quot;@version&quot;]
  }
  date {
    match =&gt; [&quot;time.observation&quot;, &quot;ISO8601&quot;]
  }
}
</pre></div>
</div>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>It is not recommended to apply any modifications to the data (within the <cite>mutate</cite> key) outside of the IntelMQ. All necessary modifications should be done only by appropriate IntelMQ bots. This example only demonstrates the possibility.</p></li>
<li><p>It is recommended to use the <cite>date</cite> filter: generally we have two timestamp fields - <cite>time.source</cite> (provided by the feed source this can be understood as when the event happened; however it is not always present) and <cite>time.observation</cite> (when IntelMQ collected this event). Logstash also adds another field <cite>&#64;timestamp</cite> with time of processing by Logstash. While it can be useful for debugging, I recommend to set the <cite>&#64;timestamp</cite> to the same value as <cite>time.observation</cite>.</p></li>
</ul>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>The pipeline also needs output, where we define our database (Elasticsearch). The simplest way of doing so is defining an output like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>output {
  elasticsearch {
    hosts =&gt; [&quot;http://10.10.10.11:9200&quot;, &quot;http://10.10.10.12:9200&quot;]
    index =&gt; &quot;intelmq-%{+YYYY.MM}&quot;
  }
}
</pre></div>
</div>
<ul class="simple">
<li><p><cite>hosts</cite> - Elasticsearch host (or more) with the correct port (9200 by default)</p></li>
<li><p><cite>index</cite> - name of the index where to insert data</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>Authors experience, hardware equipment and the amount of events collected led to having a separate index for each month. This might not necessarily suit your needs, but is a suggested option.</p></li>
<li><p>By default the ELK stack uses unsecure HTTP. It is possible to setup Security for secure connections and basic user management. This is possible with the Basic (free) licence since versions 6.8.0 and 7.1.0.</p></li>
</ul>
</div>
</div>
<div class="section" id="configuring-elasticsearch">
<h2>Configuring Elasticsearch<a class="headerlink" href="#configuring-elasticsearch" title="Permalink to this headline">¶</a></h2>
<p>Configuring Elasticsearch is entirely up to you and should be consulted with the <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/index.html">official documentation</a>. What you will most likely need is something called <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html">index template</a> mappings. IntelMQ provides a tool for generating such mappings. See <a class="reference external" href="https://github.com/certtools/intelmq/tree/develop/contrib/elasticsearch/README.md">ElasticMapper Tool</a>.</p>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>Default installation of Elasticsearch database allows anyone with cURL and connection capability administrative access to the database. Make sure you secure your toys!</p></li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/Logo_Intel_MQ.svg" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">IntelMQ is a solution for IT security teams for collecting and processing security feeds using a message queuing protocol.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=certtools&repo=intelmq&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration-management.html">Configuration and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="bots.html">Bots</a></li>
<li class="toctree-l1"><a class="reference internal" href="intelmqctl.html">intelmqctl documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="feeds.html">Feeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="intelmq-api.html">IntelMQ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="intelmq-manager.html">IntelMQ Manager</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ecosystem.html">IntelMQ Ecosystem</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ELK Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="MISP-Integrations.html">MISP integrations in IntelMQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="n6-integrations.html">IntelMQ - n6 Integration</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/guide.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/harmonization-fields.html">Harmonization field names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/release-procedure.html">Release procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/feeds-wishlist.html">Feeds wishlist</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ecosystem.html" title="previous chapter">IntelMQ Ecosystem</a></li>
      <li>Next: <a href="MISP-Integrations.html" title="next chapter">MISP integrations in IntelMQ</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, cert.at.
      
      |
      <a href="../_sources/user/ELK-Stack.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>