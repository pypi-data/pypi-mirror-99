(self.webpackChunkjupyterlab_multicontents_templates=self.webpackChunkjupyterlab_multicontents_templates||[]).push([[195],{195:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var a=n(989),s=n(271),l=n.n(s),o=n(441),i=n(275),c=n(290);async function r(e="",t={}){const n=c.ServerConnection.makeSettings(),a=i.URLExt.join(n.baseUrl,"jupyterlab_multicontents_templates",e);let s;try{s=await c.ServerConnection.makeRequest(a,t,n)}catch(e){throw new c.ServerConnection.NetworkError(e)}let l=await s.text();if(l.length>0)try{l=JSON.parse(l)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new c.ServerConnection.ResponseError(s,l.message||l);return l}class m extends l().Component{constructor(e){super(e),this.state={items:null,expandChild:!1,loading:!1}}render(){let e=(this.state.items||[]).map((e=>"directory"===e.type?l().createElement(m,{name:e.name,path:e.path,isRoot:!1,onSelect:this.props.onSelect}):"notebook"===e.type?l().createElement("li",{className:"template-item template-notebook"},l().createElement("a",{onClick:()=>this.props.onSelect(e)},l().createElement("div",null,l().createElement("span",{className:"jp-multicontents-templates-item-icon"}),l().createElement("span",null,e.name)))):void 0));return this.state.loading&&(e=[l().createElement("li",null,l().createElement("div",{className:"loader"}))]),this.props.isRoot?l().createElement("ul",{className:"template-folder multicontents-templates-ul"}," ",e," "):l().createElement("li",{className:"template-item"},l().createElement("a",{onClick:()=>this.toggle()},l().createElement("div",null,l().createElement("span",{className:null===this.state.items?"jp-multicontents-templates-folded-folder-icon":"jp-multicontents-templates-expanded-folder-icon"}),l().createElement("span",null,this.props.name))),l().createElement("ul",{className:"multicontents-templates-ul"},e," "))}componentDidMount(){this.props.isRoot&&this.expand()}toggle(){const e=!this.state.expandChild;this.props.onSelect({name:this.props.path,path:this.props.path,type:"directory"}),this.setState({expandChild:e}),e?this.expand():this.setState({items:null})}expand(){null===this.state.items&&(this.setState({loading:!0}),r("list",{method:"PUT",body:JSON.stringify({path:this.props.path})}).then((e=>{this.setState({items:e.content,loading:!1})})).catch((e=>{console.error(`Error: ${e}`),this.setState({loading:!1})})))}}class p extends o.ReactWidget{constructor(e){super(),this.addClass("jp-ReactWidget"),this.title.iconClass="jp-multicontents-templates-icon",this.title.caption="Templates",this.title.closable=!0,this.onSelect=e}render(){return l().createElement("div",{className:"multicontents-templates"},l().createElement("h1",null," Templates "),l().createElement("div",{className:"multicontents-templates-list"},l().createElement(m,{isRoot:!0,onSelect:this.onSelect})))}}class h extends o.ReactWidget{constructor(e,t,n){super(),this.name=t,this.path=e,this.importFunc=n}render(){const e=c.ServerConnection.makeSettings(),t=encodeURIComponent(this.path),n=i.URLExt.join(e.baseUrl,"jupyterlab_multicontents_templates",`preview?path=${t}`);return l().createElement("div",{style:{width:"100%",height:"100%"}},l().createElement("div",null,l().createElement("input",{type:"button",value:"Import",onClick:()=>this.importFunc(this.path)})),l().createElement("iframe",{style:{width:"100%",height:"100%"},src:n}))}}class u extends o.MainAreaWidget{constructor(e,t,n){super({content:new h(e,t,n)}),this.id="MulticontentsTemplates-preview",this.title.label=`Preview: ${t}`,this.title.closable=!0}}class d extends l().Component{constructor(e){super(e),this.state={targetPath:null}}render(){return l().createElement("div",null,l().createElement("label",null,"Save to:"),l().createElement("input",{value:this.state.targetPath,onChange:this.handleChange.bind(this),className:"multicontents-save-input"}),l().createElement(m,{isRoot:!0,onSelect:this.onSelect.bind(this)}))}change(e){this.setState({targetPath:e}),this.props.valueFunc(e)}onSelect(e){let t;t="directory"===e.type?e.path+"/"+this.props.srcNotebook.name:e.path,this.change(t)}handleChange(e){this.change(e.target.value)}}class g extends o.ReactWidget{constructor(e){super(),this.srcNotebook=e}render(){return l().createElement("div",null,l().createElement(d,{srcNotebook:this.srcNotebook,valueFunc:this.setValue}))}setValue(e){console.log(`Updated value: ${e}`),g.value=e}getValue(){return g.value}}const b={id:"jupyterlab_multicontents_templates:plugin",autoStart:!0,requires:[a.IFileBrowserFactory],activate:(e,t)=>{const n=new p((t=>{"notebook"===t.type&&e.commands.execute("multicontentTemplates:preview",{path:t.path,name:t.name})})),{tracker:a}=t;let s=null;n.id="template:list",e.shell.add(n,"left"),e.commands.addCommand("multicontentTemplates:preview",{caption:"Preview Template Notebook",execute:t=>{null!==s&&s.close(),s=new u(String(t.path),String(t.name),(t=>{e.commands.execute("multicontentTemplates:import",{path:t})})),s.isAttached||e.shell.add(s,"main"),e.shell.activateById(s.id)}}),e.commands.addCommand("multicontentTemplates:import",{caption:"import notebook",execute:n=>{const a=String(n.path);r("content",{method:"PUT",body:JSON.stringify({path:a})}).then((n=>{const a=t.defaultBrowser.model.path;return new Promise((t=>{e.commands.execute("docmanager:new-untitled",{path:a,type:"notebook"}).then((t=>(s.close(),e.commands.execute("docmanager:open",{factory:"Notebook",path:t.path})))).then((e=>e.context.ready.then((()=>{e.model.fromJSON(n.content),t(e)})))).then((()=>e.commands.execute("docmanager:save")))}))}))}}),e.commands.addCommand("multicontentTemplates:publish",{label:"Publish Notebook",iconClass:"jp-multicontents-templates-icon",execute:e=>{console.log(e);const t=a.currentWidget.selectedItems().next();(0,o.showDialog)({title:"Publish Location",body:new g(t),buttons:[o.Dialog.cancelButton(),o.Dialog.okButton({label:"Publish"})]}).then((e=>{"Publish"===e.button.label&&(console.log(t,e),r("publish",{method:"PUT",body:JSON.stringify({source_path:t.path,target_path:e.value})}).then((e=>{(0,o.showDialog)({title:"Success!",body:`successfully saved template to: ${e.path}`,buttons:[o.Dialog.okButton()]})})).catch((e=>{(0,o.showDialog)({title:"Error",body:e.message,buttons:[o.Dialog.okButton()]})}))),console.log({selectedItem:t,value:e})}))}}),e.contextMenu.addItem({command:"multicontentTemplates:publish",selector:'.jp-DirListing-item[data-file-type="notebook"]',rank:3}),console.log("JupyterLab extension jupyterlab_multicontents_templates is activated!")}}}}]);