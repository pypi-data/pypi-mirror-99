import re
import os
import sys
from pybuild import Pybuild1, InstallDir, File
from pybuild.info import P


class Package(Pybuild1):
    NAME = "Test"
    KEYWORDS = "test"
    LICENSE = "test"
    DESC = "Test Desc: foo-bar"
    HOMEPAGE = "test homepage"

    INSTALL_DIRS = [InstallDir(".", FILES=[File("Foo")])]

    CONFIG = {"TestSection": {"TestKey": "TestValue"}}

    def src_prepare(self):
        os.makedirs(P)
        with open(os.path.join(P, "Foo"), "w") as file:
            print("test", file=file)

        # Test that Windows handles backslashes in paths properly
        assert re.match(r"\[foo\]", "[foo]")
        if sys.platform == "win32":
            os.makedirs(os.path.join("Foo", "Do"))
            assert os.path.exists(r"Foo\Do")
