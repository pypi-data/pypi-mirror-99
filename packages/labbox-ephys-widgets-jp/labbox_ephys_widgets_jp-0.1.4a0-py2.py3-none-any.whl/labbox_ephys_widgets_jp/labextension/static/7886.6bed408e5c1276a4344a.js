(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[7886],{87886:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>O});var s=n(47033),i=n(45185),r=n(56271),l=n.n(r),o=n(49287),c=n(5597),a=n(45);const d=()=>{const[e,t]=(0,r.useState)([]),n=(0,r.useContext)(i.HitherContext);(0,r.useEffect)((()=>{const e=setInterval((()=>{const e=n.getHitherJobs();t(e)}),1e3);return()=>{clearInterval(e)}}),[n]);const{pendingJobs:s,runningJobs:o,finishedJobs:c,erroredJobs:a}={pendingJobs:e.filter((e=>"pending"===e.status)),runningJobs:e.filter((e=>"running"===e.status)),finishedJobs:e.filter((e=>"finished"===e.status)),erroredJobs:e.filter((e=>"error"===e.status))},d=s.length,u=o.length,g=c.length,p=a.length,b=`Jobs: ${d} pending | ${u} running | ${g} finished | ${p} errored`,m=p>0?l().createElement("span",null,":",l().createElement("span",{style:{color:"pink"}},p)):l().createElement("span",null);return l().createElement("span",{title:b,style:{fontFamily:"courier"}},d,":",u,":",g,m)};var u=n(12931);const g=({color:e})=>{const{websocketStatus:t,onReconnectWebsocket:n}=(0,r.useContext)(i.LabboxProviderContext),{icon:o,title:c}=(0,r.useMemo)((()=>{switch(t){case"waiting":return{icon:l().createElement(u.Sync,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:l().createElement(u.CheckCircleOutline,{style:{color:e}}),title:"Connected"};case"disconnected":return{icon:l().createElement(u.SyncProblem,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[t,e]),a=(0,r.useCallback)((()=>{"disconnected"===t&&n()}),[t,n]);return l().createElement(s.IconButton,{title:c,onClick:a},o)},p=({onOpenSettings:e,color:t})=>{const{icon:n,title:i}=(0,r.useMemo)((()=>({icon:l().createElement(u.Settings,null),title:"Open settings"})),[]),o=(0,r.useCallback)((()=>{e()}),[e]);return l().createElement(s.IconButton,{style:{color:t},title:i,onClick:o},n)},b=({onOpenSettings:e,workspaceRouteDispatch:t,logo:n})=>{const i=(0,r.useCallback)((()=>{t({type:"gotoRecordingsPage"})}),[t]);return l().createElement(s.AppBar,{position:"static",style:{height:50,color:"white"}},l().createElement(s.Toolbar,null,n&&l().createElement("img",{src:n,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:i}),"   ",l().createElement("span",{style:{paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold"}},"Labbox Ephys"),l().createElement("span",{style:{marginLeft:"auto"}}),l().createElement("span",{style:{paddingBottom:0,color:"white"}},l().createElement(p,{onOpenSettings:e,color:"white"}),l().createElement(g,{color:"white"}),l().createElement(d,null))))},m=(0,n(41120).Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),f=({workspaceUri:e,version:t})=>{const n=m(),{serverInfo:o}=(0,r.useContext)(i.LabboxProviderContext),{workspaceName:a}=(0,c.x)(e);return l().createElement("div",{className:n.paper,style:{zIndex:9999}},l().createElement("h2",null,"Labbox Ephys ",t),l().createElement(s.Table,null,l().createElement(s.TableRow,null,l().createElement(s.TableCell,null,"Workspace URI"),l().createElement(s.TableCell,null,e||"")),l().createElement(s.TableRow,null,l().createElement(s.TableCell,null,"Workspace name"),l().createElement(s.TableCell,null,a)),l().createElement(s.TableRow,null,l().createElement(s.TableCell,null,"Kachery node ID"),l().createElement(s.TableCell,null,o?o.nodeId:"")),l().createElement(s.TableRow,null,l().createElement(s.TableCell,null,"Default feed ID"),l().createElement(s.TableCell,null,o?o.defaultFeedId:""))))};function E(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}const I=({workspaceUri:e,workspaceRoute:t,workspaceRouteDispatch:n,version:d})=>{const{width:u,height:g}=function(){const[e,t]=(0,r.useState)(E());return(0,r.useEffect)((()=>{function e(){t(E())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),p=g-52-2,m=u-0-2,I=(0,o.FO)().filter((e=>"WorkspaceView"===e.name))[0];if(!I)throw Error("Unable to find workspace view plugin");const[O,y]=(0,r.useState)(!1),[h,w]=(0,r.useReducer)(a.Z,(0,r.useMemo)((()=>({recordings:[],sortings:[]})),[])),j=(0,r.useCallback)((e=>{e.filter((e=>e.action)).forEach((e=>w(e.action)))}),[]),{feedUri:v,workspaceName:S}=(0,c.x)(e),U=(0,r.useMemo)((()=>({workspaceName:S})),[S]),{appendMessages:k}=(0,i.useSubfeed)({feedUri:v,subfeedName:U,onMessages:j}),R=(0,r.useCallback)((e=>{k([e])}),[k]),T=(0,r.useCallback)((()=>{y(!0)}),[]),C=(0,r.useCallback)((()=>{y(!1)}),[]);return l().createElement("div",{style:{margin:0}},l().createElement(b,{onOpenSettings:T,workspaceRouteDispatch:n}),l().createElement("div",{style:{position:"absolute",top:52}},l().createElement(I.component,{width:m,height:p,workspace:h,workspaceDispatch:R,workspaceRoute:t,workspaceRouteDispatch:n})),l().createElement(s.Modal,{open:O,onClose:C,style:{zIndex:9999}},l().createElement("span",null,l().createElement(f,{workspace:h,workspaceUri:e,version:d}))))};function O(e){e.registerPlugin({type:"MainWindow",name:"MainWindow",label:"Main Window",component:I})}},49287:(e,t,n)=>{"use strict";n.d(t,{kN:()=>a,qG:()=>p,GI:()=>d,CC:()=>c,Zl:()=>l,_S:()=>m,SF:()=>u,fG:()=>E,fB:()=>f,Sd:()=>b,FO:()=>I});var s=n(45185),i=n(56271);const r=(e,t)=>{if(e.min<=t&&t<e.max)return e;const n=e.max-e.min,s=Math.max(0,Math.floor(t-n/2));return{min:s,max:s+n}},l=(e,t)=>{var n,s,i,l;if("SetRecordingSelection"===t.type)return Object.assign({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{selectedElectrodeIds:t.selectedElectrodeIds.filter((t=>!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)))});if("SetVisibleElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((e=>t.visibleElectrodeIds.includes(e))):void 0});if("SetCurrentTimepoint"===t.type)return Object.assign(Object.assign({},e),{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?r(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object.assign(Object.assign({},e),{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){const i=9e6,r=e.currentTimepoint,l=e.timeRange;if(!l)return e;const c=null!==(n=t.direction)&&void 0!==n?n:"in",a=null!==(s=t.factor)&&void 0!==s?s:1.4,d="out"===c?1/a:a;if((l.max-l.min)/d>i)return e;let u;u=void 0===r||r<l.min?l.min:r>l.max?l.max:r;const g=o(l,d,u);return Object.assign(Object.assign({},e),{timeRange:g})}if("SetAmpScaleFactor"===t.type)return Object.assign(Object.assign({},e),{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){const n=null!==(i=t.direction)&&void 0!==i?i:"up",s=null!==(l=t.multiplier)&&void 0!==l?l:1.4,r="down"===n?1/s:s;return Object.assign(Object.assign({},e),{ampScaleFactor:(e.ampScaleFactor||1)*r})}return"SetCurrentTimepointVelocity"===t.type?Object.assign(Object.assign({},e),{animation:Object.assign(Object.assign({},e.animation||{}),{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object.assign(Object.assign({},e),{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},o=(e,t,n)=>{const s=n+(e.min-n)/t,i=n+(e.max-n)/t;return{min:Math.floor(s),max:Math.floor(i)}},c=(e,t)=>((t||{}).mergeGroups||[]).filter((t=>t.includes(e)))[0]||null,a=(e,t,n)=>n&&c(e,t)||e,d=(e,t)=>{const n=c(e,t);return!n||Math.min(...n)===e},u=(e,t)=>"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:t.selectedUnitIds.filter((t=>{var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>{var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?((e,t)=>{const n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object.assign(Object.assign({},e),{selectedUnitIds:(e.selectedUnitIds||[]).filter((e=>e!==n))}):Object.assign(Object.assign({},e),{selectedUnitIds:[...e.selectedUnitIds||[],n]}):Object.assign(Object.assign({},e),{selectedUnitIds:[n]})})(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?g(Object.assign(Object.assign({},e),{applyMerges:!e.applyMerges}),t.curation):l(e,t),g=(e,t)=>e.applyMerges&&t?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>d(e,t))):void 0}):e,p=e=>e.filter((e=>!e.disabled&&!e.development)),b=e=>p(e).filter((e=>"SortingView"===e.type)).map((e=>e)),m=e=>p(e).filter((e=>"RecordingView"===e.type)).map((e=>e)),f=e=>p(e).filter((e=>"SortingUnitView"===e.type)).map((e=>e)),E=e=>p(e).filter((e=>"SortingUnitMetric"===e.type)).map((e=>e)),I=()=>{const e=(0,s.usePlugins)();return(0,i.useMemo)((()=>e.filter((e=>"WorkspaceView"===e.type)).map((e=>e))),[e])}},5597:(e,t,n)=>{"use strict";n.d(t,{x:()=>s});const s=e=>{if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};const t=e.split("/"),n=t[2]||void 0,s=t[3]||void 0;return n&&s?{feedUri:`feed://${n}`,workspaceName:s}:{feedUri:void 0,workspaceName:void 0}}},45:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const s=(e,t)=>{if("SET_CURATION"===t.type)return t.curation;if("ADD_UNIT_LABEL"===t.type){const n=t.unitId+"",s=(e.labelsByUnit||{})[n]||[];return s.includes(t.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[n]:[...s,t.label].sort()})})}if("REMOVE_UNIT_LABEL"===t.type){const n=t.unitId+"",s=(e.labelsByUnit||{})[n]||[];return s.includes(t.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[n]:s.filter((e=>e!==t.label))})}):e}return"MERGE_UNITS"===t.type?Object.assign(Object.assign({},e),{mergeGroups:l([...e.mergeGroups||[],t.unitIds])}):"UNMERGE_UNITS"===t.type?Object.assign(Object.assign({},e),{mergeGroups:l((e.mergeGroups||[]).map((e=>e.filter((e=>!t.unitIds.includes(e))))))}):e},i=(e,t)=>e.filter((e=>t.includes(e))),r=(e,t)=>[...e,...t.filter((t=>!e.includes(t)))].sort(),l=e=>{const t=e.map((e=>[...e]));let n=!0;for(;n;){n=!1;for(let e=0;e<t.length;e++){const s=t[e];for(let l=e+1;l<t.length;l++){const o=t[l];i(s,o).length>0&&(t[e]=r(s,o),t[l]=[],n=!0)}}}return t.filter((e=>e.length>=2))},o=(e,t)=>{switch(t.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==t.recording.recordingId)),t.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!t.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==t.sorting.sortingId)),t.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!t.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!t.recordingIds.includes(e.recordingId)))});case"ADD_UNIT_LABEL":case"REMOVE_UNIT_LABEL":case"MERGE_UNITS":case"UNMERGE_UNITS":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===t.sortingId?Object.assign(Object.assign({},e),{curation:s(e.curation||{},t)}):e))});default:return e}}},41120:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var s=n(22122),i=n(73914),r=n(99700);const l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.Z)(e,(0,s.Z)({defaultTheme:r.Z},t))}}}]);