(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[9101],{96333:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(56271),o=n.n(r),l=n(49287),a=n(36464),i=n(93379),c=n.n(i),s=n(97948);c()(s.Z,{insert:"head",singleton:!1}),s.Z.locals;var u=n(48003),m=n(9756),d=n(47033);const p=e=>{const{columns:t,onColumnClick:n,primarySortColumnDirection:r,primarySortColumnName:l,onDeselectAll:a}=e;return o().createElement(d.TableHead,null,o().createElement(d.TableRow,null,a?o().createElement(d.TableCell,{key:"_checkbox"},o().createElement(g,{rowId:"",selected:!1,onClick:()=>{a()},isDeselectAll:!0})):o().createElement(d.TableCell,{key:"_checkbox"}),t.map((e=>{const t=(e.tooltip||e.label||"")+" (click to sort)";return o().createElement(d.TableCell,{key:e.columnName,onClick:()=>n(e),title:t,style:{cursor:"pointer"}},o().createElement(d.Grid,{container:!0,justify:"flex-start",style:{flexFlow:"row"}},o().createElement(d.Grid,{item:!0,key:"icon"},o().createElement("span",{style:{fontSize:16,color:"gray",paddingLeft:3,paddingRight:5,paddingTop:2}},l===e.columnName&&("ascending"===r?o().createElement(m.FontAwesomeIcon,{icon:u.faCaretUp}):o().createElement(m.FontAwesomeIcon,{icon:u.faCaretDown})))),o().createElement(d.Grid,{item:!0,key:"text"},o().createElement("span",null,o().createElement("span",{key:"label"},e.label),o().createElement("span",{key:"progress"},e.calculating&&o().createElement(d.LinearProgress,null))))))}))))},g=o().memo((e=>{const{rowId:t,selected:n,onClick:r,isDeselectAll:l}=e;return o().createElement(d.Checkbox,{checked:n,indeterminate:!!l,onClick:()=>r(t),style:{padding:1},title:l?"Deselect all":`Select ${t}`})})),h=e=>{const{selectedRowIds:t,onSelectedRowIdsChanged:n,rows:l,columns:a,defaultSortColumnName:i,height:c}=e,[s,u]=(0,r.useState)([]);(0,r.useEffect)((()=>{0===s.length&&i&&u([i])}),[u,s,i]);const m=(0,r.useCallback)((e=>{const r=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(r)}),[t,n]),h=[...l],b=e=>a.filter((t=>t.columnName===e))[0],f=(e=>{const t=[];for(let n=0;n<e.length;n++){const r=e[n-1]!==e[n];t.push({columnName:e[n],keyOrder:n,sortAscending:r})}return t})(s);for(const e of f){const t=e.columnName,n=b(t);h.sort(((r,o)=>{const l=r.data[t]||{},a=o.data[t]||{},i=l.sortValue,c=a.sortValue;return e.sortAscending?n.sort(i,c):n.sort(c,i)}))}const y=(t||[]).reduce(((e,t)=>(e[t]=!0,e)),{}),v=f.length>0?f[f.length-1]:void 0,E=v?v.columnName:void 0,N=v?v.sortAscending?"ascending":"descending":void 0;return o().createElement(d.TableContainer,{style:void 0!==c?{maxHeight:c}:{}},o().createElement(d.Table,{stickyHeader:!0,className:"TableWidget"},o().createElement(p,{columns:a,primarySortColumnName:E,primarySortColumnDirection:N,onColumnClick:e=>{const t=e.columnName;let n=[...s];n=s[s.length-1]===t?s[s.length-2]===t?n.slice(0,n.length-1):[...n,t]:[...n.filter((e=>e!==t)),t],u(n)},onDeselectAll:t.length>0?()=>{n([])}:void 0}),o().createElement(d.TableBody,null,h.map((e=>{const t=y[e.rowId]||!1;return o().createElement(d.TableRow,{key:e.rowId},o().createElement(d.TableCell,{key:"_checkbox",className:t?"selectedRow":""},o().createElement(g,{rowId:e.rowId,selected:t,onClick:()=>m(e.rowId)})),a.map((n=>o().createElement(d.TableCell,{key:n.columnName,className:t?"selectedRow":""},o().createElement("div",{title:n.tooltip},n.dataElement(e.data[n.columnName].value))))))})))))},b=e=>{const{sortingUnitMetrics:t,units:n,metrics:i,selection:c,selectionDispatch:s,sorting:u,height:m}=e,d=(c||{}).selectedUnitIds||[],p=(0,a.Z)(Object.values(t||{})).filter((e=>!e.disabled)),g=(0,r.useCallback)((e=>{s({type:"SetSelectedUnitIds",selectedUnitIds:e.map((e=>Number(e)))})}),[s]),b=n.map((e=>({rowId:e+"",data:{}}))),f=(e,t)=>Number(e)-Number(t),y=e=>o().createElement("span",null,e+""),v={color:"black",fontWeight:"bold",cursor:"pointer"},E={color:"gray",textDecoration:"underline",cursor:"pointer"},N=[];N.push({columnName:"_unit_id",label:"Unit ID",tooltip:"Unit ID",sort:f,dataElement:e=>{const{unitId:t,mergeGroup:n}=e;return o().createElement("span",null,o().createElement("span",{key:"unitId",style:v},t+""),n&&n.length>0&&o().createElement("span",{key:"mergeGroup"},` (${n.map((e=>e+"")).join(", ")})`))}}),b.forEach((e=>{const t=Number(e.rowId);e.data._unit_id={value:{unitId:t,mergeGroup:(0,l.CC)(t,u.curation)},sortValue:t}})),N.push({columnName:"_labels",label:"Labels",tooltip:"Curation labels",sort:(e,t)=>e<t?-1:e>t?1:0,dataElement:e=>{const t=e;return o().createElement("span",null,t.map((e=>o().createElement("span",{key:e},o().createElement("span",{style:E},e),"Â "))))}}),b.forEach((e=>{const t=((e,t)=>((t.curation||{}).labelsByUnit||{})[e]||[])(Number(e.rowId),u);e.data._labels={value:t,sortValue:t.join(", ")}})),(u.externalUnitMetrics||[]).forEach((e=>{const t="external-metric-"+e.name;N.push({columnName:t,label:e.label,tooltip:e.tooltip||"",sort:f,dataElement:y}),b.forEach((n=>{const r=Number(n.rowId),o=e.data[r+""];n.data[t]={value:void 0!==o?o:NaN,sortValue:void 0!==o?o:NaN}}))})),p.forEach((e=>{const t="plugin-metric-"+e.name,n=(i||{})[e.name]||null,r=n?n.data:null;N.push({columnName:t,label:e.columnLabel,tooltip:e.tooltip||"",sort:f,dataElement:e.component,calculating:n&&!r}),b.forEach((n=>{const o=Number(n.rowId),l=r&&o+""in r?r[o+""]:void 0,a=void 0!==l?e.getValue(l):void 0;n.data[t]={value:l,sortValue:void 0!==a?a:e.isNumeric?NaN:""}}))}));const _=d.map((e=>e+""));return o().createElement(h,{rows:b,columns:N,selectedRowIds:_,onSelectedRowIdsChanged:g,defaultSortColumnName:"_unit_id",height:m})}},49101:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>N});var r=n(64122),o=n(56271),l=n.n(o);const a={type:"SortingUnitMetric",name:"EventCount",label:"Num. events",columnLabel:"Num. events",tooltip:"Number of firing events",hitherFnName:"createjob_get_firing_data",metricFnParams:{},hitherOpts:{useClientCache:!0},component:e=>l().createElement("span",null,void 0!==e?e.count:""),isNumeric:!0,getValue:e=>e.count},i={type:"SortingUnitMetric",name:"FiringRate",label:"Firing rate (Hz)",columnLabel:"Firing rate (Hz)",tooltip:"Average num. events per second",hitherFnName:"createjob_get_firing_data",hitherOpts:{useClientCache:!0},metricFnParams:{},component:e=>l().createElement("span",null,void 0!==e?e.rate:""),isNumeric:!0,getValue:e=>e.count},c={type:"SortingUnitMetric",name:"IsiViolations",label:"ISI viol.",columnLabel:"ISI viol.",tooltip:"ISI violation rate",hitherFnName:"createjob_get_isi_violation_rates",metricFnParams:{isi_threshold_msec:2.5},hitherOpts:{useClientCache:!0},component:e=>l().createElement("span",null,void 0!==e?e.toFixed(4):""),isNumeric:!0,getValue:e=>e},s={type:"SortingUnitMetric",name:"PeakChannels",label:"Peak chan.",columnLabel:"Peak chan.",tooltip:"ID of channel where the peak-to-peak amplitude is maximal",hitherFnName:"createjob_get_peak_channels",metricFnParams:{},hitherOpts:{useClientCache:!0},component:e=>l().createElement("span",null,void 0!==e?e:""),isNumeric:!0,getValue:e=>e},u={type:"SortingUnitMetric",name:"UnitSnrs",label:"SNR",columnLabel:"SNR",tooltip:"Unit SNR (peak-to-peak amp of mean waveform / est. std. dev on peak chan)",hitherFnName:"createjob_get_unit_snrs",metricFnParams:{},hitherOpts:{useClientCache:!0},component:e=>l().createElement("span",null,void 0!==e?e.toFixed(4):""),isNumeric:!0,getValue:e=>e};var m=n(47033),d=n(45185),p=n(65405),g=n(49287),h=n(36464),b=n(96333),f=function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function a(e){try{c(r.next(e))}catch(e){l(e)}}function i(e){try{c(r.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((r=r.apply(e,t||[])).next())}))};const y={},v=(e,t)=>{if("clear"===t)return{};const{metricName:n,status:r,data:o,error:l}=t;return e[n]&&"completed"===e[n].status?(console.warn(`Updating status of completed metric ${n}??`),e):Object.assign(Object.assign({},e),{[n]:{status:r,data:"completed"===r&&o||null,error:"error"===r&&l||null}})},E=e=>{const t=(0,o.useContext)(d.HitherContext),{sorting:n,recording:r,selection:a,selectionDispatch:i,width:c,height:s}=e,[u,E]=(0,o.useState)(!1),[N,_]=(0,o.useReducer)(v,y),[C,x]=(0,o.useState)(null);(0,o.useEffect)((()=>{C!==r&&(_("clear"),x(r))}),[r,C,x,_]);const k=(0,o.useCallback)((e=>f(void 0,void 0,void 0,(function*(){const o=e.name;if(o in N)return N[o];_({metricName:e.name,status:"executing"});try{const o=yield t.createHitherJob(e.hitherFnName,{sorting_object:n.sortingObject,recording_object:r.recordingObject,configuration:e.metricFnParams},e.hitherOpts).wait();_({metricName:e.name,status:"completed",data:o})}catch(t){console.error(t),_({metricName:e.name,status:"error",error:t.message})}}))),[N,n.sortingObject,r.recordingObject,t]),w=(0,d.usePlugins)();(0,o.useEffect)((()=>{(0,h.Z)((0,g.fG)(w)).filter((e=>!e.disabled)).forEach((e=>f(void 0,void 0,void 0,(function*(){return yield k(e)}))))}),[w,N,k]);const I=(0,o.useMemo)((()=>(0,g.fG)(w)),[w]),S=(0,p.D)(n.sortingObject,n.recordingObject);if(!S)return l().createElement("div",null,"No sorting info");let j=a.visibleUnitIds||S.unit_ids,O=!1;return!u&&j.length>30&&(j=j.slice(0,30),O=!0),l().createElement("div",{style:{width:c||300}},l().createElement(m.Paper,{style:{maxHeight:e.maxHeight,overflow:"auto"}},l().createElement(b.Z,{sortingUnitMetrics:I,units:j,metrics:N,selection:a,selectionDispatch:i,sorting:n,height:s}),O&&l().createElement(m.Button,{onClick:()=>{E(!0)}},"Show all units")))};function N(e){(e=>{e.registerPlugin(a),e.registerPlugin(i),e.registerPlugin(c),e.registerPlugin(s),e.registerPlugin(u)})(e),e.registerPlugin({type:"SortingView",name:"UnitsTable",label:"Units Table",icon:l().createElement(r.Z,null),priority:200,component:E,props:{maxHeight:300},singleton:!0})}},95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},20862:(e,t,n)=>{var r=n(50008).default;function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=l?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},64122:(e,t,n)=>{"use strict";var r=n(95318),o=n(20862);t.Z=void 0;var l=o(n(56271)),a=(0,r(n(2108)).default)(l.createElement("path",{d:"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5v11zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2zM3 19c0 1.1.9 2 2 2h3V10H3v9z"}),"TableChart");t.Z=a},2108:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(28546)},97948:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(23645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,".TableWidget .MuiTableCell-root {\n    padding-top: 1px;\n    padding-bottom: 1px;\n    padding-left: 0px;\n    padding-right: 0px;\n    font-size: 12px;\n    border: solid 1px #f0f0f0;\n}\n\n.TableWidget .MuiTableCell-root.selectedRow {\n    background-color: #b5d1ff;\n}",""]);const l=o}}]);