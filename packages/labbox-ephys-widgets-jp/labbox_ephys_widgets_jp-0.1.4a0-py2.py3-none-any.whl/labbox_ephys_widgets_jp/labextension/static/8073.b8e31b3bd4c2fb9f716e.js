(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[8073],{65940:(e,t,r)=>{"use strict";r.d(t,{N:()=>u});var o=r(16213),i=r(17872),n=r(62341);const s={electrodeBoxes:[],radius:0,pixelRadius:0,dragRegion:null,draggedElectrodeIds:[],hoveredElectrodeId:null},c={border:"rgb(30, 30, 30)",base:"rgb(0, 0, 255)",selected:"rgb(196, 196, 128)",hover:"rgb(128, 128, 255)",selectedHover:"rgb(200, 200, 196)",dragged:"rgb(0, 0, 196)",draggedSelected:"rgb(180, 180, 150)",dragRect:"rgba(196, 196, 196, 0.5)",textLight:"rgb(228, 228, 228)",textDark:"rgb(32, 32, 32)"},l=(e,t)=>{if(e.type!==o.II.Release)return;const{selectionDispatch:r,electrodeOpts:n}=t.getProps();if(n.disableSelection)return;const s=t.getState();if(null===s)return;const c=s.electrodeBoxes.filter((t=>(0,i.Xz)(e.point,[t.x,t.y],s.radius))).map((e=>e.id));if(0===c.length)return void(e.modifiers.ctrl||e.modifiers.shift||s.dragRegion||r({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[]}));const l=c[0],d=t.getProps().selection.selectedElectrodeIds||[];r({type:"SetSelectedElectrodeIds",selectedElectrodeIds:e.modifiers.ctrl?d.includes(l)?d.filter((e=>e!==l)):[...d,l]:e.modifiers.shift?[...d,l]:[l]}),t.scheduleRepaint()},d=(e,t)=>{if(e.type!==o.II.Move)return;const r=t.getState();if(null===r)return;const n=r.electrodeBoxes.filter((t=>(0,i.Xz)(e.point,[t.x,t.y],r.radius))).map((e=>e.id));t.setState(Object.assign(Object.assign({},r),{hoveredElectrodeId:0===n.length?null:n[0]})),t.scheduleRepaint()},a=(e,t)=>{var r,o,n;const s=e.getState(),{selectionDispatch:c,electrodeOpts:l}=e.getProps();if(l.disableSelection)return;if(null===s)return;const d=null!==(r=s.electrodeBoxes.filter((e=>(0,i.Qv)(e.rect,t.dragRect))))&&void 0!==r?r:[];t.released?(c({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[...t.shift&&null!==(n=null===(o=e.getProps())||void 0===o?void 0:o.selection.selectedElectrodeIds)&&void 0!==n?n:[],...d.map((e=>e.id))]}),e.setState(Object.assign(Object.assign({},s),{dragRegion:null,draggedElectrodeIds:[]}))):e.setState(Object.assign(Object.assign({},s),{dragRegion:t.dragRect,draggedElectrodeIds:d.map((e=>e.id))})),e.scheduleRepaint()},u=()=>new o.Fw(((e,t,r)=>{var o,i;const n=t.electrodeOpts,s=n.colors||c,l=n.showLabels;e.wipe();const d=r.pixelRadius>5;for(let c of r.electrodeBoxes){const a=!n.disableSelection&&((null===(o=t.selection.selectedElectrodeIds)||void 0===o?void 0:o.includes(c.id))||!1),u=!n.disableSelection&&r.hoveredElectrodeId===c.id,g=!n.disableSelection&&((null===(i=r.draggedElectrodeIds)||void 0===i?void 0:i.includes(c.id))||!1),p=a?g?s.draggedSelected:s.selectedHover:g?s.dragged:u?s.hover:s.base,m=t.layoutMode;if("geom"===m?(e.fillEllipse(c.rect,{color:p}),e.drawEllipse(c.rect,{color:s.border})):"vertical"===m&&e.drawLine(c.rect.xmin,(c.rect.ymin+c.rect.ymax)/2,c.rect.xmax,(c.rect.ymin+c.rect.ymax)/2,{color:s.border}),d){const t=[s.selected,s.draggedSelected,s.hover,s.selectedHover].includes(p)?s.textDark:s.textLight;l&&e.drawText({rect:c.rect,alignment:{Horizontal:"AlignCenter",Vertical:"AlignCenter"},font:{pixelSize:r.pixelRadius,family:"Arial"},pen:{color:t},brush:{color:t},text:c.label})}}r.dragRegion&&e.fillRect(r.dragRegion,{color:s.dragRect})}),((e,t)=>{const r=e.getState(),{width:o,height:i,electrodeLocations:s,electrodeIds:c,layoutMode:l}=t,{electrodeBoxes:d,transform:a,radius:u,pixelRadius:g}=(0,n.Z)({width:o,height:i,electrodeLocations:s,electrodeIds:c,layoutMode:l,maxElectrodePixelRadius:t.electrodeOpts.maxElectrodePixelRadius});e.setTransformMatrix(a),e.setState(Object.assign(Object.assign({},r),{electrodeBoxes:d,radius:u,pixelRadius:g})),e.scheduleRepaint()}),s,{discreteMouseEventHandlers:[l,d],dragHandlers:[a]})},62341:(e,t,r)=>{"use strict";r.d(t,{g:()=>a,Z:()=>u});var o=r(7916),i=r(45157),n=r(17872),s=r(22874);const c=new Map,l=e=>{const t=JSON.stringify(e),r=c.get(t);if(void 0!==r)return r;let i=Number.MAX_VALUE;e.forEach((t=>{e.forEach((e=>{const r=(0,o.norm)([t[0]-e[0],t[1]-e[1]]);0!==r&&(i=Math.min(i,r))}))}));const n=.45*i;return c.set(t,n),n},d=(e,t)=>({xmin:(0,s.Gt)(e.map((e=>e[0])))-t,xmax:(0,s.lR)(e.map((e=>e[0])))+t,ymin:(0,s.Gt)(e.map((e=>e[1])))-t,ymax:(0,s.lR)(e.map((e=>e[1])))+t}),a=e=>{const t=l(e),r=d(e,t);return(0,n.dz)(r)/(0,n.Cr)(r)},u=e=>{const{width:t,height:r,electrodeLocations:o,electrodeIds:c,layoutMode:a}=e;if("vertical"===a)return(({width:e,height:t,electrodeIds:r})=>{const o=r.length,n=(0,i.As)((r=>[10+r[0]*(e-20),10+r[1]*(t-20)]));return{electrodeBoxes:r.map(((e,t)=>{const r=(.5+t)/(o+1),n={xmin:0,xmax:1,ymin:r-.5/(o+1),ymax:r+.5/(o+1)},s=(0,i.As)((e=>[n.xmin+e[0]*(n.xmax-n.xmin),n.ymin+e[1]*(n.ymax-n.ymin)]));return{label:e+"",id:e,x:.5,y:r,rect:n,transform:s}})),transform:n,radius:1/(o+1),pixelRadius:(t-20)/(o+1)}})({width:t,height:r,electrodeIds:c});const u=(e=>{const t=(0,s.Gt)(e.map((e=>e[0]))),r=(0,s.lR)(e.map((e=>e[0]))),o=(0,s.Gt)(e.map((e=>e[1]))),i=(0,s.lR)(e.map((e=>e[1])));return t===r&&o===i?e.map(((e,t)=>[t,0])):e})(o),g=t-20,p=r-20,m=g/p,x=l(u);let f,h=d(u,x),y=(0,n.dz)(h)/(0,n.Cr)(h),b=u;y>1!=m>1&&(b=u.map((e=>[e[1],-e[0]])),h={xmin:h.ymin,xmax:h.ymax,ymin:-h.xmax,ymax:-h.xmin},y=(0,n.dz)(h)/(0,n.Cr)(h)),f=y>m?g/(0,n.dz)(h):p/(0,n.Cr)(h),e.maxElectrodePixelRadius&&x*f>e.maxElectrodePixelRadius&&(f/=x*f/e.maxElectrodePixelRadius);const v=(t-(0,n.dz)(h)*f)/2,E=(r-(0,n.Cr)(h)*f)/2,w=(0,i.As)((e=>[v+(e[0]-h.xmin)*f,E+(e[1]-h.ymin)*f])),R=b.map(((e,t)=>{const r=e[0],o=e[1],s=(0,n.jU)([r,o],x,x),l=(0,i.As)((e=>[s.xmin+e[0]*(s.xmax-s.xmin),s.ymin+e[1]*(s.ymax-s.ymin)]));return{label:c[t]+"",id:c[t],x:r,y:o,rect:s,transform:l}})),S=(0,n.ur)(w,[x,0])[0];return{electrodeBoxes:R,transform:w,radius:x,pixelRadius:S}}},85155:(e,t,r)=>{"use strict";r.d(t,{F0:()=>n,ZL:()=>s});var o=r(45185),i=r(56271);const n=e=>{const{result:t}=(0,o.useHitherJob)(e?"createjob_get_recording_info":"",{recording_object:e},{useClientCache:!0});return t},s=e=>{const t=(0,i.useContext)(o.HitherContext),r=(0,i.useRef)({}),[,n]=(0,i.useState)(0),s={};return e.forEach((e=>{const o=e.recordingId;if(!r.current[o]){const i=t.createHitherJob("createjob_get_recording_info",{recording_object:e.recordingObject},{useClientCache:!0});r.current[o]=i,i.wait().then((()=>{n((e=>e+1))})).catch((()=>{n((e=>e+1))}))}r.current[o].result&&(s[o]=r.current[o].result)})),s}},21677:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var o=r(56271),i=r.n(o),n=r(65940),s=r(45157),c=r(16213);const l=e=>{const t=(0,o.useMemo)((()=>({layoutMode:"geom",electrodeIds:e.electrodes.map((e=>e.id)),electrodeLocations:e.electrodes.map((e=>[e.x,e.y])),width:e.width,height:e.height,selection:e.selection,selectionDispatch:e.selectionDispatch,electrodeOpts:{showLabels:!0,maxElectrodePixelRadius:25},noiseLevel:0,samplingFrequency:0})),[e]),r=(0,c.sJ)(n.N,t),l=(0,c.jU)([r]);return i().createElement(s.ZP,Object.assign({key:"electrodeGeometryCanvas",layers:l},{width:e.width,height:e.height}))}},38073:(e,t,r)=>{"use strict";r.r(t),r.d(t,{activate:()=>a});var o=r(63847),i=r(56271),n=r.n(i),s=r(85155),c=r(21677);const l=({recording:e,width:t,height:r,selection:o,selectionDispatch:l})=>{const d=(0,s.F0)(e.recordingObject),a=o.visibleElectrodeIds,u=(0,i.useMemo)((()=>(d?((e,t)=>{if(e&&t&&t.length!==e.length)throw Error("Electrode ID count does not match location count.");return t.map(((t,r)=>{const o=e[r];return{label:t+"",id:t,x:o[0],y:o[1]}}))})(d.geom,d.channel_ids):[]).filter((e=>!a||a.includes(e.id)))),[d,a]);return d?n().createElement(c.Z,{electrodes:u,selection:o,selectionDispatch:l,width:t||350,height:r||150}):n().createElement("div",null,"No recording info found for recording.")},d=({recording:e,recordingInfo:t,calculationPool:r,width:o,height:i,selection:s,selectionDispatch:c})=>n().createElement(l,Object.assign({},{recording:e,recordingInfo:t,calculationPool:r,width:o,height:i,selection:s,selectionDispatch:c}));function a(e){e.registerPlugin({type:"RecordingView",name:"ElectrodeGeometryRecordingView",label:"Electrode geometry",priority:50,defaultExpanded:!1,component:l,singleton:!0,icon:n().createElement(o.Z,null)}),e.registerPlugin({type:"SortingView",name:"ElectrodeGeometrySortingView",label:"Electrode geometry",priority:50,component:d,singleton:!0,icon:n().createElement(o.Z,null)})}},95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},20862:(e,t,r)=>{var o=r(50008).default;function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var c=n?Object.getOwnPropertyDescriptor(e,s):null;c&&(c.get||c.set)?Object.defineProperty(r,s,c):r[s]=e[s]}return r.default=e,t&&t.set(e,r),r},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function t(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},63847:(e,t,r)=>{"use strict";var o=r(95318),i=r(20862);t.Z=void 0;var n=i(r(56271)),s=(0,o(r(2108)).default)(n.createElement("path",{d:"M10 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12-8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-4 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"Grain");t.Z=s},2108:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.createSvgIcon}});var o=r(28546)}}]);