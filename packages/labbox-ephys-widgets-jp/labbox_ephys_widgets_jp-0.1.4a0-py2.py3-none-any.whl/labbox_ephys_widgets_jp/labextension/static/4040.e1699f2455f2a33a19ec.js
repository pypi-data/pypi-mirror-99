(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[4040],{12240:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var l=n(47033),r=n(56271),o=n.n(r);const i=({job:e,message:t="",width:n=200,height:r=200})=>e?o().createElement(l.Box,{display:"flex",width:n,height:r},o().createElement(l.Box,{m:"auto"},"running"===e.status?o().createElement("span",null,"[",t,"] ",o().createElement(l.CircularProgress,null)):"error"===e.status?o().createElement("span",null,"Error: ",e.error_message," [",t,"]"):"pending"===e.status?o().createElement("span",null,t):o().createElement("span",null,"[",t,"] ",e.status))):o().createElement("div",null,"No job")},45829:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var l=n(47033),r=n(56271),o=n.n(r),i=n(49287),s=n(65405);const a=({sorting:e,selection:t,selectionDispatch:n,unitComponent:a})=>{const[c,u]=(0,r.useState)(30),d=(0,s.D)(e.sortingObject,e.recordingObject),m=t.visibleUnitIds;let p=(d?d.unit_ids:[]).filter((e=>!m||m.includes(e))).filter((n=>!t.applyMerges||(0,i.GI)(n,e.curation))),g=!1;p.length>c&&(p=p.slice(0,c),g=!0);const h=(0,r.useCallback)((e=>{const t=Number(e.currentTarget.dataset.unitId);n({type:"UnitClicked",unitId:t,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey})}),[n]);return o().createElement(l.Grid,{container:!0},p.map((e=>{var n;return o().createElement(l.Grid,{key:e,item:!0},o().createElement("div",{className:"plotWrapperStyle"},o().createElement("div",{"data-unit-id":e,className:(null===(n=t.selectedUnitIds)||void 0===n?void 0:n.includes(e))?"plotSelectedStyle":"plotUnselectedStyle",onClick:h},o().createElement("div",{className:"plotUnitLabel"},o().createElement("div",null,"Unit ",e)),a(e))))})),g&&o().createElement("div",{className:"plotWrapperStyle"},o().createElement("div",{className:"plotWrapperStyleButton"},o().createElement(l.Button,{onClick:()=>{u(c+60)}},"Show more units"))))}},88493:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var l=n(56271),r=n.n(l),o=n(13090),i=n.n(o);const s=e=>{var t,n,o;const{width:s,height:a,initialPosition:c,onChange:u,adjustable:d=!0,positionFromRight:m=!1}=e,[p,g]=(0,l.useState)(c);if(!e.children)throw Error("Unexpected: no props.children");let h,b;if(Array.isArray(e.children)){const t=e.children.filter((e=>void 0!==e));h=t[0],b=t[1]||null}else h=e.children,b=null;if(!b)return r().createElement(h.type,Object.assign({},h.props,{width:s,height:a}));const f=m?s-p:p,E=d?null!==(t=e.gripThickness)&&void 0!==t?t:10:0,y=d?null!==(n=e.gripInnerThickness)&&void 0!==n?n:4:0,v=d?null!==(o=e.gripMargin)&&void 0!==o?o:2:0,w=f-E/2-v,x=s-w-E-2*v;let C={top:0,left:0,width:s,height:a},k={left:0,top:0,width:w,height:a,zIndex:0,overflowY:"auto",overflowX:"hidden"},I={left:w+E+2*v,top:0,width:x,height:a,zIndex:0,overflowY:"auto",overflowX:"hidden"},N={left:0,top:0,width:E+2*v,height:a,backgroundColor:"transparent",cursor:"col-resize",zIndex:9998},j={left:v,top:0,width:E,height:a,background:"rgb(230, 230, 230)",cursor:"col-resize"},_={top:0,left:(E-y)/2,width:y,height:a,background:"gray",cursor:"col-resize"};return r().createElement("div",{className:"splitter",style:Object.assign(Object.assign({},C),{position:"relative"})},r().createElement("div",{key:"child1",style:Object.assign(Object.assign({},k),{position:"absolute"}),className:"SplitterChild"},r().createElement(h.type,Object.assign({},h.props,{width:w,height:a}))),d&&r().createElement(i(),{key:"drag",position:{x:f-E/2-v,y:0},axis:"x",onDrag:(e,t)=>{},onStop:(e,t)=>((e,t)=>{const n=t.x;if(n===f)return;const l=m?s-n:n;g(l),u&&u(l)})(0,t)},r().createElement("div",{style:Object.assign(Object.assign({},N),{position:"absolute"})},r().createElement("div",{style:Object.assign(Object.assign({},j),{position:"absolute"})},r().createElement("div",{style:Object.assign(Object.assign({},_),{position:"absolute"})})))),r().createElement("div",{key:"child2",style:Object.assign(Object.assign({},I),{position:"absolute"}),className:"SplitterChild"},r().createElement(b.type,Object.assign({},b.props,{width:x,height:a}))))}},84040:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>v});var l=n(79634),r=n(56271),o=n.n(r),i=n(45829),s=n(45185),a=n(43301),c=n(12240),u=n(49287);const d=(0,s.createCalculationPool)({maxSimultaneous:6}),m=({sorting:e,unitId1:t,unitId2:n,selection:l,selectionDispatch:r,width:i,height:m})=>{const{result:p,job:g}=(0,s.useHitherJob)("createjob_fetch_correlogram_plot_data",{sorting_object:e.sortingObject,unit_x:(0,u.kN)(t,e.curation,l.applyMerges),unit_y:void 0!==n?(0,u.kN)(n,e.curation,l.applyMerges):null},{useClientCache:!1,calculationPool:d});if(!p)return o().createElement(c.Z,{job:g,width:i,height:m});const h=p.bins.map(((e,t)=>({x:e,y:p.bin_counts[t]})));return o().createElement("div",{className:"App"},o().createElement(a.XYPlot,{margin:30,height:m,width:i},o().createElement(a.VerticalBarSeries,{data:h,barWidth:1}),o().createElement(a.XAxis,null),o().createElement(a.YAxis,null)),o().createElement("div",{style:{textAlign:"center",fontSize:"12px"}},"dt (msec)"))},p=({sorting:e,selection:t,selectionDispatch:n})=>{const l=(0,r.useMemo)((()=>l=>o().createElement(m,Object.assign({},{sorting:e,unitId1:l,selection:t,selectionDispatch:n},{width:180,height:180}))),[e,t,n]);return o().createElement(i.Z,{sorting:e,selection:t,selectionDispatch:n,unitComponent:l})};var g=n(88493),h=n(37249),b=n(47033);const f=({sorting:e,selection:t,selectionDispatch:n,unitIds:l,unitPairComponent:r})=>o().createElement(b.Grid,{container:!0,spacing:0},l.map((e=>o().createElement(b.Grid,{container:!0,key:e},l.map((t=>o().createElement(b.Grid,{key:t,item:!0},o().createElement("div",{className:"plotWrapperStyle"},o().createElement("div",{"data-unit-id1":e,"data-unit-id2":t},o().createElement("div",{className:"plotUnitLabel"},o().createElement("div",null,"Units ",e," vs ",t)),r(e,t)))))))))),E=({sorting:e,selection:t,selectionDispatch:n,unitIds:l,width:i,height:s})=>{const a=l.length||1,c=Math.min(220,(i-10*(a+1))/a),u=c,d=(0,r.useMemo)((()=>(l,r)=>o().createElement(m,{sorting:e,selection:t,selectionDispatch:n,unitId1:l,unitId2:r,width:c,height:u})),[e,t,n,c,u]);return o().createElement(f,{sorting:e,selection:t,selectionDispatch:n,unitIds:l,unitPairComponent:d})},y=({sorting:e,selection:t,selectionDispatch:n,width:l,height:i})=>{const[s,a]=((e,t)=>{const[n,l]=(0,r.useState)([]);return[(0,r.useMemo)((()=>Object.assign(Object.assign({},e),{selectedUnitIds:n})),[n,e]),(0,r.useMemo)((()=>e=>{"SetSelectedUnitIds"===e.type?l(e.selectedUnitIds):t(e)}),[t])]})(t,n);return o().createElement(g.Z,{width:l||600,height:i||900,initialPosition:200},o().createElement(h.Z,{sorting:e,selection:s,selectionDispatch:a}),o().createElement(E,Object.assign({sorting:e,selection:s,selectionDispatch:a,unitIds:s.selectedUnitIds||[]},{width:0,height:0})))};function v(e){e.registerPlugin({type:"SortingView",name:"Autocorrelograms",label:"Autocorrelograms",priority:50,component:p,icon:o().createElement(l.Z,null),singleton:!0}),e.registerPlugin({type:"SortingView",name:"CrossCorrelograms",label:"Cross-Correlograms",component:y,icon:o().createElement(l.Z,null),singleton:!1})}},37249:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var l=n(56271),r=n.n(l),o=n(65405),i=n(49287),s=n(96333);const a=({sorting:e,selection:t,selectionDispatch:n})=>{const l=(0,o.D)(e.sortingObject,e.recordingObject);if(!l)return r().createElement("div",null,"No sorting info");const a=((null==l?void 0:l.unit_ids)||[]).filter((n=>!t.applyMerges||(0,i.GI)(n,e.curation)));return r().createElement(s.Z,Object.assign({units:a},{selection:t,selectionDispatch:n,sorting:e}))}},96333:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var l=n(56271),r=n.n(l),o=n(49287),i=n(36464),s=n(93379),a=n.n(s),c=n(97948);a()(c.Z,{insert:"head",singleton:!1}),c.Z.locals;var u=n(48003),d=n(9756),m=n(47033);const p=e=>{const{columns:t,onColumnClick:n,primarySortColumnDirection:l,primarySortColumnName:o,onDeselectAll:i}=e;return r().createElement(m.TableHead,null,r().createElement(m.TableRow,null,i?r().createElement(m.TableCell,{key:"_checkbox"},r().createElement(g,{rowId:"",selected:!1,onClick:()=>{i()},isDeselectAll:!0})):r().createElement(m.TableCell,{key:"_checkbox"}),t.map((e=>{const t=(e.tooltip||e.label||"")+" (click to sort)";return r().createElement(m.TableCell,{key:e.columnName,onClick:()=>n(e),title:t,style:{cursor:"pointer"}},r().createElement(m.Grid,{container:!0,justify:"flex-start",style:{flexFlow:"row"}},r().createElement(m.Grid,{item:!0,key:"icon"},r().createElement("span",{style:{fontSize:16,color:"gray",paddingLeft:3,paddingRight:5,paddingTop:2}},o===e.columnName&&("ascending"===l?r().createElement(d.FontAwesomeIcon,{icon:u.faCaretUp}):r().createElement(d.FontAwesomeIcon,{icon:u.faCaretDown})))),r().createElement(m.Grid,{item:!0,key:"text"},r().createElement("span",null,r().createElement("span",{key:"label"},e.label),r().createElement("span",{key:"progress"},e.calculating&&r().createElement(m.LinearProgress,null))))))}))))},g=r().memo((e=>{const{rowId:t,selected:n,onClick:l,isDeselectAll:o}=e;return r().createElement(m.Checkbox,{checked:n,indeterminate:!!o,onClick:()=>l(t),style:{padding:1},title:o?"Deselect all":`Select ${t}`})})),h=e=>{const{selectedRowIds:t,onSelectedRowIdsChanged:n,rows:o,columns:i,defaultSortColumnName:s,height:a}=e,[c,u]=(0,l.useState)([]);(0,l.useEffect)((()=>{0===c.length&&s&&u([s])}),[u,c,s]);const d=(0,l.useCallback)((e=>{const l=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(l)}),[t,n]),h=[...o],b=e=>i.filter((t=>t.columnName===e))[0],f=(e=>{const t=[];for(let n=0;n<e.length;n++){const l=e[n-1]!==e[n];t.push({columnName:e[n],keyOrder:n,sortAscending:l})}return t})(c);for(const e of f){const t=e.columnName,n=b(t);h.sort(((l,r)=>{const o=l.data[t]||{},i=r.data[t]||{},s=o.sortValue,a=i.sortValue;return e.sortAscending?n.sort(s,a):n.sort(a,s)}))}const E=(t||[]).reduce(((e,t)=>(e[t]=!0,e)),{}),y=f.length>0?f[f.length-1]:void 0,v=y?y.columnName:void 0,w=y?y.sortAscending?"ascending":"descending":void 0;return r().createElement(m.TableContainer,{style:void 0!==a?{maxHeight:a}:{}},r().createElement(m.Table,{stickyHeader:!0,className:"TableWidget"},r().createElement(p,{columns:i,primarySortColumnName:v,primarySortColumnDirection:w,onColumnClick:e=>{const t=e.columnName;let n=[...c];n=c[c.length-1]===t?c[c.length-2]===t?n.slice(0,n.length-1):[...n,t]:[...n.filter((e=>e!==t)),t],u(n)},onDeselectAll:t.length>0?()=>{n([])}:void 0}),r().createElement(m.TableBody,null,h.map((e=>{const t=E[e.rowId]||!1;return r().createElement(m.TableRow,{key:e.rowId},r().createElement(m.TableCell,{key:"_checkbox",className:t?"selectedRow":""},r().createElement(g,{rowId:e.rowId,selected:t,onClick:()=>d(e.rowId)})),i.map((n=>r().createElement(m.TableCell,{key:n.columnName,className:t?"selectedRow":""},r().createElement("div",{title:n.tooltip},n.dataElement(e.data[n.columnName].value))))))})))))},b=e=>{const{sortingUnitMetrics:t,units:n,metrics:s,selection:a,selectionDispatch:c,sorting:u,height:d}=e,m=(a||{}).selectedUnitIds||[],p=(0,i.Z)(Object.values(t||{})).filter((e=>!e.disabled)),g=(0,l.useCallback)((e=>{c({type:"SetSelectedUnitIds",selectedUnitIds:e.map((e=>Number(e)))})}),[c]),b=n.map((e=>({rowId:e+"",data:{}}))),f=(e,t)=>Number(e)-Number(t),E=e=>r().createElement("span",null,e+""),y={color:"black",fontWeight:"bold",cursor:"pointer"},v={color:"gray",textDecoration:"underline",cursor:"pointer"},w=[];w.push({columnName:"_unit_id",label:"Unit ID",tooltip:"Unit ID",sort:f,dataElement:e=>{const{unitId:t,mergeGroup:n}=e;return r().createElement("span",null,r().createElement("span",{key:"unitId",style:y},t+""),n&&n.length>0&&r().createElement("span",{key:"mergeGroup"},` (${n.map((e=>e+"")).join(", ")})`))}}),b.forEach((e=>{const t=Number(e.rowId);e.data._unit_id={value:{unitId:t,mergeGroup:(0,o.CC)(t,u.curation)},sortValue:t}})),w.push({columnName:"_labels",label:"Labels",tooltip:"Curation labels",sort:(e,t)=>e<t?-1:e>t?1:0,dataElement:e=>{const t=e;return r().createElement("span",null,t.map((e=>r().createElement("span",{key:e},r().createElement("span",{style:v},e),"Â "))))}}),b.forEach((e=>{const t=((e,t)=>((t.curation||{}).labelsByUnit||{})[e]||[])(Number(e.rowId),u);e.data._labels={value:t,sortValue:t.join(", ")}})),(u.externalUnitMetrics||[]).forEach((e=>{const t="external-metric-"+e.name;w.push({columnName:t,label:e.label,tooltip:e.tooltip||"",sort:f,dataElement:E}),b.forEach((n=>{const l=Number(n.rowId),r=e.data[l+""];n.data[t]={value:void 0!==r?r:NaN,sortValue:void 0!==r?r:NaN}}))})),p.forEach((e=>{const t="plugin-metric-"+e.name,n=(s||{})[e.name]||null,l=n?n.data:null;w.push({columnName:t,label:e.columnLabel,tooltip:e.tooltip||"",sort:f,dataElement:e.component,calculating:n&&!l}),b.forEach((n=>{const r=Number(n.rowId),o=l&&r+""in l?l[r+""]:void 0,i=void 0!==o?e.getValue(o):void 0;n.data[t]={value:o,sortValue:void 0!==i?i:e.isNumeric?NaN:""}}))}));const x=m.map((e=>e+""));return r().createElement(h,{rows:b,columns:w,selectedRowIds:x,onSelectedRowIdsChanged:g,defaultSortColumnName:"_unit_id",height:d})}},95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},20862:(e,t,n)=>{var l=n(50008).default;function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==l(e)&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},79634:(e,t,n)=>{"use strict";var l=n(95318),r=n(20862);t.Z=void 0;var o=r(n(56271)),i=(0,l(n(2108)).default)(o.createElement("path",{d:"M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"}),"BarChart");t.Z=i},2108:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l.createSvgIcon}});var l=n(28546)},97948:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var l=n(23645),r=n.n(l)()((function(e){return e[1]}));r.push([e.id,".TableWidget .MuiTableCell-root {\n    padding-top: 1px;\n    padding-bottom: 1px;\n    padding-left: 0px;\n    padding-right: 0px;\n    font-size: 12px;\n    border: solid 1px #f0f0f0;\n}\n\n.TableWidget .MuiTableCell-root.selectedRow {\n    background-color: #b5d1ff;\n}",""]);const o=r}}]);