(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[2736],{87001:(e,t,r)=>{"use strict";r.d(t,{Z:()=>b});var s=r(56271),o=r.n(s),i=r(45157),l=r(16213),d=r(65940),c=r(62341);const n={base:"black"},a={electrodeBoxes:[]},g=(e,t)=>{const r=t.getProps();if(!r)return!0;for(let t of r.customActions||[])if("button"===t.type&&t.keyCode===e.keyCode)return t.callback(),!1;return!0},h=()=>new l.Fw(((e,t,r)=>{const{waveform:s}=t;if(!s)return;const o=t.waveformOpts,l=o.colors||n;e.wipe();const d=(t.selection.ampScaleFactor||1)/(t.noiseLevel||1)*1/10;for(let t=0;t<r.electrodeBoxes.length;t++){const c=r.electrodeBoxes[t],n=e.transform(c.transform).transform((0,i.As)((e=>[e[0]/s[t].length,.5-e[1]/2*d]))),a=n.createPainterPath();for(let e=0;e<s[t].length;e++)a.lineTo(e,s[t][e]);n.drawPath(a,{color:l.base,width:o.waveformWidth})}}),((e,t)=>{const{width:r,height:s,electrodeLocations:o,electrodeIds:i}=t,{electrodeBoxes:l,transform:d}=(0,c.Z)({width:r,height:s,electrodeLocations:o,electrodeIds:i,layoutMode:t.layoutMode,maxElectrodePixelRadius:t.electrodeOpts.maxElectrodePixelRadius});e.setTransformMatrix(d),e.setState({electrodeBoxes:l}),e.scheduleRepaint()}),a,{keyboardEventHandlers:[g]}),u={colors:{border:"rgb(120, 100, 120)",base:"rgb(255, 255, 255)",selected:"rgb(196, 196, 128)",hover:"rgb(128, 128, 255)",selectedHover:"rgb(200, 200, 196)",dragged:"rgb(0, 0, 196)",draggedSelected:"rgb(180, 180, 150)",dragRect:"rgba(196, 196, 196, 0.5)",textLight:"rgb(32, 32, 32)",textDark:"rgb(228, 228, 228)"},showLabels:!1},p={colors:{base:"black"},waveformWidth:2},b=e=>{const t=Object.assign(Object.assign({},e),{electrodeOpts:Object.assign(Object.assign({},u),e.electrodeOpts),waveformOpts:p}),r=Object.assign(Object.assign({},e),{electrodeOpts:Object.assign(Object.assign({},u),e.electrodeOpts)}),s=(0,l.sJ)(d.N,r),c=(0,l.sJ)(h,t),n=(0,l.jU)([s,c]);return o().createElement(i.ZP,Object.assign({layers:n},{width:e.width,height:e.height}))}},65940:(e,t,r)=>{"use strict";r.d(t,{N:()=>g});var s=r(16213),o=r(17872),i=r(62341);const l={electrodeBoxes:[],radius:0,pixelRadius:0,dragRegion:null,draggedElectrodeIds:[],hoveredElectrodeId:null},d={border:"rgb(30, 30, 30)",base:"rgb(0, 0, 255)",selected:"rgb(196, 196, 128)",hover:"rgb(128, 128, 255)",selectedHover:"rgb(200, 200, 196)",dragged:"rgb(0, 0, 196)",draggedSelected:"rgb(180, 180, 150)",dragRect:"rgba(196, 196, 196, 0.5)",textLight:"rgb(228, 228, 228)",textDark:"rgb(32, 32, 32)"},c=(e,t)=>{if(e.type!==s.II.Release)return;const{selectionDispatch:r,electrodeOpts:i}=t.getProps();if(i.disableSelection)return;const l=t.getState();if(null===l)return;const d=l.electrodeBoxes.filter((t=>(0,o.Xz)(e.point,[t.x,t.y],l.radius))).map((e=>e.id));if(0===d.length)return void(e.modifiers.ctrl||e.modifiers.shift||l.dragRegion||r({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[]}));const c=d[0],n=t.getProps().selection.selectedElectrodeIds||[];r({type:"SetSelectedElectrodeIds",selectedElectrodeIds:e.modifiers.ctrl?n.includes(c)?n.filter((e=>e!==c)):[...n,c]:e.modifiers.shift?[...n,c]:[c]}),t.scheduleRepaint()},n=(e,t)=>{if(e.type!==s.II.Move)return;const r=t.getState();if(null===r)return;const i=r.electrodeBoxes.filter((t=>(0,o.Xz)(e.point,[t.x,t.y],r.radius))).map((e=>e.id));t.setState(Object.assign(Object.assign({},r),{hoveredElectrodeId:0===i.length?null:i[0]})),t.scheduleRepaint()},a=(e,t)=>{var r,s,i;const l=e.getState(),{selectionDispatch:d,electrodeOpts:c}=e.getProps();if(c.disableSelection)return;if(null===l)return;const n=null!==(r=l.electrodeBoxes.filter((e=>(0,o.Qv)(e.rect,t.dragRect))))&&void 0!==r?r:[];t.released?(d({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[...t.shift&&null!==(i=null===(s=e.getProps())||void 0===s?void 0:s.selection.selectedElectrodeIds)&&void 0!==i?i:[],...n.map((e=>e.id))]}),e.setState(Object.assign(Object.assign({},l),{dragRegion:null,draggedElectrodeIds:[]}))):e.setState(Object.assign(Object.assign({},l),{dragRegion:t.dragRect,draggedElectrodeIds:n.map((e=>e.id))})),e.scheduleRepaint()},g=()=>new s.Fw(((e,t,r)=>{var s,o;const i=t.electrodeOpts,l=i.colors||d,c=i.showLabels;e.wipe();const n=r.pixelRadius>5;for(let d of r.electrodeBoxes){const a=!i.disableSelection&&((null===(s=t.selection.selectedElectrodeIds)||void 0===s?void 0:s.includes(d.id))||!1),g=!i.disableSelection&&r.hoveredElectrodeId===d.id,h=!i.disableSelection&&((null===(o=r.draggedElectrodeIds)||void 0===o?void 0:o.includes(d.id))||!1),u=a?h?l.draggedSelected:l.selectedHover:h?l.dragged:g?l.hover:l.base,p=t.layoutMode;if("geom"===p?(e.fillEllipse(d.rect,{color:u}),e.drawEllipse(d.rect,{color:l.border})):"vertical"===p&&e.drawLine(d.rect.xmin,(d.rect.ymin+d.rect.ymax)/2,d.rect.xmax,(d.rect.ymin+d.rect.ymax)/2,{color:l.border}),n){const t=[l.selected,l.draggedSelected,l.hover,l.selectedHover].includes(u)?l.textDark:l.textLight;c&&e.drawText({rect:d.rect,alignment:{Horizontal:"AlignCenter",Vertical:"AlignCenter"},font:{pixelSize:r.pixelRadius,family:"Arial"},pen:{color:t},brush:{color:t},text:d.label})}}r.dragRegion&&e.fillRect(r.dragRegion,{color:l.dragRect})}),((e,t)=>{const r=e.getState(),{width:s,height:o,electrodeLocations:l,electrodeIds:d,layoutMode:c}=t,{electrodeBoxes:n,transform:a,radius:g,pixelRadius:h}=(0,i.Z)({width:s,height:o,electrodeLocations:l,electrodeIds:d,layoutMode:c,maxElectrodePixelRadius:t.electrodeOpts.maxElectrodePixelRadius});e.setTransformMatrix(a),e.setState(Object.assign(Object.assign({},r),{electrodeBoxes:n,radius:g,pixelRadius:h})),e.scheduleRepaint()}),l,{discreteMouseEventHandlers:[c,n],dragHandlers:[a]})},62341:(e,t,r)=>{"use strict";r.d(t,{g:()=>a,Z:()=>g});var s=r(7916),o=r(45157),i=r(17872),l=r(22874);const d=new Map,c=e=>{const t=JSON.stringify(e),r=d.get(t);if(void 0!==r)return r;let o=Number.MAX_VALUE;e.forEach((t=>{e.forEach((e=>{const r=(0,s.norm)([t[0]-e[0],t[1]-e[1]]);0!==r&&(o=Math.min(o,r))}))}));const i=.45*o;return d.set(t,i),i},n=(e,t)=>({xmin:(0,l.Gt)(e.map((e=>e[0])))-t,xmax:(0,l.lR)(e.map((e=>e[0])))+t,ymin:(0,l.Gt)(e.map((e=>e[1])))-t,ymax:(0,l.lR)(e.map((e=>e[1])))+t}),a=e=>{const t=c(e),r=n(e,t);return(0,i.dz)(r)/(0,i.Cr)(r)},g=e=>{const{width:t,height:r,electrodeLocations:s,electrodeIds:d,layoutMode:a}=e;if("vertical"===a)return(({width:e,height:t,electrodeIds:r})=>{const s=r.length,i=(0,o.As)((r=>[10+r[0]*(e-20),10+r[1]*(t-20)]));return{electrodeBoxes:r.map(((e,t)=>{const r=(.5+t)/(s+1),i={xmin:0,xmax:1,ymin:r-.5/(s+1),ymax:r+.5/(s+1)},l=(0,o.As)((e=>[i.xmin+e[0]*(i.xmax-i.xmin),i.ymin+e[1]*(i.ymax-i.ymin)]));return{label:e+"",id:e,x:.5,y:r,rect:i,transform:l}})),transform:i,radius:1/(s+1),pixelRadius:(t-20)/(s+1)}})({width:t,height:r,electrodeIds:d});const g=(e=>{const t=(0,l.Gt)(e.map((e=>e[0]))),r=(0,l.lR)(e.map((e=>e[0]))),s=(0,l.Gt)(e.map((e=>e[1]))),o=(0,l.lR)(e.map((e=>e[1])));return t===r&&s===o?e.map(((e,t)=>[t,0])):e})(s),h=t-20,u=r-20,p=h/u,b=c(g);let m,x=n(g,b),f=(0,i.dz)(x)/(0,i.Cr)(x),y=g;f>1!=p>1&&(y=g.map((e=>[e[1],-e[0]])),x={xmin:x.ymin,xmax:x.ymax,ymin:-x.xmax,ymax:-x.xmin},f=(0,i.dz)(x)/(0,i.Cr)(x)),m=f>p?h/(0,i.dz)(x):u/(0,i.Cr)(x),e.maxElectrodePixelRadius&&b*m>e.maxElectrodePixelRadius&&(m/=b*m/e.maxElectrodePixelRadius);const v=(t-(0,i.dz)(x)*m)/2,w=(r-(0,i.Cr)(x)*m)/2,O=(0,o.As)((e=>[v+(e[0]-x.xmin)*m,w+(e[1]-x.ymin)*m])),E=y.map(((e,t)=>{const r=e[0],s=e[1],l=(0,i.jU)([r,s],b,b),c=(0,o.As)((e=>[l.xmin+e[0]*(l.xmax-l.xmin),l.ymin+e[1]*(l.ymax-l.ymin)]));return{label:d[t]+"",id:d[t],x:r,y:s,rect:l,transform:c}})),j=(0,i.ur)(O,[b,0])[0];return{electrodeBoxes:E,transform:O,radius:b,pixelRadius:j}}},88493:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var s=r(56271),o=r.n(s),i=r(13090),l=r.n(i);const d=e=>{var t,r,i;const{width:d,height:c,initialPosition:n,onChange:a,adjustable:g=!0,positionFromRight:h=!1}=e,[u,p]=(0,s.useState)(n);if(!e.children)throw Error("Unexpected: no props.children");let b,m;if(Array.isArray(e.children)){const t=e.children.filter((e=>void 0!==e));b=t[0],m=t[1]||null}else b=e.children,m=null;if(!m)return o().createElement(b.type,Object.assign({},b.props,{width:d,height:c}));const x=h?d-u:u,f=g?null!==(t=e.gripThickness)&&void 0!==t?t:10:0,y=g?null!==(r=e.gripInnerThickness)&&void 0!==r?r:4:0,v=g?null!==(i=e.gripMargin)&&void 0!==i?i:2:0,w=x-f/2-v,O=d-w-f-2*v;let E={top:0,left:0,width:d,height:c},j={left:0,top:0,width:w,height:c,zIndex:0,overflowY:"auto",overflowX:"hidden"},R={left:w+f+2*v,top:0,width:O,height:c,zIndex:0,overflowY:"auto",overflowX:"hidden"},I={left:0,top:0,width:f+2*v,height:c,backgroundColor:"transparent",cursor:"col-resize",zIndex:9998},S={left:v,top:0,width:f,height:c,background:"rgb(230, 230, 230)",cursor:"col-resize"},k={top:0,left:(f-y)/2,width:y,height:c,background:"gray",cursor:"col-resize"};return o().createElement("div",{className:"splitter",style:Object.assign(Object.assign({},E),{position:"relative"})},o().createElement("div",{key:"child1",style:Object.assign(Object.assign({},j),{position:"absolute"}),className:"SplitterChild"},o().createElement(b.type,Object.assign({},b.props,{width:w,height:c}))),g&&o().createElement(l(),{key:"drag",position:{x:x-f/2-v,y:0},axis:"x",onDrag:(e,t)=>{},onStop:(e,t)=>((e,t)=>{const r=t.x;if(r===x)return;const s=h?d-r:r;p(s),a&&a(s)})(0,t)},o().createElement("div",{style:Object.assign(Object.assign({},I),{position:"absolute"})},o().createElement("div",{style:Object.assign(Object.assign({},S),{position:"absolute"})},o().createElement("div",{style:Object.assign(Object.assign({},k),{position:"absolute"})})))),o().createElement("div",{key:"child2",style:Object.assign(Object.assign({},R),{position:"absolute"}),className:"SplitterChild"},o().createElement(m.type,Object.assign({},m.props,{width:O,height:c}))))}},85155:(e,t,r)=>{"use strict";r.d(t,{F0:()=>i,ZL:()=>l});var s=r(45185),o=r(56271);const i=e=>{const{result:t}=(0,s.useHitherJob)(e?"createjob_get_recording_info":"",{recording_object:e},{useClientCache:!0});return t},l=e=>{const t=(0,o.useContext)(s.HitherContext),r=(0,o.useRef)({}),[,i]=(0,o.useState)(0),l={};return e.forEach((e=>{const s=e.recordingId;if(!r.current[s]){const o=t.createHitherJob("createjob_get_recording_info",{recording_object:e.recordingObject},{useClientCache:!0});r.current[s]=o,o.wait().then((()=>{i((e=>e+1))})).catch((()=>{i((e=>e+1))}))}r.current[s].result&&(l[s]=r.current[s].result)})),l}}}]);