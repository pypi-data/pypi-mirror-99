(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[7981],{78048:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(47033),r=n(56271),l=n.n(r);const o=e=>l().createElement(i.Accordion,{TransitionProps:{unmountOnExit:void 0===e.unmountOnExit||e.unmountOnExit},defaultExpanded:e.defaultExpanded},l().createElement(i.AccordionSummary,null,e.icon&&l().createElement("span",{style:{paddingRight:10}},e.icon),l().createElement("span",{style:{paddingTop:3}},e.label)),l().createElement(i.AccordionDetails,null,l().createElement("div",{style:{width:"100%"}},e.children)))},88493:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(56271),r=n.n(i),l=n(13090),o=n.n(l);const a=e=>{var t,n,l;const{width:a,height:c,initialPosition:s,onChange:d,adjustable:u=!0,positionFromRight:p=!1}=e,[g,h]=(0,i.useState)(s);if(!e.children)throw Error("Unexpected: no props.children");let b,m;if(Array.isArray(e.children)){const t=e.children.filter((e=>void 0!==e));b=t[0],m=t[1]||null}else b=e.children,m=null;if(!m)return r().createElement(b.type,Object.assign({},b.props,{width:a,height:c}));const f=p?a-g:g,w=u?null!==(t=e.gripThickness)&&void 0!==t?t:10:0,y=u?null!==(n=e.gripInnerThickness)&&void 0!==n?n:4:0,E=u?null!==(l=e.gripMargin)&&void 0!==l?l:2:0,v=f-w/2-E,k=a-v-w-2*E;let C={top:0,left:0,width:a,height:c},S={left:0,top:0,width:v,height:c,zIndex:0,overflowY:"auto",overflowX:"hidden"},j={left:v+w+2*E,top:0,width:k,height:c,zIndex:0,overflowY:"auto",overflowX:"hidden"},O={left:0,top:0,width:w+2*E,height:c,backgroundColor:"transparent",cursor:"col-resize",zIndex:9998},x={left:E,top:0,width:w,height:c,background:"rgb(230, 230, 230)",cursor:"col-resize"},V={top:0,left:(w-y)/2,width:y,height:c,background:"gray",cursor:"col-resize"};return r().createElement("div",{className:"splitter",style:Object.assign(Object.assign({},C),{position:"relative"})},r().createElement("div",{key:"child1",style:Object.assign(Object.assign({},S),{position:"absolute"}),className:"SplitterChild"},r().createElement(b.type,Object.assign({},b.props,{width:v,height:c}))),u&&r().createElement(o(),{key:"drag",position:{x:f-w/2-E,y:0},axis:"x",onDrag:(e,t)=>{},onStop:(e,t)=>((e,t)=>{const n=t.x;if(n===f)return;const i=p?a-n:n;h(i),d&&d(i)})(0,t)},r().createElement("div",{style:Object.assign(Object.assign({},O),{position:"absolute"})},r().createElement("div",{style:Object.assign(Object.assign({},x),{position:"absolute"})},r().createElement("div",{style:Object.assign(Object.assign({},V),{position:"absolute"})})))),r().createElement("div",{key:"child2",style:Object.assign(Object.assign({},j),{position:"absolute"}),className:"SplitterChild"},r().createElement(m.type,Object.assign({},m.props,{width:k,height:c}))))}},27981:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>ie});var i=n(47033),r=n(45185),l=n(56271),o=n.n(l),a=n(78048),c=n(49287);const s=e=>{const t=(0,r.usePlugins)().filter((e=>"MVSortingUnitView"!==e.name)),n=(0,c.fB)(t);return o().createElement(l.Fragment,null,o().createElement(i.Grid,{container:!0,style:{flexFlow:"wrap"},spacing:0},n.filter((e=>!e.fullWidth)).map((n=>o().createElement(i.Grid,{item:!0,key:n.name},o().createElement(n.component,Object.assign({},Object.assign(Object.assign({},e),{plugins:t}),{width:400,height:400})))))),o().createElement(i.Grid,{container:!0,style:{flexFlow:"column"},spacing:0},n.filter((e=>e.fullWidth)).map((n=>o().createElement(i.Grid,{item:!0,key:n.name},o().createElement(a.Z,{defaultExpanded:n.defaultExpanded,label:n.label},o().createElement(n.component,Object.assign({},Object.assign(Object.assign({},e),{plugins:t}),{width:e.width,height:400}))))))))};var d=n(48003),u=n(9756),p=n(12931),g=n(63847),h=n(95171),b=n(88493),m=n(93379),f=n.n(m),w=n(97254);f()(w.Z,{insert:"head",singleton:!1}),w.Z.locals;var y=n(17945),E=n.n(y);const v={paddingTop:3,paddingBottom:3,border:1,borderStyle:"solid",borderColor:"gray"},k=({label:e,partial:t,onClick:n})=>{const i=t?"gray":"black";return o().createElement("button",{style:Object.assign(Object.assign({},v),{color:i}),onClick:n},e)},C=E()()((({sortingId:e,selection:t,selectionDispatch:n,curation:r,curationDispatch:a,size:c})=>{const s=c.width||300,d=(0,l.useMemo)((()=>t.selectedUnitIds||[]),[t.selectedUnitIds]),u=(0,l.useCallback)((t=>{for(let n of d)a({type:"ADD_UNIT_LABEL",sortingId:e,unitId:n,label:t})}),[a,d,e]),p=(0,l.useCallback)((t=>{for(let n of d)a({type:"REMOVE_UNIT_LABEL",sortingId:e,unitId:n,label:t})}),[a,d,e]),g=(0,l.useCallback)((()=>{a({type:"MERGE_UNITS",sortingId:e,unitIds:d})}),[a,d,e]),h=(0,l.useCallback)((()=>{a({type:"UNMERGE_UNITS",sortingId:e,unitIds:d})}),[a,d,e]),b=(0,l.useCallback)((()=>{n({type:"ToggleApplyMerges",curation:r})}),[n,r]),m={};for(const e of d){const t=(r.labelsByUnit||{})[e+""]||[];for(const e of t){let t=m[e]||0;t++,m[e]=t}}const f=Object.keys(m).sort().map((e=>({label:e,partial:m[e]<d.length}))),w={marginTop:25,marginBottom:25,backgroundColor:"#f9f9ff"},y=d.length>0,E=["accept","reject","noise","artifact","mua"],C=[...E,...(r.labelChoices||[]).filter((e=>!E.includes(e)))];return o().createElement("div",{style:{width:s,position:"relative"}},o().createElement(i.Paper,{style:w,key:"selected"},"Selected units: ",d.join(", ")),o().createElement(i.Paper,{style:w,key:"labels"},"Labels:",o().createElement(i.Grid,{container:!0,style:{flexFlow:"wrap"},spacing:0},f.map((e=>o().createElement(i.Grid,{item:!0,key:e.label},o().createElement(k,{label:e.label,partial:e.partial,onClick:()=>{e.partial?u(e.label):p(e.label)}})))))),o().createElement(i.Paper,{style:w,key:"apply"},"Apply labels:",o().createElement(i.Grid,{container:!0,style:{flexFlow:"wrap"},spacing:0},C.map((e=>o().createElement(i.Grid,{item:!0,key:e},(m[e]||0)<d.length||!y?o().createElement("button",{style:v,disabled:!y,onClick:()=>{u(e)}},e):o().createElement("span",null)))))),o().createElement(i.Paper,{style:w,key:"merge"},"Merge:",d.length>=2&&o().createElement("button",{key:"merge",onClick:g},"Merge selected units: ",d.join(", ")),d.length>0&&(e=>{const t=(r.mergeGroups||[]).reduce(((e,t)=>[...e,...t]),[]);for(let n of e)if(!t.includes(n))return!1;return!0})(d)&&o().createElement("button",{key:"unmerge",onClick:h},"Unmerge units: ",d.join(", ")),o().createElement("span",{style:{whiteSpace:"nowrap"}},o().createElement(i.Checkbox,{checked:t.applyMerges||!1,onClick:b})," Apply merges")))})),S=({selection:e,selectionDispatch:t})=>{const n=e.waveformsMode||"geom",r="geom"===n,a=(0,l.useCallback)((()=>{t({type:"SetWaveformsMode",waveformsMode:"geom"===n?"vertical":"geom"})}),[n,t]);return o().createElement("div",null,o().createElement("span",null,"Waveforms:"),o().createElement("span",{style:{whiteSpace:"nowrap"}},o().createElement(i.Checkbox,{checked:r,onClick:a})," Use electrode geom"))},j=({selection:e,selectionDispatch:t})=>o().createElement("div",null,o().createElement(S,{selection:e,selectionDispatch:t}));const O=(0,r.createCalculationPool)({maxSimultaneous:6}),x=({width:e,height:t,block:n,message:i})=>n?o().createElement("div",{className:"BlockInteraction",style:{position:"absolute",width:e,height:t,backgroundColor:"gray",opacity:.5,zIndex:99999}},o().createElement("div",{style:{backgroundColor:"blue",color:"white",fontSize:20}},i)):o().createElement("div",{className:"BlockInteraction"}),V=({recording:e,sorting:t,children:n,width:i,height:a})=>{const c=(0,l.useContext)(r.HitherContext),s=t.sortingObject,d=e.recordingObject,[u,p]=(0,l.useState)(null),[g,h]=(0,l.useState)("waiting"),[b,m]=(0,l.useState)(""),f=(0,l.useRef)({sortingObject:t.sortingObject,recordingObject:e.recordingObject}),w=(0,l.useMemo)((()=>e=>f.current.sortingObject===e.sortingObject&&f.current.recordingObject===e.recordingObject),[]);(0,l.useEffect)((()=>{var e,t,n,i;"waiting"===g?(f.current={recordingObject:d,sortingObject:s},h("running"),e=void 0,t=void 0,i=function*(){try{m("Checking sorting data...");const e=yield c.createHitherJob("preload_check_sorting_downloaded",{sorting_object:s},{useClientCache:!1,calculationPool:O}).wait();if(!w({recordingObject:d,sortingObject:s}))return;if(!e.isLocal){m("Downloading sorting...");const e=yield c.createHitherJob("preload_download_sorting",{sorting_object:s},{useClientCache:!1,calculationPool:O}).wait();if(!w({recordingObject:d,sortingObject:s}))return;if(!e.success)return void p(new Error("Unable to download sorting."))}m("Checking recording data...");const t=yield c.createHitherJob("preload_check_recording_downloaded",{recording_object:d},{useClientCache:!1,calculationPool:O}).wait();if(!w({recordingObject:d,sortingObject:s}))return;if(!t.isLocal){m("Downloading recording...");const e=yield c.createHitherJob("preload_download_recording",{recording_object:d},{useClientCache:!1,calculationPool:O}).wait();if(!w({recordingObject:d,sortingObject:s}))return;if(!e.success)return void p(new Error("Unable to download recording."))}m("Extracting snippets...");const n=yield c.createHitherJob("preload_extract_snippets",{recording_object:d,sorting_object:s},{useClientCache:!1,calculationPool:O}).wait();if(!w({recordingObject:d,sortingObject:s}))return;if(!n)return void p(new Error("Problem extracting snippets"));h("finished")}catch(e){p(e)}},new((n=void 0)||(n=Promise))((function(r,l){function o(e){try{c(i.next(e))}catch(e){l(e)}}function a(e){try{c(i.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))):w({recordingObject:d,sortingObject:s})||h("waiting")}),[s,d,g,w,c]);const y=(0,l.useMemo)((()=>o().cloneElement(n,{preloadStatus:g})),[n,g]),[E,v]=(0,l.useState)(null);return(0,l.useEffect)((()=>{"finished"===g&&w({recordingObject:d,sortingObject:s})&&v(y)}),[y,g,d,s,w]),o().createElement(l.Fragment,null,o().createElement(x,Object.assign({block:"finished"!==g},{width:i,height:a},{message:u?`Error: ${u.message}`:b})),E||y)},_=(e,t)=>"SetPreprocessingSelection"===t.type?t.preprocessingSelection:e,I=[{preprocessingSelection:{filterType:"none"},label:"No filter"},{preprocessingSelection:{filterType:"bandpass_filter"},label:"Bandpass filter"}],M=E()()((({preprocessingSelection:e,preprocessingSelectionDispatch:t})=>{const n=(0,l.useCallback)((e=>{var n;t({type:"SetPreprocessingSelection",preprocessingSelection:(n=e.target.value,I.filter((e=>e.preprocessingSelection.filterType===n))[0].preprocessingSelection)})}),[t]);return o().createElement(i.Select,{value:e.filterType,onChange:n},I.map((e=>o().createElement(i.MenuItem,{key:e.preprocessingSelection.filterType,value:e.preprocessingSelection.filterType},e.label))))}));var T=n(13090),P=n.n(T),D=n(17149),B=n(80366);const U=({view:e,onClose:t,opts:n,onClick:r})=>{const a=(0,l.useMemo)((()=>e.plugin.icon||o().createElement(D.Z,null)),[e.plugin.icon]),c=(0,l.useCallback)((()=>{r(e)}),[r,e]),s=o().createElement("div",{style:{whiteSpace:"nowrap"},draggable:!0,onDragStart:t=>{t.dataTransfer.setData("viewId",e.viewId)},onClick:c},o().createElement(a.type,Object.assign({},a.props,{style:{paddingRight:5,paddingLeft:3,paddingTop:0,width:20,height:20,display:"inline",verticalAlign:"middle"}})),o().createElement("span",{style:{display:"inline",verticalAlign:"middle"}},e.label),o().createElement("span",null," "),o().createElement(i.IconButton,{component:"div",onClick:()=>t(e),className:"CloseButton",style:{padding:0}},o().createElement(B.Z,{style:{display:"inline",verticalAlign:"middle",fontSize:20}}))),d=(0,l.useMemo)((()=>n.selected?{color:"white",fontWeight:"bold"}:{color:"lightgray"}),[n.selected]);return o().createElement(i.Tab,{key:e.viewId,label:s,className:"Tab",style:d})},A=({views:e,currentView:t,onCurrentViewChanged:n,onViewClosed:r,active:a})=>{(0,l.useEffect)((()=>{(t?e.indexOf(t):-1)<0&&e.length>0&&n(e[0])}),[t,n,e]);const c=(0,l.useCallback)((e=>{n(e)}),[n]);let s=t?e.indexOf(t):null;-1===s&&(s=null);const d=["ViewContainerTabBar"];a&&d.push("active");const u=(0,l.useMemo)((()=>e.map(((e,t)=>({selected:t===(s||0)})))),[e,s]);return o().createElement(i.Tabs,{value:s||0,scrollButtons:"auto",variant:"scrollable",className:d.join(" ")},e.map(((e,t)=>o().createElement(U,{key:t,view:e,onClick:c,onClose:r,opts:u[t]}))))},Z=35,z=({onDelta:e,width:t,height:n})=>{const i=(0,l.useCallback)(((e,t)=>{}),[]),r=(0,l.useCallback)(((t,n)=>{const i=n.y;e(i)}),[e]);return o().createElement(P(),{key:"drag",position:{x:0,y:0},axis:"y",onDrag:i,onStop:r},o().createElement("div",{style:{position:"absolute",width:t,height:n,backgroundColor:"white",cursor:"row-resize"}},o().createElement("div",{style:{position:"absolute",width:t,top:(n-4)/2,height:4,backgroundColor:"gray"}})))},L=e=>{const t=e.currentTarget;return[e.clientX-t.getBoundingClientRect().x,e.clientY-t.getBoundingClientRect().y]},R=({children:e,views:t,onViewClosed:n,onSetViewArea:i,width:r,height:a})=>{const[c,s]=(0,l.useState)(null),[d,u]=(0,l.useState)(null),[p,g]=(0,l.useState)("north"),[h,b]=(0,l.useState)(.5);(0,l.useEffect)((()=>{t.forEach((e=>{e.area||(e.area=p),e.activate&&(e.activate=!1,"north"===e.area?(s(e),g("north")):"south"===e.area&&(u(e),g("south")))}))}),[t,p]);const m=(r||300)-6,f=a-6,w=f-70-16,y=w*h,E=w*(1-h),v=(0,l.useCallback)((e=>{b((y+e)/(y+E))}),[b,y,E]),k={north:{tabBarStyle:{left:0,top:0,width:m,height:Z},divStyle:{left:0,top:Z,width:m,height:y}},south:{tabBarStyle:{left:0,top:Z+y+16,width:m,height:Z},divStyle:{left:0,top:70+y+16,width:m,height:E}}},C={left:0,top:Z+y,width:m,height:16},S=(0,l.useCallback)((e=>{const t=L(e)[1]<Z+y?"north":"south";t!==p&&g(t)}),[y,p,g]),j=(0,l.useCallback)((e=>{e.stopPropagation(),e.preventDefault()}),[]),O=(0,l.useCallback)((e=>{const n=L(e)[1]<Z+y?"north":"south",r=e.dataTransfer.getData("viewId");if(r){const e=t.filter((e=>e.viewId===r))[0];e&&e.area!==n&&i(e,n)}}),[t,y,i]);if(!Array.isArray(e))throw Error("Unexpected children in ViewContainer");const x=e;return o().createElement("div",{style:{position:"absolute",left:3,top:3,width:m,height:f},onClick:S,onDragOver:j,onDrop:O,className:"ViewContainer"},o().createElement("div",{key:"north-tab-bar",style:Object.assign({position:"absolute"},k.north.tabBarStyle)},o().createElement(A,{views:t.filter((e=>"north"===e.area)),currentView:c,onCurrentViewChanged:s,onViewClosed:n,active:"north"===p})),o().createElement("div",{key:"south-tab-bar",style:Object.assign({position:"absolute"},k.south.tabBarStyle)},o().createElement(A,{views:t.filter((e=>"south"===e.area)),currentView:d,onCurrentViewChanged:u,onViewClosed:n,active:"south"===p})),o().createElement("div",{key:"splitter",style:Object.assign(Object.assign({position:"absolute"},C),{zIndex:9998})},o().createElement(z,{onDelta:v,width:m,height:16})),x.map((e=>{const t=e.props.view,n="north"===t.area&&t===c||"south"===t.area&&t===d,i=k[t.area||"north"];return o().createElement("div",{key:t.viewId,style:Object.assign({visibility:n?"visible":"hidden",overflowY:"auto",overflowX:"hidden",position:"absolute"},i.divStyle)},o().createElement(e.type,Object.assign({},e.props,{width:m,height:i.divStyle.height})))})))};var N=n(36464);const G={fontSize:12,padding:4,margin:1},H=({plugin:e,onLaunch:t})=>{const n=(0,l.useCallback)((()=>{t(e)}),[t,e]);return o().createElement("button",{onClick:n,style:G},e.icon&&o().createElement(e.icon.type,Object.assign({},e.icon.props,{style:{height:14,width:14,paddingRight:2,paddingTop:0}})),e.label)},F=({plugin:e,unitId:t,label:n,onLaunch:i})=>{const r=(0,l.useCallback)((()=>{i(e,t,n)}),[i,e,t,n]);return o().createElement("button",{onClick:r,style:G},e.icon&&o().createElement("span",{style:{paddingRight:5}},e.icon),n)},W=({onLaunchSortingView:e,onLaunchSortingUnitView:t,selection:n})=>{const i=(0,r.usePlugins)(),a=(0,c.fB)(i).filter((e=>"MVSortingUnitView"===e.name))[0];return o().createElement(l.Fragment,null,o().createElement("div",{key:"sortingViews",style:{flexFlow:"wrap"}},(0,N.Z)((0,c.Sd)(i)).filter((e=>"MVSortingView"!==e.name)).map((t=>o().createElement(H,{key:t.name,plugin:t,onLaunch:e})))),o().createElement("div",{key:"view-single-unit"},a&&(n.selectedUnitIds||[]).map((e=>o().createElement(F,{key:"unit-"+e,plugin:a,unitId:e,label:`Unit ${e}`,onLaunch:t})))))},J=({view:e,sortingViewProps:t,width:n,height:i})=>{const r=e.plugin.component;let l={};return n&&(l.width=n),i&&(l.height=i),o().createElement(r,Object.assign({},t,l,e.extraProps))},q=({recordingInfo:e,selection:t,selectionDispatch:n})=>{const[r,a]=(0,l.useState)("all"),[c,s]=(0,l.useState)([]),{selectedElectrodeIds:d}=t,u=(0,l.useCallback)((()=>{a("all")}),[a]),p=(0,l.useCallback)((()=>{a("custom")}),[a]);(0,l.useEffect)((()=>{const t=((null==e?void 0:e.channel_ids)||[]).filter((e=>(e=>{switch(r){case"all":return!0;case"custom":return c.includes(e);default:throw Error("Unexpected mode")}})(e)));n({type:"SetVisibleElectrodeIds",visibleElectrodeIds:t})}),[e,n,r,c]);const g=(0,l.useCallback)((()=>{a("custom"),s(d||[])}),[d,a,s]),h=(0,l.useMemo)((()=>(d||[]).length>0),[d]);return o().createElement("div",null,o().createElement("span",{style:{whiteSpace:"nowrap"}},o().createElement(i.Radio,{checked:"all"===r,onClick:u})," Show all"),o().createElement("span",{style:{whiteSpace:"nowrap"}},o().createElement(i.Radio,{checked:"custom"===r,onClick:p})," Show custom"),o().createElement(i.Button,{disabled:!h,onClick:g},"Restrict to selected"))};var X=n(65405);const Y=(e,t)=>((t.curation||{}).labelsByUnit||{})[e]||[],$=({sorting:e,recording:t,selection:n,selectionDispatch:a})=>{const c=(0,X.D)(e.sortingObject,e.recordingObject),[s,d]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!1),[g,h]=(0,l.useState)(!0),b=n.visibleElectrodeIds,{result:m}=(0,r.useHitherJob)("createjob_get_peak_channels",{sorting_object:e.sortingObject,recording_object:t.recordingObject},{useClientCache:!0}),f=(0,l.useCallback)((()=>{p(!u)}),[u]),w=(0,l.useCallback)((()=>{d(!s)}),[s]),y=(0,l.useCallback)((()=>{h(!g)}),[g]);return(0,l.useEffect)((()=>{const t=((null==c?void 0:c.unit_ids)||[]).filter((t=>(t=>{if(g&&b&&m){const e=m[t+""];if(!b.includes(e))return!1}return u?Y(t,e).includes("accept"):!s||!Y(t,e).includes("reject")})(t)));a({type:"SetVisibleUnitIds",visibleUnitIds:t})}),[e,a,c,u,s,g,b,m]),o().createElement("div",null,o().createElement("span",{style:{whiteSpace:"nowrap"}},o().createElement(i.Checkbox,{checked:u,onClick:f})," Show accepted only"),o().createElement("span",{style:{whiteSpace:"nowrap"}},o().createElement(i.Checkbox,{checked:s,onClick:w,disabled:u})," Hide rejected"),o().createElement("span",{style:{whiteSpace:"nowrap"}},o().createElement(i.Checkbox,{checked:g,onClick:y,disabled:!b})," Restrict to visible electrodes"))};class K{constructor(e,t,n,i){this.plugin=e,this.extraProps=t,this.label=n,this.viewId=i,this.activate=!1,this.area=""}}let Q=0;const ee=(e,t)=>{if("AddView"===t.type){const n=t.plugin;if(n.singleton)for(let t of e)if(t.plugin.name===n.name)return t.activate=!0,[...e];Q++;const i=new K(n,t.extraProps||{},t.label,Q+"");return i.activate=!0,i.area=t.area,[...e,i].sort(((e,t)=>e.plugin.label>t.plugin.label?1:e.plugin.label<t.plugin.label?-1:0))}return"CloseView"===t.type?e.filter((e=>e!==t.view)):"SetViewArea"===t.type?e.map((e=>e.viewId===t.viewId?Object.assign(Object.assign({},e),{area:t.area,activate:!0}):e)):e},te=e=>{const{recording:t,sorting:n,recordingInfo:i,selection:s,selectionDispatch:m,preloadStatus:f,preprocessingSelection:w,preprocessingSelectionDispatch:y,curationDispatch:E}=e,[v,k]=(0,l.useReducer)(ee,[]),[S,O]=(0,l.useState)(!1),x=(0,r.usePlugins)(),V=(0,c.Sd)(x).filter((e=>"UnitsTable"===e.name))[0],_=(0,c.Sd)(x).filter((e=>"AverageWaveforms"===e.name))[0],I=(0,l.useMemo)((()=>[{plugin:V,area:"north"},{plugin:_,area:"south"}].filter((e=>void 0!==e.plugin))),[V,_]);(0,l.useEffect)((()=>{"finished"!==f||0!==v.length||S||(O(!0),I.forEach((e=>{})))}),[f,S,I,v.length]);const T=(0,l.useCallback)((e=>{k({type:"AddView",plugin:e,label:e.label,area:""})}),[k]),P=(0,l.useCallback)(((e,t,n)=>{k({type:"AddView",plugin:e,label:n,area:"",extraProps:{unitId:t}})}),[k]),D=(0,l.useCallback)((e=>{k({type:"CloseView",view:e})}),[k]),B=(0,l.useCallback)(((e,t)=>{k({type:"SetViewArea",viewId:e.viewId,area:t})}),[k]),U=e.width||600,A=e.height||900,Z=o().createElement("span",{style:{color:"gray"}},o().createElement(p.GraphicEq,null)),z=o().createElement("span",{style:{color:"gray"}},o().createElement(p.Visibility,null)),L=o().createElement("span",{style:{color:"gray"}},o().createElement(g.Z,null)),N=o().createElement("span",{style:{color:"gray"}},o().createElement(h.Z,null)),G=o().createElement("span",{style:{color:"gray"}},o().createElement(u.FontAwesomeIcon,{icon:d.faPencilAlt})),H=o().createElement("span",{style:{color:"gray"}},o().createElement(p.Settings,null)),F=Object.assign({},e);return o().createElement("div",{className:"MVSortingView"},o().createElement(b.Z,{width:U,height:A,initialPosition:320},o().createElement("div",null,o().createElement(a.Z,{icon:N,label:"Open views",defaultExpanded:!0,unmountOnExit:!1},o().createElement(W,{onLaunchSortingView:T,onLaunchSortingUnitView:P,selection:e.selection})),o().createElement(a.Z,{icon:z,label:"Visible units",defaultExpanded:!1,unmountOnExit:!1},o().createElement($,{sorting:n,recording:t,selection:s,selectionDispatch:m})),o().createElement(a.Z,{icon:L,label:"Visible electrodes",defaultExpanded:!1,unmountOnExit:!1},o().createElement(q,{recordingInfo:i,selection:s,selectionDispatch:m})),o().createElement(a.Z,{icon:Z,label:"Preprocessing",defaultExpanded:!1,unmountOnExit:!1},o().createElement(M,{preprocessingSelection:w,preprocessingSelectionDispatch:y})),E&&o().createElement(a.Z,{icon:G,label:"Curation",defaultExpanded:!1,unmountOnExit:!1},o().createElement(C,{sortingId:n.sortingId,curation:e.sorting.curation||{},curationDispatch:E,selection:e.selection,selectionDispatch:e.selectionDispatch})),o().createElement(a.Z,{icon:H,label:"Options",defaultExpanded:!1,unmountOnExit:!1},o().createElement(j,{selection:s,selectionDispatch:m}))),o().createElement(R,{onViewClosed:D,onSetViewArea:B,views:v,width:0,height:0},v.map((e=>o().createElement(J,{key:e.viewId,view:e,sortingViewProps:F}))))))},ne=e=>{const{recording:t,sorting:n}=e,[i,r]=(0,l.useReducer)(_,{filterType:"none"}),a=(0,l.useMemo)((()=>{if(!t)return t;if("none"===i.filterType)return t;if("bandpass_filter"===i.filterType)return Object.assign(Object.assign({},t),{recordingObject:{recording_format:"filtered",data:{filters:[{type:"bandpass_filter",freq_min:300,freq_max:3e3,freq_wid:1e3}],recording:t.recordingObject}}});throw Error(`Unexpected filter type: ${i.filterType}`)}),[t,i]);return o().createElement(V,{recording:a,sorting:n,width:e.width||0,height:e.height||0},o().createElement(te,Object.assign({},e,{preprocessingSelection:i,preprocessingSelectionDispatch:r},{recording:a})))};function ie(e){e.registerPlugin({type:"SortingView",name:"MVSortingView",label:"MVSortingView",priority:5e3,defaultExpanded:!0,notebookCellHeight:800,component:ne}),e.registerPlugin({type:"SortingUnitView",name:"MVSortingUnitView",label:"MV sorting unit view",component:s})}},95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},20862:(e,t,n)=>{var i=n(50008).default;function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=l?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},17149:(e,t,n)=>{"use strict";var i=n(95318),r=n(20862);t.Z=void 0;var l=r(n(56271)),o=(0,i(n(2108)).default)(l.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank");t.Z=o},80366:(e,t,n)=>{"use strict";var i=n(95318),r=n(20862);t.Z=void 0;var l=r(n(56271)),o=(0,i(n(2108)).default)(l.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");t.Z=o},63847:(e,t,n)=>{"use strict";var i=n(95318),r=n(20862);t.Z=void 0;var l=r(n(56271)),o=(0,i(n(2108)).default)(l.createElement("path",{d:"M10 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12-8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-4 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"Grain");t.Z=o},95171:(e,t,n)=>{"use strict";var i=n(95318),r=n(20862);t.Z=void 0;var l=r(n(56271)),o=(0,i(n(2108)).default)(l.createElement("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"}),"OpenInBrowser");t.Z=o},2108:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.createSvgIcon}});var i=n(28546)},97254:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(23645),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,".MVSortingView .ViewContainerTabBar {\n    background-color: rgb(134, 134, 150);\n}\n\n.MVSortingView .ViewContainerTabBar.active {\n    background-color: darkblue;\n}\n\n.MVSortingView .ViewContainerTabBar .Tab {\n    color: white\n}\n\n.MVSortingView .ViewContainerTabBar.active .Tab.selected {\n    font-weight: bold;\n    color: rgb(219, 219, 177)\n}\n\n.MVSortingView .ViewContainerTabBar .Tab .CloseButton {\n    color: white\n}\n\n.MVSortingView .ViewContainerTabBar.active .Tab.selected .CloseButton {\n    color: rgb(219, 219, 177)\n}\n\n.ViewContainer {\n    background-color: #f7f5f3;\n    border: solid 1px gray;\n}",""]);const l=r}}]);