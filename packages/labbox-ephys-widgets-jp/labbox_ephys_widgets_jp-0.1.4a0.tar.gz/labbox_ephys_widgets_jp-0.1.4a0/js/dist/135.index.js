(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[135],{31135:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>R});var s=n(10841),i=n(5443),r=n(69297),c=n.n(r),o=n(95849),l=n(46470),a=n(6425),d=n(94234),u=n(7424);const g=()=>{const[e,t]=(0,r.useState)([]),n=(0,r.useContext)(i.Zo);(0,r.useEffect)((()=>{const e=setInterval((()=>{const e=n.getHitherJobs();t(e)}),1e3);return()=>{clearInterval(e)}}),[n]);const{pendingJobs:s,runningJobs:o,finishedJobs:l,erroredJobs:a}={pendingJobs:e.filter((e=>"pending"===e.status)),runningJobs:e.filter((e=>"running"===e.status)),finishedJobs:e.filter((e=>"finished"===e.status)),erroredJobs:e.filter((e=>"error"===e.status))},d=s.length,u=o.length,g=l.length,p=a.length,m=`Jobs: ${d} pending | ${u} running | ${g} finished | ${p} errored`,b=p>0?c().createElement("span",null,":",c().createElement("span",{style:{color:"pink"}},p)):c().createElement("span",null);return c().createElement("span",{title:m,style:{fontFamily:"courier"}},d,":",u,":",g,b)};var p=n(39110),m=n(62275),b=n(39518),f=n(54193);const E=({color:e})=>{const{websocketStatus:t,onReconnectWebsocket:n}=(0,r.useContext)(i.AL),{icon:s,title:o}=(0,r.useMemo)((()=>{switch(t){case"waiting":return{icon:c().createElement(m.Z,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:c().createElement(b.Z,{style:{color:e}}),title:"Connected"};case"disconnected":return{icon:c().createElement(f.Z,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[t,e]),l=(0,r.useCallback)((()=>{"disconnected"===t&&n()}),[t,n]);return c().createElement(p.Z,{title:o,onClick:l},s)};var O=n(55205);const I=({onOpenSettings:e,color:t})=>{const{icon:n,title:s}=(0,r.useMemo)((()=>({icon:c().createElement(O.Z,null),title:"Open settings"})),[]),i=(0,r.useCallback)((()=>{e()}),[e]);return c().createElement(p.Z,{style:{color:t},title:s,onClick:i},n)},y=({onOpenSettings:e,workspaceRouteDispatch:t,logo:n})=>{const s=(0,r.useCallback)((()=>{t({type:"gotoRecordingsPage"})}),[t]);return c().createElement(d.Z,{position:"static",style:{height:50,color:"white"}},c().createElement(u.Z,null,n&&c().createElement("img",{src:n,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:s}),"   ",c().createElement("span",{style:{paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold"}},"Labbox Ephys"),c().createElement("span",{style:{marginLeft:"auto"}}),c().createElement("span",{style:{paddingBottom:0,color:"white"}},c().createElement(I,{onOpenSettings:e,color:"white"}),c().createElement(E,{color:"white"}),c().createElement(g,null))))};var j=n(22682),h=n(2197),v=n(92378);const w=(0,n(32772).Z)((e=>({paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}))),U=({workspaceUri:e,version:t})=>{const n=w(),{serverInfo:s}=(0,r.useContext)(i.AL),{workspaceName:o}=(0,l.x)(e);return c().createElement("div",{className:n.paper,style:{zIndex:9999}},c().createElement("h2",null,"Labbox Ephys ",t),c().createElement(j.Z,null,c().createElement(h.Z,null,c().createElement(v.Z,null,"Workspace URI"),c().createElement(v.Z,null,e||"")),c().createElement(h.Z,null,c().createElement(v.Z,null,"Workspace name"),c().createElement(v.Z,null,o)),c().createElement(h.Z,null,c().createElement(v.Z,null,"Kachery node ID"),c().createElement(v.Z,null,s?s.nodeId:"")),c().createElement(h.Z,null,c().createElement(v.Z,null,"Default feed ID"),c().createElement(v.Z,null,s?s.defaultFeedId:""))))};function S(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}const k=({workspaceUri:e,workspaceRoute:t,workspaceRouteDispatch:n,version:d})=>{const{width:u,height:g}=function(){const[e,t]=(0,r.useState)(S());return(0,r.useEffect)((()=>{function e(){t(S())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),p=g-52-2,m=u-0-2,b=(0,o.FO)().filter((e=>"WorkspaceView"===e.name))[0];if(!b)throw Error("Unable to find workspace view plugin");const[f,E]=(0,r.useState)(!1),[O,I]=(0,r.useReducer)(a.Z,(0,r.useMemo)((()=>({recordings:[],sortings:[]})),[])),j=(0,r.useCallback)((e=>{e.filter((e=>e.action)).forEach((e=>I(e.action)))}),[]),{feedUri:h,workspaceName:v}=(0,l.x)(e),w=(0,r.useMemo)((()=>({workspaceName:v})),[v]),{appendMessages:k}=(0,i.Rs)({feedUri:h,subfeedName:w,onMessages:j}),R=(0,r.useCallback)((e=>{k([e])}),[k]),M=(0,r.useCallback)((()=>{E(!0)}),[]),C=(0,r.useCallback)((()=>{E(!1)}),[]);return c().createElement("div",{style:{margin:0}},c().createElement(y,{onOpenSettings:M,workspaceRouteDispatch:n}),c().createElement("div",{style:{position:"absolute",top:52}},c().createElement(b.component,{width:m,height:p,workspace:O,workspaceDispatch:R,workspaceRoute:t,workspaceRouteDispatch:n})),c().createElement(s.Z,{open:f,onClose:C,style:{zIndex:9999}},c().createElement("span",null,c().createElement(U,{workspace:O,workspaceUri:e,version:d}))))};function R(e){e.registerPlugin({type:"MainWindow",name:"MainWindow",label:"Main Window",component:k})}},95849:(e,t,n)=>{"use strict";n.d(t,{kN:()=>a,qG:()=>p,GI:()=>d,CC:()=>l,Zl:()=>c,_S:()=>b,SF:()=>u,fG:()=>E,fB:()=>f,Sd:()=>m,FO:()=>O});var s=n(5443),i=n(69297);const r=(e,t)=>{if(e.min<=t&&t<e.max)return e;const n=e.max-e.min,s=Math.max(0,Math.floor(t-n/2));return{min:s,max:s+n}},c=(e,t)=>{var n,s,i,c;if("SetRecordingSelection"===t.type)return Object.assign({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{selectedElectrodeIds:t.selectedElectrodeIds.filter((t=>!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)))});if("SetVisibleElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((e=>t.visibleElectrodeIds.includes(e))):void 0});if("SetCurrentTimepoint"===t.type)return Object.assign(Object.assign({},e),{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?r(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object.assign(Object.assign({},e),{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){const i=9e6,r=e.currentTimepoint,c=e.timeRange;if(!c)return e;const l=null!==(n=t.direction)&&void 0!==n?n:"in",a=null!==(s=t.factor)&&void 0!==s?s:1.4,d="out"===l?1/a:a;if((c.max-c.min)/d>i)return e;let u;u=void 0===r||r<c.min?c.min:r>c.max?c.max:r;const g=o(c,d,u);return Object.assign(Object.assign({},e),{timeRange:g})}if("SetAmpScaleFactor"===t.type)return Object.assign(Object.assign({},e),{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){const n=null!==(i=t.direction)&&void 0!==i?i:"up",s=null!==(c=t.multiplier)&&void 0!==c?c:1.4,r="down"===n?1/s:s;return Object.assign(Object.assign({},e),{ampScaleFactor:(e.ampScaleFactor||1)*r})}return"SetCurrentTimepointVelocity"===t.type?Object.assign(Object.assign({},e),{animation:Object.assign(Object.assign({},e.animation||{}),{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object.assign(Object.assign({},e),{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},o=(e,t,n)=>{const s=n+(e.min-n)/t,i=n+(e.max-n)/t;return{min:Math.floor(s),max:Math.floor(i)}},l=(e,t)=>((t||{}).mergeGroups||[]).filter((t=>t.includes(e)))[0]||null,a=(e,t,n)=>n&&l(e,t)||e,d=(e,t)=>{const n=l(e,t);return!n||Math.min(...n)===e},u=(e,t)=>"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:t.selectedUnitIds.filter((t=>{var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>{var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?((e,t)=>{const n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object.assign(Object.assign({},e),{selectedUnitIds:(e.selectedUnitIds||[]).filter((e=>e!==n))}):Object.assign(Object.assign({},e),{selectedUnitIds:[...e.selectedUnitIds||[],n]}):Object.assign(Object.assign({},e),{selectedUnitIds:[n]})})(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?g(Object.assign(Object.assign({},e),{applyMerges:!e.applyMerges}),t.curation):c(e,t),g=(e,t)=>e.applyMerges&&t?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>d(e,t))):void 0}):e,p=e=>e.filter((e=>!e.disabled&&!e.development)),m=e=>p(e).filter((e=>"SortingView"===e.type)).map((e=>e)),b=e=>p(e).filter((e=>"RecordingView"===e.type)).map((e=>e)),f=e=>p(e).filter((e=>"SortingUnitView"===e.type)).map((e=>e)),E=e=>p(e).filter((e=>"SortingUnitMetric"===e.type)).map((e=>e)),O=()=>{const e=(0,s._m)();return(0,i.useMemo)((()=>e.filter((e=>"WorkspaceView"===e.type)).map((e=>e))),[e])}},46470:(e,t,n)=>{"use strict";n.d(t,{x:()=>s});const s=e=>{if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};const t=e.split("/"),n=t[2]||void 0,s=t[3]||void 0;return n&&s?{feedUri:`feed://${n}`,workspaceName:s}:{feedUri:void 0,workspaceName:void 0}}},6425:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const s=(e,t)=>{if("SET_CURATION"===t.type)return t.curation;if("ADD_UNIT_LABEL"===t.type){const n=t.unitId+"",s=(e.labelsByUnit||{})[n]||[];return s.includes(t.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[n]:[...s,t.label].sort()})})}if("REMOVE_UNIT_LABEL"===t.type){const n=t.unitId+"",s=(e.labelsByUnit||{})[n]||[];return s.includes(t.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[n]:s.filter((e=>e!==t.label))})}):e}return"MERGE_UNITS"===t.type?Object.assign(Object.assign({},e),{mergeGroups:c([...e.mergeGroups||[],t.unitIds])}):"UNMERGE_UNITS"===t.type?Object.assign(Object.assign({},e),{mergeGroups:c((e.mergeGroups||[]).map((e=>e.filter((e=>!t.unitIds.includes(e))))))}):e},i=(e,t)=>e.filter((e=>t.includes(e))),r=(e,t)=>[...e,...t.filter((t=>!e.includes(t)))].sort(),c=e=>{const t=e.map((e=>[...e]));let n=!0;for(;n;){n=!1;for(let e=0;e<t.length;e++){const s=t[e];for(let c=e+1;c<t.length;c++){const o=t[c];i(s,o).length>0&&(t[e]=r(s,o),t[c]=[],n=!0)}}}return t.filter((e=>e.length>=2))},o=(e,t)=>{switch(t.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==t.recording.recordingId)),t.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!t.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==t.sorting.sortingId)),t.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!t.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!t.recordingIds.includes(e.recordingId)))});case"ADD_UNIT_LABEL":case"REMOVE_UNIT_LABEL":case"MERGE_UNITS":case"UNMERGE_UNITS":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===t.sortingId?Object.assign(Object.assign({},e),{curation:s(e.curation||{},t)}):e))});default:return e}}}}]);