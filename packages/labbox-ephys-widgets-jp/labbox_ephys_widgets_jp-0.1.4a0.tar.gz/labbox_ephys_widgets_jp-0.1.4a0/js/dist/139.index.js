(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[139],{50725:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},3805:(e,t,n)=>{var r=n(67100).default;function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var c=o?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(n,i,c):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n},e.exports.default=e.exports,e.exports.__esModule=!0},67100:e=>{function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},27949:(e,t,n)=>{"use strict";function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return null==t?e:function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];e.apply(this,r),t.apply(this,r)}}),(function(){}))}n.d(t,{Z:()=>r})},28316:(e,t,n)=>{"use strict";function r(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];var i=this,c=function(){e.apply(i,s)};clearTimeout(t),t=setTimeout(c,n)}return r.clear=function(){clearTimeout(t)},r}n.d(t,{Z:()=>r})},30983:(e,t,n)=>{"use strict";n.r(t),n.d(t,{capitalize:()=>r.Z,createChainedFunction:()=>s.Z,createSvgIcon:()=>o.Z,debounce:()=>i.Z,deprecatedPropType:()=>c,isMuiElement:()=>a.Z,ownerDocument:()=>l.Z,ownerWindow:()=>d.Z,requirePropFactory:()=>u,setRef:()=>g.Z,unstable_useId:()=>y,unsupportedProp:()=>h,useControlled:()=>f.Z,useEventCallback:()=>p.Z,useForkRef:()=>m.Z,useIsFocusVisible:()=>v.Z});var r=n(1514),s=n(27949),o=n(41004),i=n(28316);function c(e,t){return function(){return null}}var a=n(42034),l=n(63283),d=n(93441);function u(e){return function(){return null}}var g=n(80195);function h(e,t,n,r,s){return null}var f=n(10652),p=n(97812),m=n(28160),b=n(69297);function y(e){var t=b.useState(e),n=t[0],r=t[1],s=e||n;return b.useEffect((function(){null==n&&r("mui-".concat(Math.round(1e5*Math.random())))}),[n]),s}var v=n(38705)},42034:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(69297);function s(e,t){return r.isValidElement(e)&&-1!==t.indexOf(e.type.muiName)}},63283:(e,t,n)=>{"use strict";function r(e){return e&&e.ownerDocument||document}n.d(t,{Z:()=>r})},93441:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(63283);function s(e){return(0,r.Z)(e).defaultView||window}},6269:(e,t,n)=>{"use strict";var r=n(50725),s=n(3805);t.Z=void 0;var o=s(n(69297)),i=(0,r(n(62265)).default)(o.createElement("path",{d:"M10 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12-8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-4 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"Grain");t.Z=i},62265:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(30983)},3527:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(69297),s=n.n(r),o=n(31315),i=n.n(o);const c=e=>{var t,n,o;const{width:c,height:a,initialPosition:l,onChange:d,adjustable:u=!0,positionFromRight:g=!1}=e,[h,f]=(0,r.useState)(l);if(!e.children)throw Error("Unexpected: no props.children");let p,m;if(Array.isArray(e.children)){const t=e.children.filter((e=>void 0!==e));p=t[0],m=t[1]||null}else p=e.children,m=null;if(!m)return s().createElement(p.type,Object.assign({},p.props,{width:c,height:a}));const b=g?c-h:h,y=u?null!==(t=e.gripThickness)&&void 0!==t?t:10:0,v=u?null!==(n=e.gripInnerThickness)&&void 0!==n?n:4:0,E=u?null!==(o=e.gripMargin)&&void 0!==o?o:2:0,x=b-y/2-E,_=c-x-y-2*E;let j={top:0,left:0,width:c,height:a},O={left:0,top:0,width:x,height:a,zIndex:0,overflowY:"auto",overflowX:"hidden"},w={left:x+y+2*E,top:0,width:_,height:a,zIndex:0,overflowY:"auto",overflowX:"hidden"},S={left:0,top:0,width:y+2*E,height:a,backgroundColor:"transparent",cursor:"col-resize",zIndex:9998},C={left:E,top:0,width:y,height:a,background:"rgb(230, 230, 230)",cursor:"col-resize"},R={top:0,left:(y-v)/2,width:v,height:a,background:"gray",cursor:"col-resize"};return s().createElement("div",{className:"splitter",style:Object.assign(Object.assign({},j),{position:"relative"})},s().createElement("div",{key:"child1",style:Object.assign(Object.assign({},O),{position:"absolute"}),className:"SplitterChild"},s().createElement(p.type,Object.assign({},p.props,{width:x,height:a}))),u&&s().createElement(i(),{key:"drag",position:{x:b-y/2-E,y:0},axis:"x",onDrag:(e,t)=>{},onStop:(e,t)=>((e,t)=>{const n=t.x;if(n===b)return;const r=g?c-n:n;f(r),d&&d(r)})(0,t)},s().createElement("div",{style:Object.assign(Object.assign({},S),{position:"absolute"})},s().createElement("div",{style:Object.assign(Object.assign({},C),{position:"absolute"})},s().createElement("div",{style:Object.assign(Object.assign({},R),{position:"absolute"})})))),s().createElement("div",{key:"child2",style:Object.assign(Object.assign({},w),{position:"absolute"}),className:"SplitterChild"},s().createElement(m.type,Object.assign({},m.props,{width:_,height:a}))))}},46826:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(46388),s=n.n(r),o=n(69297);const i={data:{},activeFetches:{}},c=(e,t)=>{switch(t.type){case"clear":return i;case"startFetch":return Object.assign(Object.assign({},e),{activeFetches:Object.assign(Object.assign({},e.activeFetches),{[t.queryHash]:!0})});case"setData":return Object.assign(Object.assign({},e),{data:Object.assign(Object.assign({},e.data),{[t.queryHash]:t.data}),activeFetches:Object.assign(Object.assign({},e.activeFetches),{[t.queryHash]:!1})});default:throw Error("Unexpected action in fetchCacheReducer")}},a=e=>s()(e),l=e=>{const[t,n]=(0,o.useState)(0);t<0&&console.info(t);const r=(0,o.useRef)(e),[s,l]=(0,o.useReducer)(c,i),d=(0,o.useRef)({});(0,o.useEffect)((()=>{e!==r.current&&(r.current=e,l({type:"clear"}))}),[e]);const u=(0,o.useMemo)((()=>e=>{const t=a(e),r=s.data[t];return void 0===r&&(d.current[t]=e,n((e=>e+1))),r}),[s.data]),g=(0,o.useMemo)((()=>t=>{const n=a(t);void 0===s.data[n]&&(s.activeFetches[n]||(l({type:"startFetch",queryHash:n}),e(t).then((e=>{l({type:"setData",queryHash:n,data:e})})).catch((e=>{console.warn(e),console.warn("Problem fetching data",t)}))))}),[s.data,s.activeFetches,e]);return(0,o.useEffect)((()=>{const e=Object.keys(d.current);if(0!==e.length){for(let t of e)g(d.current[t]);d.current={}}})),(0,o.useMemo)((()=>({get:u})),[u])}},15743:(e,t,n)=>{"use strict";n.d(t,{F0:()=>o,ZL:()=>i});var r=n(5443),s=n(69297);const o=e=>{const{result:t}=(0,r.lG)(e?"createjob_get_recording_info":"",{recording_object:e},{useClientCache:!0});return t},i=e=>{const t=(0,s.useContext)(r.Zo),n=(0,s.useRef)({}),[,o]=(0,s.useState)(0),i={};return e.forEach((e=>{const r=e.recordingId;if(!n.current[r]){const s=t.createHitherJob("createjob_get_recording_info",{recording_object:e.recordingObject},{useClientCache:!0});n.current[r]=s,s.wait().then((()=>{o((e=>e+1))})).catch((()=>{o((e=>e+1))}))}n.current[r].result&&(i[r]=n.current[r].result)})),i}},21139:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>S});var r=n(6269),s=n(69297),o=n.n(s),i=n(3527),c=n(73681),a=n(24059),l=n(50460),d=n(15743),u=n(59739),g=n(83711),h=n(89382);const f={BASE:"rgb(0, 0, 255)",SELECTED:"rgb(196, 196, 128)",HOVER:"rgb(128, 128, 255)",SELECTEDHOVER:"rgb(200, 200, 196)",DRAGGED:"rgb(0, 0, 196)",DRAGGEDSELECTED:"rgb(180, 180, 150)",DRAGRECT:"rgba(196, 196, 196, 0.5)"},p={electrodeBoundingBoxes:[],dragRegion:null,draggedElectrodeIds:[],hoveredElectrodeId:null,radius:0,pixelRadius:0,lastProps:{electrodes:[],selectedElectrodeIds:[],onSelectedElectrodeIdsChanged:()=>{},width:0,height:0}},m=new Map,b=(e,t)=>{const n=e.getState(),{width:r,height:s,electrodes:o}=t,i=r-20,c=s-20,l=i/c,d=(e=>{const t=JSON.stringify(e),n=m.get(t);if(void 0!==n)return n;let r=Number.MAX_VALUE;e.forEach((t=>{e.forEach((e=>{const n=(0,u.KOy)([t.x-e.x,t.y-e.y]);0!==n&&(r=Math.min(r,n))}))}));const s=.4*r;return m.set(t,s),s})(o);let f,p=((e,t)=>({xmin:(0,h.Gt)(e.map((e=>e.x)))-t,xmax:(0,h.lR)(e.map((e=>e.x)))+t,ymin:(0,h.Gt)(e.map((e=>e.y)))-t,ymax:(0,h.lR)(e.map((e=>e.y)))+t}))(o,d),b=(0,g.dz)(p)/(0,g.Cr)(p),y=o;b>1!=l>1&&(y=o.map((e=>Object.assign(Object.assign({},e),{x:e.y,y:-e.x}))),p={xmin:p.ymin,xmax:p.ymax,ymin:-p.xmax,ymax:-p.xmin},b=(0,g.dz)(p)/(0,g.Cr)(p)),f=b>l?i/(0,g.dz)(p):c/(0,g.Cr)(p),f=Math.min(f,32/d);const v=(r-(0,g.dz)(p)*f)/2,E=(s-(0,g.Cr)(p)*f)/2,x=(0,a.As)((e=>[v+(e[0]-p.xmin)*f,E+(e[1]-p.ymin)*f])),_=y.map((e=>{const t=e.x,n=e.y;return{label:e.label,id:parseInt(e.label),x:t,y:n,br:(0,g.jU)([t,n],d,d),color:e.color}}));e.setTransformMatrix(x);const j=(0,g.ur)(x,[d,0])[0];e.setState(Object.assign(Object.assign({},n),{electrodeBoundingBoxes:_,radius:d,pixelRadius:j,lastProps:t})),e.scheduleRepaint()},y=(e,t,n)=>{var r,s;e.wipe();const o=n.pixelRadius>5;for(let i of n.electrodeBoundingBoxes){const c=(null===(r=t.selectedElectrodeIds)||void 0===r?void 0:r.includes(i.id))||!1,a=n.hoveredElectrodeId===i.id,l=(null===(s=n.draggedElectrodeIds)||void 0===s?void 0:s.includes(i.id))||!1,d=i.color||(c?l?f.DRAGGEDSELECTED:a?f.SELECTEDHOVER:f.SELECTED:l?f.DRAGGED:a?f.HOVER:f.BASE);if(e.fillEllipse(i.br,{color:d}),o){const t=[f.SELECTED,f.DRAGGEDSELECTED,f.HOVER,f.SELECTEDHOVER].includes(d)?"rgb(32, 32, 32)":"rgb(228, 228, 228)";e.drawText({rect:i.br,alignment:{Horizontal:"AlignCenter",Vertical:"AlignCenter"},font:{pixelSize:n.pixelRadius,family:"Arial"},pen:{color:t},brush:{color:t},text:i.label})}}n.dragRegion&&e.fillRect(n.dragRegion,{color:f.DRAGRECT})},v=(e,t)=>{var n,r,s,o;const i=e.getState();if(null===i)return;const c=null!==(n=i.electrodeBoundingBoxes.filter((e=>(0,g.Qv)(e.br,t.dragRect))))&&void 0!==n?n:[];if(t.released){const n=t.shift&&null!==(s=null===(r=e.getProps())||void 0===r?void 0:r.selectedElectrodeIds)&&void 0!==s?s:[];null===(o=e.getProps())||void 0===o||o.onSelectedElectrodeIdsChanged([...n,...c.map((e=>e.id))]),e.setState(Object.assign(Object.assign({},i),{dragRegion:null,draggedElectrodeIds:[]}))}else e.setState(Object.assign(Object.assign({},i),{dragRegion:t.dragRect,draggedElectrodeIds:c.map((e=>e.id))}));e.scheduleRepaint()},E=(e,t)=>{var n,r,s;if(e.type!==l.II.Release)return;const o=t.getState();if(null===o)return;const i=o.electrodeBoundingBoxes.filter((t=>(0,g.Xz)(e.point,[t.x,t.y],o.radius))).map((e=>e.id));if(0===i.length)return void(e.modifiers.ctrl||e.modifiers.shift||o.dragRegion||null===(n=t.getProps())||void 0===n||n.onSelectedElectrodeIdsChanged([]));const c=i[0],a=(null===(r=t.getProps())||void 0===r?void 0:r.selectedElectrodeIds)||[],d=e.modifiers.ctrl?a.includes(c)?a.filter((e=>e!==c)):[...a,c]:e.modifiers.shift?[...a,c]:[c];null===(s=t.getProps())||void 0===s||s.onSelectedElectrodeIdsChanged(d),t.scheduleRepaint()},x=(e,t)=>{if(e.type!==l.II.Move)return;const n=t.getState();if(null===n)return;const r=n.electrodeBoundingBoxes.filter((t=>(0,g.Xz)(e.point,[t.x,t.y],n.radius))).map((e=>e.id));t.setState(Object.assign(Object.assign({},n),{hoveredElectrodeId:0===r.length?null:r[0]})),t.scheduleRepaint()},_=()=>new l.Fw(y,b,p,{dragHandlers:[v],discreteMouseEventHandlers:[E,x]}),j=(e,t)=>e+1,O=({recording:e,timeseriesData:t,selection:n,width:r,height:i})=>{const c=n.selectedElectrodeIds,[u,g]=(0,s.useState)({}),[h,f]=(0,s.useReducer)(j,0);(0,s.useEffect)((()=>{const e=n.currentTimepoint;if(void 0===e||!c||!t)return void g({});const r={};for(let n of c){const s=t.getChannelData(n,Math.floor(e),Math.floor(e)+1,1);r[n+""]=s[0]}g(r),Object.values(r).filter((e=>isNaN(e))).length>0&&setTimeout((()=>{f({type:"increment"})}),500)}),[t,n,c,g,h,f]);const p=(0,d.F0)(e.recordingObject),m={electrodes:(0,s.useMemo)((()=>{const e=(n.ampScaleFactor||1)/((null==p?void 0:p.noise_level)||1)*1/5,t=t=>{const n=u[t];return isNaN(n)?"lightgray":(e=>{if(e<=0)return"black";if(e>=1)return"white";const t=Math.floor(255*e);return`rgb(${t}, ${t}, ${t})`})(-n*e)};return(p?((e,t)=>{if(e&&t&&t.length!==e.length)throw Error("Electrode ID count does not match location count.");return t.map(((t,n)=>{const r=e[n];return{label:t+"",x:r[0],y:r[1],electrodeId:t}}))})(p.geom,p.channel_ids):[]).map((e=>Object.assign(Object.assign({},e),{id:e.electrodeId,color:t(e.electrodeId)})))}),[p,u,n.ampScaleFactor]),selectedElectrodeIds:(0,s.useMemo)((()=>n.selectedElectrodeIds||[]),[n.selectedElectrodeIds]),onSelectedElectrodeIdsChanged:(0,s.useMemo)((()=>e=>{}),[]),width:r,height:i},b=(0,l.sJ)(_,m),y=(0,l.jU)([b]);return o().createElement(a.ZP,Object.assign({layers:y},{width:r,height:i}))},w=({recording:e,recordingInfo:t,sorting:n,selection:r,selectionDispatch:a,width:l,height:d})=>{var u;const g=(0,s.useCallback)((e=>{a({type:"SetCurrentTimepointVelocity",velocity:0})}),[a]),h=(0,s.useCallback)((e=>{a({type:"SetCurrentTimepointVelocity",velocity:50})}),[a]),f=(0,c.Z)(e.recordingObject,t);return o().createElement(i.Z,{width:l||400,height:d||400,initialPosition:150},o().createElement("div",null,(null===(u=r.animation)||void 0===u?void 0:u.currentTimepointVelocity)?o().createElement("button",{onClick:g},"Stop animation"):o().createElement("button",{onClick:h},"Start animation")),o().createElement(O,Object.assign({},{recording:e,timeseriesData:f,selection:r},{width:0,height:0})))};function S(e){e.registerPlugin({type:"SortingView",name:"FireTrack",label:"FireTrack",priority:50,component:w,icon:o().createElement(r.Z,null)})}},73681:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(5443),s=n(69297),o=n(46826),i=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}a((r=r.apply(e,t||[])).next())}))};const c=(0,r.zy)({maxSimultaneous:4,method:"stack"}),a=(e,t)=>{const n=(0,s.useContext)(r.Zo),a=(0,s.useMemo)((()=>t=>i(void 0,void 0,void 0,(function*(){switch(t.type){case"dataSegment":return yield(r={hither:n,recordingObject:e,ds_factor:t.ds_factor,segment_num:t.segment_num,segment_size:t.segment_size},i(void 0,void 0,void 0,(function*(){const{hither:e,recordingObject:t,ds_factor:n,segment_num:s,segment_size:o}=r;return(yield e.createHitherJob("createjob_get_timeseries_segment",{recording_object:t,ds_factor:n,segment_num:s,segment_size:o},{useClientCache:!0,calculationPool:c}).wait()).traces})))}var r}))),[n,e]),l=(0,o.Z)(a),d=t.channel_ids.length,u=Math.ceil(1e5/d),g=(0,s.useMemo)((()=>(e,n,r,s)=>{const o=Math.floor(Math.max(0,n)/u),i=Math.ceil((Math.min(r,t.num_frames)-1)/u),c=[];for(let e=o;e<=i;e++)e===o&&e===i?c.push({segment_num:e,t1:e*u,t2:(e+1)*u,src1:n-e*u,src2:r-e*u,dst1:0,dst2:r-n}):e===o?c.push({segment_num:e,t1:e*u,t2:(e+1)*u,src1:n-e*u,src2:u,dst1:0,dst2:u+e*u-n}):e===i?c.push({segment_num:e,t1:e*u,t2:(e+1)*u,src1:0,src2:r-e*u,dst1:e*u-n,dst2:r-n}):c.push({segment_num:e,t1:e*u,t2:(e+1)*u,src1:0,src2:u,dst1:e*u-n,dst2:(e+1)*u-n});const a=[];if(1===s){for(let e=n;e<r;e++)a.push(NaN);for(let t of c){const n=l.get({type:"dataSegment",ds_factor:s,segment_num:t.segment_num,segment_size:u});if(n)for(let r=0;r<t.src2-t.src1;r++)a[t.dst1+r]=n[e][t.src1+r]}}else{for(let e=n;e<r;e++)a.push(NaN),a.push(NaN);for(let t of c){const n=l.get({type:"dataSegment",ds_factor:s,segment_num:t.segment_num,segment_size:u});if(n)for(let r=0;r<t.src2-t.src1;r++)a[2*(t.dst1+r)]=n[e][2*(t.src1+r)],a[2*(t.dst1+r)+1]=n[e][2*(t.src1+r)+1]}}return a}),[l,t.num_frames,u]);return(0,s.useMemo)((()=>({getChannelData:g,requestChannelData:g,numChannels:()=>t.channel_ids.length,numTimepoints:()=>t.num_frames,getSampleRate:()=>t.sampling_frequency})),[g,t])}}}]);