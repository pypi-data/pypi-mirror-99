(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[923],{4923:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>w,useWorkspaceRoute:()=>k});var t=s(22954),i=s(5443),n=s(69297),a=s.n(n),o=s(95849),c=s(46470),g=s(6425),d=s(85582);const u=(e,r)=>{const s=e.pathname.split("/"),t=d.parse(e.search.slice(1)).workspace||"default",i=null==r?void 0:r.defaultFeedId,n=t.startsWith("workspace://")?t:i?`workspace://${i}/${t}`:void 0,a=s[1]||"recordings";if(!["recordings","recording","sorting"].includes(a))throw Error(`Invalid page: ${a}`);switch(a){case"recordings":return{workspaceUri:n,page:a};case"recording":return{workspaceUri:n,page:a,recordingId:s[2]};case"sorting":return{workspaceUri:n,page:a,recordingId:s[2]||"",sortingId:s[3]||""};default:return{workspaceUri:n,page:"recordings"}}};var l=e=>{const r=Object.keys(e);return 0===r.length?"":"?"+r.map((r=>encodeURIComponent(r)+"="+encodeURIComponent(e[r]))).join("&")},p=s(40788),b=s(4791),f=s(52978);const h={palette:{primary:p.Z,secondary:b.Z},overrides:{MuiAccordionSummary:{root:{"&$expanded":{minHeight:0,maxHeight:30,paddingTop:10},minHeight:0}},MuiToolbar:{regular:{minHeight:48,"@media(min-width:600px)":{minHeight:48}}},MuiTabs:{root:{minHeight:30,maxHeight:30}},MuiTab:{root:{minHeight:30,maxHeight:30,padding:"6px 0px"}}}},I=(0,f.Z)(h);var m=s(19973);const k=(e,r,s)=>{const t=(0,n.useMemo)((()=>s=>{const t=(e=>{const r={};switch(e.workspaceUri&&(r.workspace=e.workspaceUri),e.page){case"recordings":return{pathname:"/",search:l(r)};case"recording":return{pathname:`/recording/${e.recordingId}`,search:l(r)};case"sorting":return{pathname:`/sorting/${e.recordingId}/${e.sortingId}`,search:l(r)}}})(((e,r)=>{let s=e;switch(r.type){case"gotoRecordingsPage":s={page:"recordings",workspaceUri:e.workspaceUri};break;case"gotoRecordingPage":s={page:"recording",recordingId:r.recordingId,workspaceUri:e.workspaceUri};break;case"gotoSortingPage":s={page:"sorting",recordingId:r.recordingId,sortingId:r.sortingId,workspaceUri:e.workspaceUri}}return s})(u(r.location,{}),s));t.pathname===e.pathname&&t.search===e.search||r.push(t)}),[e,r]);return[(0,n.useMemo)((()=>u(e,{})),[e]),t]},w=({workspaceUri:e})=>{const r=(0,i._m)(),s=(0,n.useCallback)((e=>{e.forEach((e=>{e.action&&h(e.action)}))}),[]),{feedUri:d,workspaceName:u}=(0,c.x)(e),l=(0,n.useMemo)((()=>({workspaceName:u||""})),[u]),{appendMessages:p,loadedInitialMessages:b}=(0,i.Rs)({feedUri:d,subfeedName:l,onMessages:s}),[f,h]=(0,n.useReducer)(g.Z,{recordings:[],sortings:[]}),w=(0,n.useCallback)((e=>{p([{action:e}])}),[p]),[O,U]=(0,n.useState)(null),[E,j]=(0,n.useState)(void 0),[R,_]=(0,n.useState)(void 0),[N,v]=(0,n.useState)(0),y=a().useCallback((e=>{U(e)}),[]);(0,n.useEffect)((()=>{O&&(E!==O.offsetWidth&&j(O.offsetWidth),R!==O.offsetHeight&&_(O.offsetHeight))}),[O,E,R,j,_,N]),function(e,r){const s=(0,n.useRef)();(0,n.useEffect)((()=>{s.current=e})),(0,n.useEffect)((()=>{{const e=setInterval((function(){void 0!==(null==s?void 0:s.current)&&(null==s||s.current())}),r);return()=>clearInterval(e)}}),[r])}((()=>{v(N+1)}),1e3);const[S,T]=(0,n.useState)({pathname:"",search:"?"}),[M,D]=(0,n.useState)([]),G=(0,n.useMemo)((()=>({location:S,push:e=>{D([...M,S]),T(e)}})),[S,M]),[x,C]=k(S,G,e);return a().createElement(t.Z,{theme:I},a().createElement("div",{ref:y,className:"WorkspaceViewWrapper",style:{position:"absolute",left:0,right:0,top:0,bottom:0}},a().createElement(m.Z,Object.assign({},{defaultFeedId:"",workspace:f,workspaceDispatch:w,plugins:(0,o.qG)(r),workspaceRoute:x,workspaceRouteDispatch:C,width:E||700,height:R||700}))))}},46470:(e,r,s)=>{"use strict";s.d(r,{x:()=>t});const t=e=>{if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};const r=e.split("/"),s=r[2]||void 0,t=r[3]||void 0;return s&&t?{feedUri:`feed://${s}`,workspaceName:t}:{feedUri:void 0,workspaceName:void 0}}},6425:(e,r,s)=>{"use strict";s.d(r,{Z:()=>o});const t=(e,r)=>{if("SET_CURATION"===r.type)return r.curation;if("ADD_UNIT_LABEL"===r.type){const s=r.unitId+"",t=(e.labelsByUnit||{})[s]||[];return t.includes(r.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[s]:[...t,r.label].sort()})})}if("REMOVE_UNIT_LABEL"===r.type){const s=r.unitId+"",t=(e.labelsByUnit||{})[s]||[];return t.includes(r.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[s]:t.filter((e=>e!==r.label))})}):e}return"MERGE_UNITS"===r.type?Object.assign(Object.assign({},e),{mergeGroups:a([...e.mergeGroups||[],r.unitIds])}):"UNMERGE_UNITS"===r.type?Object.assign(Object.assign({},e),{mergeGroups:a((e.mergeGroups||[]).map((e=>e.filter((e=>!r.unitIds.includes(e))))))}):e},i=(e,r)=>e.filter((e=>r.includes(e))),n=(e,r)=>[...e,...r.filter((r=>!e.includes(r)))].sort(),a=e=>{const r=e.map((e=>[...e]));let s=!0;for(;s;){s=!1;for(let e=0;e<r.length;e++){const t=r[e];for(let a=e+1;a<r.length;a++){const o=r[a];i(t,o).length>0&&(r[e]=n(t,o),r[a]=[],s=!0)}}}return r.filter((e=>e.length>=2))},o=(e,r)=>{switch(r.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==r.recording.recordingId)),r.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!r.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==r.sorting.sortingId)),r.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!r.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!r.recordingIds.includes(e.recordingId)))});case"ADD_UNIT_LABEL":case"REMOVE_UNIT_LABEL":case"MERGE_UNITS":case"UNMERGE_UNITS":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===r.sortingId?Object.assign(Object.assign({},e),{curation:t(e.curation||{},r)}):e))});default:return e}}}}]);