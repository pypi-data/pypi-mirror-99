(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[944],{87944:(e,t,i)=>{"use strict";i.r(t),i.d(t,{activate:()=>j});var n=i(6269),s=i(69297),c=i.n(s),l=i(81178),r=i(90667),o=i(3527),a=i(15743),d=i(39110);const u={paddingLeft:6,paddingRight:6,paddingTop:4,paddingBottom:4},m=e=>{const t=(0,s.useMemo)((()=>({width:e.width,height:e.height,overflow:"hidden"})),[e.width,e.height]),i=(0,s.useMemo)((()=>{const t=[];for(let i of e.customActions||[])t.push({type:i.type||"button",title:i.title,onClick:i.callback,icon:i.icon,selected:i.selected});return t}),[e.customActions]);return c().createElement("div",{className:"ViewToolBar",style:Object.assign({position:"absolute"},t)},i.map(((e,t)=>{if("button"===e.type){let i="inherit";return e.selected&&(i="primary"),c().createElement(d.Z,{title:e.title,onClick:e.onClick,key:t,color:i,style:u},e.icon)}return"divider"===e.type?c().createElement("hr",{key:t}):c().createElement("span",{key:t})})))};var g=i(5443),p=i(71866),b=i(95849),h=i(47449);const v=(0,g.zy)({maxSimultaneous:6}),y=({sorting:e,recording:t,unitId:i,selection:n,selectionDispatch:l,width:r,height:o,noiseLevel:a,customActions:d})=>{const{result:u,job:m}=(0,g.lG)("createjob_fetch_average_waveform_2",{sorting_object:e.sortingObject,recording_object:t.recordingObject,unit_id:(0,b.kN)(i,e.curation,n.applyMerges)},{useClientCache:!0,calculationPool:v}),y=(0,s.useMemo)((()=>({})),[]);if(!u)return c().createElement(p.Z,{job:m,width:r,height:o});const f=n.visibleElectrodeIds,j=u.channel_ids.filter((e=>!f||f.includes(e))),E=u.channel_locations.filter(((e,t)=>!f||f.includes(u.channel_ids[t])));return c().createElement(h.Z,{waveform:u.average_waveform,layoutMode:n.waveformsMode||"geom",noiseLevel:a,electrodeIds:j,electrodeLocations:E,samplingFrequency:u.sampling_frequency,width:r,height:o,selection:n,customActions:d,selectionDispatch:l,electrodeOpts:y})},f=e=>{const{recording:t,sorting:i,selection:n,selectionDispatch:d,width:u=600,height:g=650}=e,p=((0,a.F0)(t.recordingObject)||{}).noise_level||1,[b,h]=(0,s.useState)(null),v=(0,s.useMemo)((()=>e=>c().createElement(y,Object.assign({},{sorting:i,recording:t,unitId:e,selection:n,selectionDispatch:d},{width:180,height:250,noiseLevel:p,customActions:b||[]}))),[i,t,n,d,p,b]),f=(0,s.useCallback)((()=>{d({type:"ScaleAmpScaleFactor",direction:"up"})}),[d]),j=(0,s.useCallback)((()=>{d({type:"ScaleAmpScaleFactor",direction:"down"})}),[d]);return(0,s.useEffect)((()=>{const e=[{type:"button",callback:f,title:"Scale amplitude up [up arrow]",icon:c().createElement(l.ZTc,null),keyCode:38},{type:"button",callback:j,title:"Scale amplitude down [down arrow]",icon:c().createElement(l.NWQ,null),keyCode:40}];h(e)}),[f,j]),u?c().createElement("div",null,c().createElement(o.Z,{width:u,height:g,initialPosition:36,adjustable:!1},c().createElement(m,{width:36,height:g,customActions:b}),c().createElement(r.Z,{sorting:i,selection:n,selectionDispatch:d,unitComponent:v}))):c().createElement("div",null,"No width")};function j(e){e.registerPlugin({type:"SortingView",name:"AverageWaveforms",label:"Average waveforms",priority:50,defaultExpanded:!1,component:f,singleton:!0,icon:c().createElement(n.Z,null)})}},71866:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(83334),s=i(53167),c=i(69297),l=i.n(c);const r=({job:e,message:t="",width:i=200,height:c=200})=>e?l().createElement(n.Z,{display:"flex",width:i,height:c},l().createElement(n.Z,{m:"auto"},"running"===e.status?l().createElement("span",null,"[",t,"] ",l().createElement(s.Z,null)):"error"===e.status?l().createElement("span",null,"Error: ",e.error_message," [",t,"]"):"pending"===e.status?l().createElement("span",null,t):l().createElement("span",null,"[",t,"] ",e.status))):l().createElement("div",null,"No job")},90667:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(81459),s=i(95898),c=i(69297),l=i.n(c),r=i(95849),o=i(10051);const a=({sorting:e,selection:t,selectionDispatch:i,unitComponent:a})=>{const[d,u]=(0,c.useState)(30),m=(0,o.D)(e.sortingObject,e.recordingObject),g=t.visibleUnitIds;let p=(m?m.unit_ids:[]).filter((e=>!g||g.includes(e))).filter((i=>!t.applyMerges||(0,r.GI)(i,e.curation))),b=!1;p.length>d&&(p=p.slice(0,d),b=!0);const h=(0,c.useCallback)((e=>{const t=Number(e.currentTarget.dataset.unitId);i({type:"UnitClicked",unitId:t,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey})}),[i]);return l().createElement(n.Z,{container:!0},p.map((e=>{var i;return l().createElement(n.Z,{key:e,item:!0},l().createElement("div",{className:"plotWrapperStyle"},l().createElement("div",{"data-unit-id":e,className:(null===(i=t.selectedUnitIds)||void 0===i?void 0:i.includes(e))?"plotSelectedStyle":"plotUnselectedStyle",onClick:h},l().createElement("div",{className:"plotUnitLabel"},l().createElement("div",null,"Unit ",e)),a(e))))})),b&&l().createElement("div",{className:"plotWrapperStyle"},l().createElement("div",{className:"plotWrapperStyleButton"},l().createElement(s.Z,{onClick:()=>{u(d+60)}},"Show more units"))))}},10051:(e,t,i)=>{"use strict";i.d(t,{D:()=>c,h:()=>l});var n=i(5443),s=i(69297);const c=(e,t)=>{const{result:i}=(0,n.lG)(e?"createjob_get_sorting_info":"",{sorting_object:e,recording_object:t},{useClientCache:!0});return i},l=e=>{const t=(0,s.useContext)(n.Zo),i=(0,s.useRef)({}),[,c]=(0,s.useState)(0),l={};return e.forEach((e=>{const n=e.sortingId;if(!i.current[n]){const s=t.createHitherJob("createjob_get_sorting_info",{recording_object:e.recordingObject,sorting_object:e.sortingObject},{useClientCache:!0});i.current[n]=s,s.wait().then((()=>{c((e=>e+1))})).catch((()=>{c((e=>e+1))}))}i.current[n].result&&(l[n]=i.current[n].result)})),l}},95849:(e,t,i)=>{"use strict";i.d(t,{kN:()=>a,qG:()=>g,GI:()=>d,CC:()=>o,Zl:()=>l,_S:()=>b,SF:()=>u,fG:()=>v,fB:()=>h,Sd:()=>p,FO:()=>y});var n=i(5443),s=i(69297);const c=(e,t)=>{if(e.min<=t&&t<e.max)return e;const i=e.max-e.min,n=Math.max(0,Math.floor(t-i/2));return{min:n,max:n+i}},l=(e,t)=>{var i,n,s,l;if("SetRecordingSelection"===t.type)return Object.assign({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{selectedElectrodeIds:t.selectedElectrodeIds.filter((t=>!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)))});if("SetVisibleElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((e=>t.visibleElectrodeIds.includes(e))):void 0});if("SetCurrentTimepoint"===t.type)return Object.assign(Object.assign({},e),{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?c(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object.assign(Object.assign({},e),{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){const s=9e6,c=e.currentTimepoint,l=e.timeRange;if(!l)return e;const o=null!==(i=t.direction)&&void 0!==i?i:"in",a=null!==(n=t.factor)&&void 0!==n?n:1.4,d="out"===o?1/a:a;if((l.max-l.min)/d>s)return e;let u;u=void 0===c||c<l.min?l.min:c>l.max?l.max:c;const m=r(l,d,u);return Object.assign(Object.assign({},e),{timeRange:m})}if("SetAmpScaleFactor"===t.type)return Object.assign(Object.assign({},e),{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){const i=null!==(s=t.direction)&&void 0!==s?s:"up",n=null!==(l=t.multiplier)&&void 0!==l?l:1.4,c="down"===i?1/n:n;return Object.assign(Object.assign({},e),{ampScaleFactor:(e.ampScaleFactor||1)*c})}return"SetCurrentTimepointVelocity"===t.type?Object.assign(Object.assign({},e),{animation:Object.assign(Object.assign({},e.animation||{}),{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object.assign(Object.assign({},e),{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},r=(e,t,i)=>{const n=i+(e.min-i)/t,s=i+(e.max-i)/t;return{min:Math.floor(n),max:Math.floor(s)}},o=(e,t)=>((t||{}).mergeGroups||[]).filter((t=>t.includes(e)))[0]||null,a=(e,t,i)=>i&&o(e,t)||e,d=(e,t)=>{const i=o(e,t);return!i||Math.min(...i)===e},u=(e,t)=>"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:t.selectedUnitIds.filter((t=>{var i;return!e.visibleUnitIds||(null===(i=e.visibleUnitIds)||void 0===i?void 0:i.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>{var i;return null===(i=t.visibleUnitIds)||void 0===i?void 0:i.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?((e,t)=>{const i=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(i)?Object.assign(Object.assign({},e),{selectedUnitIds:(e.selectedUnitIds||[]).filter((e=>e!==i))}):Object.assign(Object.assign({},e),{selectedUnitIds:[...e.selectedUnitIds||[],i]}):Object.assign(Object.assign({},e),{selectedUnitIds:[i]})})(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?m(Object.assign(Object.assign({},e),{applyMerges:!e.applyMerges}),t.curation):l(e,t),m=(e,t)=>e.applyMerges&&t?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>d(e,t))):void 0}):e,g=e=>e.filter((e=>!e.disabled&&!e.development)),p=e=>g(e).filter((e=>"SortingView"===e.type)).map((e=>e)),b=e=>g(e).filter((e=>"RecordingView"===e.type)).map((e=>e)),h=e=>g(e).filter((e=>"SortingUnitView"===e.type)).map((e=>e)),v=e=>g(e).filter((e=>"SortingUnitMetric"===e.type)).map((e=>e)),y=()=>{const e=(0,n._m)();return(0,s.useMemo)((()=>e.filter((e=>"WorkspaceView"===e.type)).map((e=>e))),[e])}}}]);