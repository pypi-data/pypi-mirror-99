(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[92],{50725:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},3805:(e,t,r)=>{var o=r(67100).default;function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var s=i?Object.getOwnPropertyDescriptor(e,c):null;s&&(s.get||s.set)?Object.defineProperty(r,c,s):r[c]=e[c]}return r.default=e,t&&t.set(e,r),r},e.exports.default=e.exports,e.exports.__esModule=!0},67100:e=>{function t(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},27949:(e,t,r)=>{"use strict";function o(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return null==t?e:function(){for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];e.apply(this,o),t.apply(this,o)}}),(function(){}))}r.d(t,{Z:()=>o})},28316:(e,t,r)=>{"use strict";function o(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function o(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];var c=this,s=function(){e.apply(c,n)};clearTimeout(t),t=setTimeout(s,r)}return o.clear=function(){clearTimeout(t)},o}r.d(t,{Z:()=>o})},30983:(e,t,r)=>{"use strict";r.r(t),r.d(t,{capitalize:()=>o.Z,createChainedFunction:()=>n.Z,createSvgIcon:()=>i.Z,debounce:()=>c.Z,deprecatedPropType:()=>s,isMuiElement:()=>l.Z,ownerDocument:()=>d.Z,ownerWindow:()=>a.Z,requirePropFactory:()=>u,setRef:()=>g.Z,unstable_useId:()=>y,unsupportedProp:()=>p,useControlled:()=>m.Z,useEventCallback:()=>f.Z,useForkRef:()=>h.Z,useIsFocusVisible:()=>b.Z});var o=r(1514),n=r(27949),i=r(41004),c=r(28316);function s(e,t){return function(){return null}}var l=r(42034),d=r(63283),a=r(93441);function u(e){return function(){return null}}var g=r(80195);function p(e,t,r,o,n){return null}var m=r(10652),f=r(97812),h=r(28160),x=r(69297);function y(e){var t=x.useState(e),r=t[0],o=t[1],n=e||r;return x.useEffect((function(){null==r&&o("mui-".concat(Math.round(1e5*Math.random())))}),[r]),n}var b=r(38705)},42034:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var o=r(69297);function n(e,t){return o.isValidElement(e)&&-1!==t.indexOf(e.type.muiName)}},63283:(e,t,r)=>{"use strict";function o(e){return e&&e.ownerDocument||document}r.d(t,{Z:()=>o})},93441:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var o=r(63283);function n(e){return(0,o.Z)(e).defaultView||window}},10652:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var o=r(69297);function n(e){var t=e.controlled,r=e.default,n=(e.name,e.state,o.useRef(void 0!==t).current),i=o.useState(r),c=i[0],s=i[1];return[n?t:c,o.useCallback((function(e){n||s(e)}),[])]}},6269:(e,t,r)=>{"use strict";var o=r(50725),n=r(3805);t.Z=void 0;var i=n(r(69297)),c=(0,o(r(62265)).default)(i.createElement("path",{d:"M10 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12-8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-4 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"Grain");t.Z=c},62265:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.createSvgIcon}});var o=r(30983)},65350:(e,t,r)=>{"use strict";r.d(t,{N:()=>u});var o=r(50460),n=r(83711),i=r(63514);const c={electrodeBoxes:[],radius:0,pixelRadius:0,dragRegion:null,draggedElectrodeIds:[],hoveredElectrodeId:null},s={border:"rgb(30, 30, 30)",base:"rgb(0, 0, 255)",selected:"rgb(196, 196, 128)",hover:"rgb(128, 128, 255)",selectedHover:"rgb(200, 200, 196)",dragged:"rgb(0, 0, 196)",draggedSelected:"rgb(180, 180, 150)",dragRect:"rgba(196, 196, 196, 0.5)",textLight:"rgb(228, 228, 228)",textDark:"rgb(32, 32, 32)"},l=(e,t)=>{if(e.type!==o.II.Release)return;const{selectionDispatch:r,electrodeOpts:i}=t.getProps();if(i.disableSelection)return;const c=t.getState();if(null===c)return;const s=c.electrodeBoxes.filter((t=>(0,n.Xz)(e.point,[t.x,t.y],c.radius))).map((e=>e.id));if(0===s.length)return void(e.modifiers.ctrl||e.modifiers.shift||c.dragRegion||r({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[]}));const l=s[0],d=t.getProps().selection.selectedElectrodeIds||[];r({type:"SetSelectedElectrodeIds",selectedElectrodeIds:e.modifiers.ctrl?d.includes(l)?d.filter((e=>e!==l)):[...d,l]:e.modifiers.shift?[...d,l]:[l]}),t.scheduleRepaint()},d=(e,t)=>{if(e.type!==o.II.Move)return;const r=t.getState();if(null===r)return;const i=r.electrodeBoxes.filter((t=>(0,n.Xz)(e.point,[t.x,t.y],r.radius))).map((e=>e.id));t.setState(Object.assign(Object.assign({},r),{hoveredElectrodeId:0===i.length?null:i[0]})),t.scheduleRepaint()},a=(e,t)=>{var r,o,i;const c=e.getState(),{selectionDispatch:s,electrodeOpts:l}=e.getProps();if(l.disableSelection)return;if(null===c)return;const d=null!==(r=c.electrodeBoxes.filter((e=>(0,n.Qv)(e.rect,t.dragRect))))&&void 0!==r?r:[];t.released?(s({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[...t.shift&&null!==(i=null===(o=e.getProps())||void 0===o?void 0:o.selection.selectedElectrodeIds)&&void 0!==i?i:[],...d.map((e=>e.id))]}),e.setState(Object.assign(Object.assign({},c),{dragRegion:null,draggedElectrodeIds:[]}))):e.setState(Object.assign(Object.assign({},c),{dragRegion:t.dragRect,draggedElectrodeIds:d.map((e=>e.id))})),e.scheduleRepaint()},u=()=>new o.Fw(((e,t,r)=>{var o,n;const i=t.electrodeOpts,c=i.colors||s,l=i.showLabels;e.wipe();const d=r.pixelRadius>5;for(let s of r.electrodeBoxes){const a=!i.disableSelection&&((null===(o=t.selection.selectedElectrodeIds)||void 0===o?void 0:o.includes(s.id))||!1),u=!i.disableSelection&&r.hoveredElectrodeId===s.id,g=!i.disableSelection&&((null===(n=r.draggedElectrodeIds)||void 0===n?void 0:n.includes(s.id))||!1),p=a?g?c.draggedSelected:c.selectedHover:g?c.dragged:u?c.hover:c.base,m=t.layoutMode;if("geom"===m?(e.fillEllipse(s.rect,{color:p}),e.drawEllipse(s.rect,{color:c.border})):"vertical"===m&&e.drawLine(s.rect.xmin,(s.rect.ymin+s.rect.ymax)/2,s.rect.xmax,(s.rect.ymin+s.rect.ymax)/2,{color:c.border}),d){const t=[c.selected,c.draggedSelected,c.hover,c.selectedHover].includes(p)?c.textDark:c.textLight;l&&e.drawText({rect:s.rect,alignment:{Horizontal:"AlignCenter",Vertical:"AlignCenter"},font:{pixelSize:r.pixelRadius,family:"Arial"},pen:{color:t},brush:{color:t},text:s.label})}}r.dragRegion&&e.fillRect(r.dragRegion,{color:c.dragRect})}),((e,t)=>{const r=e.getState(),{width:o,height:n,electrodeLocations:c,electrodeIds:s,layoutMode:l}=t,{electrodeBoxes:d,transform:a,radius:u,pixelRadius:g}=(0,i.Z)({width:o,height:n,electrodeLocations:c,electrodeIds:s,layoutMode:l,maxElectrodePixelRadius:t.electrodeOpts.maxElectrodePixelRadius});e.setTransformMatrix(a),e.setState(Object.assign(Object.assign({},r),{electrodeBoxes:d,radius:u,pixelRadius:g})),e.scheduleRepaint()}),c,{discreteMouseEventHandlers:[l,d],dragHandlers:[a]})},63514:(e,t,r)=>{"use strict";r.d(t,{g:()=>a,Z:()=>u});var o=r(59739),n=r(24059),i=r(83711),c=r(89382);const s=new Map,l=e=>{const t=JSON.stringify(e),r=s.get(t);if(void 0!==r)return r;let n=Number.MAX_VALUE;e.forEach((t=>{e.forEach((e=>{const r=(0,o.KOy)([t[0]-e[0],t[1]-e[1]]);0!==r&&(n=Math.min(n,r))}))}));const i=.45*n;return s.set(t,i),i},d=(e,t)=>({xmin:(0,c.Gt)(e.map((e=>e[0])))-t,xmax:(0,c.lR)(e.map((e=>e[0])))+t,ymin:(0,c.Gt)(e.map((e=>e[1])))-t,ymax:(0,c.lR)(e.map((e=>e[1])))+t}),a=e=>{const t=l(e),r=d(e,t);return(0,i.dz)(r)/(0,i.Cr)(r)},u=e=>{const{width:t,height:r,electrodeLocations:o,electrodeIds:s,layoutMode:a}=e;if("vertical"===a)return(({width:e,height:t,electrodeIds:r})=>{const o=r.length,i=(0,n.As)((r=>[10+r[0]*(e-20),10+r[1]*(t-20)]));return{electrodeBoxes:r.map(((e,t)=>{const r=(.5+t)/(o+1),i={xmin:0,xmax:1,ymin:r-.5/(o+1),ymax:r+.5/(o+1)},c=(0,n.As)((e=>[i.xmin+e[0]*(i.xmax-i.xmin),i.ymin+e[1]*(i.ymax-i.ymin)]));return{label:e+"",id:e,x:.5,y:r,rect:i,transform:c}})),transform:i,radius:1/(o+1),pixelRadius:(t-20)/(o+1)}})({width:t,height:r,electrodeIds:s});const u=(e=>{const t=(0,c.Gt)(e.map((e=>e[0]))),r=(0,c.lR)(e.map((e=>e[0]))),o=(0,c.Gt)(e.map((e=>e[1]))),n=(0,c.lR)(e.map((e=>e[1])));return t===r&&o===n?e.map(((e,t)=>[t,0])):e})(o),g=t-20,p=r-20,m=g/p,f=l(u);let h,x=d(u,f),y=(0,i.dz)(x)/(0,i.Cr)(x),b=u;y>1!=m>1&&(b=u.map((e=>[e[1],-e[0]])),x={xmin:x.ymin,xmax:x.ymax,ymin:-x.xmax,ymax:-x.xmin},y=(0,i.dz)(x)/(0,i.Cr)(x)),h=y>m?g/(0,i.dz)(x):p/(0,i.Cr)(x),e.maxElectrodePixelRadius&&f*h>e.maxElectrodePixelRadius&&(h/=f*h/e.maxElectrodePixelRadius);const v=(t-(0,i.dz)(x)*h)/2,E=(r-(0,i.Cr)(x)*h)/2,w=(0,n.As)((e=>[v+(e[0]-x.xmin)*h,E+(e[1]-x.ymin)*h])),R=b.map(((e,t)=>{const r=e[0],o=e[1],c=(0,i.jU)([r,o],f,f),l=(0,n.As)((e=>[c.xmin+e[0]*(c.xmax-c.xmin),c.ymin+e[1]*(c.ymax-c.ymin)]));return{label:s[t]+"",id:s[t],x:r,y:o,rect:c,transform:l}})),S=(0,i.ur)(w,[f,0])[0];return{electrodeBoxes:R,transform:w,radius:f,pixelRadius:S}}},15743:(e,t,r)=>{"use strict";r.d(t,{F0:()=>i,ZL:()=>c});var o=r(5443),n=r(69297);const i=e=>{const{result:t}=(0,o.lG)(e?"createjob_get_recording_info":"",{recording_object:e},{useClientCache:!0});return t},c=e=>{const t=(0,n.useContext)(o.Zo),r=(0,n.useRef)({}),[,i]=(0,n.useState)(0),c={};return e.forEach((e=>{const o=e.recordingId;if(!r.current[o]){const n=t.createHitherJob("createjob_get_recording_info",{recording_object:e.recordingObject},{useClientCache:!0});r.current[o]=n,n.wait().then((()=>{i((e=>e+1))})).catch((()=>{i((e=>e+1))}))}r.current[o].result&&(c[o]=r.current[o].result)})),c}},13344:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var o=r(69297),n=r.n(o),i=r(65350),c=r(24059),s=r(50460);const l=e=>{const t=(0,o.useMemo)((()=>({layoutMode:"geom",electrodeIds:e.electrodes.map((e=>e.id)),electrodeLocations:e.electrodes.map((e=>[e.x,e.y])),width:e.width,height:e.height,selection:e.selection,selectionDispatch:e.selectionDispatch,electrodeOpts:{showLabels:!0,maxElectrodePixelRadius:25},noiseLevel:0,samplingFrequency:0})),[e]),r=(0,s.sJ)(i.N,t),l=(0,s.jU)([r]);return n().createElement(c.ZP,Object.assign({key:"electrodeGeometryCanvas",layers:l},{width:e.width,height:e.height}))}},97092:(e,t,r)=>{"use strict";r.r(t),r.d(t,{activate:()=>a});var o=r(6269),n=r(69297),i=r.n(n),c=r(15743),s=r(13344);const l=({recording:e,width:t,height:r,selection:o,selectionDispatch:l})=>{const d=(0,c.F0)(e.recordingObject),a=o.visibleElectrodeIds,u=(0,n.useMemo)((()=>(d?((e,t)=>{if(e&&t&&t.length!==e.length)throw Error("Electrode ID count does not match location count.");return t.map(((t,r)=>{const o=e[r];return{label:t+"",id:t,x:o[0],y:o[1]}}))})(d.geom,d.channel_ids):[]).filter((e=>!a||a.includes(e.id)))),[d,a]);return d?i().createElement(s.Z,{electrodes:u,selection:o,selectionDispatch:l,width:t||350,height:r||150}):i().createElement("div",null,"No recording info found for recording.")},d=({recording:e,recordingInfo:t,calculationPool:r,width:o,height:n,selection:c,selectionDispatch:s})=>i().createElement(l,Object.assign({},{recording:e,recordingInfo:t,calculationPool:r,width:o,height:n,selection:c,selectionDispatch:s}));function a(e){e.registerPlugin({type:"RecordingView",name:"ElectrodeGeometryRecordingView",label:"Electrode geometry",priority:50,defaultExpanded:!1,component:l,singleton:!0,icon:i().createElement(o.Z,null)}),e.registerPlugin({type:"SortingView",name:"ElectrodeGeometrySortingView",label:"Electrode geometry",priority:50,component:d,singleton:!0,icon:i().createElement(o.Z,null)})}}}]);