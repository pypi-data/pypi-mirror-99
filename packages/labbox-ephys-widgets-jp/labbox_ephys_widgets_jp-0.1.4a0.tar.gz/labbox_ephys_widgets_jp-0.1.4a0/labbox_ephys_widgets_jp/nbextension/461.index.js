(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[461],{39110:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i(61416),s=i(62379),r=i(69297),o=(i(2652),i(23060)),l=i(20562),c=i(25662),a=i(73583),d=i(1514),m=r.forwardRef((function(e,t){var i=e.edge,l=void 0!==i&&i,c=e.children,m=e.classes,u=e.className,g=e.color,h=void 0===g?"default":g,p=e.disabled,f=void 0!==p&&p,b=e.disableFocusRipple,y=void 0!==b&&b,v=e.size,x=void 0===v?"medium":v,S=(0,s.Z)(e,["edge","children","classes","className","color","disabled","disableFocusRipple","size"]);return r.createElement(a.Z,(0,n.Z)({className:(0,o.Z)(m.root,u,"default"!==h&&m["color".concat((0,d.Z)(h))],f&&m.disabled,"small"===x&&m["size".concat((0,d.Z)(x))],{start:m.edgeStart,end:m.edgeEnd}[l]),centerRipple:!0,focusRipple:!y,disabled:f,ref:t},S),r.createElement("span",{className:m.label},c))}));const u=(0,l.Z)((function(e){return{root:{textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:12,borderRadius:"50%",overflow:"visible",color:e.palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{backgroundColor:(0,c.U1)(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{backgroundColor:"transparent",color:e.palette.action.disabled}},edgeStart:{marginLeft:-12,"$sizeSmall&":{marginLeft:-3}},edgeEnd:{marginRight:-12,"$sizeSmall&":{marginRight:-3}},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main,"&:hover":{backgroundColor:(0,c.U1)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},colorSecondary:{color:e.palette.secondary.main,"&:hover":{backgroundColor:(0,c.U1)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},disabled:{},sizeSmall:{padding:3,fontSize:e.typography.pxToRem(18)},label:{width:"100%",display:"flex",alignItems:"inherit",justifyContent:"inherit"}}}),{name:"MuiIconButton"})(m)},28316:(e,t,i)=>{"use strict";function n(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function n(){for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];var o=this,l=function(){e.apply(o,s)};clearTimeout(t),t=setTimeout(l,i)}return n.clear=function(){clearTimeout(t)},n}i.d(t,{Z:()=>n})},42034:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(69297);function s(e,t){return n.isValidElement(e)&&-1!==t.indexOf(e.type.muiName)}},45040:(e,t,i)=>{"use strict";var n=i(50725),s=i(3805);t.Z=void 0;var r=s(i(69297)),o=(0,n(i(62265)).default)(r.createElement("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"}),"Timeline");t.Z=o},65350:(e,t,i)=>{"use strict";i.d(t,{N:()=>m});var n=i(50460),s=i(83711),r=i(63514);const o={electrodeBoxes:[],radius:0,pixelRadius:0,dragRegion:null,draggedElectrodeIds:[],hoveredElectrodeId:null},l={border:"rgb(30, 30, 30)",base:"rgb(0, 0, 255)",selected:"rgb(196, 196, 128)",hover:"rgb(128, 128, 255)",selectedHover:"rgb(200, 200, 196)",dragged:"rgb(0, 0, 196)",draggedSelected:"rgb(180, 180, 150)",dragRect:"rgba(196, 196, 196, 0.5)",textLight:"rgb(228, 228, 228)",textDark:"rgb(32, 32, 32)"},c=(e,t)=>{if(e.type!==n.II.Release)return;const{selectionDispatch:i,electrodeOpts:r}=t.getProps();if(r.disableSelection)return;const o=t.getState();if(null===o)return;const l=o.electrodeBoxes.filter((t=>(0,s.Xz)(e.point,[t.x,t.y],o.radius))).map((e=>e.id));if(0===l.length)return void(e.modifiers.ctrl||e.modifiers.shift||o.dragRegion||i({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[]}));const c=l[0],a=t.getProps().selection.selectedElectrodeIds||[];i({type:"SetSelectedElectrodeIds",selectedElectrodeIds:e.modifiers.ctrl?a.includes(c)?a.filter((e=>e!==c)):[...a,c]:e.modifiers.shift?[...a,c]:[c]}),t.scheduleRepaint()},a=(e,t)=>{if(e.type!==n.II.Move)return;const i=t.getState();if(null===i)return;const r=i.electrodeBoxes.filter((t=>(0,s.Xz)(e.point,[t.x,t.y],i.radius))).map((e=>e.id));t.setState(Object.assign(Object.assign({},i),{hoveredElectrodeId:0===r.length?null:r[0]})),t.scheduleRepaint()},d=(e,t)=>{var i,n,r;const o=e.getState(),{selectionDispatch:l,electrodeOpts:c}=e.getProps();if(c.disableSelection)return;if(null===o)return;const a=null!==(i=o.electrodeBoxes.filter((e=>(0,s.Qv)(e.rect,t.dragRect))))&&void 0!==i?i:[];t.released?(l({type:"SetSelectedElectrodeIds",selectedElectrodeIds:[...t.shift&&null!==(r=null===(n=e.getProps())||void 0===n?void 0:n.selection.selectedElectrodeIds)&&void 0!==r?r:[],...a.map((e=>e.id))]}),e.setState(Object.assign(Object.assign({},o),{dragRegion:null,draggedElectrodeIds:[]}))):e.setState(Object.assign(Object.assign({},o),{dragRegion:t.dragRect,draggedElectrodeIds:a.map((e=>e.id))})),e.scheduleRepaint()},m=()=>new n.Fw(((e,t,i)=>{var n,s;const r=t.electrodeOpts,o=r.colors||l,c=r.showLabels;e.wipe();const a=i.pixelRadius>5;for(let l of i.electrodeBoxes){const d=!r.disableSelection&&((null===(n=t.selection.selectedElectrodeIds)||void 0===n?void 0:n.includes(l.id))||!1),m=!r.disableSelection&&i.hoveredElectrodeId===l.id,u=!r.disableSelection&&((null===(s=i.draggedElectrodeIds)||void 0===s?void 0:s.includes(l.id))||!1),g=d?u?o.draggedSelected:o.selectedHover:u?o.dragged:m?o.hover:o.base,h=t.layoutMode;if("geom"===h?(e.fillEllipse(l.rect,{color:g}),e.drawEllipse(l.rect,{color:o.border})):"vertical"===h&&e.drawLine(l.rect.xmin,(l.rect.ymin+l.rect.ymax)/2,l.rect.xmax,(l.rect.ymin+l.rect.ymax)/2,{color:o.border}),a){const t=[o.selected,o.draggedSelected,o.hover,o.selectedHover].includes(g)?o.textDark:o.textLight;c&&e.drawText({rect:l.rect,alignment:{Horizontal:"AlignCenter",Vertical:"AlignCenter"},font:{pixelSize:i.pixelRadius,family:"Arial"},pen:{color:t},brush:{color:t},text:l.label})}}i.dragRegion&&e.fillRect(i.dragRegion,{color:o.dragRect})}),((e,t)=>{const i=e.getState(),{width:n,height:s,electrodeLocations:o,electrodeIds:l,layoutMode:c}=t,{electrodeBoxes:a,transform:d,radius:m,pixelRadius:u}=(0,r.Z)({width:n,height:s,electrodeLocations:o,electrodeIds:l,layoutMode:c,maxElectrodePixelRadius:t.electrodeOpts.maxElectrodePixelRadius});e.setTransformMatrix(d),e.setState(Object.assign(Object.assign({},i),{electrodeBoxes:a,radius:m,pixelRadius:u})),e.scheduleRepaint()}),o,{discreteMouseEventHandlers:[c,a],dragHandlers:[d]})},63514:(e,t,i)=>{"use strict";i.d(t,{g:()=>d,Z:()=>m});var n=i(59739),s=i(24059),r=i(83711),o=i(89382);const l=new Map,c=e=>{const t=JSON.stringify(e),i=l.get(t);if(void 0!==i)return i;let s=Number.MAX_VALUE;e.forEach((t=>{e.forEach((e=>{const i=(0,n.KOy)([t[0]-e[0],t[1]-e[1]]);0!==i&&(s=Math.min(s,i))}))}));const r=.45*s;return l.set(t,r),r},a=(e,t)=>({xmin:(0,o.Gt)(e.map((e=>e[0])))-t,xmax:(0,o.lR)(e.map((e=>e[0])))+t,ymin:(0,o.Gt)(e.map((e=>e[1])))-t,ymax:(0,o.lR)(e.map((e=>e[1])))+t}),d=e=>{const t=c(e),i=a(e,t);return(0,r.dz)(i)/(0,r.Cr)(i)},m=e=>{const{width:t,height:i,electrodeLocations:n,electrodeIds:l,layoutMode:d}=e;if("vertical"===d)return(({width:e,height:t,electrodeIds:i})=>{const n=i.length,r=(0,s.As)((i=>[10+i[0]*(e-20),10+i[1]*(t-20)]));return{electrodeBoxes:i.map(((e,t)=>{const i=(.5+t)/(n+1),r={xmin:0,xmax:1,ymin:i-.5/(n+1),ymax:i+.5/(n+1)},o=(0,s.As)((e=>[r.xmin+e[0]*(r.xmax-r.xmin),r.ymin+e[1]*(r.ymax-r.ymin)]));return{label:e+"",id:e,x:.5,y:i,rect:r,transform:o}})),transform:r,radius:1/(n+1),pixelRadius:(t-20)/(n+1)}})({width:t,height:i,electrodeIds:l});const m=(e=>{const t=(0,o.Gt)(e.map((e=>e[0]))),i=(0,o.lR)(e.map((e=>e[0]))),n=(0,o.Gt)(e.map((e=>e[1]))),s=(0,o.lR)(e.map((e=>e[1])));return t===i&&n===s?e.map(((e,t)=>[t,0])):e})(n),u=t-20,g=i-20,h=u/g,p=c(m);let f,b=a(m,p),y=(0,r.dz)(b)/(0,r.Cr)(b),v=m;y>1!=h>1&&(v=m.map((e=>[e[1],-e[0]])),b={xmin:b.ymin,xmax:b.ymax,ymin:-b.xmax,ymax:-b.xmin},y=(0,r.dz)(b)/(0,r.Cr)(b)),f=y>h?u/(0,r.dz)(b):g/(0,r.Cr)(b),e.maxElectrodePixelRadius&&p*f>e.maxElectrodePixelRadius&&(f/=p*f/e.maxElectrodePixelRadius);const x=(t-(0,r.dz)(b)*f)/2,S=(i-(0,r.Cr)(b)*f)/2,I=(0,s.As)((e=>[x+(e[0]-b.xmin)*f,S+(e[1]-b.ymin)*f])),_=v.map(((e,t)=>{const i=e[0],n=e[1],o=(0,r.jU)([i,n],p,p),c=(0,s.As)((e=>[o.xmin+e[0]*(o.xmax-o.xmin),o.ymin+e[1]*(o.ymax-o.ymin)]));return{label:l[t]+"",id:l[t],x:i,y:n,rect:o,transform:c}})),E=(0,r.ur)(I,[p,0])[0];return{electrodeBoxes:_,transform:I,radius:p,pixelRadius:E}}},13344:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i(69297),s=i.n(n),r=i(65350),o=i(24059),l=i(50460);const c=e=>{const t=(0,n.useMemo)((()=>({layoutMode:"geom",electrodeIds:e.electrodes.map((e=>e.id)),electrodeLocations:e.electrodes.map((e=>[e.x,e.y])),width:e.width,height:e.height,selection:e.selection,selectionDispatch:e.selectionDispatch,electrodeOpts:{showLabels:!0,maxElectrodePixelRadius:25},noiseLevel:0,samplingFrequency:0})),[e]),i=(0,l.sJ)(r.N,t),c=(0,l.jU)([i]);return s().createElement(o.ZP,Object.assign({key:"electrodeGeometryCanvas",layers:c},{width:e.width,height:e.height}))}},95849:(e,t,i)=>{"use strict";i.d(t,{kN:()=>a,qG:()=>g,GI:()=>d,CC:()=>c,Zl:()=>o,_S:()=>p,SF:()=>m,fG:()=>b,fB:()=>f,Sd:()=>h,FO:()=>y});var n=i(5443),s=i(69297);const r=(e,t)=>{if(e.min<=t&&t<e.max)return e;const i=e.max-e.min,n=Math.max(0,Math.floor(t-i/2));return{min:n,max:n+i}},o=(e,t)=>{var i,n,s,o;if("SetRecordingSelection"===t.type)return Object.assign({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{selectedElectrodeIds:t.selectedElectrodeIds.filter((t=>!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)))});if("SetVisibleElectrodeIds"===t.type)return Object.assign(Object.assign({},e),{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((e=>t.visibleElectrodeIds.includes(e))):void 0});if("SetCurrentTimepoint"===t.type)return Object.assign(Object.assign({},e),{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?r(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object.assign(Object.assign({},e),{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){const s=9e6,r=e.currentTimepoint,o=e.timeRange;if(!o)return e;const c=null!==(i=t.direction)&&void 0!==i?i:"in",a=null!==(n=t.factor)&&void 0!==n?n:1.4,d="out"===c?1/a:a;if((o.max-o.min)/d>s)return e;let m;m=void 0===r||r<o.min?o.min:r>o.max?o.max:r;const u=l(o,d,m);return Object.assign(Object.assign({},e),{timeRange:u})}if("SetAmpScaleFactor"===t.type)return Object.assign(Object.assign({},e),{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){const i=null!==(s=t.direction)&&void 0!==s?s:"up",n=null!==(o=t.multiplier)&&void 0!==o?o:1.4,r="down"===i?1/n:n;return Object.assign(Object.assign({},e),{ampScaleFactor:(e.ampScaleFactor||1)*r})}return"SetCurrentTimepointVelocity"===t.type?Object.assign(Object.assign({},e),{animation:Object.assign(Object.assign({},e.animation||{}),{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object.assign(Object.assign({},e),{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},l=(e,t,i)=>{const n=i+(e.min-i)/t,s=i+(e.max-i)/t;return{min:Math.floor(n),max:Math.floor(s)}},c=(e,t)=>((t||{}).mergeGroups||[]).filter((t=>t.includes(e)))[0]||null,a=(e,t,i)=>i&&c(e,t)||e,d=(e,t)=>{const i=c(e,t);return!i||Math.min(...i)===e},m=(e,t)=>"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:t.selectedUnitIds.filter((t=>{var i;return!e.visibleUnitIds||(null===(i=e.visibleUnitIds)||void 0===i?void 0:i.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>{var i;return null===(i=t.visibleUnitIds)||void 0===i?void 0:i.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?((e,t)=>{const i=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(i)?Object.assign(Object.assign({},e),{selectedUnitIds:(e.selectedUnitIds||[]).filter((e=>e!==i))}):Object.assign(Object.assign({},e),{selectedUnitIds:[...e.selectedUnitIds||[],i]}):Object.assign(Object.assign({},e),{selectedUnitIds:[i]})})(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?u(Object.assign(Object.assign({},e),{applyMerges:!e.applyMerges}),t.curation):o(e,t),u=(e,t)=>e.applyMerges&&t?Object.assign(Object.assign({},e),{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((e=>d(e,t))):void 0}):e,g=e=>e.filter((e=>!e.disabled&&!e.development)),h=e=>g(e).filter((e=>"SortingView"===e.type)).map((e=>e)),p=e=>g(e).filter((e=>"RecordingView"===e.type)).map((e=>e)),f=e=>g(e).filter((e=>"SortingUnitView"===e.type)).map((e=>e)),b=e=>g(e).filter((e=>"SortingUnitMetric"===e.type)).map((e=>e)),y=()=>{const e=(0,n._m)();return(0,s.useMemo)((()=>e.filter((e=>"WorkspaceView"===e.type)).map((e=>e))),[e])}},73681:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i(5443),s=i(69297),r=i(46826),o=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{c(n.next(e))}catch(e){r(e)}}function l(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,l)}c((n=n.apply(e,t||[])).next())}))};const l=(0,n.zy)({maxSimultaneous:4,method:"stack"}),c=(e,t)=>{const i=(0,s.useContext)(n.Zo),c=(0,s.useMemo)((()=>t=>o(void 0,void 0,void 0,(function*(){switch(t.type){case"dataSegment":return yield(n={hither:i,recordingObject:e,ds_factor:t.ds_factor,segment_num:t.segment_num,segment_size:t.segment_size},o(void 0,void 0,void 0,(function*(){const{hither:e,recordingObject:t,ds_factor:i,segment_num:s,segment_size:r}=n;return(yield e.createHitherJob("createjob_get_timeseries_segment",{recording_object:t,ds_factor:i,segment_num:s,segment_size:r},{useClientCache:!0,calculationPool:l}).wait()).traces})))}var n}))),[i,e]),a=(0,r.Z)(c),d=t.channel_ids.length,m=Math.ceil(1e5/d),u=(0,s.useMemo)((()=>(e,i,n,s)=>{const r=Math.floor(Math.max(0,i)/m),o=Math.ceil((Math.min(n,t.num_frames)-1)/m),l=[];for(let e=r;e<=o;e++)e===r&&e===o?l.push({segment_num:e,t1:e*m,t2:(e+1)*m,src1:i-e*m,src2:n-e*m,dst1:0,dst2:n-i}):e===r?l.push({segment_num:e,t1:e*m,t2:(e+1)*m,src1:i-e*m,src2:m,dst1:0,dst2:m+e*m-i}):e===o?l.push({segment_num:e,t1:e*m,t2:(e+1)*m,src1:0,src2:n-e*m,dst1:e*m-i,dst2:n-i}):l.push({segment_num:e,t1:e*m,t2:(e+1)*m,src1:0,src2:m,dst1:e*m-i,dst2:(e+1)*m-i});const c=[];if(1===s){for(let e=i;e<n;e++)c.push(NaN);for(let t of l){const i=a.get({type:"dataSegment",ds_factor:s,segment_num:t.segment_num,segment_size:m});if(i)for(let n=0;n<t.src2-t.src1;n++)c[t.dst1+n]=i[e][t.src1+n]}}else{for(let e=i;e<n;e++)c.push(NaN),c.push(NaN);for(let t of l){const i=a.get({type:"dataSegment",ds_factor:s,segment_num:t.segment_num,segment_size:m});if(i)for(let n=0;n<t.src2-t.src1;n++)c[2*(t.dst1+n)]=i[e][2*(t.src1+n)],c[2*(t.dst1+n)+1]=i[e][2*(t.src1+n)+1]}}return c}),[a,t.num_frames,m]);return(0,s.useMemo)((()=>({getChannelData:u,requestChannelData:u,numChannels:()=>t.channel_ids.length,numTimepoints:()=>t.num_frames,getSampleRate:()=>t.sampling_frequency})),[u,t])}},29599:(e,t,i)=>{"use strict";i.r(t),i.d(t,{activate:()=>S});var n=i(45040),s=i(69297),r=i.n(s),o=i(3527),l=i(95849),c=i(13344);const a=({recordingInfo:e,width:t,height:i,selection:n,visibleElectrodeIds:o,selectionDispatch:l})=>{const a=e,d=(0,s.useMemo)((()=>(a?((e,t)=>{if(e&&t&&t.length!==e.length)throw Error("Electrode ID count does not match location count.");return t.map(((t,i)=>{const n=e[i];return{label:t+"",id:t,x:n[0],y:n[1]}}))})(a.geom,a.channel_ids):[]).filter((e=>o.includes(e.id)))),[a,o]);return a?r().createElement(c.Z,{electrodes:d,selection:n,selectionDispatch:l,width:t,height:i}):r().createElement("div",null,"No recording info found for recording.")};var d=i(81178),m=i(24059),u=i(98946),g=i(88382);const h=["rgb(80,80,80)","rgb(104,42,42)","rgb(42,104,42)","rgb(42,42,152)"];class p{constructor(e,t,i,n,s){this.channelIndex=e,this.channelId=t,this.timeseriesData=i,this.y_offset=n,this.y_scale_factor=s,this._timeRange=null,this._yScale=1,this._pixelWidth=null}setTimeRange(e){this._timeRange=e}setYScale(e){this._yScale!==e&&(this._yScale=e)}setPixelWidth(e){this._pixelWidth!==e&&(this._pixelWidth=e)}paint(e,t){const i=this._timeRange;if(!i)return;let n,s,r,o,l,c=this._determineDownsampleFactor(t);if(null===c)return;for(;n=i.min,s=i.max,r=Math.floor(n/c),o=Math.floor(s/c),l=this.timeseriesData.getChannelData(this.channelIndex,r,o,c),0!==l.filter((e=>isNaN(e))).length&&!(o-r<200||c>100);)c*=3;const a=new m.CP;if(1===c){let e=!1;for(let t=n;t<s;t++){let i=l[t-n];if(isNaN(i))e=!1;else{let n=(i+this.y_offset)*this.y_scale_factor*this._yScale/2+.5;e?a.lineTo(t,n):(a.moveTo(t,n),e=!0)}}}else{let e=!1;for(let t=r;t<o;t++){let i=l[2*(t-r)],n=l[2*(t-r)+1];if(isNaN(i)||isNaN(n))e=!1;else{let s=(i+this.y_offset)*this.y_scale_factor*this._yScale/2+.5,r=(n+this.y_offset)*this.y_scale_factor*this._yScale/2+.5;e?(a.lineTo((t-1/3)*c,s),a.lineTo((t+1/3)*c,r)):(a.moveTo((t-1/3)*c,s),a.lineTo((t+1/3)*c,r),e=!0)}}}const d={color:h[this.channelIndex%h.length],width:1};e.drawPath(a,d)}_determineDownsampleFactor(e){let t=this._timeRange;if(!t)return null;if(null===this._pixelWidth)return null;let i=1.3;this.timeseriesData.numChannels()>32&&(i=.5);const n=Math.max(500,this._pixelWidth*i)*e,s=t.max-t.min;let r=1;for(;s/(3*r)>n;)r*=3;return r}label(){return this.channelId+""}}const f=e=>{const{timeseriesData:t,width:i,height:n,y_scale_factor:o,channel_ids:c,visibleChannelIds:a,recordingSelection:m,recordingSelectionDispatch:h}=e,[f,b]=(0,s.useState)([]),[y,v]=(0,u.Z)(l.Zl,m,(0,s.useMemo)((()=>e=>{h({type:"Set",state:e})}),[h]),400),[x,S]=(0,s.useState)(null),I=(0,s.useCallback)((()=>{v({type:"ScaleAmpScaleFactor",direction:"up"})}),[v]),_=(0,s.useCallback)((()=>{v({type:"ScaleAmpScaleFactor",direction:"down"})}),[v]);(0,s.useEffect)((()=>{const e=[];for(let n=0;n<t.numChannels();n++){const s=c[n];if(!a||a.includes(s)){const r=new p(n,s,t,0,o);r.setPixelWidth(i),r.setYScale(y.ampScaleFactor||1),e.push(r)}}b(e)}),[c,b,t,o,a,i,y.ampScaleFactor,y.timeRange]),(0,s.useEffect)((()=>{if(null===x){const e=[{type:"button",callback:I,title:"Scale amplitude up [up arrow]",icon:r().createElement(d.ZTc,null),keyCode:38},{type:"button",callback:_,title:"Scale amplitude down [down arrow]",icon:r().createElement(d.NWQ,null),keyCode:40},{type:"divider"}];S(e)}}),[x,S,_,I,y.ampScaleFactor,i]);const E=(0,s.useMemo)((()=>t?t.numTimepoints():0),[t]);return r().createElement(g.Z,{panels:f,customActions:x,width:i,height:n,samplerate:t.getSampleRate(),startTimeSpan:1e7/t.numChannels(),maxTimeSpan:1e7/t.numChannels(),numTimepoints:E,selection:y,selectionDispatch:v})};var b=i(73681);const y=e=>{const t=e.opts,i=e.recordingInfo,n=(0,b.Z)(e.recordingObject,e.recordingInfo),[c,d]=(0,s.useReducer)(l.Zl,{}),m=e.recordingSelection||c,u=e.recordingSelectionDispatch||d,g=(0,s.useMemo)((()=>m.selectedElectrodeIds||[]),[m.selectedElectrodeIds]),h=(0,s.useMemo)((()=>m.visibleElectrodeIds||i.channel_ids),[m.visibleElectrodeIds,i.channel_ids]),p=1/(e.recordingInfo.noise_level||1)*1/10;return n?r().createElement("div",null,r().createElement(o.Z,{width:e.width,height:e.height,initialPosition:200},t.channelSelectPanel&&r().createElement(a,{recordingInfo:e.recordingInfo,width:0,height:0,visibleElectrodeIds:h,selection:m,selectionDispatch:u}),!t.channelSelectPanel||g.length>0||h.length<=12?r().createElement(f,{timeseriesData:n,channel_ids:e.recordingInfo.channel_ids,channel_locations:e.recordingInfo.geom,num_timepoints:e.recordingInfo.num_frames,y_scale_factor:p,width:e.width,height:e.height,visibleChannelIds:t.channelSelectPanel?g.length>0?g:h:null,recordingSelection:m,recordingSelectionDispatch:u}):r().createElement("div",null,"Select one or more electrodes"))):r().createElement("div",null,"Creating timeseries model")},v=({recording:e,recordingInfo:t,width:i,height:n,selection:s,selectionDispatch:o})=>r().createElement(y,{recordingObject:e.recordingObject,recordingInfo:t,width:i||600,height:n||600,opts:{channelSelectPanel:!0},recordingSelection:s,recordingSelectionDispatch:o}),x=({recording:e,recordingInfo:t,width:i,height:n,selection:s,selectionDispatch:o})=>r().createElement(y,{recordingObject:e.recordingObject,recordingInfo:t,width:i||600,height:n||600,opts:{channelSelectPanel:!0},recordingSelection:s,recordingSelectionDispatch:o});function S(e){e.registerPlugin({type:"RecordingView",name:"TimeseriesView",label:"Timeseries",priority:50,fullWidth:!0,component:x}),e.registerPlugin({type:"SortingView",name:"TimeseriesView",label:"Timeseries",priority:50,component:v,icon:r().createElement(n.Z,null)})}}}]);