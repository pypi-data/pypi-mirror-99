(this["webpackJsonplabbox-ephys"]=this["webpackJsonplabbox-ephys"]||[]).push([[20],{114:function(e,t,n){"use strict";function r(e){return e&&e.ownerDocument||document}n.d(t,"a",(function(){return r}))},120:function(e,t,n){"use strict";function r(e){return function(){return null}}n.d(t,"a",(function(){return r}))},122:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(114);function c(e){return Object(r.a)(e).defaultView||window}},123:function(e,t,n){"use strict";function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return null==t?e:function(){for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];e.apply(this,r),t.apply(this,r)}}),(function(){}))}n.d(t,"a",(function(){return r}))},124:function(e,t,n){"use strict";function r(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=arguments.length,c=new Array(r),i=0;i<r;i++)c[i]=arguments[i];var o=this,a=function(){e.apply(o,c)};clearTimeout(t),t=setTimeout(a,n)}return r.clear=function(){clearTimeout(t)},r}n.d(t,"a",(function(){return r}))},128:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0);function c(e,t){return r.isValidElement(e)&&-1!==t.indexOf(e.type.muiName)}},129:function(e,t,n){"use strict";function r(e,t,n,r,c){return null}n.d(t,"a",(function(){return r}))},135:function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},136:function(e,t,n){var r=n(145);function c(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}},137:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(140)},140:function(e,t,n){"use strict";n.r(t),n.d(t,"capitalize",(function(){return r.a})),n.d(t,"createChainedFunction",(function(){return c.a})),n.d(t,"createSvgIcon",(function(){return i.a})),n.d(t,"debounce",(function(){return o.a})),n.d(t,"deprecatedPropType",(function(){return a})),n.d(t,"isMuiElement",(function(){return u.a})),n.d(t,"ownerDocument",(function(){return s.a})),n.d(t,"ownerWindow",(function(){return l.a})),n.d(t,"requirePropFactory",(function(){return d.a})),n.d(t,"setRef",(function(){return f.a})),n.d(t,"unsupportedProp",(function(){return b.a})),n.d(t,"useControlled",(function(){return h.a})),n.d(t,"useEventCallback",(function(){return p.a})),n.d(t,"useForkRef",(function(){return j.a})),n.d(t,"unstable_useId",(function(){return v})),n.d(t,"useIsFocusVisible",(function(){return O.a}));var r=n(112),c=n(123),i=n(117),o=n(124);function a(e,t){return function(){return null}}var u=n(128),s=n(114),l=n(122),d=n(120),f=n(133),b=n(129),h=n(125),p=n(132),j=n(121),g=n(0);function v(e){var t=g.useState(e),n=t[0],r=t[1],c=e||n;return g.useEffect((function(){null==n&&r("mui-".concat(Math.round(1e5*Math.random())))}),[n]),c}var O=n(139)},145:function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},146:function(e,t,n){"use strict";var r=n(10),c=n(23),i=n(12),o=n(0),a=n(161),u=n.n(a);t.a=function(e){var t,n,a,s,l,d=e.width,f=e.height,b=e.initialPosition,h=e.onChange,p=e.adjustable,j=void 0===p||p,g=e.positionFromRight,v=void 0!==g&&g,O=Object(o.useState)(b),m=Object(i.a)(O,2),y=m[0],x=m[1];if(!e.children)throw Error("Unexpected: no props.children");if(Array.isArray(e.children)){var E=e.children.filter((function(e){return void 0!==e}));s=E[0],l=E[1]||null}else s=e.children,l=null;if(!l)return Object(r.jsx)(s.type,Object(c.a)(Object(c.a)({},s.props),{},{width:d,height:f}));var w=v?d-y:y,S=j?null!==(t=e.gripThickness)&&void 0!==t?t:10:0,_=j?null!==(n=e.gripInnerThickness)&&void 0!==n?n:4:0,R=j?null!==(a=e.gripMargin)&&void 0!==a?a:2:0,C=w-S/2-R,M=d-C-S-2*R,D={top:0,left:0,width:d,height:f},I={left:0,top:0,width:C,height:f,zIndex:0,overflowY:"auto",overflowX:"hidden"},T={left:C+S+2*R,top:0,width:M,height:f,zIndex:0,overflowY:"auto",overflowX:"hidden"},k={left:0,top:0,width:S+2*R,height:f,backgroundColor:"transparent",cursor:"col-resize",zIndex:9998},z={left:R,top:0,width:S,height:f,background:"rgb(230, 230, 230)",cursor:"col-resize"},P={top:0,left:(S-_)/2,width:_,height:f,background:"gray",cursor:"col-resize"};return Object(r.jsxs)("div",{className:"splitter",style:Object(c.a)(Object(c.a)({},D),{},{position:"relative"}),children:[Object(r.jsx)("div",{style:Object(c.a)(Object(c.a)({},I),{},{position:"absolute"}),className:"SplitterChild",children:Object(r.jsx)(s.type,Object(c.a)(Object(c.a)({},s.props),{},{width:C,height:f}))},"child1"),j&&Object(r.jsx)(u.a,{position:{x:w-S/2-R,y:0},axis:"x",onDrag:function(e,t){},onStop:function(e,t){return function(e,t){var n=t.x;if(n!==w){var r=v?d-n:n;x(r),h&&h(r)}}(0,t)},children:Object(r.jsx)("div",{style:Object(c.a)(Object(c.a)({},k),{},{position:"absolute"}),children:Object(r.jsx)("div",{style:Object(c.a)(Object(c.a)({},z),{},{position:"absolute"}),children:Object(r.jsx)("div",{style:Object(c.a)(Object(c.a)({},P),{},{position:"absolute"})})})})},"drag"),Object(r.jsx)("div",{style:Object(c.a)(Object(c.a)({},T),{},{position:"absolute"}),className:"SplitterChild",children:Object(r.jsx)(l.type,Object(c.a)(Object(c.a)({},l.props),{},{width:M,height:f}))},"child2")]})}},185:function(e,t,n){"use strict";var r=n(135),c=n(136);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=c(n(0)),o=(0,r(n(137)).default)(i.createElement("path",{d:"M10 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12-8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-4 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"Grain");t.default=o},187:function(e,t,n){"use strict";var r=n(12),c=n(42),i=n(23),o=n(43),a=n.n(o),u=n(0),s={data:{},activeFetches:{}},l=function(e,t){switch(t.type){case"clear":return s;case"startFetch":return Object(i.a)(Object(i.a)({},e),{},{activeFetches:Object(i.a)(Object(i.a)({},e.activeFetches),{},Object(c.a)({},t.queryHash,!0))});case"setData":return Object(i.a)(Object(i.a)({},e),{},{data:Object(i.a)(Object(i.a)({},e.data),{},Object(c.a)({},t.queryHash,t.data)),activeFetches:Object(i.a)(Object(i.a)({},e.activeFetches),{},Object(c.a)({},t.queryHash,!1))});default:throw Error("Unexpected action in fetchCacheReducer")}},d=function(e){return a()(e)};t.a=function(e){var t=Object(u.useState)(0),n=Object(r.a)(t,2),c=n[0],i=n[1];c<0&&console.info(c);var o=Object(u.useRef)(e),a=Object(u.useReducer)(l,s),f=Object(r.a)(a,2),b=f[0],h=f[1],p=Object(u.useRef)({});Object(u.useEffect)((function(){e!==o.current&&(o.current=e,h({type:"clear"}))}),[e]);var j=Object(u.useMemo)((function(){return function(e){var t=d(e),n=b.data[t];return void 0===n&&(p.current[t]=e,i((function(e){return e+1}))),n}}),[b.data]),g=Object(u.useMemo)((function(){return function(t){var n=d(t);void 0===b.data[n]&&(b.activeFetches[n]||(h({type:"startFetch",queryHash:n}),e(t).then((function(e){h({type:"setData",queryHash:n,data:e})})).catch((function(e){console.warn(e),console.warn("Problem fetching data",t)}))))}}),[b.data,b.activeFetches,e]);return Object(u.useEffect)((function(){var e=Object.keys(p.current);if(0!==e.length){for(var t=0,n=e;t<n.length;t++){var r=n[t];g(p.current[r])}p.current={}}})),Object(u.useMemo)((function(){return{get:j}}),[j])}},601:function(e,t,n){"use strict";var r=n(24),c=n(2),i=n.n(c),o=n(38),a=n(17),u=n(0),s=n(187),l=Object(a.d)({maxSimultaneous:4,method:"stack"}),d=function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,c,o,a,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.hither,r=t.recordingObject,c=t.ds_factor,o=t.segment_num,a=t.segment_size,e.next=3,n.createHitherJob("createjob_get_timeseries_segment",{recording_object:r,ds_factor:c,segment_num:o,segment_size:a},{useClientCache:!0,calculationPool:l}).wait();case 3:return u=e.sent,e.abrupt("return",u.traces);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.a=function(e,t){var n=Object(u.useContext)(a.a),c=Object(u.useMemo)((function(){return function(){var t=Object(o.a)(i.a.mark((function t(r){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=r.type,t.next="dataSegment"===t.t0?3:6;break;case 3:return t.next=5,d({hither:n,recordingObject:e,ds_factor:r.ds_factor,segment_num:r.segment_num,segment_size:r.segment_size});case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),[n,e]),l=Object(s.a)(c),f=t.channel_ids.length,b=Math.ceil(1e5/f),h=Object(u.useMemo)((function(){return function(e,n,c,i){for(var o=Math.floor(Math.max(0,n)/b),a=Math.ceil((Math.min(c,t.num_frames)-1)/b),u=[],s=o;s<=a;s++)s===o&&s===a?u.push({segment_num:s,t1:s*b,t2:(s+1)*b,src1:n-s*b,src2:c-s*b,dst1:0,dst2:c-n}):s===o?u.push({segment_num:s,t1:s*b,t2:(s+1)*b,src1:n-s*b,src2:b,dst1:0,dst2:b+s*b-n}):s===a?u.push({segment_num:s,t1:s*b,t2:(s+1)*b,src1:0,src2:c-s*b,dst1:s*b-n,dst2:c-n}):u.push({segment_num:s,t1:s*b,t2:(s+1)*b,src1:0,src2:b,dst1:s*b-n,dst2:(s+1)*b-n});var d=[];if(1===i){for(var f=n;f<c;f++)d.push(NaN);var h,p=Object(r.a)(u);try{for(p.s();!(h=p.n()).done;){var j=h.value,g=l.get({type:"dataSegment",ds_factor:i,segment_num:j.segment_num,segment_size:b});if(g)for(var v=0;v<j.src2-j.src1;v++)d[j.dst1+v]=g[e][j.src1+v]}}catch(S){p.e(S)}finally{p.f()}}else{for(var O=n;O<c;O++)d.push(NaN),d.push(NaN);var m,y=Object(r.a)(u);try{for(y.s();!(m=y.n()).done;){var x=m.value,E=l.get({type:"dataSegment",ds_factor:i,segment_num:x.segment_num,segment_size:b});if(E)for(var w=0;w<x.src2-x.src1;w++)d[2*(x.dst1+w)]=E[e][2*(x.src1+w)],d[2*(x.dst1+w)+1]=E[e][2*(x.src1+w)+1]}}catch(S){y.e(S)}finally{y.f()}}return d}}),[l,t.num_frames,b]);return Object(u.useMemo)((function(){return{getChannelData:h,requestChannelData:h,numChannels:function(){return t.channel_ids.length},numTimepoints:function(){return t.num_frames},getSampleRate:function(){return t.sampling_frequency}}}),[h,t])}},722:function(e,t,n){"use strict";n.r(t),n.d(t,"activate",(function(){return k}));var r=n(10),c=n(185),i=n.n(c),o=n(0),a=n(23),u=n(146),s=n(601),l=n(24),d=n(12),f=n(119),b=n(115),h=n(151),p=n(33),j=n(711),g=n(116),v=n(147),O={BASE:"rgb(0, 0, 255)",SELECTED:"rgb(196, 196, 128)",HOVER:"rgb(128, 128, 255)",SELECTEDHOVER:"rgb(200, 200, 196)",DRAGGED:"rgb(0, 0, 196)",DRAGGEDSELECTED:"rgb(180, 180, 150)",DRAGRECT:"rgba(196, 196, 196, 0.5)"},m="rgb(228, 228, 228)",y="rgb(32, 32, 32)",x={electrodeBoundingBoxes:[],dragRegion:null,draggedElectrodeIds:[],hoveredElectrodeId:null,radius:0,pixelRadius:0,lastProps:{electrodes:[],selectedElectrodeIds:[],onSelectedElectrodeIdsChanged:function(){},width:0,height:0}},E=new Map,w=function(e,t){var n,r=e.getState(),c=t.width,i=t.height,o=t.electrodes,u=c-20,s=i-20,l=u/s,d=function(e){var t=JSON.stringify(e),n=E.get(t);if(void 0!==n)return n;var r=Number.MAX_VALUE;e.forEach((function(t){e.forEach((function(e){var n=Object(j.e)([t.x-e.x,t.y-e.y]);0!==n&&(r=Math.min(r,n))}))}));var c=.4*r;return E.set(t,c),c}(o),b=function(e,t){return{xmin:Object(v.b)(e.map((function(e){return e.x})))-t,xmax:Object(v.a)(e.map((function(e){return e.x})))+t,ymin:Object(v.b)(e.map((function(e){return e.y})))-t,ymax:Object(v.a)(e.map((function(e){return e.y})))+t}}(o,d),h=Object(g.e)(b)/Object(g.c)(b),p=o;h>1!==l>1&&(p=o.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{x:e.y,y:-e.x})})),b={xmin:b.ymin,xmax:b.ymax,ymin:-b.xmax,ymax:-b.xmin},h=Object(g.e)(b)/Object(g.c)(b)),n=h>l?u/Object(g.e)(b):s/Object(g.c)(b);n=Math.min(n,32/d);var O=(c-Object(g.e)(b)*n)/2,m=(i-Object(g.c)(b)*n)/2,y=Object(f.c)((function(e){return[O+(e[0]-b.xmin)*n,m+(e[1]-b.ymin)*n]})),x=p.map((function(e){var t=e.x,n=e.y;return{label:e.label,id:parseInt(e.label),x:t,y:n,br:Object(g.a)([t,n],d,d),color:e.color}}));e.setTransformMatrix(y);var w=Object(g.n)(y,[d,0])[0];e.setState(Object(a.a)(Object(a.a)({},r),{},{electrodeBoundingBoxes:x,radius:d,pixelRadius:w,lastProps:t})),e.scheduleRepaint()},S=function(e,t,n){e.wipe();var r,c=n.pixelRadius>5,i=Object(l.a)(n.electrodeBoundingBoxes);try{for(i.s();!(r=i.n()).done;){var o,a,u=r.value,s=(null===(o=t.selectedElectrodeIds)||void 0===o?void 0:o.includes(u.id))||!1,d=n.hoveredElectrodeId===u.id,f=(null===(a=n.draggedElectrodeIds)||void 0===a?void 0:a.includes(u.id))||!1,b=u.color||(s?f?O.DRAGGEDSELECTED:d?O.SELECTEDHOVER:O.SELECTED:f?O.DRAGGED:d?O.HOVER:O.BASE);if(e.fillEllipse(u.br,{color:b}),c){var h=[O.SELECTED,O.DRAGGEDSELECTED,O.HOVER,O.SELECTEDHOVER].includes(b)?y:m;e.drawText({rect:u.br,alignment:{Horizontal:"AlignCenter",Vertical:"AlignCenter"},font:{pixelSize:n.pixelRadius,family:"Arial"},pen:{color:h},brush:{color:h},text:u.label})}}}catch(p){i.e(p)}finally{i.f()}n.dragRegion&&e.fillRect(n.dragRegion,{color:O.DRAGRECT})},_=function(e,t){var n,r=e.getState();if(null!==r){var c=null!==(n=r.electrodeBoundingBoxes.filter((function(e){return Object(g.l)(e.br,t.dragRect)})))&&void 0!==n?n:[];if(t.released){var i,o,u,s=t.shift&&null!==(i=null===(o=e.getProps())||void 0===o?void 0:o.selectedElectrodeIds)&&void 0!==i?i:[];null===(u=e.getProps())||void 0===u||u.onSelectedElectrodeIdsChanged([].concat(Object(p.a)(s),Object(p.a)(c.map((function(e){return e.id}))))),e.setState(Object(a.a)(Object(a.a)({},r),{},{dragRegion:null,draggedElectrodeIds:[]}))}else e.setState(Object(a.a)(Object(a.a)({},r),{},{dragRegion:t.dragRect,draggedElectrodeIds:c.map((function(e){return e.id}))}));e.scheduleRepaint()}},R=function(e,t){var n,r;if(e.type===b.b.Release){var c=t.getState();if(null!==c){var i=c.electrodeBoundingBoxes.filter((function(t){return Object(g.k)(e.point,[t.x,t.y],c.radius)})).map((function(e){return e.id}));if(0!==i.length){var o=i[0],a=(null===(n=t.getProps())||void 0===n?void 0:n.selectedElectrodeIds)||[],u=e.modifiers.ctrl?a.includes(o)?a.filter((function(e){return e!==o})):[].concat(Object(p.a)(a),[o]):e.modifiers.shift?[].concat(Object(p.a)(a),[o]):[o];null===(r=t.getProps())||void 0===r||r.onSelectedElectrodeIdsChanged(u),t.scheduleRepaint()}else{var s;e.modifiers.ctrl||e.modifiers.shift||c.dragRegion||null===(s=t.getProps())||void 0===s||s.onSelectedElectrodeIdsChanged([])}}}},C=function(e,t){if(e.type===b.b.Move){var n=t.getState();if(null!==n){var r=n.electrodeBoundingBoxes.filter((function(t){return Object(g.k)(e.point,[t.x,t.y],n.radius)})).map((function(e){return e.id}));t.setState(Object(a.a)(Object(a.a)({},n),{},{hoveredElectrodeId:0===r.length?null:r[0]})),t.scheduleRepaint()}}},M=function(){return new b.a(S,w,x,{dragHandlers:[_],discreteMouseEventHandlers:[R,C]})},D=function(e,t){return e+1},I=function(e){var t=e.recording,n=e.timeseriesData,c=e.selection,i=e.width,u=e.height,s=c.selectedElectrodeIds,p=Object(o.useState)({}),j=Object(d.a)(p,2),g=j[0],v=j[1],O=Object(o.useReducer)(D,0),m=Object(d.a)(O,2),y=m[0],x=m[1];Object(o.useEffect)((function(){var e=c.currentTimepoint;if(void 0!==e&&s&&n){var t,r={},i=Object(l.a)(s);try{for(i.s();!(t=i.n()).done;){var o=t.value,a=n.getChannelData(o,Math.floor(e),Math.floor(e)+1,1);r[o+""]=a[0]}}catch(u){i.e(u)}finally{i.f()}v(r),Object.values(r).filter((function(e){return isNaN(e)})).length>0&&setTimeout((function(){x({type:"increment"})}),500)}else v({})}),[n,c,s,v,y,x]);var E=Object(h.a)(t.recordingObject),w={electrodes:Object(o.useMemo)((function(){var e=(c.ampScaleFactor||1)/((null===E||void 0===E?void 0:E.noise_level)||1)*1/5,t=function(t){var n=g[t];return isNaN(n)?"lightgray":function(e){if(e<=0)return"black";if(e>=1)return"white";var t=Math.floor(255*e);return"rgb(".concat(t,", ").concat(t,", ").concat(t,")")}(-n*e)};return(E?function(e,t){if(e&&t&&t.length!==e.length)throw Error("Electrode ID count does not match location count.");return t.map((function(t,n){var r=e[n];return{label:t+"",x:r[0],y:r[1],electrodeId:t}}))}(E.geom,E.channel_ids):[]).map((function(e){return Object(a.a)(Object(a.a)({},e),{},{id:e.electrodeId,color:t(e.electrodeId)})}))}),[E,g,c.ampScaleFactor]),selectedElectrodeIds:Object(o.useMemo)((function(){return c.selectedElectrodeIds||[]}),[c.selectedElectrodeIds]),onSelectedElectrodeIdsChanged:Object(o.useMemo)((function(){return function(e){}}),[]),width:i,height:u},S=Object(b.f)(M,w),_=Object(b.g)([S]);return Object(r.jsx)(f.b,Object(a.a)({layers:_},{width:i,height:u}))},T=function(e){var t,n=e.recording,c=e.recordingInfo,i=(e.sorting,e.selection),l=e.selectionDispatch,d=e.width,f=e.height,b=Object(o.useCallback)((function(e){l({type:"SetCurrentTimepointVelocity",velocity:0})}),[l]),h=Object(o.useCallback)((function(e){l({type:"SetCurrentTimepointVelocity",velocity:50})}),[l]),p=Object(s.a)(n.recordingObject,c);return Object(r.jsxs)(u.a,{width:d||400,height:f||400,initialPosition:150,children:[Object(r.jsx)("div",{children:(null===(t=i.animation)||void 0===t?void 0:t.currentTimepointVelocity)?Object(r.jsx)("button",{onClick:b,children:"Stop animation"}):Object(r.jsx)("button",{onClick:h,children:"Start animation"})}),Object(r.jsx)(I,Object(a.a)(Object(a.a)({},{recording:n,timeseriesData:p,selection:i}),{},{width:0,height:0}))]})};function k(e){e.registerPlugin({type:"SortingView",name:"FireTrack",label:"FireTrack",priority:50,component:T,icon:Object(r.jsx)(i.a,{})})}}}]);
//# sourceMappingURL=20.ee79f814.chunk.js.map