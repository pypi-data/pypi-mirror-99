(this["webpackJsonplabbox-ephys"]=this["webpackJsonplabbox-ephys"]||[]).push([[25],{118:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"i",(function(){return O})),n.d(t,"e",(function(){return g})),n.d(t,"h",(function(){return m})),n.d(t,"g",(function(){return h})),n.d(t,"j",(function(){return v}));var r=n(17),c=n(0),i=n(23),o=(n(2),n(38),function(e,t){if(e.min<=t&&t<e.max)return e;var n=e.max-e.min,r=Math.max(0,Math.floor(t-n/2));return{min:r,max:r+n}}),a=function(e,t){if("SetRecordingSelection"===t.type)return Object(i.a)({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object(i.a)(Object(i.a)({},e),{},{selectedElectrodeIds:t.selectedElectrodeIds.filter((function(t){return!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)}))});if("SetVisibleElectrodeIds"===t.type)return Object(i.a)(Object(i.a)({},e),{},{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((function(e){return t.visibleElectrodeIds.includes(e)})):void 0});if("SetCurrentTimepoint"===t.type)return Object(i.a)(Object(i.a)({},e),{},{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?o(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object(i.a)(Object(i.a)({},e),{},{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){var n,r,c=e.currentTimepoint,a=e.timeRange;if(!a)return e;var u,l=null!==(n=t.direction)&&void 0!==n?n:"in",d=null!==(r=t.factor)&&void 0!==r?r:1.4,b="out"===l?1/d:d;if((a.max-a.min)/b>9e6)return e;u=void 0===c||c<a.min?a.min:c>a.max?a.max:c;var f=s(a,b,u);return Object(i.a)(Object(i.a)({},e),{},{timeRange:f})}if("SetAmpScaleFactor"===t.type)return Object(i.a)(Object(i.a)({},e),{},{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){var j,p,O=null!==(j=t.direction)&&void 0!==j?j:"up",g=null!==(p=t.multiplier)&&void 0!==p?p:1.4,m="down"===O?1/g:g;return Object(i.a)(Object(i.a)({},e),{},{ampScaleFactor:(e.ampScaleFactor||1)*m})}return"SetCurrentTimepointVelocity"===t.type?Object(i.a)(Object(i.a)({},e),{},{animation:Object(i.a)(Object(i.a)({},e.animation||{}),{},{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object(i.a)(Object(i.a)({},e),{},{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},s=function(e,t,n){var r=n+(e.min-n)/t,c=n+(e.max-n)/t;return{min:Math.floor(r),max:Math.floor(c)}},u=n(33),l=function(e,t){return((t||{}).mergeGroups||[]).filter((function(t){return t.includes(e)}))[0]||null},d=function(e,t,n){return n&&l(e,t)||e},b=function(e,t){var n=l(e,t);return!n||Math.min.apply(Math,Object(u.a)(n))===e},f=function(e,t){return"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object(i.a)(Object(i.a)({},e),{},{selectedUnitIds:t.selectedUnitIds.filter((function(t){var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object(i.a)(Object(i.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?function(e,t){var n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object(i.a)(Object(i.a)({},e),{},{selectedUnitIds:(e.selectedUnitIds||[]).filter((function(e){return e!==n}))}):Object(i.a)(Object(i.a)({},e),{},{selectedUnitIds:[].concat(Object(u.a)(e.selectedUnitIds||[]),[n])}):Object(i.a)(Object(i.a)({},e),{},{selectedUnitIds:[n]})}(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?j(Object(i.a)(Object(i.a)({},e),{},{applyMerges:!e.applyMerges}),t.curation):a(e,t)},j=function(e,t){return e.applyMerges&&t?Object(i.a)(Object(i.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){return b(e,t)})):void 0}):e},p=function(e){return e.filter((function(e){return!e.disabled&&!e.development}))},O=function(e){return p(e).filter((function(e){return"SortingView"===e.type})).map((function(e){return e}))},g=function(e){return p(e).filter((function(e){return"RecordingView"===e.type})).map((function(e){return e}))},m=function(e){return p(e).filter((function(e){return"SortingUnitView"===e.type})).map((function(e){return e}))},h=function(e){return p(e).filter((function(e){return"SortingUnitMetric"===e.type})).map((function(e){return e}))},v=function(){var e=Object(r.g)();return Object(c.useMemo)((function(){return e.filter((function(e){return"WorkspaceView"===e.type})).map((function(e){return e}))}),[e])}},715:function(e,t,n){"use strict";n.r(t),n.d(t,"activate",(function(){return G}));var r=n(10),c=n(12),i=n(678),o=n(17),a=n(0),s=n(118),u=function(e){if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};var t=e.split("/"),n=t[2]||void 0,r=t[3]||void 0;return n&&r?{feedUri:"feed://".concat(n),workspaceName:r}:{feedUri:void 0,workspaceName:void 0}},l=n(42),d=n(33),b=n(23),f=function(e,t){if("SET_CURATION"===t.type)return t.curation;if("ADD_UNIT_LABEL"===t.type){var n=t.unitId+"",r=(e.labelsByUnit||{})[n]||[];return r.includes(t.label)?e:Object(b.a)(Object(b.a)({},e),{},{labelsByUnit:Object(b.a)(Object(b.a)({},e.labelsByUnit),{},Object(l.a)({},n,[].concat(Object(d.a)(r),[t.label]).sort()))})}if("REMOVE_UNIT_LABEL"===t.type){var c=t.unitId+"",i=(e.labelsByUnit||{})[c]||[];return i.includes(t.label)?Object(b.a)(Object(b.a)({},e),{},{labelsByUnit:Object(b.a)(Object(b.a)({},e.labelsByUnit),{},Object(l.a)({},c,i.filter((function(e){return e!==t.label}))))}):e}return"MERGE_UNITS"===t.type?Object(b.a)(Object(b.a)({},e),{},{mergeGroups:O([].concat(Object(d.a)(e.mergeGroups||[]),[t.unitIds]))}):"UNMERGE_UNITS"===t.type?Object(b.a)(Object(b.a)({},e),{},{mergeGroups:O((e.mergeGroups||[]).map((function(e){return e.filter((function(e){return!t.unitIds.includes(e)}))})))}):e},j=function(e,t){return e.filter((function(e){return t.includes(e)}))},p=function(e,t){return[].concat(Object(d.a)(e),Object(d.a)(t.filter((function(t){return!e.includes(t)})))).sort()},O=function(e){for(var t=e.map((function(e){return Object(d.a)(e)})),n=!0;n;){n=!1;for(var r=0;r<t.length;r++)for(var c=t[r],i=r+1;i<t.length;i++){var o=t[i];j(c,o).length>0&&(t[r]=p(c,o),t[i]=[],n=!0)}}return t.filter((function(e){return e.length>=2}))},g=function(e,t){switch(t.type){case"ADD_RECORDING":return Object(b.a)(Object(b.a)({},e),{},{recordings:[].concat(Object(d.a)(e.recordings.filter((function(e){return e.recordingId!==t.recording.recordingId}))),[t.recording])});case"DELETE_RECORDINGS":return Object(b.a)(Object(b.a)({},e),{},{recordings:e.recordings.filter((function(e){return!t.recordingIds.includes(e.recordingId)}))});case"ADD_SORTING":return Object(b.a)(Object(b.a)({},e),{},{sortings:[].concat(Object(d.a)(e.sortings.filter((function(e){return e.sortingId!==t.sorting.sortingId}))),[t.sorting])});case"DELETE_SORTINGS":return Object(b.a)(Object(b.a)({},e),{},{sortings:e.sortings.filter((function(e){return!t.sortingIds.includes(e.sortingId)}))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object(b.a)(Object(b.a)({},e),{},{sortings:e.sortings.filter((function(e){return!t.recordingIds.includes(e.recordingId)}))});case"ADD_UNIT_LABEL":case"REMOVE_UNIT_LABEL":case"MERGE_UNITS":case"UNMERGE_UNITS":return Object(b.a)(Object(b.a)({},e),{},{sortings:e.sortings.map((function(e){return e.sortingId===t.sortingId?Object(b.a)(Object(b.a)({},e),{},{curation:f(e.curation||{},t)}):e}))});default:return e}},m=n(705),h=n(609),v=function(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],i=t[1],s=Object(a.useContext)(o.a);Object(a.useEffect)((function(){var e=setInterval((function(){var e=s.getHitherJobs();i(e)}),1e3);return function(){clearInterval(e)}}),[s]);var u={pendingJobs:n.filter((function(e){return"pending"===e.status})),runningJobs:n.filter((function(e){return"running"===e.status})),finishedJobs:n.filter((function(e){return"finished"===e.status})),erroredJobs:n.filter((function(e){return"error"===e.status}))},l=u.runningJobs,d=u.finishedJobs,b=u.erroredJobs,f=u.pendingJobs.length,j=l.length,p=d.length,O=b.length,g="Jobs: ".concat(f," pending | ").concat(j," running | ").concat(p," finished | ").concat(O," errored"),m=O>0?Object(r.jsxs)("span",{children:[":",Object(r.jsx)("span",{style:{color:"pink"},children:O})]}):Object(r.jsx)("span",{});return Object(r.jsxs)("span",{title:g,style:{fontFamily:"courier"},children:[f,":",j,":",p,m]})},I=n(190),y=n(700),x=n(703),w=n(704),U=function(e){var t=e.color,n=Object(a.useContext)(o.c),c=n.websocketStatus,i=n.onReconnectWebsocket,s=Object(a.useMemo)((function(){switch(c){case"waiting":return{icon:Object(r.jsx)(y.a,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:Object(r.jsx)(x.a,{style:{color:t}}),title:"Connected"};case"disconnected":return{icon:Object(r.jsx)(w.a,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[c,t]),u=s.icon,l=s.title,d=Object(a.useCallback)((function(){"disconnected"===c&&i()}),[c,i]);return Object(r.jsx)(I.a,{title:l,onClick:d,children:u})},E=n(632),S=function(e){var t=e.onOpenSettings,n=e.color,c=Object(a.useMemo)((function(){return{icon:Object(r.jsx)(E.a,{}),title:"Open settings"}}),[]),i=c.icon,o=c.title,s=Object(a.useCallback)((function(){t()}),[t]);return Object(r.jsx)(I.a,{style:{color:n},title:o,onClick:s,children:i})},k=function(e){var t=e.onOpenSettings,n=e.workspaceRouteDispatch,c=e.logo,i=Object(a.useCallback)((function(){n({type:"gotoRecordingsPage"})}),[n]);return Object(r.jsx)(m.a,{position:"static",style:{height:50,color:"white"},children:Object(r.jsxs)(h.a,{children:[c&&Object(r.jsx)("img",{src:c,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:i}),"\xa0\xa0\xa0",Object(r.jsx)("span",{style:{paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold"},children:"Labbox Ephys"}),Object(r.jsx)("span",{style:{marginLeft:"auto"}}),Object(r.jsxs)("span",{style:{paddingBottom:0,color:"white"},children:[Object(r.jsx)(S,{onOpenSettings:t,color:"white"}),Object(r.jsx)(U,{color:"white"}),Object(r.jsx)(v,{})]})]})})},R=n(194),M=n(195),N=n(196),T=n(706),C=Object(T.a)((function(e){return{paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}})),D=function(e){var t=e.workspaceUri,n=e.version,c=C(),i=Object(a.useContext)(o.c).serverInfo,s=u(t).workspaceName;return Object(r.jsxs)("div",{className:c.paper,style:{zIndex:9999},children:[Object(r.jsxs)("h2",{children:["Labbox Ephys ",n]}),Object(r.jsxs)(R.a,{children:[Object(r.jsxs)(M.a,{children:[Object(r.jsx)(N.a,{children:"Workspace URI"}),Object(r.jsx)(N.a,{children:t||""})]}),Object(r.jsxs)(M.a,{children:[Object(r.jsx)(N.a,{children:"Workspace name"}),Object(r.jsx)(N.a,{children:s})]}),Object(r.jsxs)(M.a,{children:[Object(r.jsx)(N.a,{children:"Kachery node ID"}),Object(r.jsx)(N.a,{children:i?i.nodeId:""})]}),Object(r.jsxs)(M.a,{children:[Object(r.jsx)(N.a,{children:"Default feed ID"}),Object(r.jsx)(N.a,{children:i?i.defaultFeedId:""})]})]})]})};function _(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}var L=function(e){var t=e.workspaceUri,n=e.workspaceRoute,l=e.workspaceRouteDispatch,d=e.version,b=function(){var e=Object(a.useState)(_()),t=Object(c.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){function e(){r(_())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),f=b.width,j=b.height-52-2,p=f-0-2,O=Object(s.j)().filter((function(e){return"WorkspaceView"===e.name}))[0];if(!O)throw Error("Unable to find workspace view plugin");var m=Object(a.useState)(!1),h=Object(c.a)(m,2),v=h[0],I=h[1],y=Object(a.useReducer)(g,Object(a.useMemo)((function(){return{recordings:[],sortings:[]}}),[])),x=Object(c.a)(y,2),w=x[0],U=x[1],E=Object(a.useCallback)((function(e){e.filter((function(e){return e.action})).forEach((function(e){return U(e.action)}))}),[]),S=u(t),R=S.feedUri,M=S.workspaceName,N=Object(a.useMemo)((function(){return{workspaceName:M}}),[M]),T=Object(o.h)({feedUri:R,subfeedName:N,onMessages:E}).appendMessages,C=Object(a.useCallback)((function(e){T([e])}),[T]),L=Object(a.useCallback)((function(){I(!0)}),[]),G=Object(a.useCallback)((function(){I(!1)}),[]);return Object(r.jsxs)("div",{style:{margin:0},children:[Object(r.jsx)(k,{onOpenSettings:L,workspaceRouteDispatch:l}),Object(r.jsx)("div",{style:{position:"absolute",top:52},children:Object(r.jsx)(O.component,{width:p,height:j,workspace:w,workspaceDispatch:C,workspaceRoute:n,workspaceRouteDispatch:l})}),Object(r.jsx)(i.a,{open:v,onClose:G,style:{zIndex:9999},children:Object(r.jsx)("span",{children:Object(r.jsx)(D,{workspace:w,workspaceUri:t,version:d})})})]})};function G(e){e.registerPlugin({type:"MainWindow",name:"MainWindow",label:"Main Window",component:L})}}}]);
//# sourceMappingURL=25.81f6bb65.chunk.js.map