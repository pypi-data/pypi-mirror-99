(this["webpackJsonplabbox-ephys"]=this["webpackJsonplabbox-ephys"]||[]).push([[21],{115:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"d",(function(){return a})),n.d(e,"e",(function(){return x})),n.d(e,"a",(function(){return g})),n.d(e,"f",(function(){return m})),n.d(e,"g",(function(){return j}));var i,r,a,o=n(12),c=n(33),s=n(24),u=n(2),l=n.n(u),f=n(38),h=n(8),d=n(9),v=n(0),b=n(127),p=n(116);!function(t){t.Move="MOVE",t.Press="PRESS",t.Release="RELEASE"}(i||(i={})),function(t){t.Press="PRESS",t.Release="RELEASE"}(r||(r={})),function(t){t.Enter="ENTER",t.Leave="LEAVE",t.Out="OUT"}(a||(a={}));var x=function(t,e,n){var i=t.currentTarget,r=[t.clientX-i.getBoundingClientRect().x,t.clientY-i.getBoundingClientRect().y];if(n){var a=Object(p.q)(n,r[0],r[1]);r=[a[0],a[1]]}var o={alt:t.altKey,ctrl:t.ctrlKey||t.metaKey,shift:t.shiftKey};return{point:[r[0],r[1]],mouseButton:t.buttons,modifiers:o,type:e}},g=function(){function t(e,n,i,r){Object(h.a)(this,t),this._onPaint=void 0,this._onPropsChange=void 0,this._runningOnPropsChange=!1,this._props=null,this._state=void 0,this._pixelWidth=null,this._pixelHeight=null,this._canvasElement=null,this._transformMatrix=void 0,this._inverseMatrix=void 0,this._repaintScheduled=!1,this._lastRepaintTimestamp=Number(new Date),this._discreteMouseEventHandlers=[],this._dragHandlers=[],this._keyboardEventHandlers=[],this._mousePresenceEventHandlers=[],this._wheelEventHandlers=[],this._refreshRate=120,this._state=i,this._onPaint=e,this._onPropsChange=n,this._discreteMouseEventHandlers=(null===r||void 0===r?void 0:r.discreteMouseEventHandlers)||[],this._dragHandlers=(null===r||void 0===r?void 0:r.dragHandlers)||[],this._keyboardEventHandlers=(null===r||void 0===r?void 0:r.keyboardEventHandlers)||[],this._mousePresenceEventHandlers=(null===r||void 0===r?void 0:r.mousePresenceEventHandlers)||[],this._wheelEventHandlers=(null===r||void 0===r?void 0:r.wheelEventHandlers)||[],this._transformMatrix=[[1,0,0],[0,1,0],[0,0,1]],this._inverseMatrix=[[1,0,0],[0,1,0],[0,0,1]]}return Object(d.a)(t,[{key:"getProps",value:function(){if(!this._props)throw Error("getProps must not be called before initial props are set");return this._props}},{key:"setProps",value:function(t){if(this._runningOnPropsChange)throw Error("Calling setProps inside onPropsChange is not allowed.");if(null===this._props||!y(this._props,t)){this._props=t,this._pixelWidth=t.width,this._pixelHeight=t.height,this._runningOnPropsChange=!0;try{this._onPropsChange(this,t)}finally{this._runningOnPropsChange=!1}}}},{key:"getState",value:function(){return this._state}},{key:"setState",value:function(t){this._state=t}},{key:"getTransformMatrix",value:function(){return this._transformMatrix}},{key:"setTransformMatrix",value:function(t){this._transformMatrix=t;try{this._inverseMatrix=Object(p.d)(t)}catch(e){console.warn(e),console.warn("WARNING: problem getting inverse transformation matrix"),this._inverseMatrix=t}}},{key:"pixelWidth",value:function(){if(null===this._pixelWidth)throw Error("Cannot get pixelWidth before it is set");return this._pixelWidth}},{key:"pixelHeight",value:function(){if(null===this._pixelHeight)throw Error("Cannot get pixelHeight before it is set");return this._pixelHeight}},{key:"resetCanvasElement",value:function(t){this._canvasElement=t}},{key:"canvasElement",value:function(){return this._canvasElement}},{key:"refreshRate",value:function(){return this._refreshRate}},{key:"setRefreshRate",value:function(t){this._refreshRate=t}},{key:"scheduleRepaint",value:function(){var t=this;if(!this._repaintScheduled){var e=Number(new Date)-this._lastRepaintTimestamp,n=1e3/this._refreshRate;e>2*n?this._doRepaint():(this._repaintScheduled=!0,setTimeout((function(){t._repaintScheduled=!1,t._doRepaint()}),n))}}},{key:"repaintImmediate",value:function(){this._doRepaint()}},{key:"_doRepaint",value:function(){var t=Object(f.a)(l.a.mark((function t(){var e,n,i,r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null!==(e=null===(n=this._canvasElement)||void 0===n?void 0:n.getContext("2d"))&&void 0!==e?e:null){t.next=3;break}return t.abrupt("return");case 3:if(null!==this._pixelWidth&&null!==this._pixelHeight){t.next=5;break}return t.abrupt("return");case 5:if(r=new b.a(i,this._pixelWidth,this._pixelHeight,this._transformMatrix),!(a=this._onPaint(r,this._props,this._state))){t.next=11;break}return this._lastRepaintTimestamp=Number(new Date),t.next=11,a;case 11:this._lastRepaintTimestamp=Number(new Date);case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleDiscreteEvent",value:function(t,e){if(0!==this._discreteMouseEventHandlers.length){var n,i=x(t,e,this._inverseMatrix),r=Object(s.a)(this._discreteMouseEventHandlers);try{for(r.s();!(n=r.n()).done;){(0,n.value)(i,this)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"handleDrag",value:function(t,e,n,i,r){if(0!==this._dragHandlers.length){var a,o=Object(p.p)(this._inverseMatrix,t),u=i?Object(p.o)(this._inverseMatrix,[].concat(Object(c.a)(i),[1])):void 0,l=r?Object(p.o)(this._inverseMatrix,[].concat(Object(c.a)(r),[1])):void 0,f=Object(s.a)(this._dragHandlers);try{for(f.s();!(a=f.n()).done;){(0,a.value)(this,{dragRect:o,released:e,shift:n||!1,anchor:u,position:l})}}catch(h){f.e(h)}finally{f.f()}}}},{key:"handleKeyboardEvent",value:function(t,e){if(0===this._keyboardEventHandlers.length)return!0;var n,i=function(t,e){return{type:t,keyCode:e.keyCode}}(t,e),r=!0,a=Object(s.a)(this._keyboardEventHandlers);try{for(a.s();!(n=a.n()).done;){!1===(0,n.value)(i,this)&&(r=!1)}}catch(o){a.e(o)}finally{a.f()}return r}},{key:"handleMousePresenceEvent",value:function(t,e){if(0!==this._mousePresenceEventHandlers.length){var n,i={type:e},r=Object(s.a)(this._mousePresenceEventHandlers);try{for(r.s();!(n=r.n()).done;){(0,n.value)(i,this)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"handleWheelEvent",value:function(t){if(0!==this._wheelEventHandlers.length){var e,n=function(t){return{deltaY:t.deltaY}}(t),i=Object(s.a)(this._wheelEventHandlers);try{for(i.s();!(e=i.n()).done;){(0,e.value)(n,this)}}catch(r){i.e(r)}finally{i.f()}}}}]),t}(),m=function(t,e){var n=Object(v.useState)(null),i=Object(o.a)(n,2),r=i[0],a=i[1];return Object(v.useEffect)((function(){null===r&&a(t())}),[r,a,t]),r&&e&&r.setProps(e),r},j=function(t){var e=Object(v.useState)([]),n=Object(o.a)(e,2),i=n[0],r=n[1];return function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(i,t)?i:(r(t),t)},y=function(t,e){for(var n in t)if(t[n]!==e[n])return!1;for(var i in e)if(t[i]!==e[i])return!1;return!0}},116:function(t,e,n){"use strict";n.d(e,"h",(function(){return a})),n.d(e,"i",(function(){return o})),n.d(e,"j",(function(){return c})),n.d(e,"k",(function(){return s})),n.d(e,"e",(function(){return u})),n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return f})),n.d(e,"l",(function(){return h})),n.d(e,"a",(function(){return d})),n.d(e,"m",(function(){return v})),n.d(e,"d",(function(){return b})),n.d(e,"q",(function(){return p})),n.d(e,"o",(function(){return x})),n.d(e,"p",(function(){return g})),n.d(e,"n",(function(){return m})),n.d(e,"f",(function(){return j})),n.d(e,"g",(function(){return y}));n(23);var i=n(24),r=n(711),a=function(t){if(t&&Array.isArray(t)&&2===t.length){var e,n=Object(i.a)(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!j(r))return!1}}catch(a){n.e(a)}finally{n.f()}return!0}return!1},o=function(t){if(t&&Array.isArray(t)&&3===t.length){var e,n=Object(i.a)(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!j(r))return!1}}catch(a){n.e(a)}finally{n.f()}return!0}return!1},c=function(t){if(t&&Array.isArray(t)&&4===t.length){var e,n=Object(i.a)(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!j(r))return!1}}catch(a){n.e(a)}finally{n.f()}return!0}return!1},s=function(t,e,n,i){return i=i||n,Math.pow((t[0]-e[0])/n,2)+Math.pow((t[1]-e[1])/i,2)<=1},u=function(t){return Object(r.a)(t.xmax-t.xmin)},l=function(t){return Object(r.a)(t.ymax-t.ymin)},f=function(t){return[t.xmin+u(t)/2,Math.min(t.ymin,t.ymax)+l(t)/2]},h=function(t,e){return!(t.xmax<e.xmin||t.xmin>e.xmax)&&!(t.ymax<e.ymin||t.ymin>e.ymax)},d=function(t,e,n){return{xmin:t[0]-e,xmax:t[0]+e,ymin:t[1]-n,ymax:t[1]+n}},v=function(t){if(JSON.stringify(t.size())===JSON.stringify([3,3])){var e=t.toArray();if(JSON.stringify(e[2])===JSON.stringify([0,0,1]))return e}throw Error("Matrix ".concat(JSON.stringify(t)," is invalid as a transform matrix."))},b=function(t){var e=Object(r.c)(t);return Object(r.b)(e).toArray()},p=function(t,e,n){return x(t,[(i=[e,n])[0],i[1],1]);var i},x=function(t,e){2===e.length&&(e=[e[0],e[1],1]);var n=Object(r.c)(t),i=Object(r.c)(e);return Object(r.d)(n,i).toArray()},g=function(t,e){var n=Object(r.c)(t),i=Object(r.c)([[e.xmin,e.xmax],[e.ymin,e.ymax],[1,1]]),a=Object(r.d)(n,i).toArray(),o=a[0][0],c=a[0][1],s=a[1][0],u=a[1][1];return{xmin:Math.min(o,c),xmax:Math.max(o,c),ymin:Math.min(s,u),ymax:Math.max(s,u)}},m=function(t,e){var n=Object(r.c)(t),i=Object(r.c)([e[0],e[1],0]),a=Object(r.d)(n,i),o=Object(r.a)(a).toArray();return[o[0],o[1]]},j=function(t){return null!==t&&void 0!==t&&"number"===typeof t},y=function(t){return null!==t&&void 0!==t&&"string"===typeof t}},118:function(t,e,n){"use strict";n.d(e,"d",(function(){return c})),n.d(e,"a",(function(){return f})),n.d(e,"b",(function(){return h})),n.d(e,"c",(function(){return l})),n.d(e,"f",(function(){return d})),n.d(e,"i",(function(){return p})),n.d(e,"e",(function(){return x})),n.d(e,"h",(function(){return g})),n.d(e,"g",(function(){return m})),n.d(e,"j",(function(){return j}));var i=n(17),r=n(0),a=n(23),o=(n(2),n(38),function(t,e){if(t.min<=e&&e<t.max)return t;var n=t.max-t.min,i=Math.max(0,Math.floor(e-n/2));return{min:i,max:i+n}}),c=function(t,e){if("SetRecordingSelection"===e.type)return Object(a.a)({},e.recordingSelection);if("SetSelectedElectrodeIds"===e.type)return Object(a.a)(Object(a.a)({},t),{},{selectedElectrodeIds:e.selectedElectrodeIds.filter((function(e){return!t.visibleElectrodeIds||t.visibleElectrodeIds.includes(e)}))});if("SetVisibleElectrodeIds"===e.type)return Object(a.a)(Object(a.a)({},t),{},{visibleElectrodeIds:e.visibleElectrodeIds,selectedElectrodeIds:t.selectedElectrodeIds?t.selectedElectrodeIds.filter((function(t){return e.visibleElectrodeIds.includes(t)})):void 0});if("SetCurrentTimepoint"===e.type)return Object(a.a)(Object(a.a)({},t),{},{currentTimepoint:e.currentTimepoint||void 0,timeRange:e.ensureInRange&&t.timeRange&&null!==e.currentTimepoint?o(t.timeRange,e.currentTimepoint):t.timeRange});if("SetTimeRange"===e.type)return Object(a.a)(Object(a.a)({},t),{},{timeRange:e.timeRange});if("ZoomTimeRange"===e.type){var n,i,r=t.currentTimepoint,c=t.timeRange;if(!c)return t;var u,l=null!==(n=e.direction)&&void 0!==n?n:"in",f=null!==(i=e.factor)&&void 0!==i?i:1.4,h="out"===l?1/f:f;if((c.max-c.min)/h>9e6)return t;u=void 0===r||r<c.min?c.min:r>c.max?c.max:r;var d=s(c,h,u);return Object(a.a)(Object(a.a)({},t),{},{timeRange:d})}if("SetAmpScaleFactor"===e.type)return Object(a.a)(Object(a.a)({},t),{},{ampScaleFactor:e.ampScaleFactor});if("ScaleAmpScaleFactor"===e.type){var v,b,p=null!==(v=e.direction)&&void 0!==v?v:"up",x=null!==(b=e.multiplier)&&void 0!==b?b:1.4,g="down"===p?1/x:x;return Object(a.a)(Object(a.a)({},t),{},{ampScaleFactor:(t.ampScaleFactor||1)*g})}return"SetCurrentTimepointVelocity"===e.type?Object(a.a)(Object(a.a)({},t),{},{animation:Object(a.a)(Object(a.a)({},t.animation||{}),{},{currentTimepointVelocity:e.velocity})}):"SetWaveformsMode"===e.type?Object(a.a)(Object(a.a)({},t),{},{waveformsMode:e.waveformsMode}):"Set"===e.type?e.state:t},s=function(t,e,n){var i=n+(t.min-n)/e,r=n+(t.max-n)/e;return{min:Math.floor(i),max:Math.floor(r)}},u=n(33),l=function(t,e){return((e||{}).mergeGroups||[]).filter((function(e){return e.includes(t)}))[0]||null},f=function(t,e,n){return n&&l(t,e)||t},h=function(t,e){var n=l(t,e);return!n||Math.min.apply(Math,Object(u.a)(n))===t},d=function(t,e){return"SetSelection"===e.type?e.selection:"SetSelectedUnitIds"===e.type?Object(a.a)(Object(a.a)({},t),{},{selectedUnitIds:e.selectedUnitIds.filter((function(e){var n;return!t.visibleUnitIds||(null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e))}))}):"SetVisibleUnitIds"===e.type?Object(a.a)(Object(a.a)({},t),{},{selectedUnitIds:t.selectedUnitIds?t.selectedUnitIds.filter((function(t){var n;return null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t)})):void 0,visibleUnitIds:e.visibleUnitIds}):"UnitClicked"===e.type?function(t,e){var n=e.unitId;return e.ctrlKey?(t.selectedUnitIds||[]).includes(n)?Object(a.a)(Object(a.a)({},t),{},{selectedUnitIds:(t.selectedUnitIds||[]).filter((function(t){return t!==n}))}):Object(a.a)(Object(a.a)({},t),{},{selectedUnitIds:[].concat(Object(u.a)(t.selectedUnitIds||[]),[n])}):Object(a.a)(Object(a.a)({},t),{},{selectedUnitIds:[n]})}(t,e):"Set"===e.type?e.state:"ToggleApplyMerges"===e.type?v(Object(a.a)(Object(a.a)({},t),{},{applyMerges:!t.applyMerges}),e.curation):c(t,e)},v=function(t,e){return t.applyMerges&&e?Object(a.a)(Object(a.a)({},t),{},{selectedUnitIds:t.selectedUnitIds?t.selectedUnitIds.filter((function(t){return h(t,e)})):void 0}):t},b=function(t){return t.filter((function(t){return!t.disabled&&!t.development}))},p=function(t){return b(t).filter((function(t){return"SortingView"===t.type})).map((function(t){return t}))},x=function(t){return b(t).filter((function(t){return"RecordingView"===t.type})).map((function(t){return t}))},g=function(t){return b(t).filter((function(t){return"SortingUnitView"===t.type})).map((function(t){return t}))},m=function(t){return b(t).filter((function(t){return"SortingUnitMetric"===t.type})).map((function(t){return t}))},j=function(){var t=Object(i.g)();return Object(r.useMemo)((function(){return t.filter((function(t){return"WorkspaceView"===t.type})).map((function(t){return t}))}),[t])}},119:function(t,e,n){"use strict";n.d(e,"c",(function(){return a}));var i=n(144),r=n(127);n.d(e,"a",(function(){return r.b}));var a=function(t){var e=t([0,0]),n=t([1,0]),i=t([0,1]);return[[n[0]-e[0],i[0]-e[0],e[0]],[n[1]-e[1],i[1]-e[1],e[1]],[0,0,1]]};e.b=i.a},127:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return u}));var i=n(23),r=n(8),a=n(9),o=n(711),c=n(116),s=function(){function t(e,n,i,a){Object(r.a)(this,t),this._exportingFigure=!1,this._context2D=void 0,this._pixelWidth=void 0,this._pixelHeight=void 0,this._primaryContext2D=void 0,this._offscreenCanvas=null,this._transformMatrix=void 0,this._context2D=e,this._primaryContext2D=e,this._pixelWidth=n,this._pixelHeight=i,this._transformMatrix=a}return Object(a.a)(t,[{key:"transform",value:function(e){try{var n=Object(c.m)(Object(o.d)(Object(o.c)(this._transformMatrix),Object(o.c)(e)));return new t(this._context2D,this._pixelWidth,this._pixelHeight,n)}catch(i){return console.warn("Problem transforming painter:",i),this}}},{key:"useOffscreenCanvas",value:function(t,e){try{var n=new OffscreenCanvas(Math.max(t,10),Math.max(e,10));this._offscreenCanvas=n;var i=n.getContext("2d");if(!i)throw Error("Unexpected");this._context2D=i}catch(r){console.warn("Problem in useOffscreenCanvas",r)}}},{key:"transferOffscreenToPrimary",value:function(){var t=this._offscreenCanvas;if(t){var e=t.transferToImageBitmap();this._context2D=this._primaryContext2D,this._context2D.clearRect(0,0,e.width,e.height),this._context2D.drawImage(e,0,0)}else console.warn("No offscreen canvas")}},{key:"getDefaultPen",value:function(){return{color:"black"}}},{key:"getDefaultFont",value:function(){return{"pixel-size":12,family:"Arial"}}},{key:"getDefaultBrush",value:function(){return{color:"black"}}},{key:"createPainterPath",value:function(){return new u}},{key:"setExportingFigure",value:function(t){this._exportingFigure=t}},{key:"exportingFigure",value:function(){return this._exportingFigure}},{key:"fillWholeCanvas",value:function(t){console.log("Pixel dimensions: 0 to ".concat(this._pixelWidth," and 0 to ").concat(this._pixelHeight)),this._context2D.save(),h(this._context2D,{color:t}),this._context2D.fillRect(0,0,this._pixelWidth,this._pixelHeight),this._context2D.restore()}},{key:"clear",value:function(){this.clearRect({xmin:0,xmax:this._pixelWidth,ymin:0,ymax:this._pixelHeight})}},{key:"clearRect",value:function(t){this.fillRect(t,{color:"transparent"})}},{key:"ctxSave",value:function(){this._context2D.save()}},{key:"ctxRestore",value:function(){this._context2D.restore()}},{key:"wipe",value:function(){this._context2D.clearRect(0,0,this._pixelWidth,this._pixelHeight)}},{key:"ctxTranslate",value:function(t){throw Error("Deprecated method, needs rewrite.")}},{key:"ctxRotate",value:function(t){this._context2D.rotate(t)}},{key:"fillRect",value:function(t,e){var n=Object(c.p)(this._transformMatrix,t);this._context2D.save(),h(this._context2D,e),this._context2D.fillRect(Math.min(n.xmin,n.xmax),Math.min(n.ymin,n.ymax),Object(c.e)(n),Object(c.c)(n)),this._context2D.restore()}},{key:"drawRect",value:function(t,e){var n=Object(c.p)(this._transformMatrix,t);this._context2D.save(),f(this._context2D,e),this._context2D.strokeRect(Math.min(n.xmin,n.xmax),Math.min(n.ymin,n.ymax),Object(c.e)(n),Object(c.c)(n)),this._context2D.restore()}},{key:"getEllipseFromBoundingRect",value:function(t){var e=Object(c.p)(this._transformMatrix,t);return{center:Object(c.b)(e),W:Math.abs(Object(c.e)(e)),H:Math.abs(Object(c.c)(e))}}},{key:"fillEllipse",value:function(t,e){var n=Object(i.a)({},this.getEllipseFromBoundingRect(t)),r=n.center,a=n.W,o=n.H;this._context2D.fillStyle=l(e.color),this._context2D.beginPath(),this._context2D.ellipse(r[0],r[1],a/2,o/2,0,0,2*Math.PI),this._context2D.fill()}},{key:"drawEllipse",value:function(t,e){var n=Object(i.a)({},this.getEllipseFromBoundingRect(t)),r=n.center,a=n.W,o=n.H;this._context2D.save(),f(this._context2D,e),this._context2D.beginPath(),this._context2D.ellipse(r[0],r[1],a/2,o/2,0,0,2*Math.PI),this._context2D.stroke(),this._context2D.restore()}},{key:"drawPath",value:function(t,e){this._context2D.save(),f(this._context2D,e),t._draw(this._context2D,this._transformMatrix),this._context2D.restore()}},{key:"drawLine",value:function(t,e,n,i,r){var a=new u;a.moveTo(t,e),a.lineTo(n,i),this.drawPath(a,r)}},{key:"drawText",value:function(t){var e,n,i=t.text,r=t.rect,a=t.alignment,o=t.font,s=t.pen,u=t.brush,l=t.orientation,b=void 0===l?"Horizontal":l,p=Object(c.p)(this._transformMatrix,r);this._context2D.save(),"Vertical"===b&&(this._context2D.rotate(-Math.PI/2),p={xmin:-(n=p).ymax,xmax:-n.ymin,ymin:n.xmin,ymax:n.xmax},a={Horizontal:"AlignBottom"===(e=a).Vertical?"AlignLeft":"AlignTop"===e.Vertical?"AlignRight":"AlignCenter",Vertical:"AlignRight"===e.Horizontal?"AlignBottom":"AlignLeft"===e.Horizontal?"AlignTop":"AlignCenter"}),d(this._context2D,o);var x=function(t,e){var n,i,r="left",a="bottom";switch(e.Horizontal){case"AlignLeft":n=t.xmin,r="left";break;case"AlignCenter":n=Object(c.b)(t)[0],r="center";break;case"AlignRight":n=t.xmax,r="right";break;default:throw new Error("Missing horizontal alignment in drawText: AlignLeft, AlignCenter, or AlignRight")}switch(e.Vertical){case"AlignBottom":i=t.ymax,a="bottom";break;case"AlignCenter":i=Object(c.b)(t)[1],a="middle";break;case"AlignTop":i=t.ymin,a="top";break;default:throw new Error("Missing vertical alignment in drawText: AlignTop, AlignBottom, or AlignVCenter")}return{x:n,y:i,textAlign:r,textBaseline:a}}(p,a);v(this._context2D,x),f(this._context2D,s),h(this._context2D,u),this._context2D.translate(x.x,x.y),this._context2D.fillText(i,0,0),this._context2D.restore()}},{key:"drawMarker",value:function(t,e){var n=Object(c.o)(this._transformMatrix,t);this._context2D.save(),e.pen&&(f(this._context2D,e.pen),this._context2D.beginPath(),this._context2D.ellipse(n[0],n[1],e.radius,e.radius,0,0,2*Math.PI),this._context2D.stroke()),e.brush&&(h(this._context2D,e.brush),this._context2D.beginPath(),this._context2D.ellipse(n[0],n[1],e.radius,e.radius,0,0,2*Math.PI),this._context2D.fill()),this._context2D.restore()}}]),t}(),u=function(){function t(){Object(r.a)(this,t),this._actions=[]}return Object(a.a)(t,[{key:"moveTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(Object(c.h)(t))return this.moveTo(t[0],t[1]);if(!Object(c.f)(e))throw Error("unexpected");this._actions.push({name:"moveTo",x:t,y:e})}},{key:"lineTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(Object(c.h)(t))return this.lineTo(t[0],t[1]);if(!Object(c.f)(e))throw Error("unexpected");this._actions.push({name:"lineTo",x:t,y:e})}},{key:"_draw",value:function(t,e){var n=this;t.beginPath(),this._transformPathPoints(e).forEach((function(e){n._applyAction(t,e)})),t.stroke()}},{key:"_applyAction",value:function(t,e){"moveTo"===e.name?void 0!==e.x&&void 0!==e.y&&t.moveTo(e.x,e.y):"lineTo"===e.name&&void 0!==e.x&&void 0!==e.y&&t.lineTo(e.x,e.y)}},{key:"_transformPathPoints",value:function(t){var e=Object(o.c)(t);return this._actions.map((function(t){if(void 0!==t.x&&void 0!==t.y){var n=Object(o.c)([t.x,t.y,1]),r=Object(o.d)(e,n).toArray();return Object(i.a)(Object(i.a)({},t),{},{x:r[0],y:r[1]})}return t}))}}]),t}(),l=function(t){if(Object(c.g)(t))return t;if(Object(c.j)(t))return"rgba(".concat(Math.floor(t[0]),", ").concat(Math.floor(t[1]),", ").concat(Math.floor(t[2]),", ").concat(t[3],")");if(Object(c.i)(t))return"rgb(".concat(Math.floor(t[0]),", ").concat(Math.floor(t[1]),", ").concat(Math.floor(t[2]),")");throw Error("unexpected")},f=function(t,e){var n=e.color||"black",i=Object(c.f)(e.width)?e.width:1;t.strokeStyle=l(n),t.lineWidth=i||1},h=function(t,e){var n="color"in e?e.color:"black";t.fillStyle=l(n)},d=function(t,e){var n=e.pixelSize||"12",i=e.family||"Arial";t.font="".concat(n,"px ").concat(i)},v=function(t,e){t.textAlign=e.textAlign,t.textBaseline=e.textBaseline}},141:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return c}));var i=n(12),r=n(17),a=n(0),o=function(t,e){return Object(r.f)(t?"createjob_get_sorting_info":"",{sorting_object:t,recording_object:e},{useClientCache:!0}).result},c=function(t){var e=Object(a.useContext)(r.a),n=Object(a.useRef)({}),o=Object(a.useState)(0),c=Object(i.a)(o,2)[1],s={};return t.forEach((function(t){var i=t.sortingId;if(!n.current[i]){var r=e.createHitherJob("createjob_get_sorting_info",{recording_object:t.recordingObject,sorting_object:t.sortingObject},{useClientCache:!0});n.current[i]=r,r.wait().then((function(){c((function(t){return t+1}))})).catch((function(){c((function(t){return t+1}))}))}n.current[i].result&&(s[i]=n.current[i].result)})),s}},144:function(t,e,n){"use strict";var i=n(10),r=n(24),a=n(12),o=n(0),c=n.n(o),s=n(115),u="COMPUTE_DRAG",l="END_DRAG",f=function(t,e){var n=t.dragging,i=t.dragAnchor,r=e.type,a=e.mouseButton,o=e.point,c=e.shift;switch(r){case l:return{dragging:!1};case u:if(!a)return{dragging:!1};if(!o)throw Error("Unexpected: no point");if(n&&!i)throw Error("Invalid state in computing drag: cannot have drag set with no dragAnchor.");if(!n&&!i)return{dragging:!1,dragAnchor:o,shift:c||!1};if(!n&&i){if(!(n=Math.abs(o[0]-i[0])>4||Math.abs(o[1]-i[1])>4))return{dragging:!1,dragAnchor:i,shift:c||!1}}if(n&&i)return{dragging:!0,dragAnchor:i,dragPosition:o,dragRect:[Math.min(i[0],o[0]),Math.min(i[1],o[1]),Math.abs(i[0]-o[0]),Math.abs(i[1]-o[1])],shift:c||!1};break;default:throw Error("Invalid mode for drag reducer.")}throw Error("Unexpected: unreachable, but keeps ESLint happy")};e.a=function(t){var e=t.layers,n=t.preventDefaultWheel,h=t.width,d=t.height,v=Object(o.useState)(null),b=Object(a.a)(v,2),p=b[0],x=b[1],g=Object(o.useState)(!1),m=Object(a.a)(g,2),j=m[0],y=m[1],O=c.a.useCallback((function(t){x(t)}),[]);Object(o.useEffect)((function(){p&&(p._hasFocus=j)}),[j,p]),Object(o.useEffect)((function(){if(p&&e){var t=function(t){p._hasFocus&&t.preventDefault()};e.forEach((function(e,i){var r=p.children[i];r&&e?(n&&r.addEventListener("wheel",t),e.resetCanvasElement(r),e.scheduleRepaint()):console.warn("Unable to get canvas element for layer",i)}))}}),[p,e,n]);var _=Object(o.useReducer)(f,{dragging:!1}),w=Object(a.a)(_,2),M=w[0],k=w[1],E=Object(o.useRef)(null);Object(o.useEffect)((function(){e.forEach((function(t){t&&t.scheduleRepaint()}))}),[h,d,e]);var D=Object(o.useState)(null),S=Object(a.a)(D,2),R=S[0],C=S[1];Object(o.useEffect)((function(){var t=null;if(t=M.dragging?M:R&&R.dragging?R:null){var n=t.dragRect;if(n){var i,a={xmin:n[0],xmax:n[0]+n[2],ymin:n[1]+n[3],ymax:n[1]},o=Object(r.a)(e);try{for(o.s();!(i=o.n()).done;){var c=i.value;c&&c.handleDrag(a,!M.dragging,t.shift,t.dragAnchor,t.dragPosition)}}catch(s){o.e(s)}finally{o.f()}}}C(M)}),[M,R,C,e]);var I,P=Object(o.useCallback)((function(t,n){if(!M.dragging){var i,a=Object(r.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;o&&o.handleDiscreteEvent(t,n)}}catch(c){a.e(c)}finally{a.f()}}}),[e,M]),A=Object(o.useCallback)((function(t,n){if(e){var i,a=Object(r.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;o&&o.handleMousePresenceEvent(t,n)}}catch(c){a.e(c)}finally{a.f()}}}),[e]),H=Object(o.useCallback)((function(t){var e,n=Object(s.e)(t,s.b.Move),i=n.point,r=n.mouseButton,a=n.modifiers;e={type:u,mouseButton:1===r,point:i,shift:a.shift||!1},E.current?E.current=e:(E.current=e,setTimeout((function(){var t=E.current;E.current=null,t&&k(t)}),30)),P(t,s.b.Move)}),[P]),T=Object(o.useCallback)((function(t){var e=Object(s.e)(t,s.b.Press),n=e.point,i=e.modifiers;P(t,s.b.Press),k({type:u,mouseButton:!0,point:n,shift:i.shift||!1})}),[P]),U=Object(o.useCallback)((function(t){y(!0);var e=Object(s.e)(t,s.b.Move),n=e.point,i=e.mouseButton,r=e.modifiers;P(t,s.b.Release),k({type:u,mouseButton:1===i,point:n,shift:r.shift||!1}),k({type:l})}),[P,k]),W=Object(o.useCallback)((function(t){A(t,s.d.Enter)}),[A]),B=Object(o.useCallback)((function(t){y(!1),A(t,s.d.Leave)}),[A]),N=Object(o.useCallback)((function(t){var n,i=Object(r.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;a&&a.handleWheelEvent(t)}}catch(o){i.e(o)}finally{i.f()}}),[e]),V=Object(o.useCallback)((function(t){var n,i=Object(r.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;a&&!1===a.handleKeyboardEvent(s.c.Press,t)&&t.preventDefault()}}catch(o){i.e(o)}finally{i.f()}}),[e]),F=Object(r.a)(e);try{for(F.s();!(I=F.n()).done;){var L=I.value;if(L){var K=L.getProps(),z=K.width,J=K.height;if(z!==h||J!==d)throw console.warn(z,J,h,d),Error("Inconsistent width or height between canvas widget and layer")}}}catch(G){F.e(G)}finally{F.f()}return Object(i.jsx)("div",{ref:O,style:{position:"relative",width:h,height:d,left:0,top:0},onKeyDown:V,tabIndex:0,children:(e||[]).map((function(t,e){return Object(i.jsx)("canvas",{style:{position:"absolute",left:0,top:0},width:h,height:d,onMouseMove:H,onMouseDown:T,onMouseUp:U,onMouseEnter:W,onMouseLeave:B,onWheel:N},"canvas-"+e)}))})}},147:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}));var i=function(t){return t.reduce((function(t,e){return t<=e?t:e}),1/0)},r=function(t){return t.reduce((function(t,e){return t>=e?t:e}),-1/0)}},234:function(t,e,n){"use strict";var i=n(10),r=n(12),a=n(228),o=n(226),c=n(0),s=n(118),u=n(141);e.a=function(t){var e=t.sorting,n=t.selection,l=t.selectionDispatch,f=t.unitComponent,h=Object(c.useState)(30),d=Object(r.a)(h,2),v=d[0],b=d[1],p=Object(u.a)(e.sortingObject,e.recordingObject),x=n.visibleUnitIds,g=(p?p.unit_ids:[]).filter((function(t){return!x||x.includes(t)})).filter((function(t){return!n.applyMerges||Object(s.b)(t,e.curation)})),m=!1;g.length>v&&(g=g.slice(0,v),m=!0);var j=Object(c.useCallback)((function(t){var e=Number(t.currentTarget.dataset.unitId);l({type:"UnitClicked",unitId:e,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}),[l]);return Object(i.jsxs)(a.a,{container:!0,children:[g.map((function(t){var e;return Object(i.jsx)(a.a,{item:!0,children:Object(i.jsx)("div",{className:"plotWrapperStyle",children:Object(i.jsxs)("div",{"data-unit-id":t,className:(null===(e=n.selectedUnitIds)||void 0===e?void 0:e.includes(t))?"plotSelectedStyle":"plotUnselectedStyle",onClick:j,children:[Object(i.jsx)("div",{className:"plotUnitLabel",children:Object(i.jsxs)("div",{children:["Unit ",t]})}),f(t)]})})},t)})),m&&Object(i.jsx)("div",{className:"plotWrapperStyle",children:Object(i.jsx)("div",{className:"plotWrapperStyleButton",children:Object(i.jsx)(o.a,{onClick:function(){b(v+60)},children:"Show more units"})})})]})}},235:function(t,e,n){"use strict";var i=n(10),r=n(622),a=n(577);n(0);e.a=function(t){var e=t.job,n=t.message,o=void 0===n?"":n,c=t.width,s=void 0===c?200:c,u=t.height,l=void 0===u?200:u;return e?Object(i.jsx)(r.a,{display:"flex",width:s,height:l,children:Object(i.jsx)(r.a,{m:"auto",children:"running"===e.status?Object(i.jsxs)("span",{children:["[",o,"] ",Object(i.jsx)(a.a,{})]}):"error"===e.status?Object(i.jsxs)("span",{children:["Error: ",e.error_message," [",o,"]"]}):"pending"===e.status?Object(i.jsx)("span",{children:o}):Object(i.jsxs)("span",{children:["[",o,"] ",e.status]})})}):Object(i.jsx)("div",{children:"No job"})}},719:function(t,e,n){"use strict";n.r(e),n.d(e,"activate",(function(){return k}));var i=n(10),r=n(707),a=n(0),o=n(23),c=n(234),s=n(17),u=n(235),l=n(118),f=n(119),h=n(115),d=n(147),v=n(116),b={},p=function(t,e){var n=e.width,i=e.height,r=e.rect;t.setTransformMatrix(Object(f.c)((function(t){var e=(t[0]-r.xmin)/(r.xmax-r.xmin),a=1-(t[1]-r.ymin)/(r.ymax-r.ymin);return[5+e*(n-10),5+a*(i-10)]}))),t.scheduleRepaint()},x=function(t,e,n){var i=e.x,r=e.y,a=e.selectedIndex;t.wipe();for(var o=i.length,c={color:"black"},s={color:"blue"},u=0;u<o;u++)t.drawMarker([i[u],r[u]],{radius:2,pen:c,brush:s});if(void 0!==n.hoverIndex){var l=n.hoverIndex;t.drawMarker([i[l],r[l]],{radius:3,pen:{color:"gray",width:5},brush:{color:"blue"}})}if(void 0!==a){var f=a;t.drawMarker([i[f],r[f]],{radius:3,pen:{color:"orange",width:4},brush:{color:"blue"}})}},g=function(t,e){var n=t.x,i=t.y,r=n.map((function(t,e){return e})),a=10*(t.rect.xmax-t.rect.xmin)/t.width;return r.filter((function(t){return Object(v.k)(e,[n[t],i[t]],a)})).sort((function(t,r){var a=n[t]-e[0],o=i[t]-e[1],c=n[r]-e[0],s=i[r]-e[1];return a*a+o*o-(c*c+s*s)}))[0]},m=function(t,e){if(t.type===h.b.Move){var n=e.getState(),i=g(e.getProps(),t.point);e.setState(Object(o.a)(Object(o.a)({},n),{},{hoverIndex:i})),e.scheduleRepaint()}},j=function(t,e){if(t.type===h.b.Release){var n=e.getProps().onSelectedIndexChanged,i=g(e.getProps(),t.point);n&&n(i)}},y=function(){return new h.a(x,p,b,{dragHandlers:[],discreteMouseEventHandlers:[m,j]})},O=function(t){var e=t.x,n=t.y,r=t.width,c=t.height,s=t.selectedIndex,u=t.onSelectedIndexChanged,l=Object(a.useMemo)((function(){var t=Object(d.b)(e),i=Object(d.a)(e),a=Object(d.b)(n),o=Object(d.a)(n);return{x:e,y:n,rect:{xmin:t,xmax:i,ymin:a,ymax:o},width:r,height:c,selectedIndex:s,onSelectedIndexChanged:u}}),[e,n,r,c,u,s]),v=Object(h.f)(y,l),b=Object(h.g)([v]);return Object(i.jsx)(f.b,Object(o.a)({layers:b},{width:r,height:c}))},_=Object(s.d)({maxSimultaneous:6}),w=function(t){var e=t.recording,n=t.sorting,r=t.selection,c=t.selectionDispatch,f=t.unitId,h=t.width,d=t.height,v=Object(s.f)("createjob_individual_cluster_features",{recording_object:e.recordingObject,sorting_object:n.sortingObject,unit_id:Object(l.a)(f,n.curation,r.applyMerges)},{useClientCache:!0,calculationPool:_}),b=v.result,p=v.job,x=Object(a.useMemo)((function(){var t=r.currentTimepoint;if(void 0!==t&&void 0!==b)for(var e=0;e<b.timepoints.length;e++)if(Math.abs(b.timepoints[e]-t)<20)return e}),[b,r]),g=Object(a.useCallback)((function(t){if(void 0!==t&&void 0!==b){var e=b.timepoints[t];void 0!==e&&c({type:"SetCurrentTimepoint",currentTimepoint:e,ensureInRange:!0})}}),[b,c]);return b?Object(i.jsx)(O,Object(o.a)(Object(o.a)({x:b.x,y:b.y},{width:h,height:d,selectedIndex:x}),{},{onSelectedIndexChanged:g})):Object(i.jsx)(u.a,Object(o.a)({},{job:p,width:h,height:d}))},M=function(t){var e=t.recording,n=t.sorting,r=t.selection,s=t.selectionDispatch,u=Object(a.useMemo)((function(){return function(t){return Object(i.jsx)(w,Object(o.a)(Object(o.a)({},{recording:e,sorting:n,unitId:t,selection:r,selectionDispatch:s}),{},{width:180,height:180}))}}),[n,e,r,s]);return Object(i.jsx)(c.a,{sorting:n,selection:r,selectionDispatch:s,unitComponent:u})};function k(t){t.registerPlugin({type:"SortingView",name:"IndividualClustersView",label:"Clusters",priority:50,component:M,icon:Object(i.jsx)(r.a,{})})}}}]);
//# sourceMappingURL=21.23ddcd6b.chunk.js.map