[tool.poetry]
    name = "netatmoqc"
    version = "0.3.8"
    description = "Use machine learning clustering methods to perform quality control over NetAtmo data"
    authors = [
        "Paulo V. C. Medeiros <paulo.medeiros@smhi.se>"
    ]
    license = "MIT"
    readme = "README.md"
    repository = "https://source.coderefinery.org/iOBS/wp2/task-2-3/netatmoqc"
    documentation = "https://source.coderefinery.org/iOBS/wp2/task-2-3/netatmoqc/-/wikis"

[tool.poetry.scripts]
    netatmoqc = "netatmoqc.main:main"

[build-system]
    build-backend = "poetry.core.masonry.api"
    requires = [
        "poetry-core >= 1.0.0",
        "numpy >= 1.19.0",
    ]

[tool.poetry.dependencies]
    attrs = "^20.2.0"
    dash = "^1.13.4"
    dash-daq = "^0.5.0"
    dotmap = "^1.3.17"
    flask-caching = "^1.9.0"
    hdbscan = "^0.8.26"
    humanize = "^2.6.0"
    importlib-metadata = "^1.7.0"
    joblib = "^1.0.0"
    llvmlite = "0.33.^0.dev0" # numba 0.50.1 requires llvmlite <0.34,>=0.33.0.dev0
    mpi4py = {version="^3.0.3", optional=true}
    numba = "^0.50.1"
    numpy = "^1.19.0"
    pandas = "^1.0.5"
    plotly = "^4.8.2"
    psutil = "^5.7.0"
    pyproj = "^2.6.1"
    python = "^3.6.10"
    pytz = "^2020.1"
    redis = "^3.5.3"
    scikit-learn = "^0.23.1"
    # tbb>=2019.5 is needed by numba when using parallel=True in jit
    # This version, however, is not available for sys_platform==darwin (on 2020-08-25)
    tbb = { version = "^2020.0.133", markers = "sys_platform != 'darwin'" }
    toml = "^0.10.1"

[tool.poetry.extras]
    mpi = ["mpi4py"]

[tool.poetry.dev-dependencies]
    black = "^19.10b0"
    flakehell = "^0.6.1"
    isort = "^5.6.4"
    pre-commit = "^2.6.0"
    pyment = "0.3.3"
    pylint = "^2.6.0"
    pytest = "^6.0.0"
    pytest-timeout = "^1.4.1"
    tox = "^3.19.0"
    # flake8 plugins
    darglint = "^1.5.5"
    flake8-bandit = "^2.1.2"
    flake8-bugbear = "^20.1.4"
    flake8-builtins = "^1.5.3"
    flake8-comprehensions = "^3.2.3"
    flake8-docstrings = "^1.5.0"
    flake8-eradicate = "^1.0.0"
    flake8-logging-format = "^0.6.0"
    flake8-mutable = "^1.2.0"
    flake8-pytest-style = "^1.3.0"
    mccabe = "^0.6.1"
    pep8-naming = "^0.11.1"

[tool.pytest.ini_options]
    testpaths = "tests"
    addopts = "-v"
    log_cli_level = "INFO"

[tool.black]
    line-length = 79

[tool.isort]
    profile = "black"
    line_length = 79

[tool.pylint.MASTER]
    # See <https://github.com/PyCQA/pylint/blob/master/pylint/extensions/docparams.py>
    load-plugins = "pylint.extensions.docparams"

[tool.pylint.BASIC]
    # We'll use pylint separate from flakhell, as we can't pass all pylint configs
    # via flakehell at the moment. E.g., the flakehell interface to pylint does not
    # yet respect the "fail-under" config.
    # For a description of the config opts used here, see:
    # <https://docs.pylint.org/en/1.6.0/options.html>
    # <https://docs.pylint.org/en/1.6.0/features.html>
    # <https://docs.pylint.org/en/1.6.0/faq.html>
    # Also, run "pylint --generate-rcfile" to see all applied pylint opts.
    fail-under = "9.0"
    good-names = ["i", "j", "n", "x", "y", "df", "db", "dt", "g0"]
    # Default value for the rgx below: "[a-z_][a-z0-9_]{2,30}$"
    attr-rgx = "[a-z_][a-z0-9_]{1,30}$"

[tool.pylint.messages_control]
    # Disable C0116 (Missing function or method docstring). Leave it to flake8-docstrings
    # Disable C0326 and C0330 to avoid clashing with black
    # See <https://black.readthedocs.io/en/stable/compatible_configs.html#pylint>
    # Disable E0402 due to false positives <https://github.com/flycheck/flycheck/issues/1758>
    disable = "C0116, C0326, C0330, E0402"

[tool.pylint.format]
    # Set max-line-length compatible with black
    max-line-length = "79"

[tool.flakehell]
    base = ".flakehell.toml"

[tool.tox]
    legacy_tox_ini = """
[tox]
isolated_build = True
envlist = py3{6,8}
skip_missing_interpreters = true

[testenv]
whitelist_externals = poetry
commands =
    rm -f poetry.lock
    poetry install -v
    pytest
"""
