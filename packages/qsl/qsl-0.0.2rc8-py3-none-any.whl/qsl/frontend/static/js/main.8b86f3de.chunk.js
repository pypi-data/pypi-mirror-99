(this.webpackJsonpqsl=this.webpackJsonpqsl||[]).push([[0],{199:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n(0),r=n.n(c),i=n(51),o=n.n(i),l=n(4),s=n(5),u=n(72),b=n(117),j=n(22),d=n(24),h=n(7),f=n(45),O=n.n(f),x=n(60),p=n(19),g=n(201),m=n(271),v=n(119),y=n(107),C=n(69),S=n(78),k=n(258),B=n(215),w=n(57),I=n(259),E=n(209),N=n(267),L=n(156),P=function(e){return Object(a.jsx)(g.a,{value:e.optionName,control:e.control,label:"".concat(e.optionName," (").concat(e.optionConfig.shortcut,")")})},M=function(e){var t=c.useState(""),n=Object(s.a)(t,2),r=n[0],i=n[1],o=c.useState("single"),l=Object(s.a)(o,2),u=l[0],b=l[1];return Object(a.jsxs)(m.a,{container:!0,spacing:3,children:[Object(a.jsx)(m.a,{item:!0,xs:6,children:Object(a.jsx)(v.a,{value:r,placeholder:"New label name",onChange:function(e){return i(e.target.value)},style:{width:"100%"}})}),Object(a.jsx)(m.a,{item:!0,xs:3,children:Object(a.jsxs)(y.a,{labelId:"config-type-selector",id:"config-type-selector",label:"New label type",value:u,onChange:function(e){return b(e.target.value)},style:{width:"100%"},children:[Object(a.jsx)(C.a,{value:"single",children:"Single"}),Object(a.jsx)(C.a,{value:"multiple",children:"Multiple"}),Object(a.jsx)(C.a,{value:"text",children:"Text"})]})}),Object(a.jsx)(m.a,{item:!0,xs:3,children:Object(a.jsx)(S.a,{variant:"contained",color:"primary",onClick:function(){e.addConfig(r,u),i("")},style:{width:"100%"},disabled:!r||e.configGroup[u].hasOwnProperty(r),children:"Add Label"})})]})},R=function(e){var t=c.useState(""),n=Object(s.a)(t,2),r=n[0],i=n[1],o=c.useState(""),l=Object(s.a)(o,2),u=l[0],b=l[1];return Object(a.jsxs)(k.a,{style:{marginBottom:"10px"},children:[Object(a.jsx)(v.a,{value:r,onChange:function(e){return i(e.target.value)},placeholder:"New option name",style:{marginRight:"10px"}}),Object(a.jsx)(v.a,{value:u,onChange:function(e){return b(e.target.value)},placeholder:"Keyboard shortcut",style:{marginRight:"10px"}}),Object(a.jsx)(S.a,{disabled:0===r.length||1!==u.length||!e.isShortcutValid(r,u),variant:"contained",color:"primary",onClick:function(){e.addOption(r,u),i(""),b("")},children:"Add Option"})]})},z=function(e){return Object(a.jsxs)(B.a,{children:[Object(a.jsx)(w.a,{component:"fieldset",children:Object(a.jsxs)(I.a,{"aria-label":e.configName,name:e.configName,value:e.selected,children:[Object(a.jsx)(E.a,{component:"legend",children:e.configName}),Object.entries(e.config.options).map((function(t){var n=Object(s.a)(t,2),c=n[0],r=n[1];return Object(a.jsx)(P,{optionName:c,optionConfig:r,control:Object(a.jsx)(N.a,{disabled:!e.onChange,onClick:function(t){return e.onChange(t,t.target.value)}})},c)}))]})}),e.setConfig?Object(a.jsx)(R,{isShortcutValid:e.isShortcutValid,addOption:function(t,n){return e.setConfig(e.configName,Object(l.a)(Object(l.a)({},e.config),{},{options:Object(l.a)(Object(l.a)({},e.config.options),{},Object(h.a)({},t,{shortcut:n,id:null}))}))}}):null]})},A=function(e){return Object(a.jsxs)("div",{children:[Object(a.jsx)(B.a,{children:Object(a.jsxs)(w.a,{component:"fieldset",children:[Object(a.jsx)(E.a,{component:"legend",children:e.configName}),Object.entries(e.config.options).map((function(t){var n=Object(s.a)(t,2),c=n[0],r=n[1];return Object(a.jsx)(P,{optionName:c,optionConfig:r,control:Object(a.jsx)(L.a,{disabled:!e.onChange,checked:!!e.selected&&e.selected.indexOf(c)>=0,onChange:function(t){return e.onChange(t,c)},name:c})},c)}))]})}),e.setConfig?Object(a.jsx)(R,{isShortcutValid:e.isShortcutValid,addOption:function(t,n){return e.setConfig(e.configName,Object(l.a)(Object(l.a)({},e.config),{},{options:Object(l.a)(Object(l.a)({},e.config.options),{},Object(h.a)({},t,{shortcut:n,id:null}))}))}}):null]})},H=function(e){return Object(a.jsx)(w.a,{component:"fieldset",children:Object(a.jsxs)(B.a,{children:[Object(a.jsx)(E.a,{component:"legend",children:e.configName}),Object(a.jsx)(v.a,{value:e.value,onChange:function(t){return e.onChange(t,t.target.value)},onBlur:e.onBlur,onFocus:e.onFocus,disabled:!e.onChange})]})})},D=function(e,t,n,a,c){if(e.hasOwnProperty(c)){var r=e[c];return r.configName===t&&r.optionName===n&&r.type===a}return!0},T=function(e){var t=e.configGroup,n=e.labels,r=e.setLabelGroup,i=e.onEnter,o=e.onShiftEnter,u=e.onCtrlEnter,b=e.onEsc,j=e.onDel,d=e.setConfigGroup,f=c.useMemo((function(){return function(e){return Object.entries(e.single).map((function(e){var t=Object(s.a)(e,2);return[t[0],t[1],"single"]})).concat(Object.entries(e.multiple).map((function(e){var t=Object(s.a)(e,2);return[t[0],t[1],"multiple"]}))).map((function(e){var t=Object(s.a)(e,3),n=t[0],a=t[1],c=t[2];return Object.entries(a.options).map((function(e){var t=Object(s.a)(e,2),a=t[0];return{key:t[1].shortcut,configName:n,optionName:a,type:c}}))})).flat().reduce((function(e,t){return e[t.key]={type:t.type,configName:t.configName,optionName:t.optionName},e}),{})}(t)}),[t]),O=c.useState(!1),x=Object(s.a)(O,2),g=x[0],m=x[1],v=c.useCallback((function(e,n,a){var c=Object(l.a)(Object(l.a)({},t),{},Object(h.a)({},n,Object(l.a)(Object(l.a)({},t[n]),{},Object(h.a)({},e,a))));d(c)}),[t,d]),y=c.useCallback((function(e,n){var a=Object(l.a)(Object(l.a)({},t),{},Object(h.a)({},n,Object(l.a)(Object(l.a)({},t[n]),{},Object(h.a)({},e,{id:null}))));"multiple"!==n&&"single"!==n||(a[n][e].options={}),d(a)}),[t,d]),C=c.useCallback((function(e,t,a){if(r){var c,i;if("single"===t||"text"===t)i="single"===t&&n[t][e]===a?null:a,c=Object(l.a)(Object(l.a)({},n),{},Object(h.a)({},t,Object(l.a)(Object(l.a)({},n[t]),{},Object(h.a)({},e,i))));else if("multiple"===t){var o=Object(p.a)(n[t][e]),s=o.indexOf(a);s>=0?o.splice(s,1):o.push(a),c=Object(l.a)(Object(l.a)({},n),{},Object(h.a)({},t,Object(l.a)(Object(l.a)({},n[t]),{},Object(h.a)({},e,o))))}r(c)}}),[n,r]);return c.useEffect((function(){var e=function(e){if(i||r||b||j)if(!f.hasOwnProperty(e.key)||e.ctrlKey||e.shiftKey||g)!i||"Enter"!==e.key||e.shiftKey||e.ctrlKey?o&&"Enter"===e.key&&e.shiftKey&&!e.ctrlKey?o():u&&"Enter"===e.key&&!e.shiftKey&&e.ctrlKey?u():b&&"Escape"===e.key?b():j&&"Delete"===e.key&&j():i();else{var t=f[e.key],n=t.type,a=t.configName,c=t.optionName;C(a,n,c)}};return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[i,r,f,g,C]),Object(a.jsxs)("div",{children:[Object.entries(t.single).map((function(t){var n=Object(s.a)(t,2),c=n[0],i=n[1];return Object(a.jsx)(z,{config:i,onChange:r?function(e,t){return C(c,"single",t)}:null,setConfig:e.setConfigGroup?function(e,t){return v(e,"single",t)}:null,isShortcutValid:function(e,t){return D(f,c,e,"single",t)},configName:c,selected:e.labels?e.labels.single[c]:null},c)})),Object.entries(t.multiple).map((function(t){var n=Object(s.a)(t,2),c=n[0],i=n[1];return Object(a.jsx)(A,{config:i,onChange:r?function(e,t){return C(c,"multiple",t)}:null,setConfig:e.setConfigGroup?function(e,t){return v(e,"multiple",t)}:null,isShortcutValid:function(e,t){return D(f,c,e,"multiple",t)},configName:c,selected:e.labels?e.labels.multiple[c]:null},c)})),Object.entries(t.text).map((function(t){var n=Object(s.a)(t,2),c=n[0];n[1];return Object(a.jsx)(H,{onChange:r?function(e,t){return C(c,"text",t)}:null,onFocus:function(){return m(!0)},onBlur:function(){return m(!1)},configName:c,value:e.labels&&e.labels.text[c]||""},c)})),e.setConfigGroup?Object(a.jsx)(M,{addConfig:y,configGroup:t}):null]})},_=n(203).a({startIcon:{position:"absolute",left:"8px"},label:{paddingLeft:"40px"}})(S.a),U=n(272),F=n(273),G=n(216),K=n(213),q=n(47),V=q.a((function(e){return{root:{"& a":{color:"white",textDecoration:"none"}}}})),W=function(e){var t,n=e.project&&0!==e.project.nImages?Math.round(100*e.project.nLabeled/e.project.nImages):null,c=V();return Object(a.jsx)(U.a,{position:null!==(t=e.position)&&void 0!==t?t:"static",style:{zIndex:1201},children:Object(a.jsxs)(F.a,{children:[n?Object(a.jsxs)(k.a,{position:"relative",display:"inline-flex",children:[Object(a.jsx)(G.a,{style:{color:"white"},variant:"determinate",size:40,color:"secondary",value:n}),Object(a.jsx)(k.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(a.jsx)(K.a,{variant:"caption",component:"div",style:{color:"white"},children:"".concat(n,"%")})})]}):null,Object(a.jsx)(K.a,{variant:"h6",style:{marginLeft:"10px"},className:c.root,children:e.children})]})})},J=n(79),Y=n(274),Q=n(275),X=n(276),Z=n(268),$=n(277),ee=n(278),te=n(260),ne=n(261),ae=n(262),ce=n(263),re=n(48),ie=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"",oe=function(e){return{text:Object.entries(e.text).reduce((function(e,t){var n=Object(s.a)(t,2),a=n[0];n[1];return Object(l.a)(Object(l.a)({},e),{},Object(h.a)({},a,null))}),{}),multiple:Object.entries(e.multiple).reduce((function(e,t){var n=Object(s.a)(t,2),a=n[0];n[1];return Object(l.a)(Object(l.a)({},e),{},Object(h.a)({},a,[]))}),{}),single:Object.entries(e.single).reduce((function(e,t){var n=Object(s.a)(t,2),a=n[0];n[1];return Object(l.a)(Object(l.a)({},e),{},Object(h.a)({},a,null))}),{})}},le=function(e){return{image:oe(e.labelingConfiguration.image),boxes:[],default:!1,ignored:!1}},se=function(e){return Object.keys(e.box.single).length>0||Object.keys(e.box.multiple).length>0||Object.keys(e.box.text).length>0},ue={credentials:"include"},be={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"},je=function(e){return fetch("".concat(ie,"/api/v1/projects/").concat(e),ue).then((function(e){return e.json()}))},de=function(e,t){return fetch("".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),ue).then((function(e){return e.json()}))},he=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=t.map((function(e){return"exclude=".concat(e)})).join("&"),l="".concat(ie,"/api/v1/projects/").concat(e,"/images?shuffle=").concat(a,"&limit=").concat(n,"&exclude_ignored=").concat(c,"&max_labels=").concat(r,"&").concat(o);return i&&(l+="&page=".concat(i)),fetch(l,ue).then((function(e){return e.json()}))},fe=function(e,t,n){return fetch("".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),Object(l.a)(Object(l.a)({},be),{},{body:JSON.stringify(n)})).then((function(e){return e.json()}))},Oe=function(e,t){return fetch("".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),Object(l.a)(Object(l.a)({},ue),{},{method:"DELETE"})).then((function(e){return e.json()}))},xe=function(e,t){return"".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/file")},pe=function(e){return"".concat(ie,"/api/v1/projects/").concat(e,"/export")},ge=function(e){return new Promise((function(t){return setTimeout(t,e)}))},me=function(){var e=Object(x.a)(O.a.mark((function e(t){var n,a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=t.current)||void 0===n||n.focus({preventScroll:!0}),e.next=3,ge(200);case 3:null===(a=t.current)||void 0===a||a.blur(),null===(c=t.current)||void 0===c||c.click();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=function(e){return Object.fromEntries(e.map((function(e){return[e.id,{selected:!0,remoteStatus:"unknown"}]})))},ye=q.a((function(e){return{checkbox:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"},checked:{color:"rgba(0, 150, 0, 1)"},unchecked:{color:"rgba(150, 0, 0, 1)"}}})),Ce=function(e){var t=ye(),n=function(n){return Object(a.jsx)(J.a,{className:"".concat(t.checkbox," ").concat(n.selected?t.checked:t.unchecked),onClick:function(){return e.toggleSelected(n.image.id)},"aria-label":"selected ".concat(n.image.id),children:n.selected?Object(a.jsx)(te.a,{}):Object(a.jsx)(ne.a,{})})};return Object(a.jsx)(Y.a,{rowHeight:e.thumbnailSize,cols:Math.ceil(800/e.thumbnailSize),children:e.items.map((function(t){return Object(a.jsxs)(Q.a,{cols:1,children:[Object(a.jsx)("img",{style:{maxWidth:"100%",maxHeight:"100%",height:"100%",width:"100%",objectFit:"contain",transform:"none",margin:"auto",position:"absolute",top:0,bottom:0,left:0,right:0},src:xe(e.projectId,t.image.id),alt:"ID: ".concat(t.image.id),onClick:function(){return e.toggleSelected(t.image.id)}}),n(t)]},t.image.id)}))})},Se=function(){var e=d.g().params,t=e.projectId,n=e.imageIds,r=c.useState({labels:null,dirty:!1,saved:[],batches:[],batchSize:10,thumbnailSize:160,redirecting:!1,advanceOnSave:!1,history:[],project:null,currentBatchStatus:{},currentBatch:[]}),i=Object(s.a)(r,2),o=i[0],u=i[1],b=c.useRef(),f=c.useRef(),p=c.useRef(),v=c.useRef(),y=c.useRef(),C=c.useRef(),B=c.useRef(),w=c.useCallback((function(){return o.history.filter((function(e){return e.images.map((function(e){return e.id})).join(",")!==n}))}),[o,n]),I=c.useCallback((function(e){var n,a,c=o.currentBatch.filter((function(e){return o.currentBatchStatus[e.id].selected}));switch(e){case"ignore":a="ignored",n=c.map((function(e){return fe(t,e.id,Object(l.a)(Object(l.a)({},o.labels),{},{ignored:!0}))}));break;case"delete":a="unknown",n=c.map((function(e){return Oe(t,e.id)}));break;case"save":a="labeled",n=c.map((function(e){return fe(t,e.id,o.labels)}))}Promise.all(n).then((function(){var e=Object(l.a)(Object(l.a)({},o),{},{currentBatchStatus:Object(l.a)(Object(l.a)({},o.currentBatchStatus),Object.fromEntries(c.map((function(e){return[e.id,{selected:!1,remoteStatus:a}]}))))});u(e),o.advanceOnSave&&Object.entries(e.currentBatchStatus).filter((function(e){var t=Object(s.a)(e,2);t[0];return"unknown"!==t[1].remoteStatus})).length===e.currentBatch.length&&me(f)}))}),[o,f]),E=c.useCallback((function(){var e=[{images:o.currentBatch,status:o.currentBatchStatus}].concat(w());u(Object(l.a)(Object(l.a)({},o),{},{currentBatch:o.batches[0],currentBatchStatus:ve(o.batches[0]),batches:o.batches.slice(1),history:e,redirecting:!0}))}),[o,w]),N=c.useCallback((function(){u(Object(l.a)(Object(l.a)({},o),{},{history:o.history.slice(1),currentBatch:o.history[0].images,currentBatchStatus:o.history[0].status,batches:[o.currentBatch].concat(o.batches),redirecting:!0}))}),[o]),P=c.useCallback((function(){return u(Object(l.a)(Object(l.a)({},o),{},{currentBatchStatus:ve(o.currentBatch)}))}),[o]),M=c.useCallback((function(){return u(Object(l.a)(Object(l.a)({},o),{},{currentBatchStatus:Object.fromEntries(Object.entries(o.currentBatchStatus).map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return[n,Object(l.a)(Object(l.a)({},a),{},{selected:"unknown"===a.remoteStatus})]})))}))}),[o]),R=c.useCallback((function(){return u(Object(l.a)(Object(l.a)({},o),{},{currentBatchStatus:Object.fromEntries(Object.entries(o.currentBatchStatus).map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return[n,Object(l.a)(Object(l.a)({},a),{},{selected:!1})]})))}))}),[o]);c.useEffect((function(){var e=n.split(",").map((function(e){return{id:parseInt(e)}})),a=ve(e),c=o.batches.length>0?Promise.resolve(o.batches):he(t,e.map((function(e){return e.id})),o.batchSize,!0,!0,0).then((function(e){return Promise.resolve([e])}));Promise.all([je(t),de(t,e[0].id),c]).then((function(t){var n=Object(s.a)(t,3),c=n[0],r=n[1],i=n[2];return u(Object(l.a)(Object(l.a)({},o),{},{labels:r,batches:i,project:c,currentBatchStatus:a,currentBatch:e,redirecting:!1}))}))}),[t,n]),c.useEffect((function(){var e=function(){var e=Object(x.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,e.t0=t.key,e.next="A"===e.t0?4:"a"===e.t0?6:"ArrowRight"===e.t0?8:"ArrowLeft"===e.t0?10:"Enter"===e.t0?12:"Backspace"===e.t0||"Delete"===e.t0?14:16;break;case 4:return n=t.ctrlKey&&t.shiftKey?B:null,e.abrupt("break",16);case 6:return n=t.ctrlKey&&!t.shiftKey?C:null,e.abrupt("break",16);case 8:return n=f,e.abrupt("break",16);case 10:return n=p,e.abrupt("break",16);case 12:return n=t.shiftKey?v:b,e.abrupt("break",16);case 14:return n=y,e.abrupt("break",16);case 16:n&&me(n);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[o,f,p,b,v,y,C,B]);var z=null;if(o.redirecting){var A=o.currentBatch.map((function(e){return e.id})).join(",");A?A!==n&&(z=Object(a.jsx)(d.a,{to:"/projects/".concat(t,"/batches/").concat(A),push:!0})):z=Object(a.jsx)(d.a,{to:"/projects/".concat(t),push:!0})}if(!o.project||!o.labels)return null;var H=Object.entries(o.currentBatchStatus).reduce((function(e,t){var n=Object(s.a)(t,2);n[0];return e+("labeled"===n[1].remoteStatus?1:0)}),0),D=Object.entries(o.currentBatchStatus).reduce((function(e,t){var n=Object(s.a)(t,2);n[0];return e+("ignored"===n[1].remoteStatus?1:0)}),0),U=Object.entries(o.currentBatchStatus).reduce((function(e,t){var n=Object(s.a)(t,2);n[0];return e+n[1].selected}),0);return Object(a.jsxs)(m.a,{container:!0,spacing:2,children:[Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsxs)(W,{project:o.project,children:[o.project.name," / Batches"]})}),Object(a.jsxs)(m.a,{item:!0,xs:3,children:[Object(a.jsxs)(m.a,{item:!0,children:[z,Object(a.jsx)(K.a,{style:{marginBottom:"10px"},variant:"h6",children:"Image-Level Labels"}),o.labels&&o.project?Object(a.jsx)(T,{configGroup:o.project.labelingConfiguration.image,labels:o.labels.image,setLabelGroup:function(e){return u(Object(l.a)(Object(l.a)({},o),{},{labels:{boxes:[],image:e,default:!1,ignored:!1}}))}}):null,Object(a.jsx)(X.a,{})]}),Object(a.jsxs)(m.a,{item:!0,children:[Object(a.jsx)(K.a,{variant:"h6",children:"View Settings"}),Object(a.jsx)(K.a,{id:"batch-size-selector",gutterBottom:!0,children:"Target Batch Size"}),Object(a.jsx)(Z.a,{value:o.batchSize,"aria-labelledby":"batch-size-selector",valueLabelDisplay:"auto",onChange:function(e,t){return u(Object(l.a)(Object(l.a)({},o),{},{batchSize:t}))},step:10,marks:!0,min:10,max:110}),Object(a.jsx)(K.a,{id:"batch-size-selector",gutterBottom:!0,children:"Thumbnail Size"}),Object(a.jsx)(Z.a,{value:o.thumbnailSize,"aria-labelledby":"batch-size-selector",valueLabelDisplay:"auto",onChange:function(e,t){return u(Object(l.a)(Object(l.a)({},o),{},{thumbnailSize:t}))},step:20,marks:!0,min:160,max:500}),Object(a.jsx)(X.a,{})]}),Object(a.jsxs)(m.a,{item:!0,children:[Object(a.jsx)(K.a,{style:{marginBottom:"10px"},variant:"h6",children:"Label Actions"}),Object(a.jsxs)($.a,{size:"small",orientation:"vertical",color:"primary",style:{width:"100%"},"aria-label":"acton button group",children:[Object(a.jsx)(_,{startIcon:"\u23ce",disabled:H+D===o.currentBatch.length||0===U,onClick:function(){return I("save")},ref:b,children:"Save"}),Object(a.jsx)(_,{startIcon:"\u21e7\u23ce",disabled:H+D===o.currentBatch.length||0===U,onClick:function(){return I("ignore")},ref:v,children:"Ignore"}),Object(a.jsx)(_,{startIcon:"\u232b",ref:y,disabled:H+D===o.currentBatch.length||0===U,onClick:function(){return I("delete")},children:"Remove Labels"}),Object(a.jsx)(_,{startIcon:Object(a.jsx)(ae.a,{}),ref:f,onClick:E,disabled:0===o.batches.length,children:"Next"}),Object(a.jsx)(_,{startIcon:Object(a.jsx)(ce.a,{}),onClick:N,ref:p,disabled:0===w().length,children:"Previous"}),Object(a.jsx)(_,{disabled:U===o.currentBatch.length-H,onClick:M,startIcon:"\u2303A",ref:C,children:"Select All"}),Object(a.jsx)(_,{startIcon:"\u2303\u21e7A",disabled:0===U,onClick:R,ref:B,children:"Select None"})]}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:o.advanceOnSave,onChange:function(e,t){return u(Object(l.a)(Object(l.a)({},o),{},{advanceOnSave:t}))},name:"advanceOnSave"}),label:"Advance when batch complete?"}),se(o.project.labelingConfiguration)?Object(a.jsx)(K.a,{variant:"body1",children:"This project has box-level labels which will be overwritten in batch mode."}):null]}),Object(a.jsxs)(m.a,{item:!0,children:[Object(a.jsx)(X.a,{style:{marginBottom:"10px"}}),Object(a.jsx)(K.a,{variant:"h6",children:"History"}),Object(a.jsx)(K.a,{variant:"caption",children:"Ten most recently reviewed batches."}),Object(a.jsx)(re.a,{rows:o.history.map((function(e){return Object(l.a)(Object(l.a)({},e),{},{id:e.images.map((function(e){return e.id})).join(",")})})),hideFooterPagination:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,hideFooter:!0,disableColumnReorder:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"images",headerName:"ID",flex:1,renderCell:function(e){var n=e.value.map((function(e){return e.id}));return Object(a.jsx)(j.b,{to:"/projects/".concat(t,"/images/").concat(n.join(",")),children:n.slice(0,5).join(", ")+(n.length>5?", ...":"")})}}]}),z,Object(a.jsx)(X.a,{style:{marginBottom:"10px"}}),Object(a.jsx)(ee.a,{component:j.b,variant:"body1",to:"/projects/".concat(t),children:"Return to Project Menu"})]})]}),Object(a.jsxs)(m.a,{item:!0,xs:9,children:[H+D<o.currentBatch.length?Object(a.jsxs)(k.a,{children:[Object(a.jsx)(Ce,{items:o.currentBatch.filter((function(e){return"unknown"===o.currentBatchStatus[e.id].remoteStatus})).map((function(e){return{image:e,selected:o.currentBatchStatus[e.id].selected}})),thumbnailSize:o.thumbnailSize,projectId:t,toggleSelected:function(e){return u(Object(l.a)(Object(l.a)({},o),{},{currentBatchStatus:Object(l.a)(Object(l.a)({},o.currentBatchStatus),{},Object(h.a)({},e,Object(l.a)(Object(l.a)({},o.currentBatchStatus[e]),{},{selected:!o.currentBatchStatus[e].selected})))}))}}),Object(a.jsx)(X.a,{style:{marginBottom:"10px"}})]}):null,Object(a.jsxs)(m.a,{container:!0,direction:"row",alignItems:"center",spacing:1,children:[Object(a.jsx)(m.a,{item:!0,children:Object(a.jsx)(S.a,{onClick:P,disabled:0===H&&0===D,variant:"contained",children:"Reset"})}),Object(a.jsx)(m.a,{item:!0,children:Object(a.jsxs)(K.a,{variant:"body1",children:["Hiding ",H," labeled and ",D," ignored images."]})})]})]})]})},ke=n(159),Be=n(264),we=n(269),Ie=n(279),Ee=n(265),Ne=n(143),Le=n.n(Ne),Pe=function(e){return"".concat(100*e,"%")},Me=function(e){var t=e.points&&e.points.length>0,n=t&&2===e.points.length&&e.points[0].x===e.points[1].x&&e.points[0].y===e.points[1].y?e.points.slice(0,1):e.points;return{x:t?null:Math.min(e.x1,e.x2),y:t?null:Math.min(e.y1,e.y2),w:t?null:Math.abs(e.x2-e.x1),h:t?null:Math.abs(e.y2-e.y1),id:e.id,labels:e.labels,points:n}},Re=function(e,t,n){var a=t.getBoundingClientRect(),c=a.x,r=a.y,i=a.width,o=a.height;return{x:(e.nativeEvent.pageX-window.scrollX-c*n)/(i*n),y:(e.nativeEvent.pageY-window.scrollY-r*n)/(o*n)}},ze=function(e){if(!e.draftBox&&!e.box)return null;var t=e.box&&null!==e.box.points||e.draftBox&&null!==e.draftBox.points;if(!t&&e.draftBox&&!(e.draftBox.x1&&e.draftBox.x2&&e.draftBox.y1&&e.draftBox.y2))return null;var n=e.draftBox?Me(e.draftBox):e.box;if(t&&0===n.points.length)return null;var c=e.draftBox?"red":"blue",r=t?Math.min.apply(Math,n.points.map((function(e){return e.x}))):n.x,i=t?Math.min.apply(Math,n.points.map((function(e){return e.y}))):n.y,o=t?Math.max.apply(Math,n.points.map((function(e){return e.x}))):n.x+n.w,l=t?Math.max.apply(Math,n.points.map((function(e){return e.y}))):n.y+n.h,s=t?o-r:n.w,u=t?l-i:n.h,b=null;b=t&&s>0&&u>0?Object(a.jsx)("svg",{children:Array.from(Array(n.points.length-1).keys()).map((function(e){return Object(a.jsx)("line",{stroke:c,strokeWidth:"4",x1:Pe((n.points[e].x-r)/s),y1:Pe((n.points[e].y-i)/u),x2:Pe((n.points[e+1].x-r)/s),y2:Pe((n.points[e+1].y-i)/u)},e)}))}):t?Object(a.jsx)("rect",{transform:"translate(-5, -5)",width:10,height:10,fill:c}):Object(a.jsx)("rect",{width:"100%",height:"100%",stroke:c,fill:"none",strokeWidth:"4"});var j,d=null;if(e.draftBox&&e.draftBox.fixed&&!t&&null!==e.draftBox.next){var h=e.draftBox.y1>e.draftBox.y2,f=e.draftBox.x1>e.draftBox.x2,O=1===e.draftBox.next&&!h||2===e.draftBox.next&&h,x=1===e.draftBox.next&&!f||2===e.draftBox.next&&f;d=Object(a.jsx)("rect",{x:x?"0%":"100%",y:O?"0%":"100%",transform:"translate(-5, -5)",width:10,height:10,fill:"red"})}else e.draftBox&&t&&null!==e.draftBox.next&&s>0&&u>0&&(d=Object(a.jsx)("rect",{x:Pe((n.points[0].x-r)/s),y:Pe((n.points[0].y-i)/u),transform:"translate(-5, -5)",width:10,height:10,fill:"red"}));return Object(a.jsxs)("svg",{width:s>0?Pe(s):10,height:u>0?Pe(u):10,onClick:e.onClick,onMouseMove:e.onMouseMove,style:{position:"absolute",left:Pe(r),top:Pe(i),overflow:"visible"},children:[Object(a.jsx)("text",{x:5,y:5,fill:c,"font-family":"Roboto,Helvetica,Arial,sans-serif",alignmentBaseline:"hanging",children:(j=n.labels,Object.values(j.single).join(", "))}),b,d]})},Ae=function(e){var t=d.g().params,n=t.projectId,r=t.imageId,i=c.useRef(),o=Le.a.debounce((function(t){e.onHover(Re(t,i.current,e.zoom))}),5);return Object(a.jsx)("div",{children:Object(a.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[Object(a.jsx)(ze,{onMouseMove:o,onClick:function(t){return e.onSelectBox(null,Re(t,i.current,e.zoom))},draftBox:e.draftBox}),Object(a.jsxs)(ke.a,{children:[e.boxes.map((function(t,n){return Object(a.jsx)(ze,{box:t,onMouseMove:o,onClick:function(t){return e.onSelectBox(n,Re(t,i.current,e.zoom))}},n)})),Object(a.jsx)("img",{onClick:function(t){e.onClick&&e.onClick(Re(t,i.current,e.zoom))},onMouseMove:o,ref:i,src:xe(n,r),alt:"ID: ".concat(r),style:{display:"block",zoom:e.zoom}})]})]})})},He=function(e){return e.length>0?e[0].id.toString():null},De=function(e,t,n){return[{id:parseInt(e),status:t}].concat(n.filter((function(t){return t.id!==parseInt(e)}))).slice(0,10)},Te=function(){var e=d.g().params,t=e.projectId,n=e.imageId,r=c.useRef(),i=c.useRef(),o=c.useRef(),u=c.useRef(),b=c.useRef(),h=c.useRef(),f=c.useRef(),p=c.useState(null),m=Object(s.a)(p,2),v=m[0],y=m[1],C=c.useState(null),S=Object(s.a)(C,2),B=S[0],I=S[1],N=c.useState({queueSize:20,desiredImageId:n,status:"initializing",usePolygon:!1,labels:null,advanceOnSave:!1,dirty:!1,notice:null,history:[],queue:[]}),P=Object(s.a)(N,2),M=P[0],R=P[1],z=c.useState(1),A=Object(s.a)(z,2),H=A[0],D=A[1],U=v&&v.fixed,G=B?U?B.labelingConfiguration.box:B.labelingConfiguration.image:null,q=M.labels?U?v.labels:M.labels.image:null,V=c.useCallback((function(e){if(v)if(v&&null!==v.next){var t=v.points&&v.points.length>1,n=t?(a={x:e.x,y:e.y},c=v.points[0],Math.sqrt(Math.pow(a.y-c.y,2)+Math.pow(a.x-c.x,2))<.001?c:a):null;y(Object(l.a)(Object(l.a)({},v),{},{x1:t?null:1===v.next?e.x:v.x1,y1:t?null:1===v.next?e.y:v.y1,x2:t?null:2===v.next?e.x:v.x2,y2:t?null:2===v.next?e.y:v.y2,fixed:!0,next:1===v.next?2:1,points:t?v.points.concat([n]):null}))}else R(Object(l.a)(Object(l.a)({},M),{},{labels:Object(l.a)(Object(l.a)({},M.labels),{},{boxes:[Me(v)].concat(M.labels.boxes),default:!1})})),y(null);else y({x1:M.usePolygon?null:e.x,y1:M.usePolygon?null:e.y,x2:null,y2:null,labels:oe(B.labelingConfiguration.box),id:null,fixed:!!M.usePolygon,points:M.usePolygon?[{x:e.x,y:e.y},{x:e.x,y:e.y}]:null,next:2});var a,c}),[M,v,B]),Y=c.useCallback((function(e){!v||v.points||v.fixed||null===v.next||y(Object(l.a)(Object(l.a)({},v),{},{x2:e.x,y2:e.y}))}),[M,v]),Q=c.useCallback((function(e,t){if(v)v&&null!==v.next?V(t):v&&null===v.next&&(R(Object(l.a)(Object(l.a)({},M),{},{labels:Object(l.a)(Object(l.a)({},M.labels),{},{boxes:[Me(v)].concat(M.labels.boxes),default:!1})})),y(null));else{var n=M.labels.boxes.splice(e,1)[0];y({x1:(a=n).x,x2:a.x+a.w,y1:a.y,y2:a.y+a.h,labels:a.labels,id:a.id,next:null,fixed:!0,points:a.points}),R(Object(l.a)(Object(l.a)({},M),{},{labels:Object(l.a)(Object(l.a)({},M.labels),{},{boxes:M.labels.boxes,default:!1})}))}var a}),[M,v]);c.useEffect((function(){je(t).then(I)}),[t,n]),c.useEffect((function(){var e=M.queue.filter((function(e){return e.id.toString()!==n})),a=e.map((function(e){return e.id})).concat(n?[parseInt(n)]:[]);Promise.all([n?de(t,n):Promise.resolve(null),M.queueSize<=e.length?Promise.resolve([]):he(t,a,M.queueSize-e.length)]).then((function(t){var a=Object(s.a)(t,2),c=a[0],r=a[1],i=e.concat(r);R(Object(l.a)(Object(l.a)({},M),{},{labels:c,queue:i,status:n?"waiting":"redirecting",desiredImageId:n||He(i)}))}))}),[n]);var ee=c.useCallback((function(){R(Object(l.a)(Object(l.a)({},M),{},{dirty:!0})),y(null)}),[M]),te=c.useCallback((function(){M.labels.default||Oe(t,n).then((function(e){R(Object(l.a)(Object(l.a)({},M),{},{labels:e,dirty:!1,history:De(n,"Unlabeled",M.history),notice:"Deleted your label and reverted to default."}))}))}),[n,M]),ne=c.useCallback((function(){return R(Object(l.a)(Object(l.a)({},M),{},{notice:null}))}),[M]),ie=c.useCallback((function(){fe(t,n,Object(l.a)(Object(l.a)({},M.labels),{},{ignored:!1})).then(function(){var e=Object(x.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R(Object(l.a)(Object(l.a)({},M),{},{labels:t,dirty:!1,history:De(n,"Labeled",M.history),notice:"Saved your labels."})),M.advanceOnSave&&me(r);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[M,r]),le=c.useCallback((function(){y(null),R(Object(l.a)(Object(l.a)({},M),{},{dirty:!0,labels:Object(l.a)(Object(l.a)({},M.labels),{},{boxes:M.labels.boxes.concat([Me(v)])})}))}),[v,M]),ue=c.useCallback((function(){U||fe(t,n,Object(l.a)(Object(l.a)({},M.labels),{},{ignored:!0})).then((function(e){R(Object(l.a)(Object(l.a)({},M),{},{labels:e,dirty:!1,history:De(n,"Ignored",M.history),notice:"Ignored this image."}))}))}),[M,U]),be=c.useCallback((function(){U||R(Object(l.a)(Object(l.a)({},M),{},{desiredImageId:He(M.queue),history:De(n,M.labels.ignored?"Ignored":M.labels.default?"Unlabeled":"Labeled",M.history),notice:"Advancing to next image.",status:"redirecting"}))}),[n,M.labels,M]),pe=c.useCallback((function(){U||0===M.history.length||R(Object(l.a)(Object(l.a)({},M),{},{desiredImageId:M.history.length>0?M.history[0].id.toString():null,history:M.history.slice(1),queue:[{id:parseInt(n)}].concat(M.queue),status:"redirecting"}))}),[n,M]),ge=c.useCallback((function(e){U?(y(Object(l.a)(Object(l.a)({},v),{},{labels:e})),R(Object(l.a)(Object(l.a)({},M),{},{dirty:!0}))):R(Object(l.a)(Object(l.a)({},M),{},{dirty:!0,labels:Object(l.a)(Object(l.a)({},M.labels),{},{image:e,default:!1})}))}),[M,v]);c.useEffect((function(){var e=function(){var e=Object(x.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,e.t0=t.key,e.next="ArrowRight"===e.t0?4:"ArrowLeft"===e.t0?6:"Enter"===e.t0?8:"Backspace"===e.t0||"Delete"===e.t0?10:12;break;case 4:return n=r,e.abrupt("break",12);case 6:return n=i,e.abrupt("break",12);case 8:return n=U?h:t.shiftKey?u:o,e.abrupt("break",12);case 10:return n=U?f:null,e.abrupt("break",12);case 12:n&&me(n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[M,U,h,f,r,i,o,u,b]);var ve="redirecting"===M.status?Object(a.jsx)(d.a,{to:M.desiredImageId?"/projects/".concat(t,"/images/").concat(M.desiredImageId):"/projects/".concat(t),push:!0}):null;if(!M.labels||!B)return ve;return Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)(Be.a,{}),Object(a.jsxs)(W,{project:B,position:"fixed",children:[Object(a.jsx)(j.b,{to:"/projects/".concat(t),children:B.name})," / Images / ",n]}),Object(a.jsx)(we.a,{variant:"permanent",style:{flexShrink:0},children:Object(a.jsxs)(k.a,{style:{padding:"10px",width:250},children:[Object(a.jsx)(F.a,{}),ve,Object(a.jsx)(K.a,{style:{marginBottom:"10px"},variant:"h6",children:U?"Box-Level Labels":"Image-Level Labels"}),Object(a.jsx)(T,{configGroup:G,labels:q,setLabelGroup:ge}),Object(a.jsx)(X.a,{style:{marginTop:"10px"}}),Object(a.jsx)(K.a,{variant:"h6",children:"View Settings"}),Object(a.jsxs)(w.a,{style:{margin:"10px 0px",width:"100%"},component:"fieldset",children:[Object(a.jsx)(E.a,{component:"legend",children:"Zoom"}),Object(a.jsx)(Z.a,{style:{margin:"0 5px"},valueLabelDisplay:"auto","aria-labelledby":"zoom-slider",value:H,min:1,max:5,onChange:function(e,t){return D(t)}})]}),Object(a.jsx)(X.a,{}),Object(a.jsx)(K.a,{style:{marginBottom:"10px"},variant:"h6",children:"Label Actions"}),Object(a.jsxs)($.a,{size:"small",orientation:"vertical",color:"primary",style:{width:"100%"},"aria-label":"acton button group",children:[U?Object(a.jsx)(_,{startIcon:"\u23ce",onClick:le,ref:h,children:"Set Box Label"}):null,U?Object(a.jsx)(_,{startIcon:"\u232b",onClick:ee,ref:f,children:"Delete Box"}):null,U?null:Object(a.jsx)(_,{startIcon:"\u23ce",disabled:!M.labels.default&&!M.dirty,onClick:ie,ref:o,children:"Save"}),U?null:Object(a.jsx)(_,{startIcon:"\u21e7\u23ce",disabled:M.labels.ignored,onClick:ue,ref:u,children:"Ignore"}),U?null:Object(a.jsx)(_,{startIcon:Object(a.jsx)(ae.a,{}),ref:r,onClick:be,children:"Next"}),U?null:Object(a.jsx)(_,{startIcon:Object(a.jsx)(ce.a,{}),onClick:pe,ref:i,disabled:0===M.history.filter((function(e){return e.id!==parseInt(n)})).length,children:"Previous"}),U?null:Object(a.jsx)(_,{disabled:M.labels.default,ref:b,onClick:te,children:M.labels.ignored?"Unignore":"Remove Label"})]}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:M.advanceOnSave,onChange:function(e,t){return R(Object(l.a)(Object(l.a)({},M),{},{advanceOnSave:t}))},name:"advanceOnSave"}),label:"Advance on saving?"}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:M.usePolygon,onChange:function(e,t){return R(Object(l.a)(Object(l.a)({},M),{},{usePolygon:t}))},name:"usePolygon"}),label:"Use polygons instead of boxes?"}),Object(a.jsx)(X.a,{style:{marginBottom:"10px"}}),Object(a.jsx)(K.a,{variant:"h6",children:"History"}),Object(a.jsx)(K.a,{variant:"caption",children:"Ten most recently reviewed images."}),Object(a.jsx)(re.a,{rows:M.history,hideFooterPagination:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,hideFooter:!0,disableColumnReorder:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,renderCell:function(e){return Object(a.jsx)(j.b,{to:"/projects/".concat(t,"/images/").concat(e.value),children:e.value})}},{field:"status",headerName:"Status",flex:3}]})]})}),Object(a.jsxs)("div",{style:{width:"calc(100%-".concat(250,"px"),marginLeft:250},children:[Object(a.jsx)(F.a,{}),Object(a.jsx)(Ae,{onClick:se(B.labelingConfiguration)?V:null,onHover:Y,onSelectBox:Q,boxes:M.labels.boxes,draftBox:v,zoom:H}),Object(a.jsx)(Ie.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:null!==M.notice,autoHideDuration:1500,onClose:ne,message:M.notice,action:Object(a.jsx)(c.Fragment,{children:Object(a.jsx)(J.a,{size:"small","aria-label":"close",color:"inherit",onClick:ne,children:Object(a.jsx)(Ee.a,{fontSize:"small"})})})}),M.queue&&M.queue.length?M.queue.map((function(e,c){return Object(a.jsx)("img",{alt:"Background Load: ".concat(e.id),src:xe(t,n),style:{width:0,height:0}},c)})):null]})]})},_e=function(){var e=d.g().params.projectId,t=c.useState(null),n=Object(s.a)(t,2),r=n[0],i=n[1],o=c.useState(!1),u=Object(s.a)(o,2),b=u[0],h=u[1],f=c.useState(!1),O=Object(s.a)(f,2),x=O[0],p=O[1],g=c.useCallback((function(){return function(e,t){return fetch("".concat(ie,"/api/v1/projects/").concat(e),Object(l.a)(Object(l.a)({},be),{},{body:JSON.stringify(t)})).then((function(e){return e.json()}))}(e,r).then((function(e){i(e),h(!1),p(!0)}))}),[r,i]),v=c.useCallback((function(){je(e).then(i)}),[e]);return c.useEffect((function(){v()}),[e]),r?x?Object(a.jsx)(d.a,{to:"/projects/".concat(e)}):Object(a.jsxs)(m.a,{container:!0,spacing:2,children:[Object(a.jsxs)(m.a,{item:!0,xs:12,children:[Object(a.jsx)(j.b,{to:"/projects/".concat(e),children:Object(a.jsx)(K.a,{variant:"subtitle1",children:"Back to project menu"})}),Object(a.jsxs)(K.a,{variant:"h3",children:["Project: ",r.name]}),Object(a.jsx)(K.a,{variant:"h5",children:"Edit Labeling Configuration"})]}),Object(a.jsxs)(m.a,{item:!0,xs:12,sm:6,children:[Object(a.jsx)(K.a,{variant:"h6",children:"Image-Level Labels"}),Object(a.jsx)(T,{configGroup:r.labelingConfiguration.image,setConfigGroup:function(e){h(!0),i(Object(l.a)(Object(l.a)({},r),{},{labelingConfiguration:Object(l.a)(Object(l.a)({},r.labelingConfiguration),{},{image:e})}))}})]}),Object(a.jsxs)(m.a,{item:!0,sm:12,md:6,children:[Object(a.jsx)(K.a,{variant:"h6",children:"Box-Level Labels"}),Object(a.jsx)(T,{configGroup:r.labelingConfiguration.box,setConfigGroup:function(e){h(!0),i(Object(l.a)(Object(l.a)({},r),{},{labelingConfiguration:Object(l.a)(Object(l.a)({},r.labelingConfiguration),{},{box:e})}))}})]}),Object(a.jsxs)(m.a,{item:!0,container:!0,xs:12,spacing:2,children:[Object(a.jsx)(m.a,{item:!0,children:Object(a.jsx)(S.a,{onClick:g,variant:"contained",disabled:!b,color:"primary",children:"Save Labeling Configuration"})}),Object(a.jsx)(m.a,{item:!0,children:Object(a.jsx)(S.a,{onClick:v,variant:"contained",disabled:!b,color:"secondary",children:"Reset"})})]})]}):null},Ue=r.a.createContext({apiUrl:null,postHeaders:null,getHeaders:null,queueSize:null,user:null}),Fe=function(){var e=c.useContext(Ue),t=c.useState(""),n=Object(s.a)(t,2),r=n[0],i=n[1],o=c.useState([]),u=Object(s.a)(o,2),b=u[0],d=u[1];c.useEffect((function(){fetch("".concat(e.apiUrl,"/api/v1/projects"),Object(l.a)({},e.getHeaders)).then((function(e){return e.json()})).then(d)}),[]);var h=c.useCallback((function(){fetch("".concat(e.apiUrl,"/api/v1/projects"),Object(l.a)(Object(l.a)({},e.postHeaders),{},{body:JSON.stringify({name:r})})).then((function(e){return e.json()})).then((function(e){d(b.concat([e])),i("")}))}),[r,b,d]);return Object(a.jsxs)(m.a,{container:!0,spacing:2,children:[Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsxs)(W,{children:["QSL / ",Object(a.jsx)(j.b,{to:"/projects",children:"Projects"})]})}),Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsx)(re.a,{rows:b,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,renderCell:function(e){return Object(a.jsx)(j.b,{to:"/projects/".concat(e.value),children:e.value})}},{field:"name",headerName:"Name",flex:3},{field:"nImages",headerName:"Number of Images",flex:1},{field:"nLabeled",headerName:"Labeled Images",flex:1}]})}),Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsxs)(k.a,{children:[Object(a.jsx)(v.a,{value:r,onChange:function(e){return i(e.target.value)},style:{marginRight:"10px"}}),Object(a.jsx)(S.a,{variant:"contained",color:"primary",disabled:""===r,onClick:h,children:"Create Project"})]})})]})},Ge=function(){var e=c.useContext(Ue),t=c.useState(""),n=Object(s.a)(t,2),r=n[0],i=n[1],o=c.useState(!1),u=Object(s.a)(o,2),b=u[0],d=u[1],h=c.useState([]),f=Object(s.a)(h,2),O=f[0],x=f[1],p=c.useState(null),y=Object(s.a)(p,2),C=y[0],k=y[1],B=c.useState(null),w=Object(s.a)(B,2),I=w[0],E=w[1];c.useEffect((function(){fetch("".concat(e.apiUrl,"/api/v1/users/me"),Object(l.a)({},e.getHeaders)).then((function(e){return e.json()})).then(k)}),[]),c.useEffect((function(){fetch("".concat(e.apiUrl,"/api/v1/users"),Object(l.a)({},e.getHeaders)).then((function(e){return e.json()})).then(x)}),[]),c.useEffect((function(){fetch("".concat(e.apiUrl,"/api/v1/auth/config"),Object(l.a)({},e.getHeaders)).then((function(e){return e.json()})).then(E)}),[]);var N=c.useCallback((function(){fetch("".concat(e.apiUrl,"/api/v1/users"),Object(l.a)(Object(l.a)({},e.postHeaders),{},{body:JSON.stringify({name:r,isAdmin:b})})).then((function(e){return e.json()})).then((function(e){x(O.concat([e])),i("")}))}),[b,r,O,x]);return C&&I?Object(a.jsxs)(m.a,{container:!0,spacing:2,children:[Object(a.jsxs)(W,{children:["QSL / ",Object(a.jsx)(j.b,{to:"/users",children:"Users"})]}),Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsxs)(K.a,{variant:"body1",children:["github"===I.provider?"You are using GitHub as the authentication provider. Usernames should match GitHub usernames.":null,"google"===I.provider?"You are using Google as the authentication provider. Usernames should match email addresses.":null,null===I.provider?"You are not using an authentication provider. You will always be logged in as the first user.":null]})}),Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsx)(re.a,{rows:O,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,disableColumnMenu:!0},{field:"name",headerName:"Name",flex:5,disableColumnMenu:!0},{field:"isAdmin",headerName:"Adminstrator",flex:2,valueFormatter:function(e){return e.value?"Yes":"No"},disableColumnMenu:!0}]})}),Object(a.jsx)(m.a,{item:!0,xs:12,children:C.isAdmin?Object(a.jsxs)(m.a,{container:!0,direction:"row",children:[Object(a.jsx)(v.a,{value:r,onChange:function(e){return i(e.target.value)},placeholder:"New user name"}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:b,onChange:function(e,t){return d(t)},name:"makeAdmin"}),label:"Administrator"}),Object(a.jsx)(S.a,{disabled:""===r,onClick:N,children:"Create User"})]}):null})]}):null},Ke=n(144),qe=n.n(Ke),Ve=function(){var e=c.useContext(Ue),t=e.apiUrl,n=e.postHeaders,r=e.getHeaders,i=d.g().params.projectId,o=c.useState(null),u=Object(s.a)(o,2),b=u[0],h=u[1],f=c.useState([]),O=Object(s.a)(f,2),x=O[0],p=O[1],g=c.useState(null),v=Object(s.a)(g,2),y=v[0],C=v[1],k=c.useCallback((function(){return fetch("".concat(t,"/api/v1/projects/").concat(i,"/images"),Object(l.a)(Object(l.a)({},n),{},{body:JSON.stringify({files:x,defaults:y})})).then((function(){C(le(b)),p([])}))}),[b,x,y]);return c.useEffect((function(){fetch("".concat(t,"/api/v1/projects/").concat(i),Object(l.a)({},r)).then((function(e){return e.json()})).then((function(e){C(le(e)),h(e)}))}),[]),b?Object(a.jsxs)(m.a,{container:!0,spacing:2,children:[Object(a.jsxs)(m.a,{item:!0,xs:12,children:[Object(a.jsx)(j.b,{to:"/projects/".concat(i),children:Object(a.jsx)(K.a,{variant:"subtitle1",children:"Back to project menu"})}),Object(a.jsx)(K.a,{variant:"h5",children:"Add Files to Project"})]}),Object(a.jsx)(m.a,{item:!0,xs:6,children:Object(a.jsx)(qe.a,{label:"New Files",variant:"outlined",value:x,onPaste:function(e){e.preventDefault(),p(x.concat(e.clipboardData.getData("Text").split("\n").filter((function(e){return e.length>0}))))},onAdd:function(e){return p(x.concat([e]))},onDelete:function(e){return p(x.filter((function(t){return t!==e})))},fullWidth:!0})}),Object(a.jsxs)(m.a,{item:!0,xs:6,children:[Object(a.jsx)(K.a,{variant:"h6",children:"Defaults"}),Object(a.jsx)(T,{configGroup:b.labelingConfiguration.image,labels:y.image,setLabelGroup:function(e){return C(Object(l.a)(Object(l.a)({},y),{},{image:e}))}})]}),Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsx)(S.a,{onClick:k,disabled:0===x.length,style:{width:"100%"},variant:"contained",color:"primary",children:"Add Files"})})]}):null},We=function(){var e=d.g().params.projectId,t=c.useState([]),n=Object(s.a)(t,2),r=n[0],i=n[1],o=c.useState(null),l=Object(s.a)(o,2),u=l[0],b=l[1],h=c.useState(0),f=Object(s.a)(h,2),O=f[0],x=f[1],p=c.useState([]),g=Object(s.a)(p,2),v=g[0],y=g[1],C=c.useState(!1),k=Object(s.a)(C,2),B=k[0],w=k[1];if(c.useEffect((function(){je(e).then(b)}),[]),c.useEffect((function(){he(e,[],10,!1,!0,0).then(i)}),[e]),c.useEffect((function(){w(!0),he(e,[],15,!1,!1,-1,O+1).then((function(e){y(e),w(!1)}))}),[e,O]),!u)return null;var I,E=(I=u.labelingConfiguration,Object.keys(I.box.single).length>0||Object.keys(I.box.multiple).length>0||Object.keys(I.box.text).length>0||Object.keys(I.image.single).length>0||Object.keys(I.image.multiple).length>0||Object.keys(I.image.text).length>0);return Object(a.jsxs)(m.a,{container:!0,spacing:2,children:[Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsxs)(W,{project:u,children:["QSL / ",Object(a.jsx)(j.b,{to:"/projects",children:"Projects"})," /"," ",Object(a.jsx)(j.b,{to:"/projects/".concat(u.name),children:u.name})]})}),Object(a.jsx)(m.a,{item:!0,children:Object(a.jsxs)("ul",{children:[E&&v.length>0?Object(a.jsx)("li",{children:r.length>0?Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/images/").concat(r[0].id),children:Object(a.jsx)(K.a,{variant:"body1",children:"Start labeling individual images"})}):Object(a.jsx)(K.a,{variant:"body1",children:"No images remain for labeling."})}):null,E&&0!==v.length&&0!==r.length?Object(a.jsx)("li",{children:Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/batches/").concat(r.map((function(e){return e.id})).join(",")),children:Object(a.jsx)(K.a,{variant:"body1",children:"Start labeling image batches"})})}):null,Object(a.jsx)("li",{children:Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/edit-project"),children:Object(a.jsx)(K.a,{variant:"body1",children:E?"Edit project configuration":"Configure project"})})}),Object(a.jsx)("li",{children:Object(a.jsx)("a",{href:pe(e),children:Object(a.jsx)(K.a,{variant:"body1",children:"Export project"})})})]})}),Object(a.jsx)(m.a,{item:!0,xs:12,children:Object(a.jsx)(re.a,{rows:v,autoHeight:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,columns:[{field:"id",headerName:"ID",flex:1,disableColumnMenu:!0,renderCell:function(t){return Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/images/").concat(t.value),children:t.value})}},{field:"filepath",headerName:"Path",flex:5},{field:"labels",headerName:"# Labels",flex:1},{field:"status",headerName:"Status",renderCell:function(e){return Object(a.jsx)("span",{style:{textTransform:"capitalize"},children:e.value})},flex:1}],pagination:!0,pageSize:15,rowsPerPageOptions:[15],rowCount:u.nImages,paginationMode:"server",onPageChange:function(e){return x(e.page)},loading:B})}),Object(a.jsx)(m.a,{item:!0,children:Object(a.jsx)(S.a,{component:j.b,to:"/projects/".concat(e,"/add-images"),variant:"contained",color:"primary",disabled:!E,children:"Add Images"})})]})},Je=u.a({components:{MuiImageListItem:{styleOverrides:{img:{maxWidth:"100%",maxHeight:"100%",height:"auto",width:"auto",transform:"none",margin:"auto",position:"absolute",top:0,bottom:0,left:0,right:0}}}}}),Ye=function(){var e=c.useState({queueSize:20,apiUrl:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"",postHeaders:{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"},getHeaders:{credentials:"include"},user:void 0}),t=Object(s.a)(e,2),n=t[0],r=t[1];return c.useEffect((function(){fetch("".concat(n.apiUrl,"/api/v1/users/me"),Object(l.a)({},n.getHeaders)).then((function(e){if(e.ok)return e;throw Error(e.statusText)})).then((function(e){return e.json().then((function(e){r(Object(l.a)(Object(l.a)({},n),{},{user:e}))}))}),(function(){r(Object(l.a)(Object(l.a)({},n),{},{user:null}))}))}),[]),void 0===n.user?null:null===n.user?(window.location.href="".concat(n.apiUrl,"/auth/login"),null):Object(a.jsx)(Ue.Provider,{value:n,children:Object(a.jsx)(b.a,{theme:Je,children:Object(a.jsx)(j.a,{children:Object(a.jsxs)(d.d,{children:[Object(a.jsx)(d.b,{path:"/projects/:projectId/images/:imageId",children:Object(a.jsx)(Te,{})}),Object(a.jsx)(d.b,{path:"/projects/:projectId/batches/:imageIds",children:Object(a.jsx)(Se,{})}),Object(a.jsx)(d.b,{path:"/projects/:projectId/edit-project",children:Object(a.jsx)(_e,{})}),Object(a.jsx)(d.b,{path:"/projects/:projectId/add-images",children:Object(a.jsx)(Ve,{})}),Object(a.jsx)(d.b,{path:"/projects/:projectId",children:Object(a.jsx)(We,{})}),Object(a.jsx)(d.b,{path:"/projects",children:Object(a.jsx)(Fe,{})}),Object(a.jsx)(d.b,{path:"/users",children:Object(a.jsx)(Ge,{})}),Object(a.jsx)(d.b,{path:"/",children:Object(a.jsx)(d.a,{to:"/projects"})})]})})})})};n(198);o.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(Ye,{})}),document.getElementById("root"))}},[[199,1,2]]]);
//# sourceMappingURL=main.8b86f3de.chunk.js.map